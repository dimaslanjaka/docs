<!DOCTYPE html><html lang="en"><head>
    <title>Code coverage report for gulp.feed.ts</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="prettify.css">
    <link rel="stylesheet" href="base.css">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        .coverage-summary .sorter {
            background-image: url(sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class="wrapper">
    <div class="pad1">
        <h1><a href="index.html">All files</a> gulp.feed.ts</h1>
        <div class="clearfix">
            
            <div class="fl pad1y space-right2">
                <span class="strong">15.05% </span>
                <span class="quiet">Statements</span>
                <span class="fraction">14/93</span>
            </div>
        
            
            <div class="fl pad1y space-right2">
                <span class="strong">100% </span>
                <span class="quiet">Branches</span>
                <span class="fraction">0/0</span>
            </div>
        
            
            <div class="fl pad1y space-right2">
                <span class="strong">100% </span>
                <span class="quiet">Functions</span>
                <span class="fraction">0/0</span>
            </div>
        
            
            <div class="fl pad1y space-right2">
                <span class="strong">15.05% </span>
                <span class="quiet">Lines</span>
                <span class="fraction">14/93</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input oninput="onInput()" type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class="status-line low"></div>
    <pre><table class="coverage">
<tbody><tr><td class="line-count quiet"><a name="L1"></a><a href="#L1">1</a>
<a name="L2"></a><a href="#L2">2</a>
<a name="L3"></a><a href="#L3">3</a>
<a name="L4"></a><a href="#L4">4</a>
<a name="L5"></a><a href="#L5">5</a>
<a name="L6"></a><a href="#L6">6</a>
<a name="L7"></a><a href="#L7">7</a>
<a name="L8"></a><a href="#L8">8</a>
<a name="L9"></a><a href="#L9">9</a>
<a name="L10"></a><a href="#L10">10</a>
<a name="L11"></a><a href="#L11">11</a>
<a name="L12"></a><a href="#L12">12</a>
<a name="L13"></a><a href="#L13">13</a>
<a name="L14"></a><a href="#L14">14</a>
<a name="L15"></a><a href="#L15">15</a>
<a name="L16"></a><a href="#L16">16</a>
<a name="L17"></a><a href="#L17">17</a>
<a name="L18"></a><a href="#L18">18</a>
<a name="L19"></a><a href="#L19">19</a>
<a name="L20"></a><a href="#L20">20</a>
<a name="L21"></a><a href="#L21">21</a>
<a name="L22"></a><a href="#L22">22</a>
<a name="L23"></a><a href="#L23">23</a>
<a name="L24"></a><a href="#L24">24</a>
<a name="L25"></a><a href="#L25">25</a>
<a name="L26"></a><a href="#L26">26</a>
<a name="L27"></a><a href="#L27">27</a>
<a name="L28"></a><a href="#L28">28</a>
<a name="L29"></a><a href="#L29">29</a>
<a name="L30"></a><a href="#L30">30</a>
<a name="L31"></a><a href="#L31">31</a>
<a name="L32"></a><a href="#L32">32</a>
<a name="L33"></a><a href="#L33">33</a>
<a name="L34"></a><a href="#L34">34</a>
<a name="L35"></a><a href="#L35">35</a>
<a name="L36"></a><a href="#L36">36</a>
<a name="L37"></a><a href="#L37">37</a>
<a name="L38"></a><a href="#L38">38</a>
<a name="L39"></a><a href="#L39">39</a>
<a name="L40"></a><a href="#L40">40</a>
<a name="L41"></a><a href="#L41">41</a>
<a name="L42"></a><a href="#L42">42</a>
<a name="L43"></a><a href="#L43">43</a>
<a name="L44"></a><a href="#L44">44</a>
<a name="L45"></a><a href="#L45">45</a>
<a name="L46"></a><a href="#L46">46</a>
<a name="L47"></a><a href="#L47">47</a>
<a name="L48"></a><a href="#L48">48</a>
<a name="L49"></a><a href="#L49">49</a>
<a name="L50"></a><a href="#L50">50</a>
<a name="L51"></a><a href="#L51">51</a>
<a name="L52"></a><a href="#L52">52</a>
<a name="L53"></a><a href="#L53">53</a>
<a name="L54"></a><a href="#L54">54</a>
<a name="L55"></a><a href="#L55">55</a>
<a name="L56"></a><a href="#L56">56</a>
<a name="L57"></a><a href="#L57">57</a>
<a name="L58"></a><a href="#L58">58</a>
<a name="L59"></a><a href="#L59">59</a>
<a name="L60"></a><a href="#L60">60</a>
<a name="L61"></a><a href="#L61">61</a>
<a name="L62"></a><a href="#L62">62</a>
<a name="L63"></a><a href="#L63">63</a>
<a name="L64"></a><a href="#L64">64</a>
<a name="L65"></a><a href="#L65">65</a>
<a name="L66"></a><a href="#L66">66</a>
<a name="L67"></a><a href="#L67">67</a>
<a name="L68"></a><a href="#L68">68</a>
<a name="L69"></a><a href="#L69">69</a>
<a name="L70"></a><a href="#L70">70</a>
<a name="L71"></a><a href="#L71">71</a>
<a name="L72"></a><a href="#L72">72</a>
<a name="L73"></a><a href="#L73">73</a>
<a name="L74"></a><a href="#L74">74</a>
<a name="L75"></a><a href="#L75">75</a>
<a name="L76"></a><a href="#L76">76</a>
<a name="L77"></a><a href="#L77">77</a>
<a name="L78"></a><a href="#L78">78</a>
<a name="L79"></a><a href="#L79">79</a>
<a name="L80"></a><a href="#L80">80</a>
<a name="L81"></a><a href="#L81">81</a>
<a name="L82"></a><a href="#L82">82</a>
<a name="L83"></a><a href="#L83">83</a>
<a name="L84"></a><a href="#L84">84</a>
<a name="L85"></a><a href="#L85">85</a>
<a name="L86"></a><a href="#L86">86</a>
<a name="L87"></a><a href="#L87">87</a>
<a name="L88"></a><a href="#L88">88</a>
<a name="L89"></a><a href="#L89">89</a>
<a name="L90"></a><a href="#L90">90</a>
<a name="L91"></a><a href="#L91">91</a>
<a name="L92"></a><a href="#L92">92</a>
<a name="L93"></a><a href="#L93">93</a>
<a name="L94"></a><a href="#L94">94</a></td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';
import gulp from 'gulp';
import gulpDom from 'gulp-dom';
import hexo from 'hexo';
import { full_url_for, gravatar } from 'hexo-util';
import nunjucks from 'nunjucks';
import { join } from 'upath';
import envNunjucks from './utils/nunjucks-env';
import { commonIgnore, getConfig } from './_config';
&nbsp;
const env = envNunjucks();
&nbsp;
gulp.task('feed', function (done) {
<span class="cstat-no" title="statement not covered">  const config = getConfig();</span>
<span class="cstat-no" title="statement not covered">  const instance = new hexo(config.cwd);</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">  instance.init().then(() =&gt; {</span>
<span class="cstat-no" title="statement not covered">    instance.load().then(() =&gt; {</span>
<span class="cstat-no" title="statement not covered">      env.addFilter('formatUrl', (str) =&gt; {</span>
<span class="cstat-no" title="statement not covered">        return full_url_for.call(instance, str);</span>
<span class="cstat-no" title="statement not covered">      });</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {</span>
<span class="cstat-no" title="statement not covered">        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        let posts = instance.locals.get('posts');</span>
<span class="cstat-no" title="statement not covered">        posts = posts.sort('-date');</span>
<span class="cstat-no" title="statement not covered">        posts = posts.filter((post) =&gt; {</span>
<span class="cstat-no" title="statement not covered">          return post.draft !== true;</span>
<span class="cstat-no" title="statement not covered">        });</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        const { email, feed, url: urlCfg } = config;</span>
<span class="cstat-no" title="statement not covered">        const { icon: iconCfg } = feed;</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        let url = urlCfg;</span>
<span class="cstat-no" title="statement not covered">        if (url[url.length - 1] !== '/') url += '/';</span>
<span class="cstat-no" title="statement not covered">        // remove broken hexo lang shortcode</span>
<span class="cstat-no" title="statement not covered">        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        let icon = '';</span>
<span class="cstat-no" title="statement not covered">        if (iconCfg) icon = full_url_for.call(instance, iconCfg);</span>
<span class="cstat-no" title="statement not covered">        else if (email) icon = gravatar(email, {});</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        const feed_url = full_url_for.call(instance, 'rss.xml');</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        const data = template.render({</span>
<span class="cstat-no" title="statement not covered">          config,</span>
<span class="cstat-no" title="statement not covered">          url,</span>
<span class="cstat-no" title="statement not covered">          icon,</span>
<span class="cstat-no" title="statement not covered">          posts,</span>
<span class="cstat-no" title="statement not covered">          feed_url</span>
<span class="cstat-no" title="statement not covered">        });</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">        writeFileSync(dest, data);</span>
<span class="cstat-no" title="statement not covered">      }</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">      const templateRSS = join(__dirname, '_config_template_rss.xml');</span>
<span class="cstat-no" title="statement not covered">      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');</span>
<span class="cstat-no" title="statement not covered">      build(templateRSS, destRSS);</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">      const templateATOM = join(__dirname, '_config_template_atom.xml');</span>
<span class="cstat-no" title="statement not covered">      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');</span>
<span class="cstat-no" title="statement not covered">      build(templateATOM, destATOM);</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';</span>
<span class="cstat-no" title="statement not covered"></span>
<span class="cstat-no" title="statement not covered">      const publicDir = join(config.cwd, config.public_dir);</span>
<span class="cstat-no" title="statement not covered">      gulp</span>
<span class="cstat-no" title="statement not covered">        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })</span>
<span class="cstat-no" title="statement not covered">        .pipe(</span>
<span class="cstat-no" title="statement not covered">          gulpDom(function () {</span>
<span class="cstat-no" title="statement not covered">            // auto discovery rss</span>
<span class="cstat-no" title="statement not covered">            if (</span>
<span class="cstat-no" title="statement not covered">              this.querySelectorAll(`link[href="${baseURL}rss.xml"]`).length === 0 &amp;&amp;</span>
<span class="cstat-no" title="statement not covered">              this.querySelectorAll(`link[href="/rss.xml"]`).length === 0</span>
<span class="cstat-no" title="statement not covered">            ) {</span>
<span class="cstat-no" title="statement not covered">              this.head.innerHTML += `&lt;link id="rss-site-url" type="application/rss+xml" rel="alternate" href="${baseURL}rss.xml" /&gt;`;</span>
<span class="cstat-no" title="statement not covered">            }</span>
<span class="cstat-no" title="statement not covered">            // auto discovery atom</span>
<span class="cstat-no" title="statement not covered">            if (</span>
<span class="cstat-no" title="statement not covered">              this.querySelectorAll(`link[href="${baseURL}atom.xml"]`).length === 0 &amp;&amp;</span>
<span class="cstat-no" title="statement not covered">              this.querySelectorAll(`link[href="/atom.xml"]`).length === 0</span>
<span class="cstat-no" title="statement not covered">            ) {</span>
<span class="cstat-no" title="statement not covered">              this.head.innerHTML += `&lt;link id="atom-site-url" type="application/atom+xml" rel="alternate" href="${baseURL}atom.xml" /&gt;`;</span>
<span class="cstat-no" title="statement not covered">            }</span>
<span class="cstat-no" title="statement not covered">            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');</span>
<span class="cstat-no" title="statement not covered">          })</span>
<span class="cstat-no" title="statement not covered">        )</span>
<span class="cstat-no" title="statement not covered">        .pipe(gulp.dest(publicDir))</span>
<span class="cstat-no" title="statement not covered">        .once('end', () =&gt; done());</span>
<span class="cstat-no" title="statement not covered">    });</span>
<span class="cstat-no" title="statement not covered">  });</span>
});
&nbsp;</pre></td></tr></tbody></table></pre>

                <div class="push"></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class="footer quiet pad2 space-top1 center small">
                Code coverage generated by
                <a href="https://www.webmanajemen.com/page/safelink.html?url=aHR0cHM6Ly9pc3RhbmJ1bC5qcy5vcmcv" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2023-01-10T04:11:12.969Z
            </div>
        <script src="prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="sorter.js"></script>
        <script src="block-navigation.js"></script>
    

    </body></html>