window.jest_html_reporters_callback__({"numFailedTestSuites":0,"numFailedTests":0,"numPassedTestSuites":4,"numPassedTests":23,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":4,"numTotalTests":23,"startTime":1673322408831,"success":false,"testResults":[{"leaks":false,"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673322418871,"runtime":9984,"slow":true,"start":1673322408887},"skipped":false,"testFilePath":"/home/runner/work/static-blog-generator/static-blog-generator/test/copy-with-mapper.test.ts","testResults":[{"ancestorTitles":["test copy post with label mapper","clean"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["test copy post with label mapper","clean"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["test copy post with label mapper","copy"],"duration":2110,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["test copy post with label mapper","copy"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"},{"ancestorTitles":["test copy post with label mapper","validate mapped"],"duration":12,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper validate mapped label lowercase","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"label lowercase"},{"ancestorTitles":["test copy post with label mapper","validate mapped"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper validate mapped label assign (add label based on config.tags|categories.assign key)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"label assign (add label based on config.tags|categories.assign key)"},{"ancestorTitles":["test copy post with label mapper","validate mapped"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper validate mapped label mapper (label replacer)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"label mapper (label replacer)"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.util = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nexports.util = __importStar(require(\"./utils\"));\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0M7QUFBdEMsbUhBQUEsT0FBTyxPQUFlO0FBQy9CLHNEQUFnRTtBQUF2RCx5SEFBQSxPQUFPLE9BQWM7QUFDOUIsc0RBQStEO0FBQXRELHdIQUFBLE9BQU8sT0FBYTtBQUM3QiwyQ0FBOEQ7QUFBckQscUdBQUEsT0FBTyxPQUFBO0FBQUUsaUdBQUEsR0FBRyxPQUFBO0FBQUUsdUdBQUEsR0FBRyxPQUFhO0FBQ3ZDLHVDQUFnRDtBQUF2QyxtR0FBQSxPQUFPLE9BQVc7QUFDM0IsK0NBQXNFO0FBQTdELCtHQUFBLGVBQWUsT0FBQTtBQUFFLG1IQUFBLG1CQUFtQixPQUFBO0FBQzdDLHFEQUFnRTtBQUF2RCxvSUFBQSxPQUFPLE9BQW9CO0FBQ3BDLHVDQUE0RDtBQUFuRCx5R0FBQSxhQUFhLE9BQUE7QUFBRSxpSEFBQSxPQUFPLE9BQVE7QUFDdkMsb0NBQTJEO0FBQWxELG9HQUFBLFlBQVksT0FBQTtBQUFFLHNHQUFBLGNBQWMsT0FBQTtBQUNyQyx3Q0FBMkM7QUFBbEMsb0dBQUEsVUFBVSxPQUFBO0FBQ25CLGdEQUFnQztBQUNoQyx1Q0FBK0U7QUFBdEUscUdBQUEsWUFBWSxPQUFBO0FBQUUsMkdBQUEsa0JBQWtCLE9BQUE7QUFBRSxxR0FBQSxZQUFZLE9BQUE7QUFDdkQscUNBQW9DO0FBQTNCLDRGQUFBLElBQUksT0FBQTtBQUNiLCtDQUF5RDtBQUFoRCx1SEFBQSxPQUFPLE9BQWE7QUFDN0IscUNBQStEO0FBQXRELHVHQUFBLFlBQVksT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUUzQyxFQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGRlZmF1bHQgYXMgQXBwbGljYXRpb24gfSBmcm9tICcuL2FwaSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBDYWNoZWQgfSBmcm9tICcuL2d1bHAtdXRpbHMvZ3VscC5jYWNoZSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBEZWJ1ZyB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmRlYnVnJztcbmV4cG9ydCB7IGNsZWFuRGIsIGRlbCwgZGVsIGFzIGRlbGV0ZURpciB9IGZyb20gJy4vZ3VscC5jbGVhbic7XG5leHBvcnQgeyB0YXNrU2VvIGFzIGF1dG9TZW8gfSBmcm9tICcuL2d1bHAuc2VvJztcbmV4cG9ydCB7IGdlbmVyYXRlU2l0ZW1hcCwgaGV4b0dlbmVyYXRlU2l0ZW1hcCB9IGZyb20gJy4vZ3VscC5zaXRlbWFwJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc3RhbmRhbG9uZVJ1bm5lciB9IGZyb20gJy4vZ3VscC5zdGFuZGFsb25lJztcbmV4cG9ydCB7IGNvbW1pdFByb2plY3QsIGRlZmF1bHQgYXMgZ3VscCB9IGZyb20gJy4vZ3VscGZpbGUnO1xuZXhwb3J0IHsgY29weUFsbFBvc3RzLCBjb3B5U2luZ2xlUG9zdCB9IGZyb20gJy4vcG9zdC9jb3B5JztcbmV4cG9ydCB7IHVwZGF0ZVBvc3QgfSBmcm9tICcuL3Bvc3QvdXBkYXRlJztcbmV4cG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlscyc7XG5leHBvcnQgeyBhcnJheV9yYW5kb20sIGFycmF5X3JlbW92ZV9lbXB0eSwgYXJyYXlfdW5pcXVlIH0gZnJvbSAnLi91dGlscy9hcnJheSc7XG5leHBvcnQgeyBub29wIH0gZnJvbSAnLi91dGlscy9ub29wJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc2NoZWR1bGVyIH0gZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuZXhwb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8vXG4iXSwidmVyc2lvbiI6M30=","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport * as util from './utils';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/09/index_09c0a821b29a6a45121212479559f319.map","wrapperLength":82},"result":{"scriptId":"2606","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":7904,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":7901,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1179,"endOffset":1260,"count":2},{"startOffset":1237,"endOffset":1257,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1946,"endOffset":2000,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2130,"endOffset":2191,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2320,"endOffset":2381,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2497,"endOffset":2541,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2609,"endOffset":2649,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2723,"endOffset":2763,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2875,"endOffset":2917,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3045,"endOffset":3099,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3183,"endOffset":3241,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3376,"endOffset":3442,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3560,"endOffset":3608,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3677,"endOffset":3736,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3850,"endOffset":3893,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3972,"endOffset":4017,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4133,"endOffset":4176,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4342,"endOffset":4386,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4469,"endOffset":4519,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4596,"endOffset":4640,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4747,"endOffset":4782,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4904,"endOffset":4964,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5079,"endOffset":5125,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5199,"endOffset":5242,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5316,"endOffset":5359,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar chain_1 = require(\"./utils/chain\");\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = (0, _config_1.getConfig)();\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, chain_1.chain)([{ callback: gulp_standalone_1.default }]); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, _this.config.public_dir)); };\n        /**\n         * Copy all **src-post** to **source/_posts** (run before generate)\n         * * see the method {@link pcopy.copyAllPosts}\n         * @returns\n         */\n        this.copy = function () { return (0, chain_1.chain)([{ callback: function () { return pcopy.copyAllPosts(undefined, _this.config); } }]); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        this.cwd = cwd;\n        (0, _config_1.fetchConfig)(cwd);\n        options = Object.assign(this.config, options || {}, { cwd: cwd });\n        this.config = (0, _config_1.setConfig)(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 3:\n                        if (!(opt === 'archive')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 5:\n                        if (!(opt === 'post')) return [3 /*break*/, 7];\n                        return [4 /*yield*/, cleaner.cleanGeneratedPosts().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 7: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 8:\n                        _a.sent();\n                        _a.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBd0I7QUFDeEIsK0JBQTZCO0FBRTdCLG9EQUF3QztBQUN4QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsdUNBQXNDO0FBQ3RDLHNEQUFnQztBQUNoQyxnRUFBMEM7QUFDMUMscUNBQThEO0FBRTlEO0lBTUU7OztPQUdHO0lBQ0gsYUFBWSxHQUFxQixFQUFFLE9BQXlDO1FBQTVFLGlCQVNDO1FBakJELFdBQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztRQUNyQixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQUN0QixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQXlCdEI7OztXQUdHO1FBQ0gsZUFBVSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLHlCQUFnQixFQUFFLENBQUMsQ0FBQyxFQUF2QyxDQUF1QyxDQUFDO1FBRTNEOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBckQsQ0FBcUQsQ0FBQztRQUVsRTs7OztXQUlHO1FBQ0gsU0FBSSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLGNBQU0sT0FBQSxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQTFDLENBQTBDLEVBQUUsQ0FBQyxDQUFDLEVBQXZFLENBQXVFLENBQUM7UUFFckY7OztX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RCxrQkFBZSxHQUFHLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIZXhvIGZyb20gJ2hleG8nO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IE51bGxhYmxlIH0gZnJvbSAnLi9nbG9iYWxzJztcbmltcG9ydCAqIGFzIGNsZWFuZXIgZnJvbSAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgeyBjaGFpbiB9IGZyb20gJy4vdXRpbHMvY2hhaW4nO1xuaW1wb3J0IG5vb3AgZnJvbSAnLi91dGlscy9ub29wJztcbmltcG9ydCBzY2hlZHVsZXIgZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuaW1wb3J0IHsgZmV0Y2hDb25maWcsIGdldENvbmZpZywgc2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY2xhc3MgU0JHIHtcbiAgY3dkOiBzdHJpbmc7XG4gIGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBmZXRjaENvbmZpZyhjd2QpO1xuICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlnLCBvcHRpb25zIHx8IHt9LCB7IGN3ZCB9KTtcblxuICAgIHRoaXMuY29uZmlnID0gc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBjaGFpbihbeyBjYWxsYmFjazogc3RhbmRhbG9uZVJ1bm5lciB9XSk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCB0aGlzLmNvbmZpZy5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSA9ICgpID0+IGNoYWluKFt7IGNhbGxiYWNrOiAoKSA9PiBwY29weS5jb3B5QWxsUG9zdHModW5kZWZpbmVkLCB0aGlzLmNvbmZpZykgfV0pO1xuXG4gIC8qKlxuICAgKiBBbm9ueW1pemUgZXh0ZXJuYWwgbGlua3Mgb24gcHVibGljIGRpciAoX2NvbmZpZ195bWwucHVibGljX2RpcikgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBzYWZlbGluayA9ICgpID0+IHRhc2tTYWZlbGluayhub29wLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIGdlbmVyYXRlIHNpdGUgd2l0aCBoZXhvXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZSgpIHtcbiAgICBjb25zdCBoZXhvID0gbmV3IEhleG8odGhpcy5jd2QpO1xuICAgIC8vIGhleG8gaW5pdFxuICAgIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8ubG9hZCgpLmNhdGNoKG5vb3ApO1xuICAgIC8vIGhleG8gZ2VuZXJhdGVcbiAgICBhd2FpdCBoZXhvLmNhbGwoJ2dlbmVyYXRlJykuY2F0Y2gobm9vcCk7XG4gICAgYXdhaXQgaGV4by5leGl0KCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlJyB8ICdkYXRhYmFzZScgfCAncG9zdCcpIHtcbiAgICBpZiAob3B0ID09PSAnYWxsJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbkRiKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSBpZiAob3B0ID09PSAnYXJjaGl2ZScpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ3Bvc3QnKSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuR2VuZXJhdGVkUG9zdHMoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU0JHO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport { chain } from './utils/chain';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { fetchConfig, getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = getConfig();\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    this.cwd = cwd;\n    fetchConfig(cwd);\n    options = Object.assign(this.config, options || {}, { cwd });\n\n    this.config = setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => chain([{ callback: standaloneRunner }]);\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, this.config.public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy = () => chain([{ callback: () => pcopy.copyAllPosts(undefined, this.config) }]);\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archive' | 'database' | 'post') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archive') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'post') {\n      await cleaner.cleanGeneratedPosts().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/a8/api_a829825f326b4691c16e18cc91565c70.map","wrapperLength":82},"result":{"scriptId":"2607","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":16899,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":16896,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":7},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":4},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":3},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":3},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":5},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":5},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":4},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4395,"endOffset":9162,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4488,"endOffset":6135,"count":1},{"startOffset":5851,"endOffset":5871,"count":0},{"startOffset":5990,"endOffset":5995,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4847,"endOffset":4932,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5078,"endOffset":5186,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.copy","ranges":[{"startOffset":5383,"endOffset":5510,"count":1}],"isBlockCoverage":true},{"functionName":"callback","ranges":[{"startOffset":5436,"endOffset":5503,"count":1}],"isBlockCoverage":true},{"functionName":"SBG.safelink","ranges":[{"startOffset":5677,"endOffset":5819,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":6153,"endOffset":6206,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":6225,"endOffset":6276,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6354,"endOffset":7447,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":7618,"endOffset":9143,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7682,"endOffset":9135,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7733,"endOffset":9123,"count":5},{"startOffset":7805,"endOffset":7967,"count":1},{"startOffset":7883,"endOffset":7967,"count":0},{"startOffset":7988,"endOffset":8123,"count":0},{"startOffset":8144,"endOffset":8235,"count":0},{"startOffset":8256,"endOffset":8431,"count":1},{"startOffset":8338,"endOffset":8431,"count":0},{"startOffset":8452,"endOffset":8543,"count":0},{"startOffset":8564,"endOffset":8739,"count":1},{"startOffset":8643,"endOffset":8739,"count":0},{"startOffset":8760,"endOffset":8851,"count":0},{"startOffset":8872,"endOffset":8939,"count":1},{"startOffset":8960,"endOffset":9040,"count":1},{"startOffset":9061,"endOffset":9091,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHNEQUFnQztBQUNoQyxxQ0FBOEQ7QUFDOUQsOENBQXdCO0FBQ3hCLHlCQUF5QjtBQUN6QiwrQkFBNkI7QUFDN0IsNkJBQStCO0FBQy9CLHdEQUFrQztBQUNsQyxpQ0FBdUM7QUFDdkMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyxxQ0FBc0M7QUFFdEM7O0dBRUc7QUFDSCxTQUFzQixPQUFPLENBQUMsUUFBa0QsRUFBRSxLQUFnQjs7Ozs7O29CQUMxRixHQUFHLEdBQUcsSUFBQSxlQUFLLEVBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3JCLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztvQkFDM0IsSUFBSSxPQUFPLE1BQU0sQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFO3dCQUN6QyxJQUFBLGNBQVMsRUFBQyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHNCQUFzQixDQUFDLEVBQUUsSUFBQSxjQUFPLEVBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzt3QkFDckUsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO3FCQUN6RDtvQkFJRyxJQUFJLEdBQUc7d0JBQ1QsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQzt3QkFDN0MsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxXQUFXLENBQUM7d0JBQzdCLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDO3dCQUM1QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxF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QUUsZ0JBQWdCLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvQixjQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0FBQzdDLGNBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGNBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZGRpciwgcm0sIFJtT3B0aW9ucyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IGluc3BlY3QgfSBmcm9tICd1dGlsJztcbmltcG9ydCBkZWJ1ZyBmcm9tICcuL3V0aWxzL2RlYnVnJztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBDbGVhbiBQcm9qZWN0IERhdGFiYXNlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5EYihjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSwgZmlsZXM/OiBzdHJpbmdbXSkge1xuICBjb25zdCBsb2cgPSBkZWJ1ZygnY2xlYW4nKTtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGlmICh0eXBlb2YgY29uZmlnLnNvdXJjZV9kaXIgIT09ICdzdHJpbmcnKSB7XG4gICAgd3JpdGVmaWxlKGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvY2xlYW4ubG9nJyksIGluc3BlY3QoY29uZmlnKSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjb25maWcuc291cmNlX2RpciBtdXN0IGJlIGNvbmZpZ3VyZWQnKTtcbiAgfVxuXG4gIC8vIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuXG4gIGxldCBkaXJzID0gW1xuICAgIGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnNvdXJjZV9kaXIsICdfcG9zdHMnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvY2FjaGUnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvZHVtcCcpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9sb2dzJyksXG4gICAgam9pbihjb25maWcuY3dkLCAnZGIuanNvbicpXG4gIF07XG4gIGlmIChBcnJheS5pc0FycmF5KGZpbGVzKSkgZGlycyA9IGRpcnMuY29uY2F0KGZpbGVzKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZGlyID0gZGlyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICBsb2coJ2NsYW5pbmcnLCBkaXIpO1xuICAgICAgICBhd2FpdCBkZWwoZGlyKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIGxvZygnY2Fubm90IGRlbGV0ZScsIGRpcik7XG4gICAgfVxuICB9XG5cbiAgLypjb25zdCBoZXhvID0gbmV3IGhleG9MaWIoY29uZmlnLmN3ZCk7XG4gIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICBhd2FpdCBoZXhvLmNhbGwoJ2NsZWFuJykuY2F0Y2gobm9vcCk7Ki9cblxuICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSByZXR1cm4gY2FsbGJhY2soKTtcblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIGRlbGV0ZSBmb2xkZXIgYXN5bmNcbiAqIEBwYXJhbSBwYXRoXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsKHBhdGg6IHN0cmluZykge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgcm1PcHQ6IFJtT3B0aW9ucyA9IHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9O1xuICAgIGlmIChleGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIC8qaWYgKHN0YXRTeW5jKHBhdGgpLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgcm1kaXIocGF0aCwgeyBtYXhSZXRyaWVzOiAxMCB9KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm0ocGF0aCwgcm1PcHQpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9Ki9cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzb2x2ZShuZXcgRXJyb3IocGF0aCArICcgbm90IGZvdW5kJykpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogY2xlYW4gb2xkIGFyY2hpdmVzIChjYXRlZ29yaWVzLCB0YWdzLCBwYWdpbmF0aW9uKSBmcm9tIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbk9sZEFyY2hpdmVzKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCBsb2duYW1lID0gJ2NsZWFuOicgKyBhbnNpQ29sb3JzLmdyZXkoJ2FyY2hpdmVzJyk7XG5cbiAgLy8gY2xlYW4gYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNcbiAgY29uc3QgYXJjaGl2ZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuYXJjaGl2ZV9kaXIpO1xuICBjb25zdCBjYXRlZ29yaWVzID0gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgY29uZmlnLmNhdGVnb3J5X2Rpcik7XG4gIGNvbnN0IHRhZ3MgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcudGFnX2Rpcik7XG4gIGNvbnN0IGZvbGRlcnMgPSBbYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNdLmZpbHRlcigoc3RyKSA9PiBleGlzdHNTeW5jKHN0cikpO1xuXG4gIC8vIHB1c2ggbGFuZ3VhZ2UgZm9sZGVyIHRvIGJlIGRlbGV0ZWQgZnJvbSBkZXBsb3kgZGlyXG4gIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5sYW5ndWFnZSkpIHtcbiAgICBjb25zdCBsYW5nRGlyID0gY29uZmlnLmxhbmd1YWdlLm1hcCgocGF0aCkgPT4gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgcGF0aCkpO1xuICAgIGZvbGRlcnMucHVzaCguLi5sYW5nRGlyKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnLmxhbmd1YWdlID09PSAnc3RyaW5nJyAmJiBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgIGZvbGRlcnMucHVzaChqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKSkpO1xuICB9XG5cbiAgLy8gZGVsZXRlIHBhZ2luYXRpb25cbiAgY29uc3QgcGFnZXNEaXIgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCAncGFnZScpO1xuICBpZiAoZXhpc3RzU3luYyhwYWdlc0RpcikpIHtcbiAgICBjb25zdCBwYWdlcyA9IChhd2FpdCByZWFkZGlyKHBhZ2VzRGlyKSkuZmlsdGVyKChzdHIpID0+IC9eXFxkKyQvLnRlc3Qoc3RyKSkubWFwKChzdHIpID0+IGpvaW4ocGFnZXNEaXIsIHN0cikpO1xuICAgIGZvbGRlcnMucHVzaCguLi5wYWdlcyk7XG4gIH1cblxuICBjb25zdCBwcm9taXNlczogUHJvbWlzZTxhbnk+W10gPSBbXTtcblxuICAvLyBkdW1wIHRvIGZpbGVcbiAgY29uc3QgZHVtcGZpbGUgPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9jbGVhbi50eHQnKTtcbiAgd3JpdGVmaWxlKGR1bXBmaWxlLCBmb2xkZXJzLmpvaW4oRU9MKSk7XG4gIExvZ2dlci5sb2cobG9nbmFtZSwgJ2xpc3QgZGVsZXRlZCBmaWxlcycsIGR1bXBmaWxlKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGZvbGRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBwYXRoU3RyID0gZm9sZGVyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMocGF0aFN0cikpIHByb21pc2VzLnB1c2goZGVsKHBhdGhTdHIpLmNhdGNoKG5vb3ApKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuICB9XG5cbiAgY29uc3QgZmluaXNoTm93ID0gZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjbGVhbiBhcmNoaXZlcyBoYXMgc29tZSBlcnJvcycpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSBjYWxsYmFjaygpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgYXdhaXQgQmx1ZWJpcmQuYWxsKHByb21pc2VzKS50aGVuKGZpbmlzaE5vdykuY2F0Y2goZmluaXNoTm93KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuR2VuZXJhdGVkUG9zdHMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIHJldHVybiBjbGVhbkRiKGNhbGxiYWNrLCBbam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpXSk7XG59XG5cbmd1bHAudGFzaygnY2xlYW46YXJjaGl2ZScsIGNsZWFuT2xkQXJjaGl2ZXMpO1xuZ3VscC50YXNrKCdjbGVhbjpkYicsIGNsZWFuRGIpO1xuZ3VscC50YXNrKCdjbGVhbjpwb3N0JywgY2xlYW5HZW5lcmF0ZWRQb3N0cyk7XG5ndWxwLnRhc2soJ2NsZWFuOmFsbCcsIGd1bHAuc2VyaWVzKCdjbGVhbjpkYicsICdjbGVhbjphcmNoaXZlJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/6b/gulpclean_6b5cfe0a3f5f375b9d7210604d22c51b.map","wrapperLength":82},"result":{"scriptId":"3146","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24224,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24221,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":1},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":1},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":2},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":1},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":2},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":24},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":2},{"startOffset":1626,"endOffset":1648,"count":2},{"startOffset":1665,"endOffset":1721,"count":1},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":21},{"startOffset":1934,"endOffset":1952,"count":9},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":20},{"startOffset":2051,"endOffset":2084,"count":9},{"startOffset":2087,"endOffset":2114,"count":15},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":4},{"startOffset":5865,"endOffset":5958,"count":1},{"startOffset":5975,"endOffset":6047,"count":1},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":1},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = exports.fetchConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexoPostParser = __importStar(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nfunction fetchConfig(fileYML) {\n    if (!fileYML.endsWith('_config.yml'))\n        fileYML += '/_config.yml';\n    var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n    setConfig((0, object_1.orderKeys)(configYML));\n    (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\nexports.fetchConfig = fetchConfig;\nfetchConfig((0, path_1.join)(process.cwd(), '_config.yml'));\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign(settledConfig || {}, obj);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nfunction getConfig() {\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : { submodule: [] };\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvX2NvbmZpZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBOEM7QUFDOUMsMEVBQXFDO0FBRXJDLCtEQUFtRDtBQUNuRCw2QkFBNEI7QUFDNUIsOENBQXdCO0FBQ3hCLHVDQUE4QztBQUM5QyxpQ0FBdUM7QUFDdkMseUNBQTJDO0FBNEQzQyxJQUFJLGFBQWEsR0FBRyxJQUFBLDJCQUFnQixHQUF5QixDQUFDO0FBRTlELFNBQWdCLFdBQVcsQ0FBQyxPQUFlO0lBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztRQUFFLE9BQU8sSUFBSSxjQUFjLENBQUM7SUFDaEUsSUFBTSxTQUFTLEdBQUcsY0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDN0QsU0FBUyxDQUFDLElBQUEsa0JBQVMsRUFBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqRixDQUFDO0FBTEQsa0NBS0M7QUFFRCxXQUFXLENBQUMsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFFaEQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRXhELGlDQUFpQztJQUNqQyxjQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sU0FBUyxFQUFFLENBQUM7QUFDckIsQ0FBQztBQU5ELDhCQU1DO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVM7SUFDdkIsYUFBYSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLElBQUksRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDakYsOEZBQThGO0lBQzlGLE9BQU8sYUFBeUIsQ0FBQztBQUNuQyxDQUFDO0FBSkQsOEJBSUM7QUFFRCxTQUFnQixZQUFZOztJQUMxQixJQUFNLFNBQVMsR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLFVBQVUsSUFBRyxNQUFBLGFBQWEsQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQSxJQUFJLEtBQUssQ0FBQyxDQUFDO0lBQzVGLElBQU0sTUFBTSxHQUFHLElBQUEsZUFBVSxFQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLDRCQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFFLEVBQUUsU0FBUyxFQUFFLEVBQVcsRUFBcUIsQ0FBQztJQUMzRyxPQUFPLEVBQUUsU0FBUyxXQUFBLEVBQUUsTUFBTSxRQUFBLEVBQUUsQ0FBQztBQUMvQixDQUFDO0FBSkQsb0NBSUM7QUFFRDs7Ozs7O0dBTUc7QUFDVSxRQUFBLFlBQVksR0FBRztJQUMxQixrQkFBa0I7SUFDbEIsc0JBQXNCO0lBQ3RCLDZCQUE2QjtJQUM3QiwwQ0FBMEM7SUFDMUMsaUJBQWlCO0lBQ2pCLGFBQWE7SUFDYixvQkFBb0I7SUFDcEIsV0FBVztJQUNYLGFBQWE7SUFDYixjQUFjO0lBQ2QsZUFBZTtJQUNmLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsMEJBQTBCO0lBQzFCLGdCQUFnQjtJQUNoQixvQkFBb0I7SUFDcEIsb0JBQW9CO0lBQ3BCLGFBQWE7SUFDYixPQUFPLENBQUMsWUFBWTtDQUNyQixDQUFDO0FBRUY7O0dBRUc7QUFDVSxRQUFBLGNBQWMsMENBQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLGtCQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxVQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL19jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgKiBhcyBoZXhvUG9zdFBhcnNlciBmcm9tICdoZXhvLXBvc3QtcGFyc2VyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaENvbmZpZyhmaWxlWU1MOiBzdHJpbmcpIHtcbiAgaWYgKCFmaWxlWU1MLmVuZHNXaXRoKCdfY29uZmlnLnltbCcpKSBmaWxlWU1MICs9ICcvX2NvbmZpZy55bWwnO1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKHJlYWRGaWxlU3luYyhmaWxlWU1MLCAndXRmLTgnKSk7XG4gIHNldENvbmZpZyhvcmRlcktleXMoY29uZmlnWU1MKSk7XG4gIHdyaXRlZmlsZShqb2luKF9fZGlybmFtZSwgJ19jb25maWcuanNvbicpLCBKU09OLnN0cmluZ2lmeShjb25maWdZTUwsIG51bGwsIDIpKTtcbn1cblxuZmV0Y2hDb25maWcoam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKSk7XG5cbi8qKlxuICogQ29uZmlnIHNldHRlclxuICogKiB1c2VmdWwgZm9yIGplc3RcbiAqIEBwYXJhbSBvYmpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENvbmZpZyhvYmo6IFJlY29yZDxzdHJpbmcsIGFueT4gfCBQcm9qQ29uZikge1xuICBzZXR0bGVkQ29uZmlnID0gT2JqZWN0LmFzc2lnbihzZXR0bGVkQ29uZmlnIHx8IHt9LCBvYmopO1xuXG4gIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICBoZXhvUG9zdFBhcnNlci5zZXRDb25maWcoc2V0dGxlZENvbmZpZyk7XG4gIHJldHVybiBnZXRDb25maWcoKTtcbn1cblxuLyoqXG4gKiBDb25maWcgZ2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZygpIHtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXBsb3lDb25maWcoKSB7XG4gIGNvbnN0IGRlcGxveURpciA9IGpvaW4oc2V0dGxlZENvbmZpZy5jd2QsICcuZGVwbG95XycgKyBzZXR0bGVkQ29uZmlnLmRlcGxveT8udHlwZSB8fCAnZ2l0Jyk7XG4gIGNvbnN0IGdpdGh1YiA9IGV4aXN0c1N5bmMoZGVwbG95RGlyKSA/IG5ldyBnaXQoZGVwbG95RGlyKSA6ICh7IHN1Ym1vZHVsZTogW10gYXMgZ2l0W10gfSBhcyB1bmtub3duIGFzIGdpdCk7XG4gIHJldHVybiB7IGRlcGxveURpciwgZ2l0aHViIH07XG59XG5cbi8qKlxuICogY29tbW9uIGlnbm9yZSBmaWxlc1xuICogQGV4YW1wbGVcbiAqIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICogY29uc3QgZXhjbHVkZXMgPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gKiBleGNsdWRlcy5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gKi9cbmV4cG9ydCBjb25zdCBjb21tb25JZ25vcmUgPSBbXG4gICcqKi95YW5kZXhfKi5odG1sJywgLy8gc2tpcCB5YW5kZXggdmVyaWZpY2F0aW9uIGZpbGVcbiAgLy8gJyoqL2NvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovZGlzcXVzLWNvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovY29tbWVudC5odG1sJywgLy8gc2tpcCBjb21tZW50Lmh0bWxcbiAgJyoqL2Zhdmljb24uaHRtbCcsIC8vIHNraXAgZmF2aWNvblxuICAnKiovNDA0Lmh0bWwnLCAvLyBza2lwIDQwNFxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gc2tpcCBub2RlX21vZHVsZXNcbiAgJyoqL3RtcC8qKicsIC8vIHNraXAgdG1wXG4gICcqKi9idWlsZC8qKicsIC8vIHNraXAgYnVpbGRcbiAgJyoqLy5jYWNoZS8qKicsIC8vIHNraXAgY29tbW9uIGNhY2hlIGZvbGRlclxuICAnKiovLnZzY29kZS8qKicsIC8vIHNraXAgdnNjb2RlIGNvbmZpZ3VyYXRpb24gZm9sZGVyXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyBza2lwIGZyb250bWF0dGVyIHZzY29kZSBleHRlbnNpb25cbiAgJyoqL3BpbnRlcmVzdC0qLmh0bWwnLCAvLyBza2lwIHBpbnRlcmVzdCB2ZXJpZmljYXRpb24gZmlsZVxuICAnKiovXyouc3RhbmRhbG9uZS57anMsdHN9JywgLy8gc2tpcCBfZmlsZW5hbWUuc3RhbmRhbG9uZS5qc1xuICAnKiovZGVza3RvcC5pbmknLCAvLyB3aW5kb3dzIGRlc2t0b3AuaW5pXG4gICcqKi9ub2RlX21vZHVsZXMvKionLCAvLyBub2RlX21vZHVsZXNcbiAgJyoqLy5mcm9udG1hdHRlci8qKicsIC8vIHZzY29kZSBmcm9udG1hdHRlciBwbHVnaW5cbiAgJyoqLy5naXQqLyoqJywgLy8gYW55IGdpdCBjb25maWdzXG4gICcqKi8uKicgLy8gc2tpcCBkb3RzXG5dO1xuXG4vKipcbiAqIGFycmF5IG9mIGNvbmZpZy5leGNsdWRlLCBjb25maWcuaWdub3JlXG4gKi9cbmV4cG9ydCBjb25zdCBwcm9qZWN0SWdub3JlcyA9IFsuLi4oZ2V0Q29uZmlnKCkuc2tpcF9yZW5kZXIgfHwgW10pLCAuLi4oZ2V0Q29uZmlnKCkuaWdub3JlIHx8IFtdKV07XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport * as hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nexport function fetchConfig(fileYML: string) {\n  if (!fileYML.endsWith('_config.yml')) fileYML += '/_config.yml';\n  const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n  setConfig(orderKeys(configYML));\n  writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\n\nfetchConfig(join(process.cwd(), '_config.yml'));\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign(settledConfig || {}, obj);\n\n  // update hexo-post-parser config\n  hexoPostParser.setConfig(settledConfig);\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nexport function getConfig() {\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : ({ submodule: [] as git[] } as unknown as git);\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/cd/_config_cdd6159bd7bcb99ef891db3f4cdffa50.map","wrapperLength":82},"result":{"scriptId":"3510","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13247,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13244,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":1161,"endOffset":1611,"count":2},{"startOffset":1255,"endOffset":1264,"count":0},{"startOffset":1342,"endOffset":1352,"count":0},{"startOffset":1379,"endOffset":1396,"count":0},{"startOffset":1407,"endOffset":1446,"count":0},{"startOffset":1504,"endOffset":1524,"count":0},{"startOffset":1526,"endOffset":1536,"count":0},{"startOffset":1572,"endOffset":1586,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":1665,"endOffset":1992,"count":2},{"startOffset":1733,"endOffset":1928,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2050,"endOffset":2131,"count":2},{"startOffset":2102,"endOffset":2107,"count":1},{"startOffset":2108,"endOffset":2128,"count":1}],"isBlockCoverage":true},{"functionName":"fetchConfig","ranges":[{"startOffset":2751,"endOffset":3102,"count":2},{"startOffset":2833,"endOffset":2859,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":3259,"endOffset":3454,"count":3},{"startOffset":3333,"endOffset":3338,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3544,"endOffset":3779,"count":612},{"startOffset":3629,"endOffset":3634,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3811,"endOffset":4174,"count":612},{"startOffset":3973,"endOffset":3981,"count":0},{"startOffset":3993,"endOffset":4001,"count":0},{"startOffset":4053,"endOffset":4098,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml = __importStar(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:name/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBa0M7QUFDbEMsaURBQWtEO0FBQ2xELCtCQUFxQztBQUNyQyx5Q0FBNkI7QUFFN0I7OztHQUdHO0FBQ0gsU0FBZ0IsZ0JBQWdCO0lBQzlCLElBQU0saUJBQWlCLEdBQUc7UUFDeEIsT0FBTztRQUNQLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNO1FBQ04sR0FBRyxFQUFFLG9CQUFvQjtRQUN6QixJQUFJLEVBQUUsR0FBRztRQUNULFNBQVMsRUFBRSwwQkFBMEI7UUFDckMsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QixXQUFXLEVBQUU7WUFDWCxjQUFjLEVBQUUsSUFBSTtZQUNwQixhQUFhLEVBQUUsSUFBSTtTQUNwQjtRQUNELFlBQVk7UUFDWixVQUFVLEVBQUUsUUFBUTtRQUNwQixVQUFVLEVBQUUsUUFBUTtRQUNwQixPQUFPLEVBQUUsTUFBTTtRQUNmLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLFlBQVksRUFBRSxZQUFZO1FBQzFCLFFBQVEsRUFBRSxnQkFBZ0I7UUFDMUIsUUFBUSxFQUFFLE9BQU87UUFDakIsV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVO1FBQ1YsYUFBYSxFQUFFLFdBQVc7UUFDMUIsY0FBYyxFQUFFLE1BQU07UUFDdEIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsYUFBYSxFQUFFO1lBQ2IsTUFBTSxFQUFFLElBQUk7WUFDWixLQUFLLEVBQUUsTUFBTTtZQUNiLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxhQUFhLEVBQUUsQ0FBQztRQUNoQixhQUFhLEVBQUUsS0FBSztRQUNwQixpQkFBaUIsRUFBRSxLQUFLO1FBQ3hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLE1BQU0sRUFBRSxJQUFJO1FBQ1osa0JBQWtCLEVBQUUsY0FBYztRQUNsQyxTQUFTLEVBQUU7WUFDVCxXQUFXLEVBQUUsS0FBSztZQUNsQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtZQUNmLElBQUksRUFBRSxJQUFJO1lBQ1YsaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixhQUFhLEVBQUUsS0FBSztZQUNwQixJQUFJLEVBQUUsS0FBSztTQUNaO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVyxFQUFFLElBQUk7WUFDakIsV0FBVyxFQUFFLEVBQUU7U0FDaEI7UUFDRCxpQkFBaUI7UUFDakIsZ0JBQWdCLEVBQUUsZUFBZTtRQUNqQyxZQUFZLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUUsRUFBRTtRQUNYLHFCQUFxQjtRQUNyQixXQUFXLEVBQUUsWUFBWTtRQUN6QixXQUFXLEVBQUUsVUFBVTtRQUN2QixjQUFjLEVBQUUsT0FBTztRQUN2Qiw0Q0FBNEM7UUFDNUMsMEJBQTBCO1FBQzFCLGFBQWE7UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLGFBQWE7UUFDYixLQUFLLEVBQUUsV0FBVztRQUNsQixNQUFNLEVBQUU7WUFDTixLQUFLLEVBQUUsS0FBSztTQUNiO1FBQ0QsYUFBYTtRQUNiLE1BQU0sRUFBRSxFQUFFO1FBRVYsK0JBQStCO1FBQy9CLE1BQU0sRUFBRSxFQUFFO1FBRVYsaUJBQWlCO1FBQ2pCLGNBQWMsRUFBRSxJQUFJO0tBQ3JCLENBQUM7SUFDRixJQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLEdBQUcsRUFBRSxJQUFBLGNBQU0sRUFBQyxJQUFBLGlDQUFnQixFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQzdDLENBQUM7SUFDRixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztJQUNyRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxDQUFvQyxDQUFDO0FBQzFHLENBQUM7QUF4RkQsNENBd0ZDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0Isb0JBQW9CO0lBQ2xDLE9BQU8sSUFBQSxpQkFBWSxFQUFDLElBQUEsWUFBSSxFQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvRCxDQUFDO0FBRkQsb0RBRUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAqIGFzIHlhbWwgZnJvbSAneWFtbCc7XG5cbi8qKlxuICogZ2V0IGRlZmF1bHQgY29uZmlndXJhdGlvblxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWcoKSB7XG4gIGNvbnN0IGhleG9EZWZhdWx0Q29uZmlnID0ge1xuICAgIC8vIFNpdGVcbiAgICB0aXRsZTogJ0hleG8nLFxuICAgIHN1YnRpdGxlOiAnJyxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgYXV0aG9yOiAnSm9obiBEb2UnLFxuICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIHRpbWV6b25lOiAnJyxcbiAgICAvLyBVUkxcbiAgICB1cmw6ICdodHRwOi8vZXhhbXBsZS5jb20nLFxuICAgIHJvb3Q6ICcvJyxcbiAgICBwZXJtYWxpbms6ICc6eWVhci86bW9udGgvOmRheS86bmFtZS8nLFxuICAgIHBlcm1hbGlua19kZWZhdWx0czoge30sXG4gICAgcHJldHR5X3VybHM6IHtcbiAgICAgIHRyYWlsaW5nX2luZGV4OiB0cnVlLFxuICAgICAgdHJhaWxpbmdfaHRtbDogdHJ1ZVxuICAgIH0sXG4gICAgLy8gRGlyZWN0b3J5XG4gICAgc291cmNlX2RpcjogJ3NvdXJjZScsXG4gICAgcHVibGljX2RpcjogJ3B1YmxpYycsXG4gICAgdGFnX2RpcjogJ3RhZ3MnLFxuICAgIGFyY2hpdmVfZGlyOiAnYXJjaGl2ZXMnLFxuICAgIGNhdGVnb3J5X2RpcjogJ2NhdGVnb3JpZXMnLFxuICAgIGNvZGVfZGlyOiAnZG93bmxvYWRzL2NvZGUnLFxuICAgIGkxOG5fZGlyOiAnOmxhbmcnLFxuICAgIHNraXBfcmVuZGVyOiBbXSxcbiAgICAvLyBXcml0aW5nXG4gICAgbmV3X3Bvc3RfbmFtZTogJzp0aXRsZS5tZCcsXG4gICAgZGVmYXVsdF9sYXlvdXQ6ICdwb3N0JyxcbiAgICB0aXRsZWNhc2U6IGZhbHNlLFxuICAgIGV4dGVybmFsX2xpbms6IHtcbiAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgIGZpZWxkOiAnc2l0ZScsXG4gICAgICBleGNsdWRlOiAnJ1xuICAgIH0sXG4gICAgZmlsZW5hbWVfY2FzZTogMCxcbiAgICByZW5kZXJfZHJhZnRzOiBmYWxzZSxcbiAgICBwb3N0X2Fzc2V0X2ZvbGRlcjogZmFsc2UsXG4gICAgcmVsYXRpdmVfbGluazogZmFsc2UsXG4gICAgZnV0dXJlOiB0cnVlLFxuICAgIHN5bnRheF9oaWdobGlnaHRlcjogJ2hpZ2hsaWdodC5qcycsXG4gICAgaGlnaGxpZ2h0OiB7XG4gICAgICBhdXRvX2RldGVjdDogZmFsc2UsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJyxcbiAgICAgIHdyYXA6IHRydWUsXG4gICAgICBleGNsdWRlX2xhbmd1YWdlczogW10sXG4gICAgICBsYW5ndWFnZV9hdHRyOiBmYWxzZSxcbiAgICAgIGhsanM6IGZhbHNlXG4gICAgfSxcbiAgICBwcmlzbWpzOiB7XG4gICAgICBwcmVwcm9jZXNzOiB0cnVlLFxuICAgICAgbGluZV9udW1iZXI6IHRydWUsXG4gICAgICB0YWJfcmVwbGFjZTogJydcbiAgICB9LFxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgZGVmYXVsdF9jYXRlZ29yeTogJ3VuY2F0ZWdvcml6ZWQnLFxuICAgIGNhdGVnb3J5X21hcDoge30sXG4gICAgdGFnX21hcDoge30sXG4gICAgLy8gRGF0ZSAvIFRpbWUgZm9ybWF0XG4gICAgZGF0ZV9mb3JtYXQ6ICdZWVlZLU1NLUREJyxcbiAgICB0aW1lX2Zvcm1hdDogJ0hIOm1tOnNzJyxcbiAgICB1cGRhdGVkX29wdGlvbjogJ210aW1lJyxcbiAgICAvLyAqIG10aW1lOiBmaWxlIG1vZGlmaWNhdGlvbiBkYXRlIChkZWZhdWx0KVxuICAgIC8vICogZW1wdHk6IG5vIG1vcmUgdXBkYXRlXG4gICAgLy8gUGFnaW5hdGlvblxuICAgIHBlcl9wYWdlOiAxMCxcbiAgICBwYWdpbmF0aW9uX2RpcjogJ3BhZ2UnLFxuICAgIC8vIEV4dGVuc2lvbnNcbiAgICB0aGVtZTogJ2xhbmRzY2FwZScsXG4gICAgc2VydmVyOiB7XG4gICAgICBjYWNoZTogZmFsc2VcbiAgICB9LFxuICAgIC8vIERlcGxveW1lbnRcbiAgICBkZXBsb3k6IHt9LFxuXG4gICAgLy8gaWdub3JlIGZpbGVzIGZyb20gcHJvY2Vzc2luZ1xuICAgIGlnbm9yZTogW10sXG5cbiAgICAvLyBDYXRlZ29yeSAmIFRhZ1xuICAgIG1ldGFfZ2VuZXJhdG9yOiB0cnVlXG4gIH07XG4gIGNvbnN0IHNiZ0RlZmF1bHRDb25maWcgPSB7XG4gICAgY3dkOiB0b1VuaXgodHJ1ZUNhc2VQYXRoU3luYyhwcm9jZXNzLmN3ZCgpKSlcbiAgfTtcbiAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShnZXREZWZhdWx0Q29uZmlnWWFtbCgpKTtcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oaGV4b0RlZmF1bHRDb25maWcsIHNiZ0RlZmF1bHRDb25maWcsIGNvbmZpZ1lNTCkgYXMgdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcbn1cblxuLyoqXG4gKiBnZXQgZGVmYXVsdCBfY29uZmlnLnltbFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWdZYW1sKCkge1xuICByZXR1cm4gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZy55bWwnKSwgJ3V0Zi04Jyk7XG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport * as yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:name/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/0f/defaults_0ff471d7851e1315103153ae541c865c.map","wrapperLength":82},"result":{"scriptId":"3577","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":10548,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":10545,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":29},{"startOffset":314,"endOffset":329,"count":0},{"startOffset":346,"endOffset":366,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":409,"endOffset":436,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":889,"endOffset":900,"count":0},{"startOffset":962,"endOffset":1063,"count":29}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":1451,"endOffset":3888,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3981,"endOffset":4105,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHlCQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsOENBQXdCO0FBQ3hCLDREQUFrRDtBQUNsRCxzREFBZ0M7QUFFaEMsdUVBQWlEO0FBQ2pELGlDQUErQztBQUMvQywwREFBb0M7QUFDcEMscUNBQXNDO0FBRXRDOzs7OztHQUtHO0FBQ0gsU0FBZ0IsWUFBWSxDQUFDLEtBQW9ELEVBQUUsR0FBK0I7SUFBbEgsaUJBOEdDOztJQTdHQyxJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFVBQVUsR0FBRyxPQUFPLEdBQUcsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDM0UsSUFBTSxPQUFPLEdBQUcscUJBQVUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFbkQsd0JBQXdCO0lBQ3hCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztJQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUU7UUFDbEMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQVUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0tBQzFFO0lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRTtRQUMzQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGdCQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8s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LEdBQUcsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUN0QyxhQUFhO3dCQUNiLElBQUksRUFBRSxDQUFDOzs7O2FBQ1IsQ0FBQyxDQUNIO2FBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztLQUNoQztTQUFNO1FBQ0wsSUFBTSxPQUFPLEdBQUcsSUFBQSxzQkFBaUIsRUFBQyxjQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUseUJBQXlCLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sT0FBTyxDQUFDO0tBQ2hCO0FBQ0gsQ0FBQztBQTlHRCxvQ0E4R0M7QUFFRCxnQ0FBZ0M7QUFDaEMsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBzZiwgeyBTYWZlbGlua09wdGlvbnMgfSBmcm9tICdzYWZlbGlua2lmeSc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgU3JjT3B0aW9ucyB9IGZyb20gJ3ZpbnlsLWZzJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCB7IGNyZWF0ZVdyaXRlU3RyZWFtIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogUHJvY2VzcyBTYWZlbGluayBvbiBEZXBsb3kgRGlyXG4gKiBAcGFyYW0gX2RvbmUgY2FsbGJhY2sgZnVuY3Rpb25cbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2FmZWxpbmsoX2RvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkPzogdW5kZWZpbmVkIHwgbnVsbCB8IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3Qgd29ya2luZ0RpciA9IHR5cGVvZiBjd2QgPT09ICdzdHJpbmcnID8gY3dkIDogY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGxvZ25hbWUgPSBhbnNpQ29sb3JzLmdyZWVuQnJpZ2h0KCdzYWZlbGluaycpO1xuXG4gIC8vIHNraXAgcHJvY2VzcyBzYWZlbGlua1xuICBsZXQgaGFzRXJyb3IgPSBmYWxzZTtcbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluaykge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdjb25maWcgc2FmZWxpbmsnLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5yZWRpcmVjdCkge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdzYWZlbGluayByZWRpcmVjdG9yJywgYW5zaUNvbG9ycy5yZWQoJ25vdCBjb25maWd1cmVkJykpO1xuICB9XG4gIGlmICghY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsuZW5hYmxlKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgYW5zaUNvbG9ycy5yZWQoJ2Rpc2FibGVkJykpO1xuICB9XG5cbiAgaWYgKGV4aXN0c1N5bmMod29ya2luZ0RpcikgJiYgIWhhc0Vycm9yKSB7XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZ1NhZmVsaW5rOiBTYWZlbGlua09wdGlvbnMgJiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge1xuICAgICAgZW5hYmxlOiBmYWxzZSxcbiAgICAgIGV4Y2x1ZGU6IFtdIGFzIHN0cmluZ1tdLFxuICAgICAgcmVkaXJlY3Q6ICdodHRwczovL3d3dy53ZWJtYW5hamVtZW4uY29tL3BhZ2Uvc2FmZWxpbmsuaHRtbD91cmw9JyxcbiAgICAgIHBhc3N3b3JkOiAncm9vdCcsXG4gICAgICB0eXBlOiAnYmFzZTY0J1xuICAgIH07XG4gICAgY29uc3QgY29uZmlnU2FmZWxpbmsgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDb25maWdTYWZlbGluaywgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsgfHwge30pO1xuICAgIGxldCBiYXNlVVJMID0gJyc7XG4gICAgdHJ5IHtcbiAgICAgIGJhc2VVUkwgPSBuZXcgVVJMKGNvbmZpZy51cmwpLmhvc3Q7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvL1xuICAgIH1cblxuICAgIGNvbnN0IG9wdDogUGFydGlhbDxTYWZlbGlua09wdGlvbnM+ID0ge1xuICAgICAgLy8gZXhjbHVkZSBwYXR0ZXJucyAoZG9udCBhbm9ueW1pemUgdGhlc2UgcGF0dGVybnMpXG4gICAgICBleGNsdWRlOiBbXG4gICAgICAgIC4uLihjb25maWcuZXh0ZXJuYWxfbGluaz8uZXhjbHVkZSB8fCBbXSksXG4gICAgICAgIC9odHRwcz86XFwvXFwvPyg/OihbXipdKylcXC4pP3dlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIC8oW2EtejAtOV0oPzpbYS16MC05LV17MSw2MX1bYS16MC05XSk/Wy5dKSp3ZWJtYW5hamVtZW5cXC5jb20vLFxuICAgICAgICBiYXNlVVJMLFxuICAgICAgICAnd3d3LndlYm1hbmFqZW1lbi5jb20nLFxuICAgICAgICAnaHR0cHM6Ly9naXRodWIuY29tL2RpbWFzbGFuamFrYScsXG4gICAgICAgICdodHRwczovL2ZhY2Vib29rLmNvbS9kaW1hc2xhbmpha2ExJyxcbiAgICAgICAgJ2RpbWFzbGFuamFrYS5naXRodWIuaW8nLFxuICAgICAgICAuLi5jb25maWdTYWZlbGluay5leGNsdWRlXG4gICAgICBdLmZpbHRlcihmdW5jdGlvbiAoeCwgaSwgYSkge1xuICAgICAgICAvLyByZW1vdmUgZHVwbGljYXRlIGFuZCBlbXB0aWVzXG4gICAgICAgIHJldHVybiBhLmluZGV4T2YoeCkgPT09IGkgJiYgeC50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XG4gICAgICB9KSxcbiAgICAgIHJlZGlyZWN0OiBbXSxcbiAgICAgIC8vcmVkaXJlY3Q6IFssIGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0XSxcbiAgICAgIHBhc3N3b3JkOiBjb25maWdTYWZlbGluay5wYXNzd29yZCB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5wYXNzd29yZCxcbiAgICAgIHR5cGU6IGNvbmZpZ1NhZmVsaW5rLnR5cGUgfHwgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsudHlwZVxuICAgIH07XG5cbiAgICBpZiAoY29uZmlnU2FmZWxpbmsucmVkaXJlY3QpIHtcbiAgICAgIG9wdC5yZWRpcmVjdCA9IGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0O1xuICAgIH1cblxuICAgIGNvbnN0IHNhZmVsaW5rID0gbmV3IHNmLnNhZmVsaW5rKG9wdCk7XG5cbiAgICBjb25zdCBndWxwb3B0OiBTcmNPcHRpb25zID0ge1xuICAgICAgY3dkOiB3b3JraW5nRGlyLFxuICAgICAgaWdub3JlOiBbXVxuICAgIH07XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKSkge1xuICAgICAgZ3VscG9wdC5pZ25vcmU/LmNvbmNhdCguLi5jb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnU2FmZWxpbmsuZXhjbHVkZSkpIHtcbiAgICAgIGNvbnN0IGlnbm9yZSA9IGNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGUuZmlsdGVyKChzdHIpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuICEvXihodHRwcz86XFwvfHd3dy4pLy50ZXN0KHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSkgYXMgc3RyaW5nW107XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmlnbm9yZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGd1bHBcbiAgICAgIC5zcmMoWycqKi8qLntodG1sLGh0bX0nXSwgZ3VscG9wdClcbiAgICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2FmZWxpbmsnIH0pKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRocm91Z2gyLm9iaihhc3luYyAoZmlsZSwgX2VuYywgbmV4dCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3BzXG4gICAgICAgICAgaWYgKGZpbGUuaXNOdWxsKCkgfHwgZmlsZS5pc0RpcmVjdG9yeSgpIHx8ICFmaWxlIHx8IGZpbGUuaXNTdHJlYW0oKSkgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgICAvLyBwcm9jZXNzXG4gICAgICAgICAgaWYgKGZpbGUuaXNCdWZmZXIoKSAmJiBCdWZmZXIuaXNCdWZmZXIoZmlsZS5jb250ZW50cykpIHtcbiAgICAgICAgICAgIC8vIGRvIHNhZmVsaW5raWZ5XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZmlsZS5jb250ZW50cy50b1N0cmluZygndXRmLTgnKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IHNhZmVsaW5rLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIC8vIExvZ2dlci5sb2cocGFyc2VkKTtcbiAgICAgICAgICAgICAgZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKHBhcnNlZCk7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0KG51bGwsIGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcGFyc2UnLCBmaWxlLnBhdGgpO1xuICAgICAgICAgIC8vIGRyb3AgZmFpbHNcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAucGlwZShndWxwLmRlc3Qod29ya2luZ0RpcikpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHdzdHJlYW0gPSBjcmVhdGVXcml0ZVN0cmVhbShwYXRoLmpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvc2FmZWxpbmsubG9nJykpO1xuICAgIHJldHVybiB3c3RyZWFtO1xuICB9XG59XG5cbi8vIHNhZmVsaW5raWZ5IHRoZSBkZXBsb3kgZm9sZGVyXG5ndWxwLnRhc2soJ3NhZmVsaW5rJywgdGFza1NhZmVsaW5rKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4c/gulpsafelink_4c61ebd17a40a0e391c444500ad6c5a4.map","wrapperLength":82},"result":{"scriptId":"3581","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21175,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zZW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLHVFQUFpRDtBQUNqRCwwREFBb0M7QUFDcEMscUNBQWtFO0FBRWxFOzs7R0FHRztBQUNILFNBQWdCLE9BQU8sQ0FBQyxLQUFtRCxFQUFFLEdBQVc7SUFDdEYsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxNQUFNLEdBQWEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM3RSxNQUFNLENBQUMsSUFBSSxPQUFYLE1BQU0sMkJBQVMsc0JBQVksV0FBRTtJQUM3QixPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxjQUFjLENBQUMsRUFBRSxFQUFFLEdBQUcsS0FBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUM7U0FDekQsSUFBSSxDQUFDLElBQUEsb0JBQVUsRUFBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ2pDLElBQUksQ0FDSCxJQUFBLGtCQUFPLEVBQUMsVUFBVSxJQUFJO1FBQWQsaUJBMkJQO1FBMUJDLGlCQUFpQjtRQUNqQixJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFFO1lBQ2hCLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDNUIsSUFBTSxLQUFLLEdBQUcsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRLENBQUM7Z0JBQ3RFLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxtQkFBbUI7UUFDbkIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUNqRSxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNqQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDO2dCQUN4RSxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQzthQUNqQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0JBQWdCO1FBQ2hCLFdBQVc7UUFDWCxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNqQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBVSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxjQUFPLEVBQUUsQ0FBQyxNQUFNLGVBQUssSUFBSSxDQUFFLENBQUMsQ0FBQztTQUM1RTtJQUNILENBQUMsQ0FBQyxDQUNIO1NBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMxQixDQUFDO0FBdENELDBCQXNDQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO0lBQ1AsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLE9BQU8sT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNlby50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBndWxwRG9tIGZyb20gJ2d1bHAtZG9tJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBkZXBsb3lDb25maWcsIGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogQXV0byBzZW8gcnVubmVyXG4gKiBAcGFyYW0gY3dkIHdvcmtpbmcgZGlyZWN0b3J5IHRvIHNjYW4gaHRtbCdzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2VvKF9kb25lOiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkOiBzdHJpbmcpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGlnbm9yZTogc3RyaW5nW10gPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gIGlnbm9yZS5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoue2h0bSxodG1sfScsICcqLntodG1sLGh0bX0nXSwgeyBjd2QsIGlnbm9yZSB9KVxuICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2VvJyB9KSlcbiAgICAucGlwZShcbiAgICAgIGd1bHBEb20oZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgLy8gZml4IGFsdCBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmNdJykpO1xuICAgICAgICBpbWFnZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ2FsdCcpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gQWx0JztcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYWx0JywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZml4IHRpdGxlIGlmcmFtZVxuICAgICAgICBjb25zdCBpZnJhbWVzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lmcmFtZVtzcmNdJykpO1xuICAgICAgICBpZnJhbWVzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgICAgY29uc3QgYWx0ID0gZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gVGl0bGUnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRpdGxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdBUk5JTkcgTUFLRVJcbiAgICAgICAgLy8gY291bnQgSDFcbiAgICAgICAgY29uc3QgaDEgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2gxJyk7XG4gICAgICAgIGlmIChoMS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyhhbnNpQ29sb3JzLnllbGxvd0JyaWdodCgnW1dBUk5dJyksIGBIMSAoJHtoMS5sZW5ndGh9KSAke3BhdGh9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKVxuICAgIC5waXBlKGd1bHAuZGVzdChjd2QpKTtcbn1cblxuZ3VscC50YXNrKCdzZW8nLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgcmV0dXJuIHRhc2tTZW8obnVsbCwgZGVwbG95RGlyKTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/e0/gulpseo_e04b91fb9cd501fddd96cd3618e1374f.map","wrapperLength":82},"result":{"scriptId":"3630","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8792,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8789,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zdGFuZGFsb25lLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QixzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLDBEQUFvQztBQUNwQyx5Q0FBNkM7QUFDN0MscUNBQXNDO0FBRXRDOzs7R0FHRztBQUNILFNBQVMsZ0JBQWdCO0lBQ3ZCLGdCQUFNLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7SUFDaEQsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1NBQ2xHLElBQUksQ0FDSCxrQkFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFnQixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7Ozs7Ozt3QkFDM0MsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUN4RCxLQUFBLENBQUEsS0FBQSxnQkFBTSxDQUFBLENBQUMsR0FBRyxDQUFBOzt3QkFBUyxxQkFBTSxJQUFBLG9CQUFXLEVBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUE7O3dCQUFwRSxjQUFXLG1CQUFRLFNBQWlELEVBQUUsRUFBQyxDQUFDO3dCQUN4RSxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQ2xELEtBQUssR0FBRyxJQUFBLHFCQUFLLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7d0JBQy9ELEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFOzRCQUNoQixZQUFZOzRCQUNaLElBQUksRUFBRSxDQUFDO3dCQUNULENBQUMsQ0FBQyxDQUFDOzs7OztLQUNKLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7U0FDeEQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNYLGdCQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBRS9DLGtCQUFlLGdCQUFnQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuc3RhbmRhbG9uZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc3Bhd24gZnJvbSAnY3Jvc3Mtc3Bhd24nO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgcmVwbGFjZVBhdGggfSBmcm9tICcuL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIHJ1biBhbGwgXyouc3RhbmRhbG9uZS5qcyBpbnNpZGUgc3JjLXBvc3RzIChfY29uZmlnX3ltbC5wb3N0X2RpcilcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHN0YW5kYWxvbmVSdW5uZXIoKSB7XG4gIExvZ2dlci5sb2coJ1tzdGFuZGFsb25lXSBSdW5uaW5nIHNjcmlwdHMuLi5cXG4nKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAnKiovXyouc3RhbmRhbG9uZS5qcycpLCB7IGN3ZDogZ2V0Q29uZmlnKCkuY3dkLCBpZ25vcmU6IFsnKiovdG1wLyoqJ10gfSlcbiAgICAucGlwZShcbiAgICAgIHRocm91Z2gyLm9iaihhc3luYyBmdW5jdGlvbiAoZmlsZSwgX2VuYywgbmV4dCkge1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBpbnB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBMb2dnZXIubG9nKGBub2RlICR7YXdhaXQgcmVwbGFjZVBhdGgoZmlsZS5wYXRoLCBnZXRDb25maWcoKS5jd2QsICcnKX1gKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnPScucmVwZWF0KDEwKSArICcgb3VwdXQgJyArICc9Jy5yZXBlYXQoMTApKTtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBzcGF3bignbm9kZScsIFtmaWxlLnBhdGhdLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7XG4gICAgICAgIGNoaWxkLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAvLyBkcm9wIGZpbGVcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAndG1wL3N0YW5kYWxvbmUnKSkpXG4gICAgLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIExvZ2dlci5sb2coJ1xcbltzdGFuZGFsb25lXSBzdG9wcGVkJyk7XG4gICAgfSk7XG59XG5cbmd1bHAudGFzaygncG9zdDpzdGFuZGFsb25lJywgc3RhbmRhbG9uZVJ1bm5lcik7XG5cbmV4cG9ydCBkZWZhdWx0IHN0YW5kYWxvbmVSdW5uZXI7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4b/gulpstandalone_4b97cf5f5ca3169df9a2ad9287d555ef.map","wrapperLength":82},"result":{"scriptId":"4087","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8832,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8829,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zaXRlbWFwLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBZ0M7QUFDaEMscUNBQXdDO0FBQ3hDLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXVDO0FBQ3ZDLHVDQUF5QztBQUN6QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHlCQUF5QjtBQUN6QixtREFBc0Q7QUFDdEQsK0JBQTZCO0FBQzdCLHFDQUFxQztBQUNyQyx1Q0FBaUU7QUFDakUsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMsc0VBQStDO0FBQy9DLHFDQUErRDtBQUUvRDs7OztFQUlFO0FBQ0YsSUFBSSxRQUFRLEdBQUcsRUFBYyxDQUFDO0FBQzlCLElBQU0sT0FBTyxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7QUFDbEMsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUI7Ozs7O0dBS0c7QUFDSCxTQUFnQixlQUFlLENBQUMsR0FBK0IsRUFBRSxJQUFRO0lBQXpFLGlCQTZEQztJQTdEZ0UscUJBQUEsRUFBQSxRQUFRO0lBQ3ZFLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBb0M7UUFDdkQsSUFBTSxRQUFRLEdBQXlDLEVBQUUsQ0FBQztRQUMxRCxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLENBQ1gsSUFBQSxxQ0FBbUIsRUFBQyxHQUFHLEVBQUU7Z0JBQ3ZCLElBQUksTUFBQTthQUNMLENBQUMsQ0FDSCxDQUFDO1NBQ0g7YUFBTTtZQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBQSxtQkFB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QztxQkFDMUQsSUFBSSxDQUNILElBQUEsa0JBQU8sRUFBQztvQkFDTix5QkFBeUI7b0JBQ3pCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sbUJBQWUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO3dCQUN4RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNkJBQTJCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUMvRDt3QkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw2RkFBK0UsT0FBTyxxQkFBaUIsQ0FBQztxQkFDaEk7b0JBQ0QsdUVBQXVFO2dCQUN6RSxDQUFDLENBQUMsQ0FDSDtxQkFDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztxQkFDMUIsSUFBSSxDQUFDLEtBQUssRUFBRSxjQUFNLE9BQUEsT0FBTyxFQUFFLEVBQVQsQ0FBUyxDQUFDLENBQUM7WUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQWpHRCxrREFpR0M7QUFFRCxTQUFTLE9BQU8sQ0FBQyxJQUFZLEVBQUUsUUFBb0M7SUFDakUsT0FBTyxvQkFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO0lBQ25CLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBTztRQUMxQixtQkFBbUIsRUFBRSxDQUFDLElBQUksQ0FBQztZQUN6QixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNpdGVtYXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBoZXhvIH0gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG1pY3JvbWF0Y2ggZnJvbSAnbWljcm9tYXRjaCc7XG5pbXBvcnQgbnVuanVja3MgZnJvbSAnbnVuanVja3MnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgc2l0ZW1hcENyYXdsZXJBc3luYyB9IGZyb20gJ3NpdGVtYXAtY3Jhd2xlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgeW9hc3RTZW8gfSBmcm9tICcuL3NpdGVtYXAnO1xuaW1wb3J0IHsgYXJyYXlfcmVtb3ZlX2VtcHR5LCBhcnJheV91bmlxdWUgfSBmcm9tICcuL3V0aWxzL2FycmF5JztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKlxuLy8gcmVhZCBleGlzdGluZyBzaXRlbWFwLnR4dFxuY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbmxldCBzaXRlbWFwcyA9IGV4aXN0c1N5bmMoc2l0ZW1hcFRYVCkgPyBhcnJheV9yZW1vdmVfZW1wdHkocmVhZEZpbGVTeW5jKHNpdGVtYXBUWFQsICd1dGYtOCcpLnNwbGl0KC9cXHI/XFxuL2dtKSkgOiBbXTtcbiovXG5sZXQgc2l0ZW1hcHMgPSBbXSBhcyBzdHJpbmdbXTtcbmNvbnN0IGNyYXdsZWQgPSBuZXcgU2V0PHN0cmluZz4oKTtcbmNvbnN0IGVudiA9IGVudk51bmp1Y2tzKCk7XG5cbi8qKlxuICogU2l0ZW1hcCBHZW5lcmF0b3JcbiAqIEBwYXJhbSB1cmwgdXJsIHRvIGNyYXdsXG4gKiBAcGFyYW0gZGVlcCBjcmF3bCBkZWVwZXIgbiB0aW1lc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2l0ZW1hcCh1cmw/OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkLCBkZWVwID0gMCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoc2l0ZW1hcHM6IHN0cmluZ1tdKSA9PiBhbnkpID0+IHtcbiAgICBjb25zdCBwcm9taXNlczogQmx1ZWJpcmQ8UmVjb3JkPHN0cmluZywgc3RyaW5nW10+PltdID0gW107XG4gICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyh1cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjcmF3bGVkLmFkZChnZXRDb25maWcoKS51cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyhnZXRDb25maWcoKS51cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICBCbHVlYmlyZC5hbGwocHJvbWlzZXMpXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICBjb25zdCBtYXBwZWQgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBzaXRlbWFwQ3Jhd2xlckFzeW5jPjtcbiAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChzaXRlbWFwKSA9PiB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gc2l0ZW1hcCkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gc2l0ZW1hcFtrZXldO1xuICAgICAgICAgICAgaWYgKGtleSBpbiBtYXBwZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1hcHBlZFtrZXldID0gdmFsdWVzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSBhcnJheV91bmlxdWUodmFsdWVzLmNvbmNhdChtYXBwZWRba2V5XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICBjb25zdCBzYXZldG8gPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAuanNvbicpO1xuICAgICAgICB3cml0ZWZpbGUoc2F2ZXRvLCBKU09OLnN0cmluZ2lmeShtYXBwZWQsIG51bGwsIDIpKTtcblxuICAgICAgICAvLyByZXR1cm5cbiAgICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICAgIH0pXG4gICAgICAudGhlbihhc3luYyAocmVzdWx0cykgPT4ge1xuICAgICAgICBzaXRlbWFwcyA9IGFycmF5X3VuaXF1ZShhcnJheV9yZW1vdmVfZW1wdHkoT2JqZWN0LnZhbHVlcyhyZXN1bHRzKS5mbGF0KDEpLmNvbmNhdChzaXRlbWFwcykpKS5zb3J0KGZ1bmN0aW9uIChcbiAgICAgICAgICBhLFxuICAgICAgICAgIGJcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA8IGIgPyAtMSA6IDE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVlcDsgaSsrKSB7XG4gICAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHNpdGVtYXBzLmxlbmd0aDsgaWkrKykge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gc2l0ZW1hcHNbaWldO1xuICAgICAgICAgICAgaWYgKGNyYXdsZWQuaGFzKHVybCkgfHwgLy4oanN8dHN8Y3NzfHNjc3N8dHh0fHBkZnxwbmd8anBlP2d8Z2lmfHdlYnApJC9naS50ZXN0KHVybCkpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgICAgICAgTG9nZ2VyLmxvZygnW2RlcHRoXScsIGlpLCB1cmwpO1xuICAgICAgICAgICAgYXdhaXQgZ2VuZXJhdGVTaXRlbWFwKHVybCwgZGVlcCkudGhlbigoKSA9PiB3cml0ZVNpdGVtYXAoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgd3JpdGVTaXRlbWFwKHJlc29sdmUpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIHdyaXRlIHRoZSBzaXRlbWFwXG4gKiBAcGFyYW0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gd3JpdGVTaXRlbWFwKGNhbGxiYWNrPzogKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnkpIHtcbiAgbGV0IGNiID0gbm9vcDtcbiAgaWYgKGNhbGxiYWNrKSBjYiA9ICgpID0+IGNhbGxiYWNrKHNpdGVtYXBzKTtcbiAgY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbiAgd3JpdGVmaWxlKHNpdGVtYXBUWFQsIGFycmF5X3JlbW92ZV9lbXB0eShzaXRlbWFwcykuam9pbihFT0wpKTtcbiAgY2IuYXBwbHkodGhpcyk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZW1hcE9wdGlvbnMge1xuICBwYXRoOiBzdHJpbmdbXTtcbiAgdGFnczogYm9vbGVhbjtcbiAgY2F0ZWdvcmllczogYm9vbGVhbjtcbiAgcmVsOiBib29sZWFuO1xuICB5b2FzdDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleG9HZW5lcmF0ZVNpdGVtYXAoKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBoZXhvKGdldENvbmZpZygpLmN3ZCk7XG4gICAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBlbnYuYWRkRmlsdGVyKCdmb3JtYXRVcmwnLCAoc3RyKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY29uZmlnID0gc2V0Q29uZmlnKGluc3RhbmNlLmNvbmZpZyk7XG4gICAgICAgIC8vIGFzc2lnbiBkZWZhdWx0IGNvbmZpZ1xuICAgICAgICBjb25zdCBzaXRlbWFwOiBTaXRlbWFwT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgeyByZWw6IGZhbHNlLCB0YWdzOiBmYWxzZSwgY2F0ZWdvcmllczogZmFsc2UsIHBhdGg6IFsnc2l0ZW1hcC50eHQnLCAnc2l0ZW1hcC54bWwnXSB9LFxuICAgICAgICAgIGNvbmZpZy5zaXRlbWFwXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQnVpbGQgWW9hc3QgU0VPIHNpdGVtYXBcbiAgICAgICAgLy8gd2hlbiBjb25maWcueW9hc3QgZGVmaW5lZFxuICAgICAgICBpZiAoc2l0ZW1hcC55b2FzdCkge1xuICAgICAgICAgIHJldHVybiB5b2FzdFNlbyhpbnN0YW5jZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNvbmZpZy5zaXRlbWFwKSByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIGNvbnN0IGxvY2FscyA9IGluc3RhbmNlLmxvY2FscztcbiAgICAgICAgY29uc3QgeyBza2lwX3JlbmRlciB9ID0gY29uZmlnO1xuXG4gICAgICAgIGlmICghc2l0ZW1hcC50YWdzIHx8ICFzaXRlbWFwLmNhdGVnb3JpZXMpIHtcbiAgICAgICAgICByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwLnRhZ3Mgb3IgY29uZmlnLnNpdGVtYXAuY2F0ZWdvcmllcyBub3QgY29uZmlndXJlZCBpbiBfY29uZmlnLnltbCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNraXBSZW5kZXJMaXN0ID0gWycqKi8qLmpzJywgJyoqLyouY3NzJywgJyoqLy5naXQqJ107XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2tpcF9yZW5kZXIpKSB7XG4gICAgICAgICAgc2tpcFJlbmRlckxpc3QucHVzaCguLi5za2lwX3JlbmRlcik7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNraXBfcmVuZGVyID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGlmIChza2lwX3JlbmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKHNraXBfcmVuZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3N0cyA9IFsuLi5sb2NhbHMuZ2V0KCdwYWdlcycpLnRvQXJyYXkoKSwgLi4ubG9jYWxzLmdldCgncG9zdHMnKS50b0FycmF5KCldXG4gICAgICAgICAgLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBvc3Quc2l0ZW1hcCAhPT0gZmFsc2UgJiYgIWlzTWF0Y2gocG9zdC5zb3VyY2UsIHNraXBSZW5kZXJMaXN0KTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi51cGRhdGVkICYmIGEudXBkYXRlZCkgcmV0dXJuIGIudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCkgLSBhLnVwZGF0ZWQudG9EYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHBvc3RzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRtcGxTcmMgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBudW5qdWNrcy5jb21waWxlKHJlYWRGaWxlU3luYyh0bXBsU3JjLCAndXRmLTgnKSwgZW52KTtcbiAgICAgICAgY29uc3QgeyB0YWdzOiB0YWdzQ2ZnLCBjYXRlZ29yaWVzOiBjYXRzQ2ZnLCByZWw6IHJlbENmZyB9ID0gc2l0ZW1hcDtcbiAgICAgICAgbGV0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBzTm93OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHRhZ3M6IHRhZ3NDZmcgPyBsb2NhbHMuZ2V0KCd0YWdzJykudG9BcnJheSgpIDogW10sXG4gICAgICAgICAgY2F0ZWdvcmllczogY2F0c0NmZyA/IGxvY2Fscy5nZXQoJ2NhdGVnb3JpZXMnKS50b0FycmF5KCkgOiBbXVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZW1vdmUgYmxhbmsgbmV3bGluZXNcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxccypbXFxyXFxuXS9nbSwgJ1xcbicpO1xuXG4gICAgICAgIC8vZGF0YSA9IHByZXR0aWVyLmZvcm1hdChkYXRhLCB7IHBhcnNlcjogJ3htbCcsIHBsdWdpbnM6IFt4bWxwbHVnaW5dLCBlbmRPZkxpbmU6ICdsZicgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICB3cml0ZWZpbGUoam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wL2R1bXAvc2l0ZW1hcC9zaXRlbWFwLnhtbCcpLCBkYXRhKTtcblxuICAgICAgICAvLyB3cml0ZVxuICAgICAgICBjb25zdCBzaXRlbWFwWG1sID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgd3JpdGVmaWxlKHNpdGVtYXBYbWwsIGRhdGEpO1xuICAgICAgICBpbnN0YW5jZS5sb2cuaW5mbygnc2l0ZW1hcCB3cml0dGVuJywgc2l0ZW1hcFhtbCk7XG5cbiAgICAgICAgaWYgKCFyZWxDZmcpIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcbiAgICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyKTtcbiAgICAgICAgZ3VscFxuICAgICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgLy8gYXV0byBkaXNjb3Zlcnkgc2l0ZW1hcFxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIke2Jhc2VVUkx9c2l0ZW1hcC54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInNpdGVtYXAtc2l0ZS11cmxcIiB0eXBlPVwiYXBwbGljYXRpb24vdGV4dCt4bWxcIiByZWw9XCJzaXRlbWFwXCIgaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiIC8+YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IHJlc29sdmUoKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGlzTWF0Y2gocGF0aDogc3RyaW5nLCBwYXR0ZXJuczogc3RyaW5nIHwgcmVhZG9ubHkgc3RyaW5nW10pIHtcbiAgcmV0dXJuIG1pY3JvbWF0Y2guaXNNYXRjaChwYXRoLCBwYXR0ZXJucyk7XG59XG5cbmd1bHAudGFzaygnc2l0ZW1hcCcsICgpID0+IHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGhleG9HZW5lcmF0ZVNpdGVtYXAoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/3c/gulpsitemap_3c8d9f84ead1fc6d91aa70a109950e6b.map","wrapperLength":82},"result":{"scriptId":"4092","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33956,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33953,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscGZpbGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOENBQXdCO0FBQ3hCLHVDQUFrQztBQUNsQywrQkFBNkI7QUFDN0Isd0JBQXNCO0FBQ3RCLHlCQUF1QjtBQUN2Qix1QkFBcUI7QUFDckIsMkJBQXlCO0FBQ3pCLHNCQUFvQjtBQUNwQix1QkFBcUI7QUFDckIsNkJBQTJCO0FBQzNCLDBEQUFvQztBQUVwQyx5QkFBeUI7QUFDekIsU0FBZ0IsYUFBYSxDQUFDLE1BQWlDO0lBQzdELElBQU0sT0FBTyxHQUFHLENBQUMsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFdBQVcsQ0FBQyxFQUFFLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxRQUFRLENBQUMsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqRyxJQUFNLE1BQU0sR0FBRztRQUNiLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUFFLE9BQU8sTUFBTSxFQUFFLENBQUM7UUFDckMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQU0sR0FBRyxHQUFHO1lBQ1YsR0FBRyxFQUFFLE1BQU07WUFDWCxLQUFLLEVBQUUsU0FBUztTQUNqQixDQUFDO1FBQ0YsT0FBTyxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFPLEdBQUcsQ0FBQzthQUN6QyxJQUFJLENBQUMsY0FBTSxPQUFBLElBQUEsaUJBQUssRUFBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQU8sR0FBRyxDQUFDLEVBQWhFLENBQWdFLENBQUM7YUFDNUUsS0FBSyxDQUFDLFVBQUMsQ0FBQztZQUNQLElBQUksQ0FBQyxZQUFZLEtBQUs7Z0JBQUUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUM7YUFDRCxPQUFPLENBQUM7WUFDUCxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztJQUNGLE9BQU8sTUFBTSxFQUFFLENBQUM7QUFDbEIsQ0FBQztBQXBCRCxzQ0FvQkM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBRTNDLGtCQUFlLGNBQUksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwZmlsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5kZXBsb3knO1xuaW1wb3J0ICcuL2d1bHAuZmVlZCc7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgJy4vZ3VscC5zZW8nO1xuaW1wb3J0ICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgJy4vZ3VscC5zdGFuZGFsb25lJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuXG4vLyBjb21taXQgY3VycmVudCBwcm9qZWN0XG5leHBvcnQgZnVuY3Rpb24gY29tbWl0UHJvamVjdChmaW5pc2g6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgZ2l0RGlycyA9IFtqb2luKHByb2Nlc3MuY3dkKCksICdzcmMtcG9zdHMnKSwgam9pbihwcm9jZXNzLmN3ZCgpLCAnc291cmNlJyksIHByb2Nlc3MuY3dkKCldO1xuICBjb25zdCBjb21taXQgPSAoKSA9PiB7XG4gICAgaWYgKCFnaXREaXJzLmxlbmd0aCkgcmV0dXJuIGZpbmlzaCgpO1xuICAgIGNvbnN0IGdpdERpciA9IGdpdERpcnNbMF07XG4gICAgY29uc3Qgb3B0ID0ge1xuICAgICAgY3dkOiBnaXREaXIsXG4gICAgICBzdGRpbzogJ2luaGVyaXQnXG4gICAgfTtcbiAgICByZXR1cm4gc3Bhd24oJ2dpdCcsIFsnYWRkJywgJy1BJ10sIDxhbnk+b3B0KVxuICAgICAgLnRoZW4oKCkgPT4gc3Bhd24oJ2dpdCcsIFsnY29tbWl0JywgJy1tJywgJ3VwZGF0ZSAnICsgbmV3IERhdGUoKV0sIDxhbnk+b3B0KSlcbiAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSBMb2dnZXIubG9nKGUubWVzc2FnZSwgZ2l0RGlyKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGdpdERpcnMuc2hpZnQoKTtcbiAgICAgICAgY29tbWl0KCk7XG4gICAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIGNvbW1pdCgpO1xufVxuXG5ndWxwLnRhc2soJ3Byb2plY3QtY29tbWl0JywgY29tbWl0UHJvamVjdCk7XG5cbmV4cG9ydCBkZWZhdWx0IGd1bHA7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/49/gulpfile_49358b99439a29678d73729f1ed5c86f.map","wrapperLength":82},"result":{"scriptId":"4441","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4983,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4980,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5kZXBsb3kudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMseUJBQWdDO0FBQ2hDLDBFQUEwRDtBQUMxRCx1REFBMkQ7QUFDM0QsOENBQWtEO0FBQ2xELG9FQUFxQztBQUNyQywrQkFBcUM7QUFDckMsd0JBQXNCO0FBQ3RCLDJCQUF5QjtBQUN6QiwwREFBb0M7QUFDcEMscUNBQW9EO0FBRXBEOzs7R0FHRztBQUNILFNBQWdCLE9BQU87SUFDYixJQUFBLFNBQVMsR0FBSyxJQUFBLHNCQUFZLEdBQUUsVUFBbkIsQ0FBb0I7SUFDckMsSUFBTSxTQUFTLEdBQUcsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzlELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLHFCQUFxQixDQUFDLEVBQUU7UUFDaEUsR0FBRyxFQUFFLFNBQVM7UUFDZCxHQUFHLEVBQUUsSUFBSTtLQUNWLENBQUM7U0FDRCxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUMxQixFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBVkQsMEJBVUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixZQUFZO0lBQzFCLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQVUsT0FBTztRQUNuQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQixD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QVc7SUFDNUIsT0FBTyxJQUFBLGNBQU0sRUFBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBQSxjQUFNLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDeEQsQ0FBQztBQUVELFNBQVM7QUFDVCxjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuZGVwbG95LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBnaXRIZWxwZXIgfSBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IHsgc3Bhd25Bc3luYyB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlci9kaXN0L3NwYXduJztcbmltcG9ydCBndWxwLCB7IFRhc2tGdW5jdGlvbkNhbGxiYWNrIH0gZnJvbSAnZ3VscCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5pbXBvcnQgeyBqb2luLCB0b1VuaXggfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb3B5R2VuKCkge1xuICBjb25zdCB7IGRlcGxveURpciB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgZ2V0Q29uZmlnKCkucHVibGljX2Rpcik7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoqJywgJyEqKi8uZ2l0KicsICchKiovdG1wLyoqJywgJyEqKi9ub2RlX21vZHVsZXMvKionXSwge1xuICAgICAgY3dkOiBwdWJsaWNEaXIsXG4gICAgICBkb3Q6IHRydWVcbiAgICB9KVxuICAgIC5waXBlKGd1bHAuZGVzdChkZXBsb3lEaXIpKVxuICAgIC5vbignZXJyb3InLCBjb25zb2xlLnRyYWNlKTtcbn1cblxuLyoqXG4gKiBhc3luY2hyb25vdXMgY29weSBnZW5lcmF0ZWQgZmlsZXMgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIHRvIGRlcGxveSBkaXIgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYXN5bmNDb3B5R2VuKCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgY29weUdlbigpLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vLyBjb3B5IHB1YmxpYyB0byAuZGVwbG95X2dpdFxuZ3VscC50YXNrKCdkZXBsb3k6Y29weScsIGNvcHlHZW4pO1xuXG4vKipcbiAqIGdpdCBwdWxsIG9uIGRlcGxveSBkaXJcbiAqIEBwYXJhbSBkb25lXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHB1bGwoZG9uZTogVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGN3ZCA9IGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyO1xuICBjb25zdCBnaCA9IGNvbmZpZy5kZXBsb3kuZ2l0aHViO1xuICBjb25zdCBkb1B1bGwgPSBhc3luYyAoY3dkOiBzdHJpbmcpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydjb25maWcnLCAncHVsbC5yZWJhc2UnLCAnZmFsc2UnXSwge1xuICAgICAgICBjd2RcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIExvZ2dlci5sb2coZS5tZXNzYWdlLCBzdWIucm9vdCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIExvZ2dlci5sb2coJ3B1bGxpbmcnLCBjd2QpO1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydwdWxsJywgJy1YJywgJ3RoZWlycyddLCB7XG4gICAgICAgIGN3ZCxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgTG9nZ2VyLmxvZygnY2Fubm90IHB1bGwnLCBjd2QpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjbG9uZSA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWV4aXN0c1N5bmMoY3dkKSkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWy4uLidjbG9uZSAtYiBtYXN0ZXIgLS1zaW5nbGUtYnJhbmNoJy5zcGxpdCgnICcpLCBjb25maWcuZGVwbG95LnJlcG8sICcuZGVwbG95X2dpdCddLCB7XG4gICAgICAgIGN3ZDogX19kaXJuYW1lXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgYXdhaXQgY2xvbmUoKTtcbiAgZG9QdWxsKGN3ZCk7XG4gIGlmIChnaCkge1xuICAgIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaC5zdWJtb2R1bGUuZ2V0KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJtb2R1bGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdWIgPSBzdWJtb2R1bGVzW2ldO1xuXG4gICAgICBkb1B1bGwoc3ViLnJvb3QpO1xuICAgIH1cbiAgfVxuICBkb25lKCk7XG59XG5cbmZ1bmN0aW9uIHN0YXR1cyhkb25lPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm47XG4gIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChzdGF0dXNlcykgPT4ge1xuICAgIHN0YXR1c2VzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgbGV0IHN0ciA9ICcnO1xuXG4gICAgICBzd2l0Y2ggKGl0ZW0uY2hhbmdlcykge1xuICAgICAgICBjYXNlICdkZWxldGVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5yZWQoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnYWRkZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZWVuKGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21vZGlmaWVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy55ZWxsb3coaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndW50cmFja2VkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5ncmV5KGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgc3RyICs9IGl0ZW0uY2hhbmdlcztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgc3RyICs9ICcgJztcbiAgICAgIHN0ciArPSBpdGVtLnBhdGg7XG4gICAgICBMb2dnZXIubG9nKHN0cik7XG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIGRvbmUoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbW1pdCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1YikgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgY29uc3Qgbm93ID0gbW9tZW50KCkudHooZ2V0Q29uZmlnKCkudGltZXpvbmUpLmZvcm1hdCgnTExMJyk7XG4gIGNvbnN0IGNvbW1pdFJvb3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBnaXRodWIuc3RhdHVzKCkudGhlbigoY2hhbmdlcykgPT4ge1xuICAgICAgICBMb2dnZXIubG9nKCdjaGFuZ2VzJywgY2hhbmdlcy5sZW5ndGgsIHRvVW5peChnaXRodWIuY3dkKS5yZXBsYWNlKHRvVW5peChwcm9jZXNzLmN3ZCgpKSwgJycpKTtcbiAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGdpdGh1Yi5hZGQoJy1BJykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBnaXRodWIuY29tbWl0KCd1cGRhdGUgc2l0ZSAnICsgbm93KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBjb21taXRTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSkge1xuICAgICAgICBjb25zdCBpbmZvID0gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICAgICAgY29uc3QgY29tbWl0U3VibW9kdWxlQ2hpbGQgPSBhc3luYyAoc3ViOiAodHlwZW9mIGluZm8pW251bWJlcl0pID0+IHtcbiAgICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBuZXcgZ2l0SGVscGVyKHN1Yi5yb290KTtcbiAgICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHN1Ym1vZHVsZS5zdGF0dXMoKTtcbiAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmFkZCgnLUEnKTtcbiAgICAgICAgICAgIGF3YWl0IHN1Ym1vZHVsZS5jb21taXQoYHVwZGF0ZSAke3N1Yi5wYXRofSAke25vd31gLCAnYW0nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGl0ZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlSXQpID0+IHtcbiAgICAgICAgICAgIC8vIHJlc29sdmUgZGlyZWN0bHkgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm8gbWFkZSBjaGFuZ2VzXG4gICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPT09IDApIHJldHVybiByZXNvbHZlSXQobnVsbCk7XG4gICAgICAgICAgICBjb21taXRTdWJtb2R1bGVDaGlsZChpbmZvWzBdKVxuICAgICAgICAgICAgICAuY2F0Y2gobm9vcClcbiAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGluZm8uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAvLyByZS1pdGVyYXRlIHdoZW4gc3VibW9kdWxlIGl0ZW1zIG5vdCBjb21taXR0ZWRcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPiAwKSByZXR1cm4gaXRlcmF0ZSgpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmVzIGFsbFxuICAgICAgICAgICAgICAgIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGl0ZXJhdGUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb21taXRTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oY29tbWl0Um9vdClcbiAgICAgIC50aGVuKCgpID0+IHJlc29sdmUobnVsbCkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbm9vcCgpIHtcbiAgLy9cbn1cblxuZnVuY3Rpb24gcHVzaCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1Yikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBzdWJtb2R1bGVzID0gZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSA/IGdpdGh1Yi5zdWJtb2R1bGUuZ2V0KCkgOiBbXTtcbiAgY29uc3QgcHVzaFN1Ym1vZHVsZSA9IGZ1bmN0aW9uIChzdWJtb2R1bGU6ICh0eXBlb2Ygc3VibW9kdWxlcylbbnVtYmVyXSkge1xuICAgIGNvbnN0IHsgdXJsLCBicmFuY2gsIHJvb3QgfSA9IHN1Ym1vZHVsZTtcbiAgICBpZiAoIXN1Ym1vZHVsZS5naXRodWIpIHtcbiAgICAgIHN1Ym1vZHVsZS5naXRodWIgPSBuZXcgZ2l0SGVscGVyKHJvb3QpO1xuICAgIH1cbiAgICBjb25zdCB7IGdpdGh1YiB9ID0gc3VibW9kdWxlO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgIGNvbnN0IHNldFIgPSAoKSA9PiBnaXRodWIuc2V0cmVtb3RlKHVybCk7XG4gICAgICBjb25zdCBzZXRCID0gKCkgPT4gZ2l0aHViLnNldGJyYW5jaChicmFuY2gpO1xuICAgICAgUHJvbWlzZS5hbGwoW3NldFIoKSwgc2V0QigpXSkudGhlbigoKSA9PiB7XG4gICAgICAgIGdpdGh1Yi5jYW5QdXNoKCkudGhlbigoYWxsb3dlZCkgPT4ge1xuICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKHJvb3QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgLy8gcHVzaCB0aGVuIHJlc29sdmVcbiAgICAgICAgICAgIGdpdGh1Yi5wdXNoKGZhbHNlLCB7IHN0ZGlvOiAncGlwZScgfSkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICdjaGFuZ2VzIG5vdCBzdGFnZWQnKTtcbiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGNoYW5nZXMgbm90IHN0YWdlZFxuICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdpdGh1Yi5pc1VwVG9EYXRlKCkudGhlbigodXBkYXRlZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgTG9nZ2VyLmxvZygnc3VibW9kdWxlJywgd29ya3NwYWNlKHJvb3QpLCAndXBkYXRlZCcsIHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBpcyB1cCB0byBkYXRlXG4gICAgICAgICAgICAgICAgICByZXNvbHZlUHVzaChudWxsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBpdGVyYXRlU3VibW9kdWxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgaWYgKHN1Ym1vZHVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBzdWJtb2R1bGVzLnNoaWZ0KCk7XG4gICAgICAgIGlmIChzdWJtb2R1bGUpIHtcbiAgICAgICAgICBwdXNoU3VibW9kdWxlKHN1Ym1vZHVsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGl0ZXJhdGVTdWJtb2R1bGUoKS50aGVuKHJlc29sdmUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGl0ZXJhdGVTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVQdXNoKSA9PiB7XG4gICAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgICBMb2dnZXIubG9nKHdvcmtzcGFjZShnaXRodWIuY3dkKSwgJ2NhbiBwdXNoJywgYWxsb3dlZCk7XG4gICAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgICBnaXRodWIucHVzaCgpLnRoZW4ocmVzb2x2ZVB1c2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNvbHZlKTtcbiAgICAvL3B1c2hTdWJtb2R1bGUoc3VibW9kdWxlc1sxXSkudGhlbihyZXNvbHZlKTtcbiAgfSk7XG59XG5cbmd1bHAudGFzaygnZGVwbG95OnB1c2gnLCBwdXNoKTtcbmd1bHAudGFzaygnZGVwbG95OnN0YXR1cycsIHN0YXR1cyk7XG5ndWxwLnRhc2soJ2RlcGxveTpjb21taXQnLCBjb21taXQpO1xuZ3VscC50YXNrKCdkZXBsb3k6cHVsbCcsIHB1bGwpO1xuXG4vKipcbiAqIGdldCByZWxhdGl2ZSBwYXRoIGZyb20gd29ya3NwYWNlXG4gKiBAcGFyYW0gc3RyXG4gKiBAcmV0dXJuc1xuICovXG5mdW5jdGlvbiB3b3Jrc3BhY2Uoc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRvVW5peChzdHIpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJyk7XG59XG5cbi8vIGRlcGxveVxuZ3VscC50YXNrKCdkZXBsb3knLCBndWxwLnNlcmllcygnZGVwbG95OnB1bGwnLCAnZGVwbG95OmNvcHknLCAnc2FmZWxpbmsnLCAnZGVwbG95OmNvbW1pdCcsICdkZXBsb3k6cHVzaCcpKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/29/gulpdeploy_294088671a308604e99e2f253a1fa5cc.map","wrapperLength":82},"result":{"scriptId":"4442","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39671,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39668,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5mZWVkLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEseUJBQXVFO0FBQ3ZFLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXdCO0FBQ3hCLHVDQUFtRDtBQUNuRCxzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLHNFQUErQztBQUMvQyxxQ0FBb0Q7QUFFcEQsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUIsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsVUFBVSxJQUFJO0lBQzlCLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sUUFBUSxHQUFHLElBQUksY0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQ25CLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUFHO2dCQUM3QixPQUFPLHdCQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztZQUVILFNBQVMsS0FBSyxDQUFDLE9BQTZCLEVBQUUsSUFBMEI7Z0JBQ3RFLElBQU0sUUFBUSxHQUFHLGtCQUFRLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQVksRUFBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRXZFLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6QyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUIsS0FBSyxHQUFHLEtBQUssQ0FB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SSxDQUFDLFNBQVMsSUFBSSwwRkFBNEUsT0FBTyxpQkFBYSxDQUFDO2lCQUN6SDtnQkFDRCxzQkFBc0I7Z0JBQ3RCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sZ0JBQVksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO29CQUNyRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsMEJBQXdCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUM1RDtvQkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw0RkFBOEUsT0FBTyxrQkFBYyxDQUFDO2lCQUM1SDtnQkFDRCx1RUFBdUU7WUFDekUsQ0FBQyxDQUFDLENBQ0g7aUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLElBQUksRUFBRSxFQUFOLENBQU0sQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLmZlZWQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGF0aE9yRmlsZURlc2NyaXB0b3IsIHJlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IsIGdyYXZhdGFyIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuZ3VscC50YXNrKCdmZWVkJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oY29uZmlnLmN3ZCk7XG5cbiAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgIGluc3RhbmNlLmxvYWQoKS50aGVuKCgpID0+IHtcbiAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIGJ1aWxkKHRtcGxTcmM6IFBhdGhPckZpbGVEZXNjcmlwdG9yLCBkZXN0OiBQYXRoT3JGaWxlRGVzY3JpcHRvcikge1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuXG4gICAgICAgIGxldCBwb3N0cyA9IGluc3RhbmNlLmxvY2Fscy5nZXQoJ3Bvc3RzJyk7XG4gICAgICAgIHBvc3RzID0gcG9zdHMuc29ydCgnLWRhdGUnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5maWx0ZXIoKHBvc3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gcG9zdC5kcmFmdCAhPT0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgeyBlbWFpbCwgZmVlZCwgdXJsOiB1cmxDZmcgfSA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgeyBpY29uOiBpY29uQ2ZnIH0gPSBmZWVkO1xuXG4gICAgICAgIGxldCB1cmwgPSB1cmxDZmc7XG4gICAgICAgIGlmICh1cmxbdXJsLmxlbmd0aCAtIDFdICE9PSAnLycpIHVybCArPSAnLyc7XG4gICAgICAgIC8vIHJlbW92ZSBicm9rZW4gaGV4byBsYW5nIHNob3J0Y29kZVxuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCc6bGFuZy8nKSkgdXJsID0gdXJsLnJlcGxhY2UoJy86bGFuZy8nLCAnLycpO1xuXG4gICAgICAgIGxldCBpY29uID0gJyc7XG4gICAgICAgIGlmIChpY29uQ2ZnKSBpY29uID0gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIGljb25DZmcpO1xuICAgICAgICBlbHNlIGlmIChlbWFpbCkgaWNvbiA9IGdyYXZhdGFyKGVtYWlsLCB7fSk7XG5cbiAgICAgICAgY29uc3QgZmVlZF91cmwgPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgJ3Jzcy54bWwnKTtcblxuICAgICAgICBjb25zdCBkYXRhID0gdGVtcGxhdGUucmVuZGVyKHtcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIGljb24sXG4gICAgICAgICAgcG9zdHMsXG4gICAgICAgICAgZmVlZF91cmxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd3JpdGVGaWxlU3luYyhkZXN0LCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGVtcGxhdGVSU1MgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfcnNzLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdFJTUyA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdyc3MueG1sJyk7XG4gICAgICBidWlsZCh0ZW1wbGF0ZVJTUywgZGVzdFJTUyk7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlQVRPTSA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9hdG9tLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdEFUT00gPSBqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnYXRvbS54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlQVRPTSwgZGVzdEFUT00pO1xuXG4gICAgICBjb25zdCBiYXNlVVJMID0gY29uZmlnLnVybC5lbmRzV2l0aCgnLycpID8gY29uZmlnLnVybCA6IGNvbmZpZy51cmwgKyAnLyc7XG5cbiAgICAgIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgZ3VscFxuICAgICAgICAuc3JjKCcqKi8qLmh0bWwnLCB7IGN3ZDogcHVibGljRGlyLCBpZ25vcmU6IGNvbW1vbklnbm9yZSB9KVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGF1dG8gZGlzY292ZXJ5IHJzc1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3Jzcy54bWxcIl1gKS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInJzcy1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9yc3MreG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCIgLz5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgYXRvbVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwiYXRvbS1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9hdG9tK3htbFwiIHJlbD1cImFsdGVybmF0ZVwiIGhyZWY9XCIke2Jhc2VVUkx9YXRvbS54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiBkb25lKCkpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/fb/gulpfeed_fbf9aaad66351334553810020391b0ff.map","wrapperLength":82},"result":{"scriptId":"4443","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13358,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13355,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673322423740,"runtime":4789,"slow":false,"start":1673322418951},"skipped":false,"testFilePath":"/home/runner/work/static-blog-generator/static-blog-generator/test/permalink-yyyy-mm-title.test.ts","testResults":[{"ancestorTitles":["permalink","/:year/:month/:title/","clean"],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["permalink","/:year/:month/:title/","clean"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["permalink","/:year/:month/:title/","copy"],"duration":2137,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["permalink","/:year/:month/:title/","copy"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"},{"ancestorTitles":["permalink","/:year/:month/:title/","validate"],"duration":12,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ validate post with custom permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post with custom permalink"},{"ancestorTitles":["permalink","/:year/:month/:title/","validate"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ validate post without permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post without permalink"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.util = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nexports.util = __importStar(require(\"./utils\"));\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0M7QUFBdEMsbUhBQUEsT0FBTyxPQUFlO0FBQy9CLHNEQUFnRTtBQUF2RCx5SEFBQSxPQUFPLE9BQWM7QUFDOUIsc0RBQStEO0FBQXRELHdIQUFBLE9BQU8sT0FBYTtBQUM3QiwyQ0FBOEQ7QUFBckQscUdBQUEsT0FBTyxPQUFBO0FBQUUsaUdBQUEsR0FBRyxPQUFBO0FBQUUsdUdBQUEsR0FBRyxPQUFhO0FBQ3ZDLHVDQUFnRDtBQUF2QyxtR0FBQSxPQUFPLE9BQVc7QUFDM0IsK0NBQXNFO0FBQTdELCtHQUFBLGVBQWUsT0FBQTtBQUFFLG1IQUFBLG1CQUFtQixPQUFBO0FBQzdDLHFEQUFnRTtBQUF2RCxvSUFBQSxPQUFPLE9BQW9CO0FBQ3BDLHVDQUE0RDtBQUFuRCx5R0FBQSxhQUFhLE9BQUE7QUFBRSxpSEFBQSxPQUFPLE9BQVE7QUFDdkMsb0NBQTJEO0FBQWxELG9HQUFBLFlBQVksT0FBQTtBQUFFLHNHQUFBLGNBQWMsT0FBQTtBQUNyQyx3Q0FBMkM7QUFBbEMsb0dBQUEsVUFBVSxPQUFBO0FBQ25CLGdEQUFnQztBQUNoQyx1Q0FBK0U7QUFBdEUscUdBQUEsWUFBWSxPQUFBO0FBQUUsMkdBQUEsa0JBQWtCLE9BQUE7QUFBRSxxR0FBQSxZQUFZLE9BQUE7QUFDdkQscUNBQW9DO0FBQTNCLDRGQUFBLElBQUksT0FBQTtBQUNiLCtDQUF5RDtBQUFoRCx1SEFBQSxPQUFPLE9BQWE7QUFDN0IscUNBQStEO0FBQXRELHVHQUFBLFlBQVksT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUUzQyxFQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGRlZmF1bHQgYXMgQXBwbGljYXRpb24gfSBmcm9tICcuL2FwaSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBDYWNoZWQgfSBmcm9tICcuL2d1bHAtdXRpbHMvZ3VscC5jYWNoZSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBEZWJ1ZyB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmRlYnVnJztcbmV4cG9ydCB7IGNsZWFuRGIsIGRlbCwgZGVsIGFzIGRlbGV0ZURpciB9IGZyb20gJy4vZ3VscC5jbGVhbic7XG5leHBvcnQgeyB0YXNrU2VvIGFzIGF1dG9TZW8gfSBmcm9tICcuL2d1bHAuc2VvJztcbmV4cG9ydCB7IGdlbmVyYXRlU2l0ZW1hcCwgaGV4b0dlbmVyYXRlU2l0ZW1hcCB9IGZyb20gJy4vZ3VscC5zaXRlbWFwJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc3RhbmRhbG9uZVJ1bm5lciB9IGZyb20gJy4vZ3VscC5zdGFuZGFsb25lJztcbmV4cG9ydCB7IGNvbW1pdFByb2plY3QsIGRlZmF1bHQgYXMgZ3VscCB9IGZyb20gJy4vZ3VscGZpbGUnO1xuZXhwb3J0IHsgY29weUFsbFBvc3RzLCBjb3B5U2luZ2xlUG9zdCB9IGZyb20gJy4vcG9zdC9jb3B5JztcbmV4cG9ydCB7IHVwZGF0ZVBvc3QgfSBmcm9tICcuL3Bvc3QvdXBkYXRlJztcbmV4cG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlscyc7XG5leHBvcnQgeyBhcnJheV9yYW5kb20sIGFycmF5X3JlbW92ZV9lbXB0eSwgYXJyYXlfdW5pcXVlIH0gZnJvbSAnLi91dGlscy9hcnJheSc7XG5leHBvcnQgeyBub29wIH0gZnJvbSAnLi91dGlscy9ub29wJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc2NoZWR1bGVyIH0gZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuZXhwb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8vXG4iXSwidmVyc2lvbiI6M30=","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport * as util from './utils';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/09/index_09c0a821b29a6a45121212479559f319.map","wrapperLength":82},"result":{"scriptId":"5757","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":7904,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":7901,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1179,"endOffset":1260,"count":2},{"startOffset":1237,"endOffset":1257,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1946,"endOffset":2000,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2130,"endOffset":2191,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2320,"endOffset":2381,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2497,"endOffset":2541,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2609,"endOffset":2649,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2723,"endOffset":2763,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2875,"endOffset":2917,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3045,"endOffset":3099,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3183,"endOffset":3241,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3376,"endOffset":3442,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3560,"endOffset":3608,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3677,"endOffset":3736,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3850,"endOffset":3893,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3972,"endOffset":4017,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4133,"endOffset":4176,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4342,"endOffset":4386,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4469,"endOffset":4519,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4596,"endOffset":4640,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4747,"endOffset":4782,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4904,"endOffset":4964,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5079,"endOffset":5125,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5199,"endOffset":5242,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5316,"endOffset":5359,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar chain_1 = require(\"./utils/chain\");\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = (0, _config_1.getConfig)();\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, chain_1.chain)([{ callback: gulp_standalone_1.default }]); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, _this.config.public_dir)); };\n        /**\n         * Copy all **src-post** to **source/_posts** (run before generate)\n         * * see the method {@link pcopy.copyAllPosts}\n         * @returns\n         */\n        this.copy = function () { return (0, chain_1.chain)([{ callback: function () { return pcopy.copyAllPosts(undefined, _this.config); } }]); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        this.cwd = cwd;\n        (0, _config_1.fetchConfig)(cwd);\n        options = Object.assign(this.config, options || {}, { cwd: cwd });\n        this.config = (0, _config_1.setConfig)(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 3:\n                        if (!(opt === 'archive')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 5:\n                        if (!(opt === 'post')) return [3 /*break*/, 7];\n                        return [4 /*yield*/, cleaner.cleanGeneratedPosts().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 7: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 8:\n                        _a.sent();\n                        _a.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBd0I7QUFDeEIsK0JBQTZCO0FBRTdCLG9EQUF3QztBQUN4QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsdUNBQXNDO0FBQ3RDLHNEQUFnQztBQUNoQyxnRUFBMEM7QUFDMUMscUNBQThEO0FBRTlEO0lBTUU7OztPQUdHO0lBQ0gsYUFBWSxHQUFxQixFQUFFLE9BQXlDO1FBQTVFLGlCQVNDO1FBakJELFdBQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztRQUNyQixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQUN0QixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQXlCdEI7OztXQUdHO1FBQ0gsZUFBVSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLHlCQUFnQixFQUFFLENBQUMsQ0FBQyxFQUF2QyxDQUF1QyxDQUFDO1FBRTNEOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBckQsQ0FBcUQsQ0FBQztRQUVsRTs7OztXQUlHO1FBQ0gsU0FBSSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLGNBQU0sT0FBQSxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQTFDLENBQTBDLEVBQUUsQ0FBQyxDQUFDLEVBQXZFLENBQXVFLENBQUM7UUFFckY7OztX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RCxrQkFBZSxHQUFHLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIZXhvIGZyb20gJ2hleG8nO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IE51bGxhYmxlIH0gZnJvbSAnLi9nbG9iYWxzJztcbmltcG9ydCAqIGFzIGNsZWFuZXIgZnJvbSAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgeyBjaGFpbiB9IGZyb20gJy4vdXRpbHMvY2hhaW4nO1xuaW1wb3J0IG5vb3AgZnJvbSAnLi91dGlscy9ub29wJztcbmltcG9ydCBzY2hlZHVsZXIgZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuaW1wb3J0IHsgZmV0Y2hDb25maWcsIGdldENvbmZpZywgc2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY2xhc3MgU0JHIHtcbiAgY3dkOiBzdHJpbmc7XG4gIGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBmZXRjaENvbmZpZyhjd2QpO1xuICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlnLCBvcHRpb25zIHx8IHt9LCB7IGN3ZCB9KTtcblxuICAgIHRoaXMuY29uZmlnID0gc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBjaGFpbihbeyBjYWxsYmFjazogc3RhbmRhbG9uZVJ1bm5lciB9XSk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCB0aGlzLmNvbmZpZy5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSA9ICgpID0+IGNoYWluKFt7IGNhbGxiYWNrOiAoKSA9PiBwY29weS5jb3B5QWxsUG9zdHModW5kZWZpbmVkLCB0aGlzLmNvbmZpZykgfV0pO1xuXG4gIC8qKlxuICAgKiBBbm9ueW1pemUgZXh0ZXJuYWwgbGlua3Mgb24gcHVibGljIGRpciAoX2NvbmZpZ195bWwucHVibGljX2RpcikgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBzYWZlbGluayA9ICgpID0+IHRhc2tTYWZlbGluayhub29wLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIGdlbmVyYXRlIHNpdGUgd2l0aCBoZXhvXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZSgpIHtcbiAgICBjb25zdCBoZXhvID0gbmV3IEhleG8odGhpcy5jd2QpO1xuICAgIC8vIGhleG8gaW5pdFxuICAgIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8ubG9hZCgpLmNhdGNoKG5vb3ApO1xuICAgIC8vIGhleG8gZ2VuZXJhdGVcbiAgICBhd2FpdCBoZXhvLmNhbGwoJ2dlbmVyYXRlJykuY2F0Y2gobm9vcCk7XG4gICAgYXdhaXQgaGV4by5leGl0KCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlJyB8ICdkYXRhYmFzZScgfCAncG9zdCcpIHtcbiAgICBpZiAob3B0ID09PSAnYWxsJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbkRiKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSBpZiAob3B0ID09PSAnYXJjaGl2ZScpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ3Bvc3QnKSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuR2VuZXJhdGVkUG9zdHMoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU0JHO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport { chain } from './utils/chain';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { fetchConfig, getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = getConfig();\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    this.cwd = cwd;\n    fetchConfig(cwd);\n    options = Object.assign(this.config, options || {}, { cwd });\n\n    this.config = setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => chain([{ callback: standaloneRunner }]);\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, this.config.public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy = () => chain([{ callback: () => pcopy.copyAllPosts(undefined, this.config) }]);\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archive' | 'database' | 'post') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archive') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'post') {\n      await cleaner.cleanGeneratedPosts().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/a8/api_a829825f326b4691c16e18cc91565c70.map","wrapperLength":82},"result":{"scriptId":"5758","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":16899,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":16896,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":7},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":4},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":3},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":3},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":5},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":5},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":4},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4395,"endOffset":9162,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4488,"endOffset":6135,"count":1},{"startOffset":5851,"endOffset":5871,"count":0},{"startOffset":5990,"endOffset":5995,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4847,"endOffset":4932,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5078,"endOffset":5186,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.copy","ranges":[{"startOffset":5383,"endOffset":5510,"count":1}],"isBlockCoverage":true},{"functionName":"callback","ranges":[{"startOffset":5436,"endOffset":5503,"count":1}],"isBlockCoverage":true},{"functionName":"SBG.safelink","ranges":[{"startOffset":5677,"endOffset":5819,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":6153,"endOffset":6206,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":6225,"endOffset":6276,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6354,"endOffset":7447,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":7618,"endOffset":9143,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7682,"endOffset":9135,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7733,"endOffset":9123,"count":5},{"startOffset":7805,"endOffset":7967,"count":1},{"startOffset":7883,"endOffset":7967,"count":0},{"startOffset":7988,"endOffset":8123,"count":0},{"startOffset":8144,"endOffset":8235,"count":0},{"startOffset":8256,"endOffset":8431,"count":1},{"startOffset":8338,"endOffset":8431,"count":0},{"startOffset":8452,"endOffset":8543,"count":0},{"startOffset":8564,"endOffset":8739,"count":1},{"startOffset":8643,"endOffset":8739,"count":0},{"startOffset":8760,"endOffset":8851,"count":0},{"startOffset":8872,"endOffset":8939,"count":1},{"startOffset":8960,"endOffset":9040,"count":1},{"startOffset":9061,"endOffset":9091,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHNEQUFnQztBQUNoQyxxQ0FBOEQ7QUFDOUQsOENBQXdCO0FBQ3hCLHlCQUF5QjtBQUN6QiwrQkFBNkI7QUFDN0IsNkJBQStCO0FBQy9CLHdEQUFrQztBQUNsQyxpQ0FBdUM7QUFDdkMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyxxQ0FBc0M7QUFFdEM7O0dBRUc7QUFDSCxTQUFzQixPQUFPLENBQUMsUUFBa0QsRUFBRSxLQUFnQjs7Ozs7O29CQUMxRixHQUFHLEdBQUcsSUFBQSxlQUFLLEVBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3JCLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztvQkFDM0IsSUFBSSxPQUFPLE1BQU0sQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFO3dCQUN6QyxJQUFBLGNBQVMsRUFBQyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHNCQUFzQixDQUFDLEVBQUUsSUFBQSxjQUFPLEVBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzt3QkFDckUsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO3FCQUN6RDtvQkFJRyxJQUFJLEdBQUc7d0JBQ1QsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQzt3QkFDN0MsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxXQUFXLENBQUM7d0JBQzdCLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDO3dCQUM1QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxF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QUUsZ0JBQWdCLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvQixjQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0FBQzdDLGNBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGNBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZGRpciwgcm0sIFJtT3B0aW9ucyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IGluc3BlY3QgfSBmcm9tICd1dGlsJztcbmltcG9ydCBkZWJ1ZyBmcm9tICcuL3V0aWxzL2RlYnVnJztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBDbGVhbiBQcm9qZWN0IERhdGFiYXNlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5EYihjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSwgZmlsZXM/OiBzdHJpbmdbXSkge1xuICBjb25zdCBsb2cgPSBkZWJ1ZygnY2xlYW4nKTtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGlmICh0eXBlb2YgY29uZmlnLnNvdXJjZV9kaXIgIT09ICdzdHJpbmcnKSB7XG4gICAgd3JpdGVmaWxlKGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvY2xlYW4ubG9nJyksIGluc3BlY3QoY29uZmlnKSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjb25maWcuc291cmNlX2RpciBtdXN0IGJlIGNvbmZpZ3VyZWQnKTtcbiAgfVxuXG4gIC8vIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuXG4gIGxldCBkaXJzID0gW1xuICAgIGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnNvdXJjZV9kaXIsICdfcG9zdHMnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvY2FjaGUnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvZHVtcCcpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9sb2dzJyksXG4gICAgam9pbihjb25maWcuY3dkLCAnZGIuanNvbicpXG4gIF07XG4gIGlmIChBcnJheS5pc0FycmF5KGZpbGVzKSkgZGlycyA9IGRpcnMuY29uY2F0KGZpbGVzKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZGlyID0gZGlyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICBsb2coJ2NsYW5pbmcnLCBkaXIpO1xuICAgICAgICBhd2FpdCBkZWwoZGlyKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIGxvZygnY2Fubm90IGRlbGV0ZScsIGRpcik7XG4gICAgfVxuICB9XG5cbiAgLypjb25zdCBoZXhvID0gbmV3IGhleG9MaWIoY29uZmlnLmN3ZCk7XG4gIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICBhd2FpdCBoZXhvLmNhbGwoJ2NsZWFuJykuY2F0Y2gobm9vcCk7Ki9cblxuICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSByZXR1cm4gY2FsbGJhY2soKTtcblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIGRlbGV0ZSBmb2xkZXIgYXN5bmNcbiAqIEBwYXJhbSBwYXRoXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsKHBhdGg6IHN0cmluZykge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgcm1PcHQ6IFJtT3B0aW9ucyA9IHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9O1xuICAgIGlmIChleGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIC8qaWYgKHN0YXRTeW5jKHBhdGgpLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgcm1kaXIocGF0aCwgeyBtYXhSZXRyaWVzOiAxMCB9KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm0ocGF0aCwgcm1PcHQpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9Ki9cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzb2x2ZShuZXcgRXJyb3IocGF0aCArICcgbm90IGZvdW5kJykpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogY2xlYW4gb2xkIGFyY2hpdmVzIChjYXRlZ29yaWVzLCB0YWdzLCBwYWdpbmF0aW9uKSBmcm9tIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbk9sZEFyY2hpdmVzKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCBsb2duYW1lID0gJ2NsZWFuOicgKyBhbnNpQ29sb3JzLmdyZXkoJ2FyY2hpdmVzJyk7XG5cbiAgLy8gY2xlYW4gYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNcbiAgY29uc3QgYXJjaGl2ZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuYXJjaGl2ZV9kaXIpO1xuICBjb25zdCBjYXRlZ29yaWVzID0gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgY29uZmlnLmNhdGVnb3J5X2Rpcik7XG4gIGNvbnN0IHRhZ3MgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcudGFnX2Rpcik7XG4gIGNvbnN0IGZvbGRlcnMgPSBbYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNdLmZpbHRlcigoc3RyKSA9PiBleGlzdHNTeW5jKHN0cikpO1xuXG4gIC8vIHB1c2ggbGFuZ3VhZ2UgZm9sZGVyIHRvIGJlIGRlbGV0ZWQgZnJvbSBkZXBsb3kgZGlyXG4gIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5sYW5ndWFnZSkpIHtcbiAgICBjb25zdCBsYW5nRGlyID0gY29uZmlnLmxhbmd1YWdlLm1hcCgocGF0aCkgPT4gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgcGF0aCkpO1xuICAgIGZvbGRlcnMucHVzaCguLi5sYW5nRGlyKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnLmxhbmd1YWdlID09PSAnc3RyaW5nJyAmJiBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgIGZvbGRlcnMucHVzaChqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKSkpO1xuICB9XG5cbiAgLy8gZGVsZXRlIHBhZ2luYXRpb25cbiAgY29uc3QgcGFnZXNEaXIgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCAncGFnZScpO1xuICBpZiAoZXhpc3RzU3luYyhwYWdlc0RpcikpIHtcbiAgICBjb25zdCBwYWdlcyA9IChhd2FpdCByZWFkZGlyKHBhZ2VzRGlyKSkuZmlsdGVyKChzdHIpID0+IC9eXFxkKyQvLnRlc3Qoc3RyKSkubWFwKChzdHIpID0+IGpvaW4ocGFnZXNEaXIsIHN0cikpO1xuICAgIGZvbGRlcnMucHVzaCguLi5wYWdlcyk7XG4gIH1cblxuICBjb25zdCBwcm9taXNlczogUHJvbWlzZTxhbnk+W10gPSBbXTtcblxuICAvLyBkdW1wIHRvIGZpbGVcbiAgY29uc3QgZHVtcGZpbGUgPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9jbGVhbi50eHQnKTtcbiAgd3JpdGVmaWxlKGR1bXBmaWxlLCBmb2xkZXJzLmpvaW4oRU9MKSk7XG4gIExvZ2dlci5sb2cobG9nbmFtZSwgJ2xpc3QgZGVsZXRlZCBmaWxlcycsIGR1bXBmaWxlKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGZvbGRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBwYXRoU3RyID0gZm9sZGVyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMocGF0aFN0cikpIHByb21pc2VzLnB1c2goZGVsKHBhdGhTdHIpLmNhdGNoKG5vb3ApKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuICB9XG5cbiAgY29uc3QgZmluaXNoTm93ID0gZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjbGVhbiBhcmNoaXZlcyBoYXMgc29tZSBlcnJvcycpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSBjYWxsYmFjaygpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgYXdhaXQgQmx1ZWJpcmQuYWxsKHByb21pc2VzKS50aGVuKGZpbmlzaE5vdykuY2F0Y2goZmluaXNoTm93KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuR2VuZXJhdGVkUG9zdHMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIHJldHVybiBjbGVhbkRiKGNhbGxiYWNrLCBbam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpXSk7XG59XG5cbmd1bHAudGFzaygnY2xlYW46YXJjaGl2ZScsIGNsZWFuT2xkQXJjaGl2ZXMpO1xuZ3VscC50YXNrKCdjbGVhbjpkYicsIGNsZWFuRGIpO1xuZ3VscC50YXNrKCdjbGVhbjpwb3N0JywgY2xlYW5HZW5lcmF0ZWRQb3N0cyk7XG5ndWxwLnRhc2soJ2NsZWFuOmFsbCcsIGd1bHAuc2VyaWVzKCdjbGVhbjpkYicsICdjbGVhbjphcmNoaXZlJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/6b/gulpclean_6b5cfe0a3f5f375b9d7210604d22c51b.map","wrapperLength":82},"result":{"scriptId":"6293","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24224,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24221,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = exports.fetchConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexoPostParser = __importStar(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nfunction fetchConfig(fileYML) {\n    if (!fileYML.endsWith('_config.yml'))\n        fileYML += '/_config.yml';\n    var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n    setConfig((0, object_1.orderKeys)(configYML));\n    (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\nexports.fetchConfig = fetchConfig;\nfetchConfig((0, path_1.join)(process.cwd(), '_config.yml'));\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign(settledConfig || {}, obj);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nfunction getConfig() {\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : { submodule: [] };\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvX2NvbmZpZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBOEM7QUFDOUMsMEVBQXFDO0FBRXJDLCtEQUFtRDtBQUNuRCw2QkFBNEI7QUFDNUIsOENBQXdCO0FBQ3hCLHVDQUE4QztBQUM5QyxpQ0FBdUM7QUFDdkMseUNBQTJDO0FBNEQzQyxJQUFJLGFBQWEsR0FBRyxJQUFBLDJCQUFnQixHQUF5QixDQUFDO0FBRTlELFNBQWdCLFdBQVcsQ0FBQyxPQUFlO0lBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztRQUFFLE9BQU8sSUFBSSxjQUFjLENBQUM7SUFDaEUsSUFBTSxTQUFTLEdBQUcsY0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDN0QsU0FBUyxDQUFDLElBQUEsa0JBQVMsRUFBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqRixDQUFDO0FBTEQsa0NBS0M7QUFFRCxXQUFXLENBQUMsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFFaEQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRXhELGlDQUFpQztJQUNqQyxjQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sU0FBUyxFQUFFLENBQUM7QUFDckIsQ0FBQztBQU5ELDhCQU1DO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVM7SUFDdkIsYUFBYSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLElBQUksRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDakYsOEZBQThGO0lBQzlGLE9BQU8sYUFBeUIsQ0FBQztBQUNuQyxDQUFDO0FBSkQsOEJBSUM7QUFFRCxTQUFnQixZQUFZOztJQUMxQixJQUFNLFNBQVMsR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLFVBQVUsSUFBRyxNQUFBLGFBQWEsQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQSxJQUFJLEtBQUssQ0FBQyxDQUFDO0lBQzVGLElBQU0sTUFBTSxHQUFHLElBQUEsZUFBVSxFQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLDRCQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFFLEVBQUUsU0FBUyxFQUFFLEVBQVcsRUFBcUIsQ0FBQztJQUMzRyxPQUFPLEVBQUUsU0FBUyxXQUFBLEVBQUUsTUFBTSxRQUFBLEVBQUUsQ0FBQztBQUMvQixDQUFDO0FBSkQsb0NBSUM7QUFFRDs7Ozs7O0dBTUc7QUFDVSxRQUFBLFlBQVksR0FBRztJQUMxQixrQkFBa0I7SUFDbEIsc0JBQXNCO0lBQ3RCLDZCQUE2QjtJQUM3QiwwQ0FBMEM7SUFDMUMsaUJBQWlCO0lBQ2pCLGFBQWE7SUFDYixvQkFBb0I7SUFDcEIsV0FBVztJQUNYLGFBQWE7SUFDYixjQUFjO0lBQ2QsZUFBZTtJQUNmLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsMEJBQTBCO0lBQzFCLGdCQUFnQjtJQUNoQixvQkFBb0I7SUFDcEIsb0JBQW9CO0lBQ3BCLGFBQWE7SUFDYixPQUFPLENBQUMsWUFBWTtDQUNyQixDQUFDO0FBRUY7O0dBRUc7QUFDVSxRQUFBLGNBQWMsMENBQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLGtCQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxVQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL19jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgKiBhcyBoZXhvUG9zdFBhcnNlciBmcm9tICdoZXhvLXBvc3QtcGFyc2VyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaENvbmZpZyhmaWxlWU1MOiBzdHJpbmcpIHtcbiAgaWYgKCFmaWxlWU1MLmVuZHNXaXRoKCdfY29uZmlnLnltbCcpKSBmaWxlWU1MICs9ICcvX2NvbmZpZy55bWwnO1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKHJlYWRGaWxlU3luYyhmaWxlWU1MLCAndXRmLTgnKSk7XG4gIHNldENvbmZpZyhvcmRlcktleXMoY29uZmlnWU1MKSk7XG4gIHdyaXRlZmlsZShqb2luKF9fZGlybmFtZSwgJ19jb25maWcuanNvbicpLCBKU09OLnN0cmluZ2lmeShjb25maWdZTUwsIG51bGwsIDIpKTtcbn1cblxuZmV0Y2hDb25maWcoam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKSk7XG5cbi8qKlxuICogQ29uZmlnIHNldHRlclxuICogKiB1c2VmdWwgZm9yIGplc3RcbiAqIEBwYXJhbSBvYmpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENvbmZpZyhvYmo6IFJlY29yZDxzdHJpbmcsIGFueT4gfCBQcm9qQ29uZikge1xuICBzZXR0bGVkQ29uZmlnID0gT2JqZWN0LmFzc2lnbihzZXR0bGVkQ29uZmlnIHx8IHt9LCBvYmopO1xuXG4gIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICBoZXhvUG9zdFBhcnNlci5zZXRDb25maWcoc2V0dGxlZENvbmZpZyk7XG4gIHJldHVybiBnZXRDb25maWcoKTtcbn1cblxuLyoqXG4gKiBDb25maWcgZ2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZygpIHtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXBsb3lDb25maWcoKSB7XG4gIGNvbnN0IGRlcGxveURpciA9IGpvaW4oc2V0dGxlZENvbmZpZy5jd2QsICcuZGVwbG95XycgKyBzZXR0bGVkQ29uZmlnLmRlcGxveT8udHlwZSB8fCAnZ2l0Jyk7XG4gIGNvbnN0IGdpdGh1YiA9IGV4aXN0c1N5bmMoZGVwbG95RGlyKSA/IG5ldyBnaXQoZGVwbG95RGlyKSA6ICh7IHN1Ym1vZHVsZTogW10gYXMgZ2l0W10gfSBhcyB1bmtub3duIGFzIGdpdCk7XG4gIHJldHVybiB7IGRlcGxveURpciwgZ2l0aHViIH07XG59XG5cbi8qKlxuICogY29tbW9uIGlnbm9yZSBmaWxlc1xuICogQGV4YW1wbGVcbiAqIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICogY29uc3QgZXhjbHVkZXMgPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gKiBleGNsdWRlcy5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gKi9cbmV4cG9ydCBjb25zdCBjb21tb25JZ25vcmUgPSBbXG4gICcqKi95YW5kZXhfKi5odG1sJywgLy8gc2tpcCB5YW5kZXggdmVyaWZpY2F0aW9uIGZpbGVcbiAgLy8gJyoqL2NvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovZGlzcXVzLWNvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovY29tbWVudC5odG1sJywgLy8gc2tpcCBjb21tZW50Lmh0bWxcbiAgJyoqL2Zhdmljb24uaHRtbCcsIC8vIHNraXAgZmF2aWNvblxuICAnKiovNDA0Lmh0bWwnLCAvLyBza2lwIDQwNFxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gc2tpcCBub2RlX21vZHVsZXNcbiAgJyoqL3RtcC8qKicsIC8vIHNraXAgdG1wXG4gICcqKi9idWlsZC8qKicsIC8vIHNraXAgYnVpbGRcbiAgJyoqLy5jYWNoZS8qKicsIC8vIHNraXAgY29tbW9uIGNhY2hlIGZvbGRlclxuICAnKiovLnZzY29kZS8qKicsIC8vIHNraXAgdnNjb2RlIGNvbmZpZ3VyYXRpb24gZm9sZGVyXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyBza2lwIGZyb250bWF0dGVyIHZzY29kZSBleHRlbnNpb25cbiAgJyoqL3BpbnRlcmVzdC0qLmh0bWwnLCAvLyBza2lwIHBpbnRlcmVzdCB2ZXJpZmljYXRpb24gZmlsZVxuICAnKiovXyouc3RhbmRhbG9uZS57anMsdHN9JywgLy8gc2tpcCBfZmlsZW5hbWUuc3RhbmRhbG9uZS5qc1xuICAnKiovZGVza3RvcC5pbmknLCAvLyB3aW5kb3dzIGRlc2t0b3AuaW5pXG4gICcqKi9ub2RlX21vZHVsZXMvKionLCAvLyBub2RlX21vZHVsZXNcbiAgJyoqLy5mcm9udG1hdHRlci8qKicsIC8vIHZzY29kZSBmcm9udG1hdHRlciBwbHVnaW5cbiAgJyoqLy5naXQqLyoqJywgLy8gYW55IGdpdCBjb25maWdzXG4gICcqKi8uKicgLy8gc2tpcCBkb3RzXG5dO1xuXG4vKipcbiAqIGFycmF5IG9mIGNvbmZpZy5leGNsdWRlLCBjb25maWcuaWdub3JlXG4gKi9cbmV4cG9ydCBjb25zdCBwcm9qZWN0SWdub3JlcyA9IFsuLi4oZ2V0Q29uZmlnKCkuc2tpcF9yZW5kZXIgfHwgW10pLCAuLi4oZ2V0Q29uZmlnKCkuaWdub3JlIHx8IFtdKV07XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport * as hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nexport function fetchConfig(fileYML: string) {\n  if (!fileYML.endsWith('_config.yml')) fileYML += '/_config.yml';\n  const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n  setConfig(orderKeys(configYML));\n  writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\n\nfetchConfig(join(process.cwd(), '_config.yml'));\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign(settledConfig || {}, obj);\n\n  // update hexo-post-parser config\n  hexoPostParser.setConfig(settledConfig);\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nexport function getConfig() {\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : ({ submodule: [] as git[] } as unknown as git);\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/cd/_config_cdd6159bd7bcb99ef891db3f4cdffa50.map","wrapperLength":82},"result":{"scriptId":"6656","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13247,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13244,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":1161,"endOffset":1611,"count":2},{"startOffset":1255,"endOffset":1264,"count":0},{"startOffset":1342,"endOffset":1352,"count":0},{"startOffset":1379,"endOffset":1396,"count":0},{"startOffset":1407,"endOffset":1446,"count":0},{"startOffset":1504,"endOffset":1524,"count":0},{"startOffset":1526,"endOffset":1536,"count":0},{"startOffset":1572,"endOffset":1586,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":1665,"endOffset":1992,"count":2},{"startOffset":1733,"endOffset":1928,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2050,"endOffset":2131,"count":2},{"startOffset":2102,"endOffset":2107,"count":1},{"startOffset":2108,"endOffset":2128,"count":1}],"isBlockCoverage":true},{"functionName":"fetchConfig","ranges":[{"startOffset":2751,"endOffset":3102,"count":2},{"startOffset":2833,"endOffset":2859,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":3259,"endOffset":3454,"count":3},{"startOffset":3333,"endOffset":3338,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3544,"endOffset":3779,"count":609},{"startOffset":3629,"endOffset":3634,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3811,"endOffset":4174,"count":609},{"startOffset":3973,"endOffset":3981,"count":0},{"startOffset":3993,"endOffset":4001,"count":0},{"startOffset":4053,"endOffset":4098,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml = __importStar(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:name/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBa0M7QUFDbEMsaURBQWtEO0FBQ2xELCtCQUFxQztBQUNyQyx5Q0FBNkI7QUFFN0I7OztHQUdHO0FBQ0gsU0FBZ0IsZ0JBQWdCO0lBQzlCLElBQU0saUJBQWlCLEdBQUc7UUFDeEIsT0FBTztRQUNQLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNO1FBQ04sR0FBRyxFQUFFLG9CQUFvQjtRQUN6QixJQUFJLEVBQUUsR0FBRztRQUNULFNBQVMsRUFBRSwwQkFBMEI7UUFDckMsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QixXQUFXLEVBQUU7WUFDWCxjQUFjLEVBQUUsSUFBSTtZQUNwQixhQUFhLEVBQUUsSUFBSTtTQUNwQjtRQUNELFlBQVk7UUFDWixVQUFVLEVBQUUsUUFBUTtRQUNwQixVQUFVLEVBQUUsUUFBUTtRQUNwQixPQUFPLEVBQUUsTUFBTTtRQUNmLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLFlBQVksRUFBRSxZQUFZO1FBQzFCLFFBQVEsRUFBRSxnQkFBZ0I7UUFDMUIsUUFBUSxFQUFFLE9BQU87UUFDakIsV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVO1FBQ1YsYUFBYSxFQUFFLFdBQVc7UUFDMUIsY0FBYyxFQUFFLE1BQU07UUFDdEIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsYUFBYSxFQUFFO1lBQ2IsTUFBTSxFQUFFLElBQUk7WUFDWixLQUFLLEVBQUUsTUFBTTtZQUNiLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxhQUFhLEVBQUUsQ0FBQztRQUNoQixhQUFhLEVBQUUsS0FBSztRQUNwQixpQkFBaUIsRUFBRSxLQUFLO1FBQ3hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLE1BQU0sRUFBRSxJQUFJO1FBQ1osa0JBQWtCLEVBQUUsY0FBYztRQUNsQyxTQUFTLEVBQUU7WUFDVCxXQUFXLEVBQUUsS0FBSztZQUNsQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtZQUNmLElBQUksRUFBRSxJQUFJO1lBQ1YsaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixhQUFhLEVBQUUsS0FBSztZQUNwQixJQUFJLEVBQUUsS0FBSztTQUNaO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVyxFQUFFLElBQUk7WUFDakIsV0FBVyxFQUFFLEVBQUU7U0FDaEI7UUFDRCxpQkFBaUI7UUFDakIsZ0JBQWdCLEVBQUUsZUFBZTtRQUNqQyxZQUFZLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUUsRUFBRTtRQUNYLHFCQUFxQjtRQUNyQixXQUFXLEVBQUUsWUFBWTtRQUN6QixXQUFXLEVBQUUsVUFBVTtRQUN2QixjQUFjLEVBQUUsT0FBTztRQUN2Qiw0Q0FBNEM7UUFDNUMsMEJBQTBCO1FBQzFCLGFBQWE7UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLGFBQWE7UUFDYixLQUFLLEVBQUUsV0FBVztRQUNsQixNQUFNLEVBQUU7WUFDTixLQUFLLEVBQUUsS0FBSztTQUNiO1FBQ0QsYUFBYTtRQUNiLE1BQU0sRUFBRSxFQUFFO1FBRVYsK0JBQStCO1FBQy9CLE1BQU0sRUFBRSxFQUFFO1FBRVYsaUJBQWlCO1FBQ2pCLGNBQWMsRUFBRSxJQUFJO0tBQ3JCLENBQUM7SUFDRixJQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLEdBQUcsRUFBRSxJQUFBLGNBQU0sRUFBQyxJQUFBLGlDQUFnQixFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQzdDLENBQUM7SUFDRixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztJQUNyRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxDQUFvQyxDQUFDO0FBQzFHLENBQUM7QUF4RkQsNENBd0ZDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0Isb0JBQW9CO0lBQ2xDLE9BQU8sSUFBQSxpQkFBWSxFQUFDLElBQUEsWUFBSSxFQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvRCxDQUFDO0FBRkQsb0RBRUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAqIGFzIHlhbWwgZnJvbSAneWFtbCc7XG5cbi8qKlxuICogZ2V0IGRlZmF1bHQgY29uZmlndXJhdGlvblxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWcoKSB7XG4gIGNvbnN0IGhleG9EZWZhdWx0Q29uZmlnID0ge1xuICAgIC8vIFNpdGVcbiAgICB0aXRsZTogJ0hleG8nLFxuICAgIHN1YnRpdGxlOiAnJyxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgYXV0aG9yOiAnSm9obiBEb2UnLFxuICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIHRpbWV6b25lOiAnJyxcbiAgICAvLyBVUkxcbiAgICB1cmw6ICdodHRwOi8vZXhhbXBsZS5jb20nLFxuICAgIHJvb3Q6ICcvJyxcbiAgICBwZXJtYWxpbms6ICc6eWVhci86bW9udGgvOmRheS86bmFtZS8nLFxuICAgIHBlcm1hbGlua19kZWZhdWx0czoge30sXG4gICAgcHJldHR5X3VybHM6IHtcbiAgICAgIHRyYWlsaW5nX2luZGV4OiB0cnVlLFxuICAgICAgdHJhaWxpbmdfaHRtbDogdHJ1ZVxuICAgIH0sXG4gICAgLy8gRGlyZWN0b3J5XG4gICAgc291cmNlX2RpcjogJ3NvdXJjZScsXG4gICAgcHVibGljX2RpcjogJ3B1YmxpYycsXG4gICAgdGFnX2RpcjogJ3RhZ3MnLFxuICAgIGFyY2hpdmVfZGlyOiAnYXJjaGl2ZXMnLFxuICAgIGNhdGVnb3J5X2RpcjogJ2NhdGVnb3JpZXMnLFxuICAgIGNvZGVfZGlyOiAnZG93bmxvYWRzL2NvZGUnLFxuICAgIGkxOG5fZGlyOiAnOmxhbmcnLFxuICAgIHNraXBfcmVuZGVyOiBbXSxcbiAgICAvLyBXcml0aW5nXG4gICAgbmV3X3Bvc3RfbmFtZTogJzp0aXRsZS5tZCcsXG4gICAgZGVmYXVsdF9sYXlvdXQ6ICdwb3N0JyxcbiAgICB0aXRsZWNhc2U6IGZhbHNlLFxuICAgIGV4dGVybmFsX2xpbms6IHtcbiAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgIGZpZWxkOiAnc2l0ZScsXG4gICAgICBleGNsdWRlOiAnJ1xuICAgIH0sXG4gICAgZmlsZW5hbWVfY2FzZTogMCxcbiAgICByZW5kZXJfZHJhZnRzOiBmYWxzZSxcbiAgICBwb3N0X2Fzc2V0X2ZvbGRlcjogZmFsc2UsXG4gICAgcmVsYXRpdmVfbGluazogZmFsc2UsXG4gICAgZnV0dXJlOiB0cnVlLFxuICAgIHN5bnRheF9oaWdobGlnaHRlcjogJ2hpZ2hsaWdodC5qcycsXG4gICAgaGlnaGxpZ2h0OiB7XG4gICAgICBhdXRvX2RldGVjdDogZmFsc2UsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJyxcbiAgICAgIHdyYXA6IHRydWUsXG4gICAgICBleGNsdWRlX2xhbmd1YWdlczogW10sXG4gICAgICBsYW5ndWFnZV9hdHRyOiBmYWxzZSxcbiAgICAgIGhsanM6IGZhbHNlXG4gICAgfSxcbiAgICBwcmlzbWpzOiB7XG4gICAgICBwcmVwcm9jZXNzOiB0cnVlLFxuICAgICAgbGluZV9udW1iZXI6IHRydWUsXG4gICAgICB0YWJfcmVwbGFjZTogJydcbiAgICB9LFxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgZGVmYXVsdF9jYXRlZ29yeTogJ3VuY2F0ZWdvcml6ZWQnLFxuICAgIGNhdGVnb3J5X21hcDoge30sXG4gICAgdGFnX21hcDoge30sXG4gICAgLy8gRGF0ZSAvIFRpbWUgZm9ybWF0XG4gICAgZGF0ZV9mb3JtYXQ6ICdZWVlZLU1NLUREJyxcbiAgICB0aW1lX2Zvcm1hdDogJ0hIOm1tOnNzJyxcbiAgICB1cGRhdGVkX29wdGlvbjogJ210aW1lJyxcbiAgICAvLyAqIG10aW1lOiBmaWxlIG1vZGlmaWNhdGlvbiBkYXRlIChkZWZhdWx0KVxuICAgIC8vICogZW1wdHk6IG5vIG1vcmUgdXBkYXRlXG4gICAgLy8gUGFnaW5hdGlvblxuICAgIHBlcl9wYWdlOiAxMCxcbiAgICBwYWdpbmF0aW9uX2RpcjogJ3BhZ2UnLFxuICAgIC8vIEV4dGVuc2lvbnNcbiAgICB0aGVtZTogJ2xhbmRzY2FwZScsXG4gICAgc2VydmVyOiB7XG4gICAgICBjYWNoZTogZmFsc2VcbiAgICB9LFxuICAgIC8vIERlcGxveW1lbnRcbiAgICBkZXBsb3k6IHt9LFxuXG4gICAgLy8gaWdub3JlIGZpbGVzIGZyb20gcHJvY2Vzc2luZ1xuICAgIGlnbm9yZTogW10sXG5cbiAgICAvLyBDYXRlZ29yeSAmIFRhZ1xuICAgIG1ldGFfZ2VuZXJhdG9yOiB0cnVlXG4gIH07XG4gIGNvbnN0IHNiZ0RlZmF1bHRDb25maWcgPSB7XG4gICAgY3dkOiB0b1VuaXgodHJ1ZUNhc2VQYXRoU3luYyhwcm9jZXNzLmN3ZCgpKSlcbiAgfTtcbiAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShnZXREZWZhdWx0Q29uZmlnWWFtbCgpKTtcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oaGV4b0RlZmF1bHRDb25maWcsIHNiZ0RlZmF1bHRDb25maWcsIGNvbmZpZ1lNTCkgYXMgdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcbn1cblxuLyoqXG4gKiBnZXQgZGVmYXVsdCBfY29uZmlnLnltbFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWdZYW1sKCkge1xuICByZXR1cm4gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZy55bWwnKSwgJ3V0Zi04Jyk7XG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport * as yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:name/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/0f/defaults_0ff471d7851e1315103153ae541c865c.map","wrapperLength":82},"result":{"scriptId":"6722","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":10548,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":10545,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":29},{"startOffset":314,"endOffset":329,"count":0},{"startOffset":346,"endOffset":366,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":409,"endOffset":436,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":889,"endOffset":900,"count":0},{"startOffset":962,"endOffset":1063,"count":29}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":1451,"endOffset":3888,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3981,"endOffset":4105,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHlCQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsOENBQXdCO0FBQ3hCLDREQUFrRDtBQUNsRCxzREFBZ0M7QUFFaEMsdUVBQWlEO0FBQ2pELGlDQUErQztBQUMvQywwREFBb0M7QUFDcEMscUNBQXNDO0FBRXRDOzs7OztHQUtHO0FBQ0gsU0FBZ0IsWUFBWSxDQUFDLEtBQW9ELEVBQUUsR0FBK0I7SUFBbEgsaUJBOEdDOztJQTdHQyxJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFVBQVUsR0FBRyxPQUFPLEdBQUcsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDM0UsSUFBTSxPQUFPLEdBQUcscUJBQVUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFbkQsd0JBQXdCO0lBQ3hCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztJQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUU7UUFDbEMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQVUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0tBQzFFO0lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRTtRQUMzQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGdCQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8s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LEdBQUcsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUN0QyxhQUFhO3dCQUNiLElBQUksRUFBRSxDQUFDOzs7O2FBQ1IsQ0FBQyxDQUNIO2FBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztLQUNoQztTQUFNO1FBQ0wsSUFBTSxPQUFPLEdBQUcsSUFBQSxzQkFBaUIsRUFBQyxjQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUseUJBQXlCLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sT0FBTyxDQUFDO0tBQ2hCO0FBQ0gsQ0FBQztBQTlHRCxvQ0E4R0M7QUFFRCxnQ0FBZ0M7QUFDaEMsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBzZiwgeyBTYWZlbGlua09wdGlvbnMgfSBmcm9tICdzYWZlbGlua2lmeSc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgU3JjT3B0aW9ucyB9IGZyb20gJ3ZpbnlsLWZzJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCB7IGNyZWF0ZVdyaXRlU3RyZWFtIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogUHJvY2VzcyBTYWZlbGluayBvbiBEZXBsb3kgRGlyXG4gKiBAcGFyYW0gX2RvbmUgY2FsbGJhY2sgZnVuY3Rpb25cbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2FmZWxpbmsoX2RvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkPzogdW5kZWZpbmVkIHwgbnVsbCB8IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3Qgd29ya2luZ0RpciA9IHR5cGVvZiBjd2QgPT09ICdzdHJpbmcnID8gY3dkIDogY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGxvZ25hbWUgPSBhbnNpQ29sb3JzLmdyZWVuQnJpZ2h0KCdzYWZlbGluaycpO1xuXG4gIC8vIHNraXAgcHJvY2VzcyBzYWZlbGlua1xuICBsZXQgaGFzRXJyb3IgPSBmYWxzZTtcbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluaykge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdjb25maWcgc2FmZWxpbmsnLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5yZWRpcmVjdCkge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdzYWZlbGluayByZWRpcmVjdG9yJywgYW5zaUNvbG9ycy5yZWQoJ25vdCBjb25maWd1cmVkJykpO1xuICB9XG4gIGlmICghY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsuZW5hYmxlKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgYW5zaUNvbG9ycy5yZWQoJ2Rpc2FibGVkJykpO1xuICB9XG5cbiAgaWYgKGV4aXN0c1N5bmMod29ya2luZ0RpcikgJiYgIWhhc0Vycm9yKSB7XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZ1NhZmVsaW5rOiBTYWZlbGlua09wdGlvbnMgJiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge1xuICAgICAgZW5hYmxlOiBmYWxzZSxcbiAgICAgIGV4Y2x1ZGU6IFtdIGFzIHN0cmluZ1tdLFxuICAgICAgcmVkaXJlY3Q6ICdodHRwczovL3d3dy53ZWJtYW5hamVtZW4uY29tL3BhZ2Uvc2FmZWxpbmsuaHRtbD91cmw9JyxcbiAgICAgIHBhc3N3b3JkOiAncm9vdCcsXG4gICAgICB0eXBlOiAnYmFzZTY0J1xuICAgIH07XG4gICAgY29uc3QgY29uZmlnU2FmZWxpbmsgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDb25maWdTYWZlbGluaywgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsgfHwge30pO1xuICAgIGxldCBiYXNlVVJMID0gJyc7XG4gICAgdHJ5IHtcbiAgICAgIGJhc2VVUkwgPSBuZXcgVVJMKGNvbmZpZy51cmwpLmhvc3Q7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvL1xuICAgIH1cblxuICAgIGNvbnN0IG9wdDogUGFydGlhbDxTYWZlbGlua09wdGlvbnM+ID0ge1xuICAgICAgLy8gZXhjbHVkZSBwYXR0ZXJucyAoZG9udCBhbm9ueW1pemUgdGhlc2UgcGF0dGVybnMpXG4gICAgICBleGNsdWRlOiBbXG4gICAgICAgIC4uLihjb25maWcuZXh0ZXJuYWxfbGluaz8uZXhjbHVkZSB8fCBbXSksXG4gICAgICAgIC9odHRwcz86XFwvXFwvPyg/OihbXipdKylcXC4pP3dlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIC8oW2EtejAtOV0oPzpbYS16MC05LV17MSw2MX1bYS16MC05XSk/Wy5dKSp3ZWJtYW5hamVtZW5cXC5jb20vLFxuICAgICAgICBiYXNlVVJMLFxuICAgICAgICAnd3d3LndlYm1hbmFqZW1lbi5jb20nLFxuICAgICAgICAnaHR0cHM6Ly9naXRodWIuY29tL2RpbWFzbGFuamFrYScsXG4gICAgICAgICdodHRwczovL2ZhY2Vib29rLmNvbS9kaW1hc2xhbmpha2ExJyxcbiAgICAgICAgJ2RpbWFzbGFuamFrYS5naXRodWIuaW8nLFxuICAgICAgICAuLi5jb25maWdTYWZlbGluay5leGNsdWRlXG4gICAgICBdLmZpbHRlcihmdW5jdGlvbiAoeCwgaSwgYSkge1xuICAgICAgICAvLyByZW1vdmUgZHVwbGljYXRlIGFuZCBlbXB0aWVzXG4gICAgICAgIHJldHVybiBhLmluZGV4T2YoeCkgPT09IGkgJiYgeC50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XG4gICAgICB9KSxcbiAgICAgIHJlZGlyZWN0OiBbXSxcbiAgICAgIC8vcmVkaXJlY3Q6IFssIGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0XSxcbiAgICAgIHBhc3N3b3JkOiBjb25maWdTYWZlbGluay5wYXNzd29yZCB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5wYXNzd29yZCxcbiAgICAgIHR5cGU6IGNvbmZpZ1NhZmVsaW5rLnR5cGUgfHwgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsudHlwZVxuICAgIH07XG5cbiAgICBpZiAoY29uZmlnU2FmZWxpbmsucmVkaXJlY3QpIHtcbiAgICAgIG9wdC5yZWRpcmVjdCA9IGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0O1xuICAgIH1cblxuICAgIGNvbnN0IHNhZmVsaW5rID0gbmV3IHNmLnNhZmVsaW5rKG9wdCk7XG5cbiAgICBjb25zdCBndWxwb3B0OiBTcmNPcHRpb25zID0ge1xuICAgICAgY3dkOiB3b3JraW5nRGlyLFxuICAgICAgaWdub3JlOiBbXVxuICAgIH07XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKSkge1xuICAgICAgZ3VscG9wdC5pZ25vcmU/LmNvbmNhdCguLi5jb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnU2FmZWxpbmsuZXhjbHVkZSkpIHtcbiAgICAgIGNvbnN0IGlnbm9yZSA9IGNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGUuZmlsdGVyKChzdHIpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuICEvXihodHRwcz86XFwvfHd3dy4pLy50ZXN0KHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSkgYXMgc3RyaW5nW107XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmlnbm9yZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGd1bHBcbiAgICAgIC5zcmMoWycqKi8qLntodG1sLGh0bX0nXSwgZ3VscG9wdClcbiAgICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2FmZWxpbmsnIH0pKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRocm91Z2gyLm9iaihhc3luYyAoZmlsZSwgX2VuYywgbmV4dCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3BzXG4gICAgICAgICAgaWYgKGZpbGUuaXNOdWxsKCkgfHwgZmlsZS5pc0RpcmVjdG9yeSgpIHx8ICFmaWxlIHx8IGZpbGUuaXNTdHJlYW0oKSkgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgICAvLyBwcm9jZXNzXG4gICAgICAgICAgaWYgKGZpbGUuaXNCdWZmZXIoKSAmJiBCdWZmZXIuaXNCdWZmZXIoZmlsZS5jb250ZW50cykpIHtcbiAgICAgICAgICAgIC8vIGRvIHNhZmVsaW5raWZ5XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZmlsZS5jb250ZW50cy50b1N0cmluZygndXRmLTgnKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IHNhZmVsaW5rLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIC8vIExvZ2dlci5sb2cocGFyc2VkKTtcbiAgICAgICAgICAgICAgZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKHBhcnNlZCk7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0KG51bGwsIGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcGFyc2UnLCBmaWxlLnBhdGgpO1xuICAgICAgICAgIC8vIGRyb3AgZmFpbHNcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAucGlwZShndWxwLmRlc3Qod29ya2luZ0RpcikpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHdzdHJlYW0gPSBjcmVhdGVXcml0ZVN0cmVhbShwYXRoLmpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvc2FmZWxpbmsubG9nJykpO1xuICAgIHJldHVybiB3c3RyZWFtO1xuICB9XG59XG5cbi8vIHNhZmVsaW5raWZ5IHRoZSBkZXBsb3kgZm9sZGVyXG5ndWxwLnRhc2soJ3NhZmVsaW5rJywgdGFza1NhZmVsaW5rKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4c/gulpsafelink_4c61ebd17a40a0e391c444500ad6c5a4.map","wrapperLength":82},"result":{"scriptId":"6726","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21175,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zZW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLHVFQUFpRDtBQUNqRCwwREFBb0M7QUFDcEMscUNBQWtFO0FBRWxFOzs7R0FHRztBQUNILFNBQWdCLE9BQU8sQ0FBQyxLQUFtRCxFQUFFLEdBQVc7SUFDdEYsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxNQUFNLEdBQWEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM3RSxNQUFNLENBQUMsSUFBSSxPQUFYLE1BQU0sMkJBQVMsc0JBQVksV0FBRTtJQUM3QixPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxjQUFjLENBQUMsRUFBRSxFQUFFLEdBQUcsS0FBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUM7U0FDekQsSUFBSSxDQUFDLElBQUEsb0JBQVUsRUFBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ2pDLElBQUksQ0FDSCxJQUFBLGtCQUFPLEVBQUMsVUFBVSxJQUFJO1FBQWQsaUJBMkJQO1FBMUJDLGlCQUFpQjtRQUNqQixJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFFO1lBQ2hCLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDNUIsSUFBTSxLQUFLLEdBQUcsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRLENBQUM7Z0JBQ3RFLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxtQkFBbUI7UUFDbkIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUNqRSxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNqQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDO2dCQUN4RSxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQzthQUNqQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0JBQWdCO1FBQ2hCLFdBQVc7UUFDWCxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNqQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBVSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxjQUFPLEVBQUUsQ0FBQyxNQUFNLGVBQUssSUFBSSxDQUFFLENBQUMsQ0FBQztTQUM1RTtJQUNILENBQUMsQ0FBQyxDQUNIO1NBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMxQixDQUFDO0FBdENELDBCQXNDQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO0lBQ1AsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLE9BQU8sT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNlby50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBndWxwRG9tIGZyb20gJ2d1bHAtZG9tJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBkZXBsb3lDb25maWcsIGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogQXV0byBzZW8gcnVubmVyXG4gKiBAcGFyYW0gY3dkIHdvcmtpbmcgZGlyZWN0b3J5IHRvIHNjYW4gaHRtbCdzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2VvKF9kb25lOiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkOiBzdHJpbmcpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGlnbm9yZTogc3RyaW5nW10gPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gIGlnbm9yZS5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoue2h0bSxodG1sfScsICcqLntodG1sLGh0bX0nXSwgeyBjd2QsIGlnbm9yZSB9KVxuICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2VvJyB9KSlcbiAgICAucGlwZShcbiAgICAgIGd1bHBEb20oZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgLy8gZml4IGFsdCBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmNdJykpO1xuICAgICAgICBpbWFnZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ2FsdCcpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gQWx0JztcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYWx0JywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZml4IHRpdGxlIGlmcmFtZVxuICAgICAgICBjb25zdCBpZnJhbWVzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lmcmFtZVtzcmNdJykpO1xuICAgICAgICBpZnJhbWVzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgICAgY29uc3QgYWx0ID0gZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gVGl0bGUnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRpdGxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdBUk5JTkcgTUFLRVJcbiAgICAgICAgLy8gY291bnQgSDFcbiAgICAgICAgY29uc3QgaDEgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2gxJyk7XG4gICAgICAgIGlmIChoMS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyhhbnNpQ29sb3JzLnllbGxvd0JyaWdodCgnW1dBUk5dJyksIGBIMSAoJHtoMS5sZW5ndGh9KSAke3BhdGh9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKVxuICAgIC5waXBlKGd1bHAuZGVzdChjd2QpKTtcbn1cblxuZ3VscC50YXNrKCdzZW8nLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgcmV0dXJuIHRhc2tTZW8obnVsbCwgZGVwbG95RGlyKTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/e0/gulpseo_e04b91fb9cd501fddd96cd3618e1374f.map","wrapperLength":82},"result":{"scriptId":"6775","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8792,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8789,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zdGFuZGFsb25lLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QixzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLDBEQUFvQztBQUNwQyx5Q0FBNkM7QUFDN0MscUNBQXNDO0FBRXRDOzs7R0FHRztBQUNILFNBQVMsZ0JBQWdCO0lBQ3ZCLGdCQUFNLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7SUFDaEQsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1NBQ2xHLElBQUksQ0FDSCxrQkFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFnQixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7Ozs7Ozt3QkFDM0MsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUN4RCxLQUFBLENBQUEsS0FBQSxnQkFBTSxDQUFBLENBQUMsR0FBRyxDQUFBOzt3QkFBUyxxQkFBTSxJQUFBLG9CQUFXLEVBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUE7O3dCQUFwRSxjQUFXLG1CQUFRLFNBQWlELEVBQUUsRUFBQyxDQUFDO3dCQUN4RSxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQ2xELEtBQUssR0FBRyxJQUFBLHFCQUFLLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7d0JBQy9ELEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFOzRCQUNoQixZQUFZOzRCQUNaLElBQUksRUFBRSxDQUFDO3dCQUNULENBQUMsQ0FBQyxDQUFDOzs7OztLQUNKLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7U0FDeEQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNYLGdCQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBRS9DLGtCQUFlLGdCQUFnQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuc3RhbmRhbG9uZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc3Bhd24gZnJvbSAnY3Jvc3Mtc3Bhd24nO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgcmVwbGFjZVBhdGggfSBmcm9tICcuL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIHJ1biBhbGwgXyouc3RhbmRhbG9uZS5qcyBpbnNpZGUgc3JjLXBvc3RzIChfY29uZmlnX3ltbC5wb3N0X2RpcilcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHN0YW5kYWxvbmVSdW5uZXIoKSB7XG4gIExvZ2dlci5sb2coJ1tzdGFuZGFsb25lXSBSdW5uaW5nIHNjcmlwdHMuLi5cXG4nKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAnKiovXyouc3RhbmRhbG9uZS5qcycpLCB7IGN3ZDogZ2V0Q29uZmlnKCkuY3dkLCBpZ25vcmU6IFsnKiovdG1wLyoqJ10gfSlcbiAgICAucGlwZShcbiAgICAgIHRocm91Z2gyLm9iaihhc3luYyBmdW5jdGlvbiAoZmlsZSwgX2VuYywgbmV4dCkge1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBpbnB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBMb2dnZXIubG9nKGBub2RlICR7YXdhaXQgcmVwbGFjZVBhdGgoZmlsZS5wYXRoLCBnZXRDb25maWcoKS5jd2QsICcnKX1gKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnPScucmVwZWF0KDEwKSArICcgb3VwdXQgJyArICc9Jy5yZXBlYXQoMTApKTtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBzcGF3bignbm9kZScsIFtmaWxlLnBhdGhdLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7XG4gICAgICAgIGNoaWxkLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAvLyBkcm9wIGZpbGVcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAndG1wL3N0YW5kYWxvbmUnKSkpXG4gICAgLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIExvZ2dlci5sb2coJ1xcbltzdGFuZGFsb25lXSBzdG9wcGVkJyk7XG4gICAgfSk7XG59XG5cbmd1bHAudGFzaygncG9zdDpzdGFuZGFsb25lJywgc3RhbmRhbG9uZVJ1bm5lcik7XG5cbmV4cG9ydCBkZWZhdWx0IHN0YW5kYWxvbmVSdW5uZXI7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4b/gulpstandalone_4b97cf5f5ca3169df9a2ad9287d555ef.map","wrapperLength":82},"result":{"scriptId":"7232","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8832,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8829,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zaXRlbWFwLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBZ0M7QUFDaEMscUNBQXdDO0FBQ3hDLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXVDO0FBQ3ZDLHVDQUF5QztBQUN6QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHlCQUF5QjtBQUN6QixtREFBc0Q7QUFDdEQsK0JBQTZCO0FBQzdCLHFDQUFxQztBQUNyQyx1Q0FBaUU7QUFDakUsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMsc0VBQStDO0FBQy9DLHFDQUErRDtBQUUvRDs7OztFQUlFO0FBQ0YsSUFBSSxRQUFRLEdBQUcsRUFBYyxDQUFDO0FBQzlCLElBQU0sT0FBTyxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7QUFDbEMsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUI7Ozs7O0dBS0c7QUFDSCxTQUFnQixlQUFlLENBQUMsR0FBK0IsRUFBRSxJQUFRO0lBQXpFLGlCQTZEQztJQTdEZ0UscUJBQUEsRUFBQSxRQUFRO0lBQ3ZFLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBb0M7UUFDdkQsSUFBTSxRQUFRLEdBQXlDLEVBQUUsQ0FBQztRQUMxRCxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLENBQ1gsSUFBQSxxQ0FBbUIsRUFBQyxHQUFHLEVBQUU7Z0JBQ3ZCLElBQUksTUFBQTthQUNMLENBQUMsQ0FDSCxDQUFDO1NBQ0g7YUFBTTtZQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBQSxtQkFB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QztxQkFDMUQsSUFBSSxDQUNILElBQUEsa0JBQU8sRUFBQztvQkFDTix5QkFBeUI7b0JBQ3pCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sbUJBQWUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO3dCQUN4RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNkJBQTJCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUMvRDt3QkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw2RkFBK0UsT0FBTyxxQkFBaUIsQ0FBQztxQkFDaEk7b0JBQ0QsdUVBQXVFO2dCQUN6RSxDQUFDLENBQUMsQ0FDSDtxQkFDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztxQkFDMUIsSUFBSSxDQUFDLEtBQUssRUFBRSxjQUFNLE9BQUEsT0FBTyxFQUFFLEVBQVQsQ0FBUyxDQUFDLENBQUM7WUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQWpHRCxrREFpR0M7QUFFRCxTQUFTLE9BQU8sQ0FBQyxJQUFZLEVBQUUsUUFBb0M7SUFDakUsT0FBTyxvQkFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO0lBQ25CLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBTztRQUMxQixtQkFBbUIsRUFBRSxDQUFDLElBQUksQ0FBQztZQUN6QixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNpdGVtYXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBoZXhvIH0gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG1pY3JvbWF0Y2ggZnJvbSAnbWljcm9tYXRjaCc7XG5pbXBvcnQgbnVuanVja3MgZnJvbSAnbnVuanVja3MnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgc2l0ZW1hcENyYXdsZXJBc3luYyB9IGZyb20gJ3NpdGVtYXAtY3Jhd2xlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgeW9hc3RTZW8gfSBmcm9tICcuL3NpdGVtYXAnO1xuaW1wb3J0IHsgYXJyYXlfcmVtb3ZlX2VtcHR5LCBhcnJheV91bmlxdWUgfSBmcm9tICcuL3V0aWxzL2FycmF5JztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKlxuLy8gcmVhZCBleGlzdGluZyBzaXRlbWFwLnR4dFxuY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbmxldCBzaXRlbWFwcyA9IGV4aXN0c1N5bmMoc2l0ZW1hcFRYVCkgPyBhcnJheV9yZW1vdmVfZW1wdHkocmVhZEZpbGVTeW5jKHNpdGVtYXBUWFQsICd1dGYtOCcpLnNwbGl0KC9cXHI/XFxuL2dtKSkgOiBbXTtcbiovXG5sZXQgc2l0ZW1hcHMgPSBbXSBhcyBzdHJpbmdbXTtcbmNvbnN0IGNyYXdsZWQgPSBuZXcgU2V0PHN0cmluZz4oKTtcbmNvbnN0IGVudiA9IGVudk51bmp1Y2tzKCk7XG5cbi8qKlxuICogU2l0ZW1hcCBHZW5lcmF0b3JcbiAqIEBwYXJhbSB1cmwgdXJsIHRvIGNyYXdsXG4gKiBAcGFyYW0gZGVlcCBjcmF3bCBkZWVwZXIgbiB0aW1lc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2l0ZW1hcCh1cmw/OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkLCBkZWVwID0gMCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoc2l0ZW1hcHM6IHN0cmluZ1tdKSA9PiBhbnkpID0+IHtcbiAgICBjb25zdCBwcm9taXNlczogQmx1ZWJpcmQ8UmVjb3JkPHN0cmluZywgc3RyaW5nW10+PltdID0gW107XG4gICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyh1cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjcmF3bGVkLmFkZChnZXRDb25maWcoKS51cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyhnZXRDb25maWcoKS51cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICBCbHVlYmlyZC5hbGwocHJvbWlzZXMpXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICBjb25zdCBtYXBwZWQgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBzaXRlbWFwQ3Jhd2xlckFzeW5jPjtcbiAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChzaXRlbWFwKSA9PiB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gc2l0ZW1hcCkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gc2l0ZW1hcFtrZXldO1xuICAgICAgICAgICAgaWYgKGtleSBpbiBtYXBwZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1hcHBlZFtrZXldID0gdmFsdWVzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSBhcnJheV91bmlxdWUodmFsdWVzLmNvbmNhdChtYXBwZWRba2V5XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICBjb25zdCBzYXZldG8gPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAuanNvbicpO1xuICAgICAgICB3cml0ZWZpbGUoc2F2ZXRvLCBKU09OLnN0cmluZ2lmeShtYXBwZWQsIG51bGwsIDIpKTtcblxuICAgICAgICAvLyByZXR1cm5cbiAgICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICAgIH0pXG4gICAgICAudGhlbihhc3luYyAocmVzdWx0cykgPT4ge1xuICAgICAgICBzaXRlbWFwcyA9IGFycmF5X3VuaXF1ZShhcnJheV9yZW1vdmVfZW1wdHkoT2JqZWN0LnZhbHVlcyhyZXN1bHRzKS5mbGF0KDEpLmNvbmNhdChzaXRlbWFwcykpKS5zb3J0KGZ1bmN0aW9uIChcbiAgICAgICAgICBhLFxuICAgICAgICAgIGJcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA8IGIgPyAtMSA6IDE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVlcDsgaSsrKSB7XG4gICAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHNpdGVtYXBzLmxlbmd0aDsgaWkrKykge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gc2l0ZW1hcHNbaWldO1xuICAgICAgICAgICAgaWYgKGNyYXdsZWQuaGFzKHVybCkgfHwgLy4oanN8dHN8Y3NzfHNjc3N8dHh0fHBkZnxwbmd8anBlP2d8Z2lmfHdlYnApJC9naS50ZXN0KHVybCkpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgICAgICAgTG9nZ2VyLmxvZygnW2RlcHRoXScsIGlpLCB1cmwpO1xuICAgICAgICAgICAgYXdhaXQgZ2VuZXJhdGVTaXRlbWFwKHVybCwgZGVlcCkudGhlbigoKSA9PiB3cml0ZVNpdGVtYXAoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgd3JpdGVTaXRlbWFwKHJlc29sdmUpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIHdyaXRlIHRoZSBzaXRlbWFwXG4gKiBAcGFyYW0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gd3JpdGVTaXRlbWFwKGNhbGxiYWNrPzogKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnkpIHtcbiAgbGV0IGNiID0gbm9vcDtcbiAgaWYgKGNhbGxiYWNrKSBjYiA9ICgpID0+IGNhbGxiYWNrKHNpdGVtYXBzKTtcbiAgY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbiAgd3JpdGVmaWxlKHNpdGVtYXBUWFQsIGFycmF5X3JlbW92ZV9lbXB0eShzaXRlbWFwcykuam9pbihFT0wpKTtcbiAgY2IuYXBwbHkodGhpcyk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZW1hcE9wdGlvbnMge1xuICBwYXRoOiBzdHJpbmdbXTtcbiAgdGFnczogYm9vbGVhbjtcbiAgY2F0ZWdvcmllczogYm9vbGVhbjtcbiAgcmVsOiBib29sZWFuO1xuICB5b2FzdDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleG9HZW5lcmF0ZVNpdGVtYXAoKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBoZXhvKGdldENvbmZpZygpLmN3ZCk7XG4gICAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBlbnYuYWRkRmlsdGVyKCdmb3JtYXRVcmwnLCAoc3RyKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY29uZmlnID0gc2V0Q29uZmlnKGluc3RhbmNlLmNvbmZpZyk7XG4gICAgICAgIC8vIGFzc2lnbiBkZWZhdWx0IGNvbmZpZ1xuICAgICAgICBjb25zdCBzaXRlbWFwOiBTaXRlbWFwT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgeyByZWw6IGZhbHNlLCB0YWdzOiBmYWxzZSwgY2F0ZWdvcmllczogZmFsc2UsIHBhdGg6IFsnc2l0ZW1hcC50eHQnLCAnc2l0ZW1hcC54bWwnXSB9LFxuICAgICAgICAgIGNvbmZpZy5zaXRlbWFwXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQnVpbGQgWW9hc3QgU0VPIHNpdGVtYXBcbiAgICAgICAgLy8gd2hlbiBjb25maWcueW9hc3QgZGVmaW5lZFxuICAgICAgICBpZiAoc2l0ZW1hcC55b2FzdCkge1xuICAgICAgICAgIHJldHVybiB5b2FzdFNlbyhpbnN0YW5jZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNvbmZpZy5zaXRlbWFwKSByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIGNvbnN0IGxvY2FscyA9IGluc3RhbmNlLmxvY2FscztcbiAgICAgICAgY29uc3QgeyBza2lwX3JlbmRlciB9ID0gY29uZmlnO1xuXG4gICAgICAgIGlmICghc2l0ZW1hcC50YWdzIHx8ICFzaXRlbWFwLmNhdGVnb3JpZXMpIHtcbiAgICAgICAgICByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwLnRhZ3Mgb3IgY29uZmlnLnNpdGVtYXAuY2F0ZWdvcmllcyBub3QgY29uZmlndXJlZCBpbiBfY29uZmlnLnltbCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNraXBSZW5kZXJMaXN0ID0gWycqKi8qLmpzJywgJyoqLyouY3NzJywgJyoqLy5naXQqJ107XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2tpcF9yZW5kZXIpKSB7XG4gICAgICAgICAgc2tpcFJlbmRlckxpc3QucHVzaCguLi5za2lwX3JlbmRlcik7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNraXBfcmVuZGVyID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGlmIChza2lwX3JlbmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKHNraXBfcmVuZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3N0cyA9IFsuLi5sb2NhbHMuZ2V0KCdwYWdlcycpLnRvQXJyYXkoKSwgLi4ubG9jYWxzLmdldCgncG9zdHMnKS50b0FycmF5KCldXG4gICAgICAgICAgLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBvc3Quc2l0ZW1hcCAhPT0gZmFsc2UgJiYgIWlzTWF0Y2gocG9zdC5zb3VyY2UsIHNraXBSZW5kZXJMaXN0KTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi51cGRhdGVkICYmIGEudXBkYXRlZCkgcmV0dXJuIGIudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCkgLSBhLnVwZGF0ZWQudG9EYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHBvc3RzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRtcGxTcmMgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBudW5qdWNrcy5jb21waWxlKHJlYWRGaWxlU3luYyh0bXBsU3JjLCAndXRmLTgnKSwgZW52KTtcbiAgICAgICAgY29uc3QgeyB0YWdzOiB0YWdzQ2ZnLCBjYXRlZ29yaWVzOiBjYXRzQ2ZnLCByZWw6IHJlbENmZyB9ID0gc2l0ZW1hcDtcbiAgICAgICAgbGV0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBzTm93OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHRhZ3M6IHRhZ3NDZmcgPyBsb2NhbHMuZ2V0KCd0YWdzJykudG9BcnJheSgpIDogW10sXG4gICAgICAgICAgY2F0ZWdvcmllczogY2F0c0NmZyA/IGxvY2Fscy5nZXQoJ2NhdGVnb3JpZXMnKS50b0FycmF5KCkgOiBbXVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZW1vdmUgYmxhbmsgbmV3bGluZXNcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxccypbXFxyXFxuXS9nbSwgJ1xcbicpO1xuXG4gICAgICAgIC8vZGF0YSA9IHByZXR0aWVyLmZvcm1hdChkYXRhLCB7IHBhcnNlcjogJ3htbCcsIHBsdWdpbnM6IFt4bWxwbHVnaW5dLCBlbmRPZkxpbmU6ICdsZicgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICB3cml0ZWZpbGUoam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wL2R1bXAvc2l0ZW1hcC9zaXRlbWFwLnhtbCcpLCBkYXRhKTtcblxuICAgICAgICAvLyB3cml0ZVxuICAgICAgICBjb25zdCBzaXRlbWFwWG1sID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgd3JpdGVmaWxlKHNpdGVtYXBYbWwsIGRhdGEpO1xuICAgICAgICBpbnN0YW5jZS5sb2cuaW5mbygnc2l0ZW1hcCB3cml0dGVuJywgc2l0ZW1hcFhtbCk7XG5cbiAgICAgICAgaWYgKCFyZWxDZmcpIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcbiAgICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyKTtcbiAgICAgICAgZ3VscFxuICAgICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgLy8gYXV0byBkaXNjb3Zlcnkgc2l0ZW1hcFxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIke2Jhc2VVUkx9c2l0ZW1hcC54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInNpdGVtYXAtc2l0ZS11cmxcIiB0eXBlPVwiYXBwbGljYXRpb24vdGV4dCt4bWxcIiByZWw9XCJzaXRlbWFwXCIgaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiIC8+YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IHJlc29sdmUoKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGlzTWF0Y2gocGF0aDogc3RyaW5nLCBwYXR0ZXJuczogc3RyaW5nIHwgcmVhZG9ubHkgc3RyaW5nW10pIHtcbiAgcmV0dXJuIG1pY3JvbWF0Y2guaXNNYXRjaChwYXRoLCBwYXR0ZXJucyk7XG59XG5cbmd1bHAudGFzaygnc2l0ZW1hcCcsICgpID0+IHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGhleG9HZW5lcmF0ZVNpdGVtYXAoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/3c/gulpsitemap_3c8d9f84ead1fc6d91aa70a109950e6b.map","wrapperLength":82},"result":{"scriptId":"7237","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33956,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33953,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscGZpbGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOENBQXdCO0FBQ3hCLHVDQUFrQztBQUNsQywrQkFBNkI7QUFDN0Isd0JBQXNCO0FBQ3RCLHlCQUF1QjtBQUN2Qix1QkFBcUI7QUFDckIsMkJBQXlCO0FBQ3pCLHNCQUFvQjtBQUNwQix1QkFBcUI7QUFDckIsNkJBQTJCO0FBQzNCLDBEQUFvQztBQUVwQyx5QkFBeUI7QUFDekIsU0FBZ0IsYUFBYSxDQUFDLE1BQWlDO0lBQzdELElBQU0sT0FBTyxHQUFHLENBQUMsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFdBQVcsQ0FBQyxFQUFFLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxRQUFRLENBQUMsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqRyxJQUFNLE1BQU0sR0FBRztRQUNiLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUFFLE9BQU8sTUFBTSxFQUFFLENBQUM7UUFDckMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQU0sR0FBRyxHQUFHO1lBQ1YsR0FBRyxFQUFFLE1BQU07WUFDWCxLQUFLLEVBQUUsU0FBUztTQUNqQixDQUFDO1FBQ0YsT0FBTyxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFPLEdBQUcsQ0FBQzthQUN6QyxJQUFJLENBQUMsY0FBTSxPQUFBLElBQUEsaUJBQUssRUFBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQU8sR0FBRyxDQUFDLEVBQWhFLENBQWdFLENBQUM7YUFDNUUsS0FBSyxDQUFDLFVBQUMsQ0FBQztZQUNQLElBQUksQ0FBQyxZQUFZLEtBQUs7Z0JBQUUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUM7YUFDRCxPQUFPLENBQUM7WUFDUCxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztJQUNGLE9BQU8sTUFBTSxFQUFFLENBQUM7QUFDbEIsQ0FBQztBQXBCRCxzQ0FvQkM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBRTNDLGtCQUFlLGNBQUksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwZmlsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5kZXBsb3knO1xuaW1wb3J0ICcuL2d1bHAuZmVlZCc7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgJy4vZ3VscC5zZW8nO1xuaW1wb3J0ICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgJy4vZ3VscC5zdGFuZGFsb25lJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuXG4vLyBjb21taXQgY3VycmVudCBwcm9qZWN0XG5leHBvcnQgZnVuY3Rpb24gY29tbWl0UHJvamVjdChmaW5pc2g6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgZ2l0RGlycyA9IFtqb2luKHByb2Nlc3MuY3dkKCksICdzcmMtcG9zdHMnKSwgam9pbihwcm9jZXNzLmN3ZCgpLCAnc291cmNlJyksIHByb2Nlc3MuY3dkKCldO1xuICBjb25zdCBjb21taXQgPSAoKSA9PiB7XG4gICAgaWYgKCFnaXREaXJzLmxlbmd0aCkgcmV0dXJuIGZpbmlzaCgpO1xuICAgIGNvbnN0IGdpdERpciA9IGdpdERpcnNbMF07XG4gICAgY29uc3Qgb3B0ID0ge1xuICAgICAgY3dkOiBnaXREaXIsXG4gICAgICBzdGRpbzogJ2luaGVyaXQnXG4gICAgfTtcbiAgICByZXR1cm4gc3Bhd24oJ2dpdCcsIFsnYWRkJywgJy1BJ10sIDxhbnk+b3B0KVxuICAgICAgLnRoZW4oKCkgPT4gc3Bhd24oJ2dpdCcsIFsnY29tbWl0JywgJy1tJywgJ3VwZGF0ZSAnICsgbmV3IERhdGUoKV0sIDxhbnk+b3B0KSlcbiAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSBMb2dnZXIubG9nKGUubWVzc2FnZSwgZ2l0RGlyKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGdpdERpcnMuc2hpZnQoKTtcbiAgICAgICAgY29tbWl0KCk7XG4gICAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIGNvbW1pdCgpO1xufVxuXG5ndWxwLnRhc2soJ3Byb2plY3QtY29tbWl0JywgY29tbWl0UHJvamVjdCk7XG5cbmV4cG9ydCBkZWZhdWx0IGd1bHA7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/49/gulpfile_49358b99439a29678d73729f1ed5c86f.map","wrapperLength":82},"result":{"scriptId":"7586","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4983,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4980,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5kZXBsb3kudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMseUJBQWdDO0FBQ2hDLDBFQUEwRDtBQUMxRCx1REFBMkQ7QUFDM0QsOENBQWtEO0FBQ2xELG9FQUFxQztBQUNyQywrQkFBcUM7QUFDckMsd0JBQXNCO0FBQ3RCLDJCQUF5QjtBQUN6QiwwREFBb0M7QUFDcEMscUNBQW9EO0FBRXBEOzs7R0FHRztBQUNILFNBQWdCLE9BQU87SUFDYixJQUFBLFNBQVMsR0FBSyxJQUFBLHNCQUFZLEdBQUUsVUFBbkIsQ0FBb0I7SUFDckMsSUFBTSxTQUFTLEdBQUcsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzlELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLHFCQUFxQixDQUFDLEVBQUU7UUFDaEUsR0FBRyxFQUFFLFNBQVM7UUFDZCxHQUFHLEVBQUUsSUFBSTtLQUNWLENBQUM7U0FDRCxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUMxQixFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBVkQsMEJBVUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixZQUFZO0lBQzFCLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQVUsT0FBTztRQUNuQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQixD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QVc7SUFDNUIsT0FBTyxJQUFBLGNBQU0sRUFBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBQSxjQUFNLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDeEQsQ0FBQztBQUVELFNBQVM7QUFDVCxjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuZGVwbG95LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBnaXRIZWxwZXIgfSBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IHsgc3Bhd25Bc3luYyB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlci9kaXN0L3NwYXduJztcbmltcG9ydCBndWxwLCB7IFRhc2tGdW5jdGlvbkNhbGxiYWNrIH0gZnJvbSAnZ3VscCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5pbXBvcnQgeyBqb2luLCB0b1VuaXggfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb3B5R2VuKCkge1xuICBjb25zdCB7IGRlcGxveURpciB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgZ2V0Q29uZmlnKCkucHVibGljX2Rpcik7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoqJywgJyEqKi8uZ2l0KicsICchKiovdG1wLyoqJywgJyEqKi9ub2RlX21vZHVsZXMvKionXSwge1xuICAgICAgY3dkOiBwdWJsaWNEaXIsXG4gICAgICBkb3Q6IHRydWVcbiAgICB9KVxuICAgIC5waXBlKGd1bHAuZGVzdChkZXBsb3lEaXIpKVxuICAgIC5vbignZXJyb3InLCBjb25zb2xlLnRyYWNlKTtcbn1cblxuLyoqXG4gKiBhc3luY2hyb25vdXMgY29weSBnZW5lcmF0ZWQgZmlsZXMgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIHRvIGRlcGxveSBkaXIgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYXN5bmNDb3B5R2VuKCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgY29weUdlbigpLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vLyBjb3B5IHB1YmxpYyB0byAuZGVwbG95X2dpdFxuZ3VscC50YXNrKCdkZXBsb3k6Y29weScsIGNvcHlHZW4pO1xuXG4vKipcbiAqIGdpdCBwdWxsIG9uIGRlcGxveSBkaXJcbiAqIEBwYXJhbSBkb25lXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHB1bGwoZG9uZTogVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGN3ZCA9IGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyO1xuICBjb25zdCBnaCA9IGNvbmZpZy5kZXBsb3kuZ2l0aHViO1xuICBjb25zdCBkb1B1bGwgPSBhc3luYyAoY3dkOiBzdHJpbmcpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydjb25maWcnLCAncHVsbC5yZWJhc2UnLCAnZmFsc2UnXSwge1xuICAgICAgICBjd2RcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIExvZ2dlci5sb2coZS5tZXNzYWdlLCBzdWIucm9vdCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIExvZ2dlci5sb2coJ3B1bGxpbmcnLCBjd2QpO1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydwdWxsJywgJy1YJywgJ3RoZWlycyddLCB7XG4gICAgICAgIGN3ZCxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgTG9nZ2VyLmxvZygnY2Fubm90IHB1bGwnLCBjd2QpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjbG9uZSA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWV4aXN0c1N5bmMoY3dkKSkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWy4uLidjbG9uZSAtYiBtYXN0ZXIgLS1zaW5nbGUtYnJhbmNoJy5zcGxpdCgnICcpLCBjb25maWcuZGVwbG95LnJlcG8sICcuZGVwbG95X2dpdCddLCB7XG4gICAgICAgIGN3ZDogX19kaXJuYW1lXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgYXdhaXQgY2xvbmUoKTtcbiAgZG9QdWxsKGN3ZCk7XG4gIGlmIChnaCkge1xuICAgIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaC5zdWJtb2R1bGUuZ2V0KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJtb2R1bGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdWIgPSBzdWJtb2R1bGVzW2ldO1xuXG4gICAgICBkb1B1bGwoc3ViLnJvb3QpO1xuICAgIH1cbiAgfVxuICBkb25lKCk7XG59XG5cbmZ1bmN0aW9uIHN0YXR1cyhkb25lPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm47XG4gIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChzdGF0dXNlcykgPT4ge1xuICAgIHN0YXR1c2VzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgbGV0IHN0ciA9ICcnO1xuXG4gICAgICBzd2l0Y2ggKGl0ZW0uY2hhbmdlcykge1xuICAgICAgICBjYXNlICdkZWxldGVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5yZWQoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnYWRkZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZWVuKGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21vZGlmaWVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy55ZWxsb3coaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndW50cmFja2VkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5ncmV5KGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgc3RyICs9IGl0ZW0uY2hhbmdlcztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgc3RyICs9ICcgJztcbiAgICAgIHN0ciArPSBpdGVtLnBhdGg7XG4gICAgICBMb2dnZXIubG9nKHN0cik7XG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIGRvbmUoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbW1pdCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1YikgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgY29uc3Qgbm93ID0gbW9tZW50KCkudHooZ2V0Q29uZmlnKCkudGltZXpvbmUpLmZvcm1hdCgnTExMJyk7XG4gIGNvbnN0IGNvbW1pdFJvb3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBnaXRodWIuc3RhdHVzKCkudGhlbigoY2hhbmdlcykgPT4ge1xuICAgICAgICBMb2dnZXIubG9nKCdjaGFuZ2VzJywgY2hhbmdlcy5sZW5ndGgsIHRvVW5peChnaXRodWIuY3dkKS5yZXBsYWNlKHRvVW5peChwcm9jZXNzLmN3ZCgpKSwgJycpKTtcbiAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGdpdGh1Yi5hZGQoJy1BJykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBnaXRodWIuY29tbWl0KCd1cGRhdGUgc2l0ZSAnICsgbm93KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBjb21taXRTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSkge1xuICAgICAgICBjb25zdCBpbmZvID0gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICAgICAgY29uc3QgY29tbWl0U3VibW9kdWxlQ2hpbGQgPSBhc3luYyAoc3ViOiAodHlwZW9mIGluZm8pW251bWJlcl0pID0+IHtcbiAgICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBuZXcgZ2l0SGVscGVyKHN1Yi5yb290KTtcbiAgICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHN1Ym1vZHVsZS5zdGF0dXMoKTtcbiAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmFkZCgnLUEnKTtcbiAgICAgICAgICAgIGF3YWl0IHN1Ym1vZHVsZS5jb21taXQoYHVwZGF0ZSAke3N1Yi5wYXRofSAke25vd31gLCAnYW0nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGl0ZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlSXQpID0+IHtcbiAgICAgICAgICAgIC8vIHJlc29sdmUgZGlyZWN0bHkgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm8gbWFkZSBjaGFuZ2VzXG4gICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPT09IDApIHJldHVybiByZXNvbHZlSXQobnVsbCk7XG4gICAgICAgICAgICBjb21taXRTdWJtb2R1bGVDaGlsZChpbmZvWzBdKVxuICAgICAgICAgICAgICAuY2F0Y2gobm9vcClcbiAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGluZm8uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAvLyByZS1pdGVyYXRlIHdoZW4gc3VibW9kdWxlIGl0ZW1zIG5vdCBjb21taXR0ZWRcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPiAwKSByZXR1cm4gaXRlcmF0ZSgpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmVzIGFsbFxuICAgICAgICAgICAgICAgIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGl0ZXJhdGUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb21taXRTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oY29tbWl0Um9vdClcbiAgICAgIC50aGVuKCgpID0+IHJlc29sdmUobnVsbCkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbm9vcCgpIHtcbiAgLy9cbn1cblxuZnVuY3Rpb24gcHVzaCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1Yikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBzdWJtb2R1bGVzID0gZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSA/IGdpdGh1Yi5zdWJtb2R1bGUuZ2V0KCkgOiBbXTtcbiAgY29uc3QgcHVzaFN1Ym1vZHVsZSA9IGZ1bmN0aW9uIChzdWJtb2R1bGU6ICh0eXBlb2Ygc3VibW9kdWxlcylbbnVtYmVyXSkge1xuICAgIGNvbnN0IHsgdXJsLCBicmFuY2gsIHJvb3QgfSA9IHN1Ym1vZHVsZTtcbiAgICBpZiAoIXN1Ym1vZHVsZS5naXRodWIpIHtcbiAgICAgIHN1Ym1vZHVsZS5naXRodWIgPSBuZXcgZ2l0SGVscGVyKHJvb3QpO1xuICAgIH1cbiAgICBjb25zdCB7IGdpdGh1YiB9ID0gc3VibW9kdWxlO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgIGNvbnN0IHNldFIgPSAoKSA9PiBnaXRodWIuc2V0cmVtb3RlKHVybCk7XG4gICAgICBjb25zdCBzZXRCID0gKCkgPT4gZ2l0aHViLnNldGJyYW5jaChicmFuY2gpO1xuICAgICAgUHJvbWlzZS5hbGwoW3NldFIoKSwgc2V0QigpXSkudGhlbigoKSA9PiB7XG4gICAgICAgIGdpdGh1Yi5jYW5QdXNoKCkudGhlbigoYWxsb3dlZCkgPT4ge1xuICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKHJvb3QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgLy8gcHVzaCB0aGVuIHJlc29sdmVcbiAgICAgICAgICAgIGdpdGh1Yi5wdXNoKGZhbHNlLCB7IHN0ZGlvOiAncGlwZScgfSkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICdjaGFuZ2VzIG5vdCBzdGFnZWQnKTtcbiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGNoYW5nZXMgbm90IHN0YWdlZFxuICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdpdGh1Yi5pc1VwVG9EYXRlKCkudGhlbigodXBkYXRlZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgTG9nZ2VyLmxvZygnc3VibW9kdWxlJywgd29ya3NwYWNlKHJvb3QpLCAndXBkYXRlZCcsIHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBpcyB1cCB0byBkYXRlXG4gICAgICAgICAgICAgICAgICByZXNvbHZlUHVzaChudWxsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBpdGVyYXRlU3VibW9kdWxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgaWYgKHN1Ym1vZHVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBzdWJtb2R1bGVzLnNoaWZ0KCk7XG4gICAgICAgIGlmIChzdWJtb2R1bGUpIHtcbiAgICAgICAgICBwdXNoU3VibW9kdWxlKHN1Ym1vZHVsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGl0ZXJhdGVTdWJtb2R1bGUoKS50aGVuKHJlc29sdmUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGl0ZXJhdGVTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVQdXNoKSA9PiB7XG4gICAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgICBMb2dnZXIubG9nKHdvcmtzcGFjZShnaXRodWIuY3dkKSwgJ2NhbiBwdXNoJywgYWxsb3dlZCk7XG4gICAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgICBnaXRodWIucHVzaCgpLnRoZW4ocmVzb2x2ZVB1c2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNvbHZlKTtcbiAgICAvL3B1c2hTdWJtb2R1bGUoc3VibW9kdWxlc1sxXSkudGhlbihyZXNvbHZlKTtcbiAgfSk7XG59XG5cbmd1bHAudGFzaygnZGVwbG95OnB1c2gnLCBwdXNoKTtcbmd1bHAudGFzaygnZGVwbG95OnN0YXR1cycsIHN0YXR1cyk7XG5ndWxwLnRhc2soJ2RlcGxveTpjb21taXQnLCBjb21taXQpO1xuZ3VscC50YXNrKCdkZXBsb3k6cHVsbCcsIHB1bGwpO1xuXG4vKipcbiAqIGdldCByZWxhdGl2ZSBwYXRoIGZyb20gd29ya3NwYWNlXG4gKiBAcGFyYW0gc3RyXG4gKiBAcmV0dXJuc1xuICovXG5mdW5jdGlvbiB3b3Jrc3BhY2Uoc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRvVW5peChzdHIpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJyk7XG59XG5cbi8vIGRlcGxveVxuZ3VscC50YXNrKCdkZXBsb3knLCBndWxwLnNlcmllcygnZGVwbG95OnB1bGwnLCAnZGVwbG95OmNvcHknLCAnc2FmZWxpbmsnLCAnZGVwbG95OmNvbW1pdCcsICdkZXBsb3k6cHVzaCcpKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/29/gulpdeploy_294088671a308604e99e2f253a1fa5cc.map","wrapperLength":82},"result":{"scriptId":"7587","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39671,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39668,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5mZWVkLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEseUJBQXVFO0FBQ3ZFLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXdCO0FBQ3hCLHVDQUFtRDtBQUNuRCxzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLHNFQUErQztBQUMvQyxxQ0FBb0Q7QUFFcEQsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUIsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsVUFBVSxJQUFJO0lBQzlCLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sUUFBUSxHQUFHLElBQUksY0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQ25CLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUFHO2dCQUM3QixPQUFPLHdCQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztZQUVILFNBQVMsS0FBSyxDQUFDLE9BQTZCLEVBQUUsSUFBMEI7Z0JBQ3RFLElBQU0sUUFBUSxHQUFHLGtCQUFRLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQVksRUFBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRXZFLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6QyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUIsS0FBSyxHQUFHLEtBQUssQ0FB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SSxDQUFDLFNBQVMsSUFBSSwwRkFBNEUsT0FBTyxpQkFBYSxDQUFDO2lCQUN6SDtnQkFDRCxzQkFBc0I7Z0JBQ3RCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sZ0JBQVksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO29CQUNyRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsMEJBQXdCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUM1RDtvQkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw0RkFBOEUsT0FBTyxrQkFBYyxDQUFDO2lCQUM1SDtnQkFDRCx1RUFBdUU7WUFDekUsQ0FBQyxDQUFDLENBQ0g7aUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLElBQUksRUFBRSxFQUFOLENBQU0sQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLmZlZWQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGF0aE9yRmlsZURlc2NyaXB0b3IsIHJlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IsIGdyYXZhdGFyIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuZ3VscC50YXNrKCdmZWVkJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oY29uZmlnLmN3ZCk7XG5cbiAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgIGluc3RhbmNlLmxvYWQoKS50aGVuKCgpID0+IHtcbiAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIGJ1aWxkKHRtcGxTcmM6IFBhdGhPckZpbGVEZXNjcmlwdG9yLCBkZXN0OiBQYXRoT3JGaWxlRGVzY3JpcHRvcikge1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuXG4gICAgICAgIGxldCBwb3N0cyA9IGluc3RhbmNlLmxvY2Fscy5nZXQoJ3Bvc3RzJyk7XG4gICAgICAgIHBvc3RzID0gcG9zdHMuc29ydCgnLWRhdGUnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5maWx0ZXIoKHBvc3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gcG9zdC5kcmFmdCAhPT0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgeyBlbWFpbCwgZmVlZCwgdXJsOiB1cmxDZmcgfSA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgeyBpY29uOiBpY29uQ2ZnIH0gPSBmZWVkO1xuXG4gICAgICAgIGxldCB1cmwgPSB1cmxDZmc7XG4gICAgICAgIGlmICh1cmxbdXJsLmxlbmd0aCAtIDFdICE9PSAnLycpIHVybCArPSAnLyc7XG4gICAgICAgIC8vIHJlbW92ZSBicm9rZW4gaGV4byBsYW5nIHNob3J0Y29kZVxuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCc6bGFuZy8nKSkgdXJsID0gdXJsLnJlcGxhY2UoJy86bGFuZy8nLCAnLycpO1xuXG4gICAgICAgIGxldCBpY29uID0gJyc7XG4gICAgICAgIGlmIChpY29uQ2ZnKSBpY29uID0gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIGljb25DZmcpO1xuICAgICAgICBlbHNlIGlmIChlbWFpbCkgaWNvbiA9IGdyYXZhdGFyKGVtYWlsLCB7fSk7XG5cbiAgICAgICAgY29uc3QgZmVlZF91cmwgPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgJ3Jzcy54bWwnKTtcblxuICAgICAgICBjb25zdCBkYXRhID0gdGVtcGxhdGUucmVuZGVyKHtcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIGljb24sXG4gICAgICAgICAgcG9zdHMsXG4gICAgICAgICAgZmVlZF91cmxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd3JpdGVGaWxlU3luYyhkZXN0LCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGVtcGxhdGVSU1MgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfcnNzLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdFJTUyA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdyc3MueG1sJyk7XG4gICAgICBidWlsZCh0ZW1wbGF0ZVJTUywgZGVzdFJTUyk7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlQVRPTSA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9hdG9tLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdEFUT00gPSBqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnYXRvbS54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlQVRPTSwgZGVzdEFUT00pO1xuXG4gICAgICBjb25zdCBiYXNlVVJMID0gY29uZmlnLnVybC5lbmRzV2l0aCgnLycpID8gY29uZmlnLnVybCA6IGNvbmZpZy51cmwgKyAnLyc7XG5cbiAgICAgIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgZ3VscFxuICAgICAgICAuc3JjKCcqKi8qLmh0bWwnLCB7IGN3ZDogcHVibGljRGlyLCBpZ25vcmU6IGNvbW1vbklnbm9yZSB9KVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGF1dG8gZGlzY292ZXJ5IHJzc1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3Jzcy54bWxcIl1gKS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInJzcy1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9yc3MreG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCIgLz5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgYXRvbVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwiYXRvbS1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9hdG9tK3htbFwiIHJlbD1cImFsdGVybmF0ZVwiIGhyZWY9XCIke2Jhc2VVUkx9YXRvbS54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiBkb25lKCkpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/fb/gulpfeed_fbf9aaad66351334553810020391b0ff.map","wrapperLength":82},"result":{"scriptId":"7588","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13358,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13355,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673322428148,"runtime":4327,"slow":false,"start":1673322423821},"skipped":false,"testFilePath":"/home/runner/work/static-blog-generator/static-blog-generator/test/permalink-title.test.ts","testResults":[{"ancestorTitles":["permalink",":title.html","clean"],"duration":63,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["permalink",":title.html","clean"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["permalink",":title.html","copy"],"duration":1810,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["permalink",":title.html","copy"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"},{"ancestorTitles":["permalink",":title.html","validate"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html validate post with custom permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post with custom permalink"},{"ancestorTitles":["permalink",":title.html","validate"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html validate post without permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post without permalink"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.util = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nexports.util = __importStar(require(\"./utils\"));\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0M7QUFBdEMsbUhBQUEsT0FBTyxPQUFlO0FBQy9CLHNEQUFnRTtBQUF2RCx5SEFBQSxPQUFPLE9BQWM7QUFDOUIsc0RBQStEO0FBQXRELHdIQUFBLE9BQU8sT0FBYTtBQUM3QiwyQ0FBOEQ7QUFBckQscUdBQUEsT0FBTyxPQUFBO0FBQUUsaUdBQUEsR0FBRyxPQUFBO0FBQUUsdUdBQUEsR0FBRyxPQUFhO0FBQ3ZDLHVDQUFnRDtBQUF2QyxtR0FBQSxPQUFPLE9BQVc7QUFDM0IsK0NBQXNFO0FBQTdELCtHQUFBLGVBQWUsT0FBQTtBQUFFLG1IQUFBLG1CQUFtQixPQUFBO0FBQzdDLHFEQUFnRTtBQUF2RCxvSUFBQSxPQUFPLE9BQW9CO0FBQ3BDLHVDQUE0RDtBQUFuRCx5R0FBQSxhQUFhLE9BQUE7QUFBRSxpSEFBQSxPQUFPLE9BQVE7QUFDdkMsb0NBQTJEO0FBQWxELG9HQUFBLFlBQVksT0FBQTtBQUFFLHNHQUFBLGNBQWMsT0FBQTtBQUNyQyx3Q0FBMkM7QUFBbEMsb0dBQUEsVUFBVSxPQUFBO0FBQ25CLGdEQUFnQztBQUNoQyx1Q0FBK0U7QUFBdEUscUdBQUEsWUFBWSxPQUFBO0FBQUUsMkdBQUEsa0JBQWtCLE9BQUE7QUFBRSxxR0FBQSxZQUFZLE9BQUE7QUFDdkQscUNBQW9DO0FBQTNCLDRGQUFBLElBQUksT0FBQTtBQUNiLCtDQUF5RDtBQUFoRCx1SEFBQSxPQUFPLE9BQWE7QUFDN0IscUNBQStEO0FBQXRELHVHQUFBLFlBQVksT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUUzQyxFQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGRlZmF1bHQgYXMgQXBwbGljYXRpb24gfSBmcm9tICcuL2FwaSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBDYWNoZWQgfSBmcm9tICcuL2d1bHAtdXRpbHMvZ3VscC5jYWNoZSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBEZWJ1ZyB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmRlYnVnJztcbmV4cG9ydCB7IGNsZWFuRGIsIGRlbCwgZGVsIGFzIGRlbGV0ZURpciB9IGZyb20gJy4vZ3VscC5jbGVhbic7XG5leHBvcnQgeyB0YXNrU2VvIGFzIGF1dG9TZW8gfSBmcm9tICcuL2d1bHAuc2VvJztcbmV4cG9ydCB7IGdlbmVyYXRlU2l0ZW1hcCwgaGV4b0dlbmVyYXRlU2l0ZW1hcCB9IGZyb20gJy4vZ3VscC5zaXRlbWFwJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc3RhbmRhbG9uZVJ1bm5lciB9IGZyb20gJy4vZ3VscC5zdGFuZGFsb25lJztcbmV4cG9ydCB7IGNvbW1pdFByb2plY3QsIGRlZmF1bHQgYXMgZ3VscCB9IGZyb20gJy4vZ3VscGZpbGUnO1xuZXhwb3J0IHsgY29weUFsbFBvc3RzLCBjb3B5U2luZ2xlUG9zdCB9IGZyb20gJy4vcG9zdC9jb3B5JztcbmV4cG9ydCB7IHVwZGF0ZVBvc3QgfSBmcm9tICcuL3Bvc3QvdXBkYXRlJztcbmV4cG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlscyc7XG5leHBvcnQgeyBhcnJheV9yYW5kb20sIGFycmF5X3JlbW92ZV9lbXB0eSwgYXJyYXlfdW5pcXVlIH0gZnJvbSAnLi91dGlscy9hcnJheSc7XG5leHBvcnQgeyBub29wIH0gZnJvbSAnLi91dGlscy9ub29wJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc2NoZWR1bGVyIH0gZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuZXhwb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8vXG4iXSwidmVyc2lvbiI6M30=","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport * as util from './utils';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/09/index_09c0a821b29a6a45121212479559f319.map","wrapperLength":82},"result":{"scriptId":"8876","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":7904,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":7901,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1179,"endOffset":1260,"count":2},{"startOffset":1237,"endOffset":1257,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1946,"endOffset":2000,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2130,"endOffset":2191,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2320,"endOffset":2381,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2497,"endOffset":2541,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2609,"endOffset":2649,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2723,"endOffset":2763,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2875,"endOffset":2917,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3045,"endOffset":3099,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3183,"endOffset":3241,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3376,"endOffset":3442,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3560,"endOffset":3608,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3677,"endOffset":3736,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3850,"endOffset":3893,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3972,"endOffset":4017,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4133,"endOffset":4176,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4342,"endOffset":4386,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4469,"endOffset":4519,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4596,"endOffset":4640,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4747,"endOffset":4782,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4904,"endOffset":4964,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5079,"endOffset":5125,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5199,"endOffset":5242,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5316,"endOffset":5359,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar chain_1 = require(\"./utils/chain\");\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = (0, _config_1.getConfig)();\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, chain_1.chain)([{ callback: gulp_standalone_1.default }]); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, _this.config.public_dir)); };\n        /**\n         * Copy all **src-post** to **source/_posts** (run before generate)\n         * * see the method {@link pcopy.copyAllPosts}\n         * @returns\n         */\n        this.copy = function () { return (0, chain_1.chain)([{ callback: function () { return pcopy.copyAllPosts(undefined, _this.config); } }]); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        this.cwd = cwd;\n        (0, _config_1.fetchConfig)(cwd);\n        options = Object.assign(this.config, options || {}, { cwd: cwd });\n        this.config = (0, _config_1.setConfig)(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 3:\n                        if (!(opt === 'archive')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 5:\n                        if (!(opt === 'post')) return [3 /*break*/, 7];\n                        return [4 /*yield*/, cleaner.cleanGeneratedPosts().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 7: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 8:\n                        _a.sent();\n                        _a.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBd0I7QUFDeEIsK0JBQTZCO0FBRTdCLG9EQUF3QztBQUN4QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsdUNBQXNDO0FBQ3RDLHNEQUFnQztBQUNoQyxnRUFBMEM7QUFDMUMscUNBQThEO0FBRTlEO0lBTUU7OztPQUdHO0lBQ0gsYUFBWSxHQUFxQixFQUFFLE9BQXlDO1FBQTVFLGlCQVNDO1FBakJELFdBQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztRQUNyQixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQUN0QixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQXlCdEI7OztXQUdHO1FBQ0gsZUFBVSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLHlCQUFnQixFQUFFLENBQUMsQ0FBQyxFQUF2QyxDQUF1QyxDQUFDO1FBRTNEOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBckQsQ0FBcUQsQ0FBQztRQUVsRTs7OztXQUlHO1FBQ0gsU0FBSSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLGNBQU0sT0FBQSxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQTFDLENBQTBDLEVBQUUsQ0FBQyxDQUFDLEVBQXZFLENBQXVFLENBQUM7UUFFckY7OztXQUdHO1FBQ0gsYUFBUSxHQUFHLGNBQU0sT0FBQSxJQUFBLDRCQUFZLEVBQUMsY0FBSSxFQUFFLElBQUEsWUFBSSxFQUFDLEtBQUksQ0FBQyxHQUFHLEVBQUUsSUFBQSxtQkFBUyxHQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBMUQsQ0FBMEQsQ0FBQztRQXpDMUUsSUFBSSxDQUFDLEdBQUc7WUFBRSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzlCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1FBQ2YsSUFBQSxxQkFBVyxFQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsT0FBTyxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsS0FBQSxFQUFFLENBQUMsQ0FBQztRQUU3RCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUEsbUJBQVMsRUFBQyxPQUFPLENBQUMsQ0FBQztRQUNqQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pCLElBQUksbUJBQVMsRUFBRSxDQUFDO0lBQ2xCLENBQUM7SUFHTSxVQUFNLEdBQWIsVUFBYyxHQUFRO1FBQ3BCLElBQUksQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDO0lBQ3hCLENBQUM7SUFDTSxVQUFNLEdBQWI7UUFDRSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQTJCRDs7T0FFRztJQUNHLHNCQUFRLEdBQWQ7Ozs7Ozt3QkFDUSxJQUFJLEdBQUcsSUFBSSxjQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO3dCQUNoQyxZQUFZO3dCQUNaLHFCQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEVBQUE7O3dCQUQ3QixZQUFZO3dCQUNaLFNBQTZCLENBQUM7d0JBQzlCLHFCQUFNLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEVBQUE7O3dCQUE3QixTQUE2QixDQUFDO3dCQUM5QixnQkFBZ0I7d0JBQ2hCLHFCQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDLGNBQUksQ0FBQyxFQUFBOzt3QkFEdkMsZ0JBQWdCO3dCQUNoQixTQUF1QyxDQUFDO3dCQUN4QyxxQkFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQUE7O3dCQUFqQixTQUFpQixDQUFDOzs7OztLQUNuQjtJQUVEOzs7O09BSUc7SUFDRyxtQkFBSyxHQUFYLFVBQVksR0FBNkM7Ozs7OzZCQUNuRCxDQUFBLEdBQUcsS0FBSyxLQUFLLENBQUEsRUFBYix3QkFBYTt3QkFDZixxQkFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBQTs7d0JBQTFDLFNBQTBDLENBQUM7d0JBQzNDLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs7NkJBQzNDLENBQUEsR0FBRyxLQUFLLFNBQVMsQ0FBQSxFQUFqQix3QkFBaUI7d0JBQzFCLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs7NkJBQzNDLENBQUEsR0FBRyxLQUFLLE1BQU0sQ0FBQSxFQUFkLHdCQUFjO3dCQUN2QixxQkFBTSxPQUFPLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFBOzt3QkFBdEQsU0FBc0QsQ0FBQzs7NEJBRXZELHFCQUFNLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFBOzt3QkFBMUMsU0FBMEMsQ0FBQzs7Ozs7O0tBRTlDO0lBQ0gsVUFBQztBQUFELENBQUMsQUFwRkQsSUFvRkM7QUFFRCxrQkFBZSxHQUFHLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIZXhvIGZyb20gJ2hleG8nO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IE51bGxhYmxlIH0gZnJvbSAnLi9nbG9iYWxzJztcbmltcG9ydCAqIGFzIGNsZWFuZXIgZnJvbSAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgeyBjaGFpbiB9IGZyb20gJy4vdXRpbHMvY2hhaW4nO1xuaW1wb3J0IG5vb3AgZnJvbSAnLi91dGlscy9ub29wJztcbmltcG9ydCBzY2hlZHVsZXIgZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuaW1wb3J0IHsgZmV0Y2hDb25maWcsIGdldENvbmZpZywgc2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY2xhc3MgU0JHIHtcbiAgY3dkOiBzdHJpbmc7XG4gIGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBmZXRjaENvbmZpZyhjd2QpO1xuICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlnLCBvcHRpb25zIHx8IHt9LCB7IGN3ZCB9KTtcblxuICAgIHRoaXMuY29uZmlnID0gc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBjaGFpbihbeyBjYWxsYmFjazogc3RhbmRhbG9uZVJ1bm5lciB9XSk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCB0aGlzLmNvbmZpZy5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSA9ICgpID0+IGNoYWluKFt7IGNhbGxiYWNrOiAoKSA9PiBwY29weS5jb3B5QWxsUG9zdHModW5kZWZpbmVkLCB0aGlzLmNvbmZpZykgfV0pO1xuXG4gIC8qKlxuICAgKiBBbm9ueW1pemUgZXh0ZXJuYWwgbGlua3Mgb24gcHVibGljIGRpciAoX2NvbmZpZ195bWwucHVibGljX2RpcikgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBzYWZlbGluayA9ICgpID0+IHRhc2tTYWZlbGluayhub29wLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIGdlbmVyYXRlIHNpdGUgd2l0aCBoZXhvXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZSgpIHtcbiAgICBjb25zdCBoZXhvID0gbmV3IEhleG8odGhpcy5jd2QpO1xuICAgIC8vIGhleG8gaW5pdFxuICAgIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8ubG9hZCgpLmNhdGNoKG5vb3ApO1xuICAgIC8vIGhleG8gZ2VuZXJhdGVcbiAgICBhd2FpdCBoZXhvLmNhbGwoJ2dlbmVyYXRlJykuY2F0Y2gobm9vcCk7XG4gICAgYXdhaXQgaGV4by5leGl0KCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlJyB8ICdkYXRhYmFzZScgfCAncG9zdCcpIHtcbiAgICBpZiAob3B0ID09PSAnYWxsJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbkRiKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSBpZiAob3B0ID09PSAnYXJjaGl2ZScpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ3Bvc3QnKSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuR2VuZXJhdGVkUG9zdHMoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU0JHO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport { chain } from './utils/chain';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { fetchConfig, getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = getConfig();\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    this.cwd = cwd;\n    fetchConfig(cwd);\n    options = Object.assign(this.config, options || {}, { cwd });\n\n    this.config = setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => chain([{ callback: standaloneRunner }]);\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, this.config.public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy = () => chain([{ callback: () => pcopy.copyAllPosts(undefined, this.config) }]);\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archive' | 'database' | 'post') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archive') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'post') {\n      await cleaner.cleanGeneratedPosts().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/a8/api_a829825f326b4691c16e18cc91565c70.map","wrapperLength":82},"result":{"scriptId":"8877","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":16899,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":16896,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":7},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":4},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":3},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":3},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":5},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":5},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":4},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4395,"endOffset":9162,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4488,"endOffset":6135,"count":1},{"startOffset":5851,"endOffset":5871,"count":0},{"startOffset":5990,"endOffset":5995,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4847,"endOffset":4932,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5078,"endOffset":5186,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.copy","ranges":[{"startOffset":5383,"endOffset":5510,"count":1}],"isBlockCoverage":true},{"functionName":"callback","ranges":[{"startOffset":5436,"endOffset":5503,"count":1}],"isBlockCoverage":true},{"functionName":"SBG.safelink","ranges":[{"startOffset":5677,"endOffset":5819,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":6153,"endOffset":6206,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":6225,"endOffset":6276,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6354,"endOffset":7447,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":7618,"endOffset":9143,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7682,"endOffset":9135,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7733,"endOffset":9123,"count":5},{"startOffset":7805,"endOffset":7967,"count":1},{"startOffset":7883,"endOffset":7967,"count":0},{"startOffset":7988,"endOffset":8123,"count":0},{"startOffset":8144,"endOffset":8235,"count":0},{"startOffset":8256,"endOffset":8431,"count":1},{"startOffset":8338,"endOffset":8431,"count":0},{"startOffset":8452,"endOffset":8543,"count":0},{"startOffset":8564,"endOffset":8739,"count":1},{"startOffset":8643,"endOffset":8739,"count":0},{"startOffset":8760,"endOffset":8851,"count":0},{"startOffset":8872,"endOffset":8939,"count":1},{"startOffset":8960,"endOffset":9040,"count":1},{"startOffset":9061,"endOffset":9091,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHNEQUFnQztBQUNoQyxxQ0FBOEQ7QUFDOUQsOENBQXdCO0FBQ3hCLHlCQUF5QjtBQUN6QiwrQkFBNkI7QUFDN0IsNkJBQStCO0FBQy9CLHdEQUFrQztBQUNsQyxpQ0FBdUM7QUFDdkMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyxxQ0FBc0M7QUFFdEM7O0dBRUc7QUFDSCxTQUFzQixPQUFPLENBQUMsUUFBa0QsRUFBRSxLQUFnQjs7Ozs7O29CQUMxRixHQUFHLEdBQUcsSUFBQSxlQUFLLEVBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3JCLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztvQkFDM0IsSUFBSSxPQUFPLE1BQU0sQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFO3dCQUN6QyxJQUFBLGNBQVMsRUFBQyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHNCQUFzQixDQUFDLEVBQUUsSUFBQSxjQUFPLEVBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzt3QkFDckUsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO3FCQUN6RDtvQkFJRyxJQUFJLEdBQUc7d0JBQ1QsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQzt3QkFDN0MsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxXQUFXLENBQUM7d0JBQzdCLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDO3dCQUM1QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQzt3QkFDNUIsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUM7cUJBQzVCLENBQUM7b0JBQ0YsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQzt3QkFBRSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDM0MsQ0FBQyxHQUFHLENBQUM7Ozt5QkFBRSxDQUFBLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFBO29CQUN2QixHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7O3lCQUVkLElBQUEscUJBQVUsRUFBQyxHQUFHLENBQUMsRUFBZix3QkFBZTtvQkFDakIsR0FBRyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsQ0FBQztvQkFDcEIscUJBQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFBOztvQkFBZCxTQUFjLENBQUM7Ozs7O29CQUdqQixHQUFHLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQyxDQUFDOzs7b0JBUkcsQ0FBQyxFQUFFLENBQUE7OztvQkFZcEM7OzJEQUV1QztvQkFFdkMsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVO3dCQUFFLHNCQUFPLFFBQVEsRUFBRSxFQUFDO29CQUV0RCxzQkFBTyxTQUFTLEVBQUM7Ozs7Q0FDbEI7QUFyQ0QsMEJBcUNDO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLEdBQUcsQ0FBQyxJQUFZO0lBQzlCLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBTztRQUMxQixJQUFNLEtBQUssR0FBYyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDO1FBQzFELElBQUksSUFBQSxxQkFBVSxFQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3BCLElBQUEsYUFBRSxFQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzdDOzs7O2VBSUc7U0FDSjthQUFNO1lBQ0wsT0FBTyxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQ3pDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBZEQsa0JBY0M7QUFFRDs7R0FFRztBQUNILFNBQXNCLGdCQUFnQixDQUFDLFFBQWtEOzs7Ozs7b0JBQ2pGLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztvQkFDckIsT0FBTyxHQUFHLFFBQVEsR0FBRyxxQkFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztvQkFHakQsUUFBUSxHQUFHLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDN0QsVUFBVSxHQUFHLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztvQkFDaEUsSUFBSSxHQUFHLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDckQsT0FBTyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxJQUFBLHFCQUFVLEVBQUMsR0FBRyxDQUFDLEVBQWYsQ0FBZSxDQUFDLENBQUM7b0JBRTlFLHFEQUFxRDtvQkFDckQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRTt3QkFDNUIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQW5DLENBQW1DLENBQUMsQ0FBQzt3QkFDbkYsT0FBTyxDQUFDLElBQUksT0FBWixPQUFPLDJCQUFTLE9BQU8sV0FBRTtxQkFDMUI7eUJBQU0sSUFBSSxPQUFPLE1BQU0sQ0FBQyxRQUFRLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTt3QkFDM0YsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztxQkFDdEU7b0JBR0ssUUFBUSxHQUFHLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO3lCQUNuRCxJQUFBLHFCQUFVLEVBQUMsUUFBUSxDQUFDLEVBQXBCLHdCQUFvQjtvQkFDUCxxQkFBTSxJQUFBLGtCQUFPLEVBQUMsUUFBUSxDQUFDLEVBQUE7O29CQUFoQyxLQUFLLEdBQUcsQ0FBQyxTQUF1QixDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBakIsQ0FBaUIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQUcsSUFBSyxPQUFBLElBQUEsWUFBSSxFQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsRUFBbkIsQ0FBbUIsQ0FBQztvQkFDNUcsT0FBTyxDQUFDLElBQUksT0FBWixPQUFPLDJCQUFTLEtBQUssV0FBRTs7O29CQUduQixRQUFRLEdBQW1CLEVBQUUsQ0FBQztvQkFHOUIsUUFBUSxHQUFHLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO29CQUMzRCxJQUFBLGNBQVMsRUFBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFHLENBQUMsQ0FBQyxDQUFDO29CQUN2QyxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBRXBELEtBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTt3QkFDakMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDM0IsSUFBSTs0QkFDRixJQUFJLElBQUEscUJBQVUsRUFBQyxPQUFPLENBQUM7Z0NBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLGNBQUksQ0FBQyxDQUFDLENBQUM7eUJBQ2xFO3dCQUFDLFdBQU07NEJBQ04sRUFBRTt5QkFDSDtxQkFDRjtvQkFFSyxTQUFTLEdBQUcsVUFBVSxDQUFNO3dCQUNoQyxJQUFJLENBQUMsWUFBWSxLQUFLLEVBQUU7NEJBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQzt5QkFDOUM7d0JBQ0QsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVOzRCQUFFLFFBQVEsRUFBRSxDQUFDO3dCQUMvQyxPQUFPLFNBQVMsQ0FBQztvQkFDbkIsQ0FBQyxDQUFDO29CQUVGLHFCQUFNLGtCQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUE7O29CQUE3RCxTQUE2RCxDQUFDOzs7OztDQUMvRDtBQWxERCw0Q0FrREM7QUFFRCxTQUFzQixtQkFBbUIsQ0FBQyxRQUFrRDs7OztZQUNwRixNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7WUFDM0Isc0JBQU8sT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUM7OztDQUMzRTtBQUhELGtEQUdDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvQixjQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0FBQzdDLGNBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGNBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZGRpciwgcm0sIFJtT3B0aW9ucyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IGluc3BlY3QgfSBmcm9tICd1dGlsJztcbmltcG9ydCBkZWJ1ZyBmcm9tICcuL3V0aWxzL2RlYnVnJztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBDbGVhbiBQcm9qZWN0IERhdGFiYXNlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5EYihjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSwgZmlsZXM/OiBzdHJpbmdbXSkge1xuICBjb25zdCBsb2cgPSBkZWJ1ZygnY2xlYW4nKTtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGlmICh0eXBlb2YgY29uZmlnLnNvdXJjZV9kaXIgIT09ICdzdHJpbmcnKSB7XG4gICAgd3JpdGVmaWxlKGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvY2xlYW4ubG9nJyksIGluc3BlY3QoY29uZmlnKSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjb25maWcuc291cmNlX2RpciBtdXN0IGJlIGNvbmZpZ3VyZWQnKTtcbiAgfVxuXG4gIC8vIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuXG4gIGxldCBkaXJzID0gW1xuICAgIGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnNvdXJjZV9kaXIsICdfcG9zdHMnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvY2FjaGUnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvZHVtcCcpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9sb2dzJyksXG4gICAgam9pbihjb25maWcuY3dkLCAnZGIuanNvbicpXG4gIF07XG4gIGlmIChBcnJheS5pc0FycmF5KGZpbGVzKSkgZGlycyA9IGRpcnMuY29uY2F0KGZpbGVzKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZGlyID0gZGlyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICBsb2coJ2NsYW5pbmcnLCBkaXIpO1xuICAgICAgICBhd2FpdCBkZWwoZGlyKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIGxvZygnY2Fubm90IGRlbGV0ZScsIGRpcik7XG4gICAgfVxuICB9XG5cbiAgLypjb25zdCBoZXhvID0gbmV3IGhleG9MaWIoY29uZmlnLmN3ZCk7XG4gIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICBhd2FpdCBoZXhvLmNhbGwoJ2NsZWFuJykuY2F0Y2gobm9vcCk7Ki9cblxuICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSByZXR1cm4gY2FsbGJhY2soKTtcblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIGRlbGV0ZSBmb2xkZXIgYXN5bmNcbiAqIEBwYXJhbSBwYXRoXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsKHBhdGg6IHN0cmluZykge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgcm1PcHQ6IFJtT3B0aW9ucyA9IHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9O1xuICAgIGlmIChleGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIC8qaWYgKHN0YXRTeW5jKHBhdGgpLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgcm1kaXIocGF0aCwgeyBtYXhSZXRyaWVzOiAxMCB9KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm0ocGF0aCwgcm1PcHQpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9Ki9cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzb2x2ZShuZXcgRXJyb3IocGF0aCArICcgbm90IGZvdW5kJykpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogY2xlYW4gb2xkIGFyY2hpdmVzIChjYXRlZ29yaWVzLCB0YWdzLCBwYWdpbmF0aW9uKSBmcm9tIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbk9sZEFyY2hpdmVzKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCBsb2duYW1lID0gJ2NsZWFuOicgKyBhbnNpQ29sb3JzLmdyZXkoJ2FyY2hpdmVzJyk7XG5cbiAgLy8gY2xlYW4gYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNcbiAgY29uc3QgYXJjaGl2ZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuYXJjaGl2ZV9kaXIpO1xuICBjb25zdCBjYXRlZ29yaWVzID0gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgY29uZmlnLmNhdGVnb3J5X2Rpcik7XG4gIGNvbnN0IHRhZ3MgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcudGFnX2Rpcik7XG4gIGNvbnN0IGZvbGRlcnMgPSBbYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNdLmZpbHRlcigoc3RyKSA9PiBleGlzdHNTeW5jKHN0cikpO1xuXG4gIC8vIHB1c2ggbGFuZ3VhZ2UgZm9sZGVyIHRvIGJlIGRlbGV0ZWQgZnJvbSBkZXBsb3kgZGlyXG4gIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5sYW5ndWFnZSkpIHtcbiAgICBjb25zdCBsYW5nRGlyID0gY29uZmlnLmxhbmd1YWdlLm1hcCgocGF0aCkgPT4gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgcGF0aCkpO1xuICAgIGZvbGRlcnMucHVzaCguLi5sYW5nRGlyKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnLmxhbmd1YWdlID09PSAnc3RyaW5nJyAmJiBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgIGZvbGRlcnMucHVzaChqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKSkpO1xuICB9XG5cbiAgLy8gZGVsZXRlIHBhZ2luYXRpb25cbiAgY29uc3QgcGFnZXNEaXIgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCAncGFnZScpO1xuICBpZiAoZXhpc3RzU3luYyhwYWdlc0RpcikpIHtcbiAgICBjb25zdCBwYWdlcyA9IChhd2FpdCByZWFkZGlyKHBhZ2VzRGlyKSkuZmlsdGVyKChzdHIpID0+IC9eXFxkKyQvLnRlc3Qoc3RyKSkubWFwKChzdHIpID0+IGpvaW4ocGFnZXNEaXIsIHN0cikpO1xuICAgIGZvbGRlcnMucHVzaCguLi5wYWdlcyk7XG4gIH1cblxuICBjb25zdCBwcm9taXNlczogUHJvbWlzZTxhbnk+W10gPSBbXTtcblxuICAvLyBkdW1wIHRvIGZpbGVcbiAgY29uc3QgZHVtcGZpbGUgPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9jbGVhbi50eHQnKTtcbiAgd3JpdGVmaWxlKGR1bXBmaWxlLCBmb2xkZXJzLmpvaW4oRU9MKSk7XG4gIExvZ2dlci5sb2cobG9nbmFtZSwgJ2xpc3QgZGVsZXRlZCBmaWxlcycsIGR1bXBmaWxlKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGZvbGRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBwYXRoU3RyID0gZm9sZGVyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMocGF0aFN0cikpIHByb21pc2VzLnB1c2goZGVsKHBhdGhTdHIpLmNhdGNoKG5vb3ApKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuICB9XG5cbiAgY29uc3QgZmluaXNoTm93ID0gZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjbGVhbiBhcmNoaXZlcyBoYXMgc29tZSBlcnJvcycpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSBjYWxsYmFjaygpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgYXdhaXQgQmx1ZWJpcmQuYWxsKHByb21pc2VzKS50aGVuKGZpbmlzaE5vdykuY2F0Y2goZmluaXNoTm93KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuR2VuZXJhdGVkUG9zdHMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIHJldHVybiBjbGVhbkRiKGNhbGxiYWNrLCBbam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpXSk7XG59XG5cbmd1bHAudGFzaygnY2xlYW46YXJjaGl2ZScsIGNsZWFuT2xkQXJjaGl2ZXMpO1xuZ3VscC50YXNrKCdjbGVhbjpkYicsIGNsZWFuRGIpO1xuZ3VscC50YXNrKCdjbGVhbjpwb3N0JywgY2xlYW5HZW5lcmF0ZWRQb3N0cyk7XG5ndWxwLnRhc2soJ2NsZWFuOmFsbCcsIGd1bHAuc2VyaWVzKCdjbGVhbjpkYicsICdjbGVhbjphcmNoaXZlJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/6b/gulpclean_6b5cfe0a3f5f375b9d7210604d22c51b.map","wrapperLength":82},"result":{"scriptId":"9406","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24224,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24221,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = exports.fetchConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexoPostParser = __importStar(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nfunction fetchConfig(fileYML) {\n    if (!fileYML.endsWith('_config.yml'))\n        fileYML += '/_config.yml';\n    var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n    setConfig((0, object_1.orderKeys)(configYML));\n    (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\nexports.fetchConfig = fetchConfig;\nfetchConfig((0, path_1.join)(process.cwd(), '_config.yml'));\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign(settledConfig || {}, obj);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nfunction getConfig() {\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : { submodule: [] };\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvX2NvbmZpZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBOEM7QUFDOUMsMEVBQXFDO0FBRXJDLCtEQUFtRDtBQUNuRCw2QkFBNEI7QUFDNUIsOENBQXdCO0FBQ3hCLHVDQUE4QztBQUM5QyxpQ0FBdUM7QUFDdkMseUNBQTJDO0FBNEQzQyxJQUFJLGFBQWEsR0FBRyxJQUFBLDJCQUFnQixHQUF5QixDQUFDO0FBRTlELFNBQWdCLFdBQVcsQ0FBQyxPQUFlO0lBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztRQUFFLE9BQU8sSUFBSSxjQUFjLENBQUM7SUFDaEUsSUFBTSxTQUFTLEdBQUcsY0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDN0QsU0FBUyxDQUFDLElBQUEsa0JBQVMsRUFBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqRixDQUFDO0FBTEQsa0NBS0M7QUFFRCxXQUFXLENBQUMsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFFaEQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRXhELGlDQUFpQztJQUNqQyxjQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sU0FBUyxFQUFFLENBQUM7QUFDckIsQ0FBQztBQU5ELDhCQU1DO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVM7SUFDdkIsYUFBYSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLElBQUksRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDakYsOEZBQThGO0lBQzlGLE9BQU8sYUFBeUIsQ0FBQztBQUNuQyxDQUFDO0FBSkQsOEJBSUM7QUFFRCxTQUFnQixZQUFZOztJQUMxQixJQUFNLFNBQVMsR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLFVBQVUsSUFBRyxNQUFBLGFBQWEsQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQSxJQUFJLEtBQUssQ0FBQyxDQUFDO0lBQzVGLElBQU0sTUFBTSxHQUFHLElBQUEsZUFBVSxFQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLDRCQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFFLEVBQUUsU0FBUyxFQUFFLEVBQVcsRUFBcUIsQ0FBQztJQUMzRyxPQUFPLEVBQUUsU0FBUyxXQUFBLEVBQUUsTUFBTSxRQUFBLEVBQUUsQ0FBQztBQUMvQixDQUFDO0FBSkQsb0NBSUM7QUFFRDs7Ozs7O0dBTUc7QUFDVSxRQUFBLFlBQVksR0FBRztJQUMxQixrQkFBa0I7SUFDbEIsc0JBQXNCO0lBQ3RCLDZCQUE2QjtJQUM3QiwwQ0FBMEM7SUFDMUMsaUJBQWlCO0lBQ2pCLGFBQWE7SUFDYixvQkFBb0I7SUFDcEIsV0FBVztJQUNYLGFBQWE7SUFDYixjQUFjO0lBQ2QsZUFBZTtJQUNmLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsMEJBQTBCO0lBQzFCLGdCQUFnQjtJQUNoQixvQkFBb0I7SUFDcEIsb0JBQW9CO0lBQ3BCLGFBQWE7SUFDYixPQUFPLENBQUMsWUFBWTtDQUNyQixDQUFDO0FBRUY7O0dBRUc7QUFDVSxRQUFBLGNBQWMsMENBQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLGtCQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxVQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL19jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgKiBhcyBoZXhvUG9zdFBhcnNlciBmcm9tICdoZXhvLXBvc3QtcGFyc2VyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaENvbmZpZyhmaWxlWU1MOiBzdHJpbmcpIHtcbiAgaWYgKCFmaWxlWU1MLmVuZHNXaXRoKCdfY29uZmlnLnltbCcpKSBmaWxlWU1MICs9ICcvX2NvbmZpZy55bWwnO1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKHJlYWRGaWxlU3luYyhmaWxlWU1MLCAndXRmLTgnKSk7XG4gIHNldENvbmZpZyhvcmRlcktleXMoY29uZmlnWU1MKSk7XG4gIHdyaXRlZmlsZShqb2luKF9fZGlybmFtZSwgJ19jb25maWcuanNvbicpLCBKU09OLnN0cmluZ2lmeShjb25maWdZTUwsIG51bGwsIDIpKTtcbn1cblxuZmV0Y2hDb25maWcoam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKSk7XG5cbi8qKlxuICogQ29uZmlnIHNldHRlclxuICogKiB1c2VmdWwgZm9yIGplc3RcbiAqIEBwYXJhbSBvYmpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENvbmZpZyhvYmo6IFJlY29yZDxzdHJpbmcsIGFueT4gfCBQcm9qQ29uZikge1xuICBzZXR0bGVkQ29uZmlnID0gT2JqZWN0LmFzc2lnbihzZXR0bGVkQ29uZmlnIHx8IHt9LCBvYmopO1xuXG4gIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICBoZXhvUG9zdFBhcnNlci5zZXRDb25maWcoc2V0dGxlZENvbmZpZyk7XG4gIHJldHVybiBnZXRDb25maWcoKTtcbn1cblxuLyoqXG4gKiBDb25maWcgZ2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZygpIHtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXBsb3lDb25maWcoKSB7XG4gIGNvbnN0IGRlcGxveURpciA9IGpvaW4oc2V0dGxlZENvbmZpZy5jd2QsICcuZGVwbG95XycgKyBzZXR0bGVkQ29uZmlnLmRlcGxveT8udHlwZSB8fCAnZ2l0Jyk7XG4gIGNvbnN0IGdpdGh1YiA9IGV4aXN0c1N5bmMoZGVwbG95RGlyKSA/IG5ldyBnaXQoZGVwbG95RGlyKSA6ICh7IHN1Ym1vZHVsZTogW10gYXMgZ2l0W10gfSBhcyB1bmtub3duIGFzIGdpdCk7XG4gIHJldHVybiB7IGRlcGxveURpciwgZ2l0aHViIH07XG59XG5cbi8qKlxuICogY29tbW9uIGlnbm9yZSBmaWxlc1xuICogQGV4YW1wbGVcbiAqIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICogY29uc3QgZXhjbHVkZXMgPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gKiBleGNsdWRlcy5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gKi9cbmV4cG9ydCBjb25zdCBjb21tb25JZ25vcmUgPSBbXG4gICcqKi95YW5kZXhfKi5odG1sJywgLy8gc2tpcCB5YW5kZXggdmVyaWZpY2F0aW9uIGZpbGVcbiAgLy8gJyoqL2NvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovZGlzcXVzLWNvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovY29tbWVudC5odG1sJywgLy8gc2tpcCBjb21tZW50Lmh0bWxcbiAgJyoqL2Zhdmljb24uaHRtbCcsIC8vIHNraXAgZmF2aWNvblxuICAnKiovNDA0Lmh0bWwnLCAvLyBza2lwIDQwNFxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gc2tpcCBub2RlX21vZHVsZXNcbiAgJyoqL3RtcC8qKicsIC8vIHNraXAgdG1wXG4gICcqKi9idWlsZC8qKicsIC8vIHNraXAgYnVpbGRcbiAgJyoqLy5jYWNoZS8qKicsIC8vIHNraXAgY29tbW9uIGNhY2hlIGZvbGRlclxuICAnKiovLnZzY29kZS8qKicsIC8vIHNraXAgdnNjb2RlIGNvbmZpZ3VyYXRpb24gZm9sZGVyXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyBza2lwIGZyb250bWF0dGVyIHZzY29kZSBleHRlbnNpb25cbiAgJyoqL3BpbnRlcmVzdC0qLmh0bWwnLCAvLyBza2lwIHBpbnRlcmVzdCB2ZXJpZmljYXRpb24gZmlsZVxuICAnKiovXyouc3RhbmRhbG9uZS57anMsdHN9JywgLy8gc2tpcCBfZmlsZW5hbWUuc3RhbmRhbG9uZS5qc1xuICAnKiovZGVza3RvcC5pbmknLCAvLyB3aW5kb3dzIGRlc2t0b3AuaW5pXG4gICcqKi9ub2RlX21vZHVsZXMvKionLCAvLyBub2RlX21vZHVsZXNcbiAgJyoqLy5mcm9udG1hdHRlci8qKicsIC8vIHZzY29kZSBmcm9udG1hdHRlciBwbHVnaW5cbiAgJyoqLy5naXQqLyoqJywgLy8gYW55IGdpdCBjb25maWdzXG4gICcqKi8uKicgLy8gc2tpcCBkb3RzXG5dO1xuXG4vKipcbiAqIGFycmF5IG9mIGNvbmZpZy5leGNsdWRlLCBjb25maWcuaWdub3JlXG4gKi9cbmV4cG9ydCBjb25zdCBwcm9qZWN0SWdub3JlcyA9IFsuLi4oZ2V0Q29uZmlnKCkuc2tpcF9yZW5kZXIgfHwgW10pLCAuLi4oZ2V0Q29uZmlnKCkuaWdub3JlIHx8IFtdKV07XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport * as hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nexport function fetchConfig(fileYML: string) {\n  if (!fileYML.endsWith('_config.yml')) fileYML += '/_config.yml';\n  const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n  setConfig(orderKeys(configYML));\n  writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\n\nfetchConfig(join(process.cwd(), '_config.yml'));\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign(settledConfig || {}, obj);\n\n  // update hexo-post-parser config\n  hexoPostParser.setConfig(settledConfig);\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nexport function getConfig() {\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : ({ submodule: [] as git[] } as unknown as git);\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/cd/_config_cdd6159bd7bcb99ef891db3f4cdffa50.map","wrapperLength":82},"result":{"scriptId":"9769","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13247,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13244,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":1161,"endOffset":1611,"count":2},{"startOffset":1255,"endOffset":1264,"count":0},{"startOffset":1342,"endOffset":1352,"count":0},{"startOffset":1379,"endOffset":1396,"count":0},{"startOffset":1407,"endOffset":1446,"count":0},{"startOffset":1504,"endOffset":1524,"count":0},{"startOffset":1526,"endOffset":1536,"count":0},{"startOffset":1572,"endOffset":1586,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":1665,"endOffset":1992,"count":2},{"startOffset":1733,"endOffset":1928,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2050,"endOffset":2131,"count":2},{"startOffset":2102,"endOffset":2107,"count":1},{"startOffset":2108,"endOffset":2128,"count":1}],"isBlockCoverage":true},{"functionName":"fetchConfig","ranges":[{"startOffset":2751,"endOffset":3102,"count":2},{"startOffset":2833,"endOffset":2859,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":3259,"endOffset":3454,"count":3},{"startOffset":3333,"endOffset":3338,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3544,"endOffset":3779,"count":609},{"startOffset":3629,"endOffset":3634,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3811,"endOffset":4174,"count":609},{"startOffset":3973,"endOffset":3981,"count":0},{"startOffset":3993,"endOffset":4001,"count":0},{"startOffset":4053,"endOffset":4098,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml = __importStar(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:name/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBa0M7QUFDbEMsaURBQWtEO0FBQ2xELCtCQUFxQztBQUNyQyx5Q0FBNkI7QUFFN0I7OztHQUdHO0FBQ0gsU0FBZ0IsZ0JBQWdCO0lBQzlCLElBQU0saUJBQWlCLEdBQUc7UUFDeEIsT0FBTztRQUNQLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNO1FBQ04sR0FBRyxFQUFFLG9CQUFvQjtRQUN6QixJQUFJLEVBQUUsR0FBRztRQUNULFNBQVMsRUFBRSwwQkFBMEI7UUFDckMsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QixXQUFXLEVBQUU7WUFDWCxjQUFjLEVBQUUsSUFBSTtZQUNwQixhQUFhLEVBQUUsSUFBSTtTQUNwQjtRQUNELFlBQVk7UUFDWixVQUFVLEVBQUUsUUFBUTtRQUNwQixVQUFVLEVBQUUsUUFBUTtRQUNwQixPQUFPLEVBQUUsTUFBTTtRQUNmLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLFlBQVksRUFBRSxZQUFZO1FBQzFCLFFBQVEsRUFBRSxnQkFBZ0I7UUFDMUIsUUFBUSxFQUFFLE9BQU87UUFDakIsV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVO1FBQ1YsYUFBYSxFQUFFLFdBQVc7UUFDMUIsY0FBYyxFQUFFLE1BQU07UUFDdEIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsYUFBYSxFQUFFO1lBQ2IsTUFBTSxFQUFFLElBQUk7WUFDWixLQUFLLEVBQUUsTUFBTTtZQUNiLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxhQUFhLEVBQUUsQ0FBQztRQUNoQixhQUFhLEVBQUUsS0FBSztRQUNwQixpQkFBaUIsRUFBRSxLQUFLO1FBQ3hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLE1BQU0sRUFBRSxJQUFJO1FBQ1osa0JBQWtCLEVBQUUsY0FBYztRQUNsQyxTQUFTLEVBQUU7WUFDVCxXQUFXLEVBQUUsS0FBSztZQUNsQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtZQUNmLElBQUksRUFBRSxJQUFJO1lBQ1YsaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixhQUFhLEVBQUUsS0FBSztZQUNwQixJQUFJLEVBQUUsS0FBSztTQUNaO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVyxFQUFFLElBQUk7WUFDakIsV0FBVyxFQUFFLEVBQUU7U0FDaEI7UUFDRCxpQkFBaUI7UUFDakIsZ0JBQWdCLEVBQUUsZUFBZTtRQUNqQyxZQUFZLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUUsRUFBRTtRQUNYLHFCQUFxQjtRQUNyQixXQUFXLEVBQUUsWUFBWTtRQUN6QixXQUFXLEVBQUUsVUFBVTtRQUN2QixjQUFjLEVBQUUsT0FBTztRQUN2Qiw0Q0FBNEM7UUFDNUMsMEJBQTBCO1FBQzFCLGFBQWE7UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLGFBQWE7UUFDYixLQUFLLEVBQUUsV0FBVztRQUNsQixNQUFNLEVBQUU7WUFDTixLQUFLLEVBQUUsS0FBSztTQUNiO1FBQ0QsYUFBYTtRQUNiLE1BQU0sRUFBRSxFQUFFO1FBRVYsK0JBQStCO1FBQy9CLE1BQU0sRUFBRSxFQUFFO1FBRVYsaUJBQWlCO1FBQ2pCLGNBQWMsRUFBRSxJQUFJO0tBQ3JCLENBQUM7SUFDRixJQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLEdBQUcsRUFBRSxJQUFBLGNBQU0sRUFBQyxJQUFBLGlDQUFnQixFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQzdDLENBQUM7SUFDRixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztJQUNyRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxDQUFvQyxDQUFDO0FBQzFHLENBQUM7QUF4RkQsNENBd0ZDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0Isb0JBQW9CO0lBQ2xDLE9BQU8sSUFBQSxpQkFBWSxFQUFDLElBQUEsWUFBSSxFQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvRCxDQUFDO0FBRkQsb0RBRUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAqIGFzIHlhbWwgZnJvbSAneWFtbCc7XG5cbi8qKlxuICogZ2V0IGRlZmF1bHQgY29uZmlndXJhdGlvblxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWcoKSB7XG4gIGNvbnN0IGhleG9EZWZhdWx0Q29uZmlnID0ge1xuICAgIC8vIFNpdGVcbiAgICB0aXRsZTogJ0hleG8nLFxuICAgIHN1YnRpdGxlOiAnJyxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgYXV0aG9yOiAnSm9obiBEb2UnLFxuICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIHRpbWV6b25lOiAnJyxcbiAgICAvLyBVUkxcbiAgICB1cmw6ICdodHRwOi8vZXhhbXBsZS5jb20nLFxuICAgIHJvb3Q6ICcvJyxcbiAgICBwZXJtYWxpbms6ICc6eWVhci86bW9udGgvOmRheS86bmFtZS8nLFxuICAgIHBlcm1hbGlua19kZWZhdWx0czoge30sXG4gICAgcHJldHR5X3VybHM6IHtcbiAgICAgIHRyYWlsaW5nX2luZGV4OiB0cnVlLFxuICAgICAgdHJhaWxpbmdfaHRtbDogdHJ1ZVxuICAgIH0sXG4gICAgLy8gRGlyZWN0b3J5XG4gICAgc291cmNlX2RpcjogJ3NvdXJjZScsXG4gICAgcHVibGljX2RpcjogJ3B1YmxpYycsXG4gICAgdGFnX2RpcjogJ3RhZ3MnLFxuICAgIGFyY2hpdmVfZGlyOiAnYXJjaGl2ZXMnLFxuICAgIGNhdGVnb3J5X2RpcjogJ2NhdGVnb3JpZXMnLFxuICAgIGNvZGVfZGlyOiAnZG93bmxvYWRzL2NvZGUnLFxuICAgIGkxOG5fZGlyOiAnOmxhbmcnLFxuICAgIHNraXBfcmVuZGVyOiBbXSxcbiAgICAvLyBXcml0aW5nXG4gICAgbmV3X3Bvc3RfbmFtZTogJzp0aXRsZS5tZCcsXG4gICAgZGVmYXVsdF9sYXlvdXQ6ICdwb3N0JyxcbiAgICB0aXRsZWNhc2U6IGZhbHNlLFxuICAgIGV4dGVybmFsX2xpbms6IHtcbiAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgIGZpZWxkOiAnc2l0ZScsXG4gICAgICBleGNsdWRlOiAnJ1xuICAgIH0sXG4gICAgZmlsZW5hbWVfY2FzZTogMCxcbiAgICByZW5kZXJfZHJhZnRzOiBmYWxzZSxcbiAgICBwb3N0X2Fzc2V0X2ZvbGRlcjogZmFsc2UsXG4gICAgcmVsYXRpdmVfbGluazogZmFsc2UsXG4gICAgZnV0dXJlOiB0cnVlLFxuICAgIHN5bnRheF9oaWdobGlnaHRlcjogJ2hpZ2hsaWdodC5qcycsXG4gICAgaGlnaGxpZ2h0OiB7XG4gICAgICBhdXRvX2RldGVjdDogZmFsc2UsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJyxcbiAgICAgIHdyYXA6IHRydWUsXG4gICAgICBleGNsdWRlX2xhbmd1YWdlczogW10sXG4gICAgICBsYW5ndWFnZV9hdHRyOiBmYWxzZSxcbiAgICAgIGhsanM6IGZhbHNlXG4gICAgfSxcbiAgICBwcmlzbWpzOiB7XG4gICAgICBwcmVwcm9jZXNzOiB0cnVlLFxuICAgICAgbGluZV9udW1iZXI6IHRydWUsXG4gICAgICB0YWJfcmVwbGFjZTogJydcbiAgICB9LFxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgZGVmYXVsdF9jYXRlZ29yeTogJ3VuY2F0ZWdvcml6ZWQnLFxuICAgIGNhdGVnb3J5X21hcDoge30sXG4gICAgdGFnX21hcDoge30sXG4gICAgLy8gRGF0ZSAvIFRpbWUgZm9ybWF0XG4gICAgZGF0ZV9mb3JtYXQ6ICdZWVlZLU1NLUREJyxcbiAgICB0aW1lX2Zvcm1hdDogJ0hIOm1tOnNzJyxcbiAgICB1cGRhdGVkX29wdGlvbjogJ210aW1lJyxcbiAgICAvLyAqIG10aW1lOiBmaWxlIG1vZGlmaWNhdGlvbiBkYXRlIChkZWZhdWx0KVxuICAgIC8vICogZW1wdHk6IG5vIG1vcmUgdXBkYXRlXG4gICAgLy8gUGFnaW5hdGlvblxuICAgIHBlcl9wYWdlOiAxMCxcbiAgICBwYWdpbmF0aW9uX2RpcjogJ3BhZ2UnLFxuICAgIC8vIEV4dGVuc2lvbnNcbiAgICB0aGVtZTogJ2xhbmRzY2FwZScsXG4gICAgc2VydmVyOiB7XG4gICAgICBjYWNoZTogZmFsc2VcbiAgICB9LFxuICAgIC8vIERlcGxveW1lbnRcbiAgICBkZXBsb3k6IHt9LFxuXG4gICAgLy8gaWdub3JlIGZpbGVzIGZyb20gcHJvY2Vzc2luZ1xuICAgIGlnbm9yZTogW10sXG5cbiAgICAvLyBDYXRlZ29yeSAmIFRhZ1xuICAgIG1ldGFfZ2VuZXJhdG9yOiB0cnVlXG4gIH07XG4gIGNvbnN0IHNiZ0RlZmF1bHRDb25maWcgPSB7XG4gICAgY3dkOiB0b1VuaXgodHJ1ZUNhc2VQYXRoU3luYyhwcm9jZXNzLmN3ZCgpKSlcbiAgfTtcbiAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShnZXREZWZhdWx0Q29uZmlnWWFtbCgpKTtcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oaGV4b0RlZmF1bHRDb25maWcsIHNiZ0RlZmF1bHRDb25maWcsIGNvbmZpZ1lNTCkgYXMgdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcbn1cblxuLyoqXG4gKiBnZXQgZGVmYXVsdCBfY29uZmlnLnltbFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWdZYW1sKCkge1xuICByZXR1cm4gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZy55bWwnKSwgJ3V0Zi04Jyk7XG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport * as yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:name/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/0f/defaults_0ff471d7851e1315103153ae541c865c.map","wrapperLength":82},"result":{"scriptId":"9835","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":10548,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":10545,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":29},{"startOffset":314,"endOffset":329,"count":0},{"startOffset":346,"endOffset":366,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":409,"endOffset":436,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":889,"endOffset":900,"count":0},{"startOffset":962,"endOffset":1063,"count":29}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":1451,"endOffset":3888,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3981,"endOffset":4105,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHlCQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsOENBQXdCO0FBQ3hCLDREQUFrRDtBQUNsRCxzREFBZ0M7QUFFaEMsdUVBQWlEO0FBQ2pELGlDQUErQztBQUMvQywwREFBb0M7QUFDcEMscUNBQXNDO0FBRXRDOzs7OztHQUtHO0FBQ0gsU0FBZ0IsWUFBWSxDQUFDLEtBQW9ELEVBQUUsR0FBK0I7SUFBbEgsaUJBOEdDOztJQTdHQyxJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFVBQVUsR0FBRyxPQUFPLEdBQUcsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDM0UsSUFBTSxPQUFPLEdBQUcscUJBQVUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFbkQsd0JBQXdCO0lBQ3hCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztJQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUU7UUFDbEMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQVUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0tBQzFFO0lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRTtRQUMzQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGdCQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8s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LEdBQUcsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUN0QyxhQUFhO3dCQUNiLElBQUksRUFBRSxDQUFDOzs7O2FBQ1IsQ0FBQyxDQUNIO2FBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztLQUNoQztTQUFNO1FBQ0wsSUFBTSxPQUFPLEdBQUcsSUFBQSxzQkFBaUIsRUFBQyxjQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUseUJBQXlCLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sT0FBTyxDQUFDO0tBQ2hCO0FBQ0gsQ0FBQztBQTlHRCxvQ0E4R0M7QUFFRCxnQ0FBZ0M7QUFDaEMsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBzZiwgeyBTYWZlbGlua09wdGlvbnMgfSBmcm9tICdzYWZlbGlua2lmeSc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgU3JjT3B0aW9ucyB9IGZyb20gJ3ZpbnlsLWZzJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCB7IGNyZWF0ZVdyaXRlU3RyZWFtIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogUHJvY2VzcyBTYWZlbGluayBvbiBEZXBsb3kgRGlyXG4gKiBAcGFyYW0gX2RvbmUgY2FsbGJhY2sgZnVuY3Rpb25cbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2FmZWxpbmsoX2RvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkPzogdW5kZWZpbmVkIHwgbnVsbCB8IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3Qgd29ya2luZ0RpciA9IHR5cGVvZiBjd2QgPT09ICdzdHJpbmcnID8gY3dkIDogY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGxvZ25hbWUgPSBhbnNpQ29sb3JzLmdyZWVuQnJpZ2h0KCdzYWZlbGluaycpO1xuXG4gIC8vIHNraXAgcHJvY2VzcyBzYWZlbGlua1xuICBsZXQgaGFzRXJyb3IgPSBmYWxzZTtcbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluaykge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdjb25maWcgc2FmZWxpbmsnLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5yZWRpcmVjdCkge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdzYWZlbGluayByZWRpcmVjdG9yJywgYW5zaUNvbG9ycy5yZWQoJ25vdCBjb25maWd1cmVkJykpO1xuICB9XG4gIGlmICghY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsuZW5hYmxlKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgYW5zaUNvbG9ycy5yZWQoJ2Rpc2FibGVkJykpO1xuICB9XG5cbiAgaWYgKGV4aXN0c1N5bmMod29ya2luZ0RpcikgJiYgIWhhc0Vycm9yKSB7XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZ1NhZmVsaW5rOiBTYWZlbGlua09wdGlvbnMgJiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge1xuICAgICAgZW5hYmxlOiBmYWxzZSxcbiAgICAgIGV4Y2x1ZGU6IFtdIGFzIHN0cmluZ1tdLFxuICAgICAgcmVkaXJlY3Q6ICdodHRwczovL3d3dy53ZWJtYW5hamVtZW4uY29tL3BhZ2Uvc2FmZWxpbmsuaHRtbD91cmw9JyxcbiAgICAgIHBhc3N3b3JkOiAncm9vdCcsXG4gICAgICB0eXBlOiAnYmFzZTY0J1xuICAgIH07XG4gICAgY29uc3QgY29uZmlnU2FmZWxpbmsgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDb25maWdTYWZlbGluaywgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsgfHwge30pO1xuICAgIGxldCBiYXNlVVJMID0gJyc7XG4gICAgdHJ5IHtcbiAgICAgIGJhc2VVUkwgPSBuZXcgVVJMKGNvbmZpZy51cmwpLmhvc3Q7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvL1xuICAgIH1cblxuICAgIGNvbnN0IG9wdDogUGFydGlhbDxTYWZlbGlua09wdGlvbnM+ID0ge1xuICAgICAgLy8gZXhjbHVkZSBwYXR0ZXJucyAoZG9udCBhbm9ueW1pemUgdGhlc2UgcGF0dGVybnMpXG4gICAgICBleGNsdWRlOiBbXG4gICAgICAgIC4uLihjb25maWcuZXh0ZXJuYWxfbGluaz8uZXhjbHVkZSB8fCBbXSksXG4gICAgICAgIC9odHRwcz86XFwvXFwvPyg/OihbXipdKylcXC4pP3dlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIC8oW2EtejAtOV0oPzpbYS16MC05LV17MSw2MX1bYS16MC05XSk/Wy5dKSp3ZWJtYW5hamVtZW5cXC5jb20vLFxuICAgICAgICBiYXNlVVJMLFxuICAgICAgICAnd3d3LndlYm1hbmFqZW1lbi5jb20nLFxuICAgICAgICAnaHR0cHM6Ly9naXRodWIuY29tL2RpbWFzbGFuamFrYScsXG4gICAgICAgICdodHRwczovL2ZhY2Vib29rLmNvbS9kaW1hc2xhbmpha2ExJyxcbiAgICAgICAgJ2RpbWFzbGFuamFrYS5naXRodWIuaW8nLFxuICAgICAgICAuLi5jb25maWdTYWZlbGluay5leGNsdWRlXG4gICAgICBdLmZpbHRlcihmdW5jdGlvbiAoeCwgaSwgYSkge1xuICAgICAgICAvLyByZW1vdmUgZHVwbGljYXRlIGFuZCBlbXB0aWVzXG4gICAgICAgIHJldHVybiBhLmluZGV4T2YoeCkgPT09IGkgJiYgeC50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XG4gICAgICB9KSxcbiAgICAgIHJlZGlyZWN0OiBbXSxcbiAgICAgIC8vcmVkaXJlY3Q6IFssIGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0XSxcbiAgICAgIHBhc3N3b3JkOiBjb25maWdTYWZlbGluay5wYXNzd29yZCB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5wYXNzd29yZCxcbiAgICAgIHR5cGU6IGNvbmZpZ1NhZmVsaW5rLnR5cGUgfHwgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsudHlwZVxuICAgIH07XG5cbiAgICBpZiAoY29uZmlnU2FmZWxpbmsucmVkaXJlY3QpIHtcbiAgICAgIG9wdC5yZWRpcmVjdCA9IGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0O1xuICAgIH1cblxuICAgIGNvbnN0IHNhZmVsaW5rID0gbmV3IHNmLnNhZmVsaW5rKG9wdCk7XG5cbiAgICBjb25zdCBndWxwb3B0OiBTcmNPcHRpb25zID0ge1xuICAgICAgY3dkOiB3b3JraW5nRGlyLFxuICAgICAgaWdub3JlOiBbXVxuICAgIH07XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKSkge1xuICAgICAgZ3VscG9wdC5pZ25vcmU/LmNvbmNhdCguLi5jb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnU2FmZWxpbmsuZXhjbHVkZSkpIHtcbiAgICAgIGNvbnN0IGlnbm9yZSA9IGNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGUuZmlsdGVyKChzdHIpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuICEvXihodHRwcz86XFwvfHd3dy4pLy50ZXN0KHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSkgYXMgc3RyaW5nW107XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmlnbm9yZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGd1bHBcbiAgICAgIC5zcmMoWycqKi8qLntodG1sLGh0bX0nXSwgZ3VscG9wdClcbiAgICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2FmZWxpbmsnIH0pKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRocm91Z2gyLm9iaihhc3luYyAoZmlsZSwgX2VuYywgbmV4dCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3BzXG4gICAgICAgICAgaWYgKGZpbGUuaXNOdWxsKCkgfHwgZmlsZS5pc0RpcmVjdG9yeSgpIHx8ICFmaWxlIHx8IGZpbGUuaXNTdHJlYW0oKSkgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgICAvLyBwcm9jZXNzXG4gICAgICAgICAgaWYgKGZpbGUuaXNCdWZmZXIoKSAmJiBCdWZmZXIuaXNCdWZmZXIoZmlsZS5jb250ZW50cykpIHtcbiAgICAgICAgICAgIC8vIGRvIHNhZmVsaW5raWZ5XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZmlsZS5jb250ZW50cy50b1N0cmluZygndXRmLTgnKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IHNhZmVsaW5rLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIC8vIExvZ2dlci5sb2cocGFyc2VkKTtcbiAgICAgICAgICAgICAgZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKHBhcnNlZCk7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0KG51bGwsIGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcGFyc2UnLCBmaWxlLnBhdGgpO1xuICAgICAgICAgIC8vIGRyb3AgZmFpbHNcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAucGlwZShndWxwLmRlc3Qod29ya2luZ0RpcikpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHdzdHJlYW0gPSBjcmVhdGVXcml0ZVN0cmVhbShwYXRoLmpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvc2FmZWxpbmsubG9nJykpO1xuICAgIHJldHVybiB3c3RyZWFtO1xuICB9XG59XG5cbi8vIHNhZmVsaW5raWZ5IHRoZSBkZXBsb3kgZm9sZGVyXG5ndWxwLnRhc2soJ3NhZmVsaW5rJywgdGFza1NhZmVsaW5rKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4c/gulpsafelink_4c61ebd17a40a0e391c444500ad6c5a4.map","wrapperLength":82},"result":{"scriptId":"9839","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21175,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zZW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLHVFQUFpRDtBQUNqRCwwREFBb0M7QUFDcEMscUNBQWtFO0FBRWxFOzs7R0FHRztBQUNILFNBQWdCLE9BQU8sQ0FBQyxLQUFtRCxFQUFFLEdBQVc7SUFDdEYsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxNQUFNLEdBQWEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM3RSxNQUFNLENBQUMsSUFBSSxPQUFYLE1BQU0sMkJBQVMsc0JBQVksV0FBRTtJQUM3QixPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxjQUFjLENBQUMsRUFBRSxFQUFFLEdBQUcsS0FBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUM7U0FDekQsSUFBSSxDQUFDLElBQUEsb0JBQVUsRUFBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ2pDLElBQUksQ0FDSCxJQUFBLGtCQUFPLEVBQUMsVUFBVSxJQUFJO1FBQWQsaUJBMkJQO1FBMUJDLGlCQUFpQjtRQUNqQixJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFFO1lBQ2hCLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDNUIsSUFBTSxLQUFLLEdBQUcsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRLENBQUM7Z0JBQ3RFLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxtQkFBbUI7UUFDbkIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUNqRSxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNqQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDO2dCQUN4RSxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQzthQUNqQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0JBQWdCO1FBQ2hCLFdBQVc7UUFDWCxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNqQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBVSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxjQUFPLEVBQUUsQ0FBQyxNQUFNLGVBQUssSUFBSSxDQUFFLENBQUMsQ0FBQztTQUM1RTtJQUNILENBQUMsQ0FBQyxDQUNIO1NBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMxQixDQUFDO0FBdENELDBCQXNDQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO0lBQ1AsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLE9BQU8sT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNlby50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBndWxwRG9tIGZyb20gJ2d1bHAtZG9tJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBkZXBsb3lDb25maWcsIGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogQXV0byBzZW8gcnVubmVyXG4gKiBAcGFyYW0gY3dkIHdvcmtpbmcgZGlyZWN0b3J5IHRvIHNjYW4gaHRtbCdzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2VvKF9kb25lOiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkOiBzdHJpbmcpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGlnbm9yZTogc3RyaW5nW10gPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gIGlnbm9yZS5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoue2h0bSxodG1sfScsICcqLntodG1sLGh0bX0nXSwgeyBjd2QsIGlnbm9yZSB9KVxuICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2VvJyB9KSlcbiAgICAucGlwZShcbiAgICAgIGd1bHBEb20oZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgLy8gZml4IGFsdCBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmNdJykpO1xuICAgICAgICBpbWFnZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ2FsdCcpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gQWx0JztcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYWx0JywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZml4IHRpdGxlIGlmcmFtZVxuICAgICAgICBjb25zdCBpZnJhbWVzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lmcmFtZVtzcmNdJykpO1xuICAgICAgICBpZnJhbWVzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgICAgY29uc3QgYWx0ID0gZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gVGl0bGUnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRpdGxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdBUk5JTkcgTUFLRVJcbiAgICAgICAgLy8gY291bnQgSDFcbiAgICAgICAgY29uc3QgaDEgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2gxJyk7XG4gICAgICAgIGlmIChoMS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyhhbnNpQ29sb3JzLnllbGxvd0JyaWdodCgnW1dBUk5dJyksIGBIMSAoJHtoMS5sZW5ndGh9KSAke3BhdGh9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKVxuICAgIC5waXBlKGd1bHAuZGVzdChjd2QpKTtcbn1cblxuZ3VscC50YXNrKCdzZW8nLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgcmV0dXJuIHRhc2tTZW8obnVsbCwgZGVwbG95RGlyKTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/e0/gulpseo_e04b91fb9cd501fddd96cd3618e1374f.map","wrapperLength":82},"result":{"scriptId":"9888","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8792,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8789,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zdGFuZGFsb25lLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QixzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLDBEQUFvQztBQUNwQyx5Q0FBNkM7QUFDN0MscUNBQXNDO0FBRXRDOzs7R0FHRztBQUNILFNBQVMsZ0JBQWdCO0lBQ3ZCLGdCQUFNLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7SUFDaEQsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1NBQ2xHLElBQUksQ0FDSCxrQkFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFnQixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7Ozs7Ozt3QkFDM0MsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUN4RCxLQUFBLENBQUEsS0FBQSxnQkFBTSxDQUFBLENBQUMsR0FBRyxDQUFBOzt3QkFBUyxxQkFBTSxJQUFBLG9CQUFXLEVBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUE7O3dCQUFwRSxjQUFXLG1CQUFRLFNBQWlELEVBQUUsRUFBQyxDQUFDO3dCQUN4RSxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQ2xELEtBQUssR0FBRyxJQUFBLHFCQUFLLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7d0JBQy9ELEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFOzRCQUNoQixZQUFZOzRCQUNaLElBQUksRUFBRSxDQUFDO3dCQUNULENBQUMsQ0FBQyxDQUFDOzs7OztLQUNKLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7U0FDeEQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNYLGdCQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBRS9DLGtCQUFlLGdCQUFnQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuc3RhbmRhbG9uZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc3Bhd24gZnJvbSAnY3Jvc3Mtc3Bhd24nO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgcmVwbGFjZVBhdGggfSBmcm9tICcuL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIHJ1biBhbGwgXyouc3RhbmRhbG9uZS5qcyBpbnNpZGUgc3JjLXBvc3RzIChfY29uZmlnX3ltbC5wb3N0X2RpcilcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHN0YW5kYWxvbmVSdW5uZXIoKSB7XG4gIExvZ2dlci5sb2coJ1tzdGFuZGFsb25lXSBSdW5uaW5nIHNjcmlwdHMuLi5cXG4nKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAnKiovXyouc3RhbmRhbG9uZS5qcycpLCB7IGN3ZDogZ2V0Q29uZmlnKCkuY3dkLCBpZ25vcmU6IFsnKiovdG1wLyoqJ10gfSlcbiAgICAucGlwZShcbiAgICAgIHRocm91Z2gyLm9iaihhc3luYyBmdW5jdGlvbiAoZmlsZSwgX2VuYywgbmV4dCkge1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBpbnB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBMb2dnZXIubG9nKGBub2RlICR7YXdhaXQgcmVwbGFjZVBhdGgoZmlsZS5wYXRoLCBnZXRDb25maWcoKS5jd2QsICcnKX1gKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnPScucmVwZWF0KDEwKSArICcgb3VwdXQgJyArICc9Jy5yZXBlYXQoMTApKTtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBzcGF3bignbm9kZScsIFtmaWxlLnBhdGhdLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7XG4gICAgICAgIGNoaWxkLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAvLyBkcm9wIGZpbGVcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAndG1wL3N0YW5kYWxvbmUnKSkpXG4gICAgLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIExvZ2dlci5sb2coJ1xcbltzdGFuZGFsb25lXSBzdG9wcGVkJyk7XG4gICAgfSk7XG59XG5cbmd1bHAudGFzaygncG9zdDpzdGFuZGFsb25lJywgc3RhbmRhbG9uZVJ1bm5lcik7XG5cbmV4cG9ydCBkZWZhdWx0IHN0YW5kYWxvbmVSdW5uZXI7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4b/gulpstandalone_4b97cf5f5ca3169df9a2ad9287d555ef.map","wrapperLength":82},"result":{"scriptId":"10345","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8832,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8829,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zaXRlbWFwLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBZ0M7QUFDaEMscUNBQXdDO0FBQ3hDLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXVDO0FBQ3ZDLHVDQUF5QztBQUN6QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHlCQUF5QjtBQUN6QixtREFBc0Q7QUFDdEQsK0JBQTZCO0FBQzdCLHFDQUFxQztBQUNyQyx1Q0FBaUU7QUFDakUsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMsc0VBQStDO0FBQy9DLHFDQUErRDtBQUUvRDs7OztFQUlFO0FBQ0YsSUFBSSxRQUFRLEdBQUcsRUFBYyxDQUFDO0FBQzlCLElBQU0sT0FBTyxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7QUFDbEMsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUI7Ozs7O0dBS0c7QUFDSCxTQUFnQixlQUFlLENBQUMsR0FBK0IsRUFBRSxJQUFRO0lBQXpFLGlCQTZEQztJQTdEZ0UscUJBQUEsRUFBQSxRQUFRO0lBQ3ZFLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBb0M7UUFDdkQsSUFBTSxRQUFRLEdBQXlDLEVBQUUsQ0FBQztRQUMxRCxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLENBQ1gsSUFBQSxxQ0FBbUIsRUFBQyxHQUFHLEVBQUU7Z0JBQ3ZCLElBQUksTUFBQTthQUNMLENBQUMsQ0FDSCxDQUFDO1NBQ0g7YUFBTTtZQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBQSxtQkFB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QztxQkFDMUQsSUFBSSxDQUNILElBQUEsa0JBQU8sRUFBQztvQkFDTix5QkFBeUI7b0JBQ3pCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sbUJBQWUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO3dCQUN4RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNkJBQTJCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUMvRDt3QkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw2RkFBK0UsT0FBTyxxQkFBaUIsQ0FBQztxQkFDaEk7b0JBQ0QsdUVBQXVFO2dCQUN6RSxDQUFDLENBQUMsQ0FDSDtxQkFDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztxQkFDMUIsSUFBSSxDQUFDLEtBQUssRUFBRSxjQUFNLE9BQUEsT0FBTyxFQUFFLEVBQVQsQ0FBUyxDQUFDLENBQUM7WUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQWpHRCxrREFpR0M7QUFFRCxTQUFTLE9BQU8sQ0FBQyxJQUFZLEVBQUUsUUFBb0M7SUFDakUsT0FBTyxvQkFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO0lBQ25CLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBTztRQUMxQixtQkFBbUIsRUFBRSxDQUFDLElBQUksQ0FBQztZQUN6QixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNpdGVtYXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBoZXhvIH0gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG1pY3JvbWF0Y2ggZnJvbSAnbWljcm9tYXRjaCc7XG5pbXBvcnQgbnVuanVja3MgZnJvbSAnbnVuanVja3MnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgc2l0ZW1hcENyYXdsZXJBc3luYyB9IGZyb20gJ3NpdGVtYXAtY3Jhd2xlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgeW9hc3RTZW8gfSBmcm9tICcuL3NpdGVtYXAnO1xuaW1wb3J0IHsgYXJyYXlfcmVtb3ZlX2VtcHR5LCBhcnJheV91bmlxdWUgfSBmcm9tICcuL3V0aWxzL2FycmF5JztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKlxuLy8gcmVhZCBleGlzdGluZyBzaXRlbWFwLnR4dFxuY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbmxldCBzaXRlbWFwcyA9IGV4aXN0c1N5bmMoc2l0ZW1hcFRYVCkgPyBhcnJheV9yZW1vdmVfZW1wdHkocmVhZEZpbGVTeW5jKHNpdGVtYXBUWFQsICd1dGYtOCcpLnNwbGl0KC9cXHI/XFxuL2dtKSkgOiBbXTtcbiovXG5sZXQgc2l0ZW1hcHMgPSBbXSBhcyBzdHJpbmdbXTtcbmNvbnN0IGNyYXdsZWQgPSBuZXcgU2V0PHN0cmluZz4oKTtcbmNvbnN0IGVudiA9IGVudk51bmp1Y2tzKCk7XG5cbi8qKlxuICogU2l0ZW1hcCBHZW5lcmF0b3JcbiAqIEBwYXJhbSB1cmwgdXJsIHRvIGNyYXdsXG4gKiBAcGFyYW0gZGVlcCBjcmF3bCBkZWVwZXIgbiB0aW1lc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2l0ZW1hcCh1cmw/OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkLCBkZWVwID0gMCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoc2l0ZW1hcHM6IHN0cmluZ1tdKSA9PiBhbnkpID0+IHtcbiAgICBjb25zdCBwcm9taXNlczogQmx1ZWJpcmQ8UmVjb3JkPHN0cmluZywgc3RyaW5nW10+PltdID0gW107XG4gICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyh1cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjcmF3bGVkLmFkZChnZXRDb25maWcoKS51cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyhnZXRDb25maWcoKS51cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICBCbHVlYmlyZC5hbGwocHJvbWlzZXMpXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICBjb25zdCBtYXBwZWQgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBzaXRlbWFwQ3Jhd2xlckFzeW5jPjtcbiAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChzaXRlbWFwKSA9PiB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gc2l0ZW1hcCkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gc2l0ZW1hcFtrZXldO1xuICAgICAgICAgICAgaWYgKGtleSBpbiBtYXBwZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1hcHBlZFtrZXldID0gdmFsdWVzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSBhcnJheV91bmlxdWUodmFsdWVzLmNvbmNhdChtYXBwZWRba2V5XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICBjb25zdCBzYXZldG8gPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAuanNvbicpO1xuICAgICAgICB3cml0ZWZpbGUoc2F2ZXRvLCBKU09OLnN0cmluZ2lmeShtYXBwZWQsIG51bGwsIDIpKTtcblxuICAgICAgICAvLyByZXR1cm5cbiAgICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICAgIH0pXG4gICAgICAudGhlbihhc3luYyAocmVzdWx0cykgPT4ge1xuICAgICAgICBzaXRlbWFwcyA9IGFycmF5X3VuaXF1ZShhcnJheV9yZW1vdmVfZW1wdHkoT2JqZWN0LnZhbHVlcyhyZXN1bHRzKS5mbGF0KDEpLmNvbmNhdChzaXRlbWFwcykpKS5zb3J0KGZ1bmN0aW9uIChcbiAgICAgICAgICBhLFxuICAgICAgICAgIGJcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA8IGIgPyAtMSA6IDE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVlcDsgaSsrKSB7XG4gICAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHNpdGVtYXBzLmxlbmd0aDsgaWkrKykge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gc2l0ZW1hcHNbaWldO1xuICAgICAgICAgICAgaWYgKGNyYXdsZWQuaGFzKHVybCkgfHwgLy4oanN8dHN8Y3NzfHNjc3N8dHh0fHBkZnxwbmd8anBlP2d8Z2lmfHdlYnApJC9naS50ZXN0KHVybCkpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgICAgICAgTG9nZ2VyLmxvZygnW2RlcHRoXScsIGlpLCB1cmwpO1xuICAgICAgICAgICAgYXdhaXQgZ2VuZXJhdGVTaXRlbWFwKHVybCwgZGVlcCkudGhlbigoKSA9PiB3cml0ZVNpdGVtYXAoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgd3JpdGVTaXRlbWFwKHJlc29sdmUpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIHdyaXRlIHRoZSBzaXRlbWFwXG4gKiBAcGFyYW0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gd3JpdGVTaXRlbWFwKGNhbGxiYWNrPzogKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnkpIHtcbiAgbGV0IGNiID0gbm9vcDtcbiAgaWYgKGNhbGxiYWNrKSBjYiA9ICgpID0+IGNhbGxiYWNrKHNpdGVtYXBzKTtcbiAgY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbiAgd3JpdGVmaWxlKHNpdGVtYXBUWFQsIGFycmF5X3JlbW92ZV9lbXB0eShzaXRlbWFwcykuam9pbihFT0wpKTtcbiAgY2IuYXBwbHkodGhpcyk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZW1hcE9wdGlvbnMge1xuICBwYXRoOiBzdHJpbmdbXTtcbiAgdGFnczogYm9vbGVhbjtcbiAgY2F0ZWdvcmllczogYm9vbGVhbjtcbiAgcmVsOiBib29sZWFuO1xuICB5b2FzdDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleG9HZW5lcmF0ZVNpdGVtYXAoKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBoZXhvKGdldENvbmZpZygpLmN3ZCk7XG4gICAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBlbnYuYWRkRmlsdGVyKCdmb3JtYXRVcmwnLCAoc3RyKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY29uZmlnID0gc2V0Q29uZmlnKGluc3RhbmNlLmNvbmZpZyk7XG4gICAgICAgIC8vIGFzc2lnbiBkZWZhdWx0IGNvbmZpZ1xuICAgICAgICBjb25zdCBzaXRlbWFwOiBTaXRlbWFwT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgeyByZWw6IGZhbHNlLCB0YWdzOiBmYWxzZSwgY2F0ZWdvcmllczogZmFsc2UsIHBhdGg6IFsnc2l0ZW1hcC50eHQnLCAnc2l0ZW1hcC54bWwnXSB9LFxuICAgICAgICAgIGNvbmZpZy5zaXRlbWFwXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQnVpbGQgWW9hc3QgU0VPIHNpdGVtYXBcbiAgICAgICAgLy8gd2hlbiBjb25maWcueW9hc3QgZGVmaW5lZFxuICAgICAgICBpZiAoc2l0ZW1hcC55b2FzdCkge1xuICAgICAgICAgIHJldHVybiB5b2FzdFNlbyhpbnN0YW5jZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNvbmZpZy5zaXRlbWFwKSByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIGNvbnN0IGxvY2FscyA9IGluc3RhbmNlLmxvY2FscztcbiAgICAgICAgY29uc3QgeyBza2lwX3JlbmRlciB9ID0gY29uZmlnO1xuXG4gICAgICAgIGlmICghc2l0ZW1hcC50YWdzIHx8ICFzaXRlbWFwLmNhdGVnb3JpZXMpIHtcbiAgICAgICAgICByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwLnRhZ3Mgb3IgY29uZmlnLnNpdGVtYXAuY2F0ZWdvcmllcyBub3QgY29uZmlndXJlZCBpbiBfY29uZmlnLnltbCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNraXBSZW5kZXJMaXN0ID0gWycqKi8qLmpzJywgJyoqLyouY3NzJywgJyoqLy5naXQqJ107XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2tpcF9yZW5kZXIpKSB7XG4gICAgICAgICAgc2tpcFJlbmRlckxpc3QucHVzaCguLi5za2lwX3JlbmRlcik7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNraXBfcmVuZGVyID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGlmIChza2lwX3JlbmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKHNraXBfcmVuZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3N0cyA9IFsuLi5sb2NhbHMuZ2V0KCdwYWdlcycpLnRvQXJyYXkoKSwgLi4ubG9jYWxzLmdldCgncG9zdHMnKS50b0FycmF5KCldXG4gICAgICAgICAgLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBvc3Quc2l0ZW1hcCAhPT0gZmFsc2UgJiYgIWlzTWF0Y2gocG9zdC5zb3VyY2UsIHNraXBSZW5kZXJMaXN0KTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi51cGRhdGVkICYmIGEudXBkYXRlZCkgcmV0dXJuIGIudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCkgLSBhLnVwZGF0ZWQudG9EYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHBvc3RzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRtcGxTcmMgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBudW5qdWNrcy5jb21waWxlKHJlYWRGaWxlU3luYyh0bXBsU3JjLCAndXRmLTgnKSwgZW52KTtcbiAgICAgICAgY29uc3QgeyB0YWdzOiB0YWdzQ2ZnLCBjYXRlZ29yaWVzOiBjYXRzQ2ZnLCByZWw6IHJlbENmZyB9ID0gc2l0ZW1hcDtcbiAgICAgICAgbGV0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBzTm93OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHRhZ3M6IHRhZ3NDZmcgPyBsb2NhbHMuZ2V0KCd0YWdzJykudG9BcnJheSgpIDogW10sXG4gICAgICAgICAgY2F0ZWdvcmllczogY2F0c0NmZyA/IGxvY2Fscy5nZXQoJ2NhdGVnb3JpZXMnKS50b0FycmF5KCkgOiBbXVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZW1vdmUgYmxhbmsgbmV3bGluZXNcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxccypbXFxyXFxuXS9nbSwgJ1xcbicpO1xuXG4gICAgICAgIC8vZGF0YSA9IHByZXR0aWVyLmZvcm1hdChkYXRhLCB7IHBhcnNlcjogJ3htbCcsIHBsdWdpbnM6IFt4bWxwbHVnaW5dLCBlbmRPZkxpbmU6ICdsZicgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICB3cml0ZWZpbGUoam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wL2R1bXAvc2l0ZW1hcC9zaXRlbWFwLnhtbCcpLCBkYXRhKTtcblxuICAgICAgICAvLyB3cml0ZVxuICAgICAgICBjb25zdCBzaXRlbWFwWG1sID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgd3JpdGVmaWxlKHNpdGVtYXBYbWwsIGRhdGEpO1xuICAgICAgICBpbnN0YW5jZS5sb2cuaW5mbygnc2l0ZW1hcCB3cml0dGVuJywgc2l0ZW1hcFhtbCk7XG5cbiAgICAgICAgaWYgKCFyZWxDZmcpIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcbiAgICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyKTtcbiAgICAgICAgZ3VscFxuICAgICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgLy8gYXV0byBkaXNjb3Zlcnkgc2l0ZW1hcFxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIke2Jhc2VVUkx9c2l0ZW1hcC54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInNpdGVtYXAtc2l0ZS11cmxcIiB0eXBlPVwiYXBwbGljYXRpb24vdGV4dCt4bWxcIiByZWw9XCJzaXRlbWFwXCIgaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiIC8+YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IHJlc29sdmUoKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGlzTWF0Y2gocGF0aDogc3RyaW5nLCBwYXR0ZXJuczogc3RyaW5nIHwgcmVhZG9ubHkgc3RyaW5nW10pIHtcbiAgcmV0dXJuIG1pY3JvbWF0Y2guaXNNYXRjaChwYXRoLCBwYXR0ZXJucyk7XG59XG5cbmd1bHAudGFzaygnc2l0ZW1hcCcsICgpID0+IHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGhleG9HZW5lcmF0ZVNpdGVtYXAoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/3c/gulpsitemap_3c8d9f84ead1fc6d91aa70a109950e6b.map","wrapperLength":82},"result":{"scriptId":"10350","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33956,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33953,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscGZpbGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOENBQXdCO0FBQ3hCLHVDQUFrQztBQUNsQywrQkFBNkI7QUFDN0Isd0JBQXNCO0FBQ3RCLHlCQUF1QjtBQUN2Qix1QkFBcUI7QUFDckIsMkJBQXlCO0FBQ3pCLHNCQUFvQjtBQUNwQix1QkFBcUI7QUFDckIsNkJBQTJCO0FBQzNCLDBEQUFvQztBQUVwQyx5QkFBeUI7QUFDekIsU0FBZ0IsYUFBYSxDQUFDLE1BQWlDO0lBQzdELElBQU0sT0FBTyxHQUFHLENBQUMsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFdBQVcsQ0FBQyxFQUFFLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxRQUFRLENBQUMsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqRyxJQUFNLE1BQU0sR0FBRztRQUNiLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUFFLE9BQU8sTUFBTSxFQUFFLENBQUM7UUFDckMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQU0sR0FBRyxHQUFHO1lBQ1YsR0FBRyxFQUFFLE1BQU07WUFDWCxLQUFLLEVBQUUsU0FBUztTQUNqQixDQUFDO1FBQ0YsT0FBTyxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFPLEdBQUcsQ0FBQzthQUN6QyxJQUFJLENBQUMsY0FBTSxPQUFBLElBQUEsaUJBQUssRUFBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQU8sR0FBRyxDQUFDLEVBQWhFLENBQWdFLENBQUM7YUFDNUUsS0FBSyxDQUFDLFVBQUMsQ0FBQztZQUNQLElBQUksQ0FBQyxZQUFZLEtBQUs7Z0JBQUUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUM7YUFDRCxPQUFPLENBQUM7WUFDUCxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztJQUNGLE9BQU8sTUFBTSxFQUFFLENBQUM7QUFDbEIsQ0FBQztBQXBCRCxzQ0FvQkM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBRTNDLGtCQUFlLGNBQUksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwZmlsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5kZXBsb3knO1xuaW1wb3J0ICcuL2d1bHAuZmVlZCc7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgJy4vZ3VscC5zZW8nO1xuaW1wb3J0ICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgJy4vZ3VscC5zdGFuZGFsb25lJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuXG4vLyBjb21taXQgY3VycmVudCBwcm9qZWN0XG5leHBvcnQgZnVuY3Rpb24gY29tbWl0UHJvamVjdChmaW5pc2g6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgZ2l0RGlycyA9IFtqb2luKHByb2Nlc3MuY3dkKCksICdzcmMtcG9zdHMnKSwgam9pbihwcm9jZXNzLmN3ZCgpLCAnc291cmNlJyksIHByb2Nlc3MuY3dkKCldO1xuICBjb25zdCBjb21taXQgPSAoKSA9PiB7XG4gICAgaWYgKCFnaXREaXJzLmxlbmd0aCkgcmV0dXJuIGZpbmlzaCgpO1xuICAgIGNvbnN0IGdpdERpciA9IGdpdERpcnNbMF07XG4gICAgY29uc3Qgb3B0ID0ge1xuICAgICAgY3dkOiBnaXREaXIsXG4gICAgICBzdGRpbzogJ2luaGVyaXQnXG4gICAgfTtcbiAgICByZXR1cm4gc3Bhd24oJ2dpdCcsIFsnYWRkJywgJy1BJ10sIDxhbnk+b3B0KVxuICAgICAgLnRoZW4oKCkgPT4gc3Bhd24oJ2dpdCcsIFsnY29tbWl0JywgJy1tJywgJ3VwZGF0ZSAnICsgbmV3IERhdGUoKV0sIDxhbnk+b3B0KSlcbiAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSBMb2dnZXIubG9nKGUubWVzc2FnZSwgZ2l0RGlyKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGdpdERpcnMuc2hpZnQoKTtcbiAgICAgICAgY29tbWl0KCk7XG4gICAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIGNvbW1pdCgpO1xufVxuXG5ndWxwLnRhc2soJ3Byb2plY3QtY29tbWl0JywgY29tbWl0UHJvamVjdCk7XG5cbmV4cG9ydCBkZWZhdWx0IGd1bHA7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/49/gulpfile_49358b99439a29678d73729f1ed5c86f.map","wrapperLength":82},"result":{"scriptId":"10699","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4983,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4980,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5kZXBsb3kudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMseUJBQWdDO0FBQ2hDLDBFQUEwRDtBQUMxRCx1REFBMkQ7QUFDM0QsOENBQWtEO0FBQ2xELG9FQUFxQztBQUNyQywrQkFBcUM7QUFDckMsd0JBQXNCO0FBQ3RCLDJCQUF5QjtBQUN6QiwwREFBb0M7QUFDcEMscUNBQW9EO0FBRXBEOzs7R0FHRztBQUNILFNBQWdCLE9BQU87SUFDYixJQUFBLFNBQVMsR0FBSyxJQUFBLHNCQUFZLEdBQUUsVUFBbkIsQ0FBb0I7SUFDckMsSUFBTSxTQUFTLEdBQUcsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzlELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLHFCQUFxQixDQUFDLEVBQUU7UUFDaEUsR0FBRyxFQUFFLFNBQVM7UUFDZCxHQUFHLEVBQUUsSUFBSTtLQUNWLENBQUM7U0FDRCxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUMxQixFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBVkQsMEJBVUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixZQUFZO0lBQzFCLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQVUsT0FBTztRQUNuQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQixD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QVc7SUFDNUIsT0FBTyxJQUFBLGNBQU0sRUFBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBQSxjQUFNLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDeEQsQ0FBQztBQUVELFNBQVM7QUFDVCxjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuZGVwbG95LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBnaXRIZWxwZXIgfSBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IHsgc3Bhd25Bc3luYyB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlci9kaXN0L3NwYXduJztcbmltcG9ydCBndWxwLCB7IFRhc2tGdW5jdGlvbkNhbGxiYWNrIH0gZnJvbSAnZ3VscCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5pbXBvcnQgeyBqb2luLCB0b1VuaXggfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb3B5R2VuKCkge1xuICBjb25zdCB7IGRlcGxveURpciB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgZ2V0Q29uZmlnKCkucHVibGljX2Rpcik7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoqJywgJyEqKi8uZ2l0KicsICchKiovdG1wLyoqJywgJyEqKi9ub2RlX21vZHVsZXMvKionXSwge1xuICAgICAgY3dkOiBwdWJsaWNEaXIsXG4gICAgICBkb3Q6IHRydWVcbiAgICB9KVxuICAgIC5waXBlKGd1bHAuZGVzdChkZXBsb3lEaXIpKVxuICAgIC5vbignZXJyb3InLCBjb25zb2xlLnRyYWNlKTtcbn1cblxuLyoqXG4gKiBhc3luY2hyb25vdXMgY29weSBnZW5lcmF0ZWQgZmlsZXMgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIHRvIGRlcGxveSBkaXIgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYXN5bmNDb3B5R2VuKCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgY29weUdlbigpLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vLyBjb3B5IHB1YmxpYyB0byAuZGVwbG95X2dpdFxuZ3VscC50YXNrKCdkZXBsb3k6Y29weScsIGNvcHlHZW4pO1xuXG4vKipcbiAqIGdpdCBwdWxsIG9uIGRlcGxveSBkaXJcbiAqIEBwYXJhbSBkb25lXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHB1bGwoZG9uZTogVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGN3ZCA9IGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyO1xuICBjb25zdCBnaCA9IGNvbmZpZy5kZXBsb3kuZ2l0aHViO1xuICBjb25zdCBkb1B1bGwgPSBhc3luYyAoY3dkOiBzdHJpbmcpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydjb25maWcnLCAncHVsbC5yZWJhc2UnLCAnZmFsc2UnXSwge1xuICAgICAgICBjd2RcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIExvZ2dlci5sb2coZS5tZXNzYWdlLCBzdWIucm9vdCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIExvZ2dlci5sb2coJ3B1bGxpbmcnLCBjd2QpO1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydwdWxsJywgJy1YJywgJ3RoZWlycyddLCB7XG4gICAgICAgIGN3ZCxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgTG9nZ2VyLmxvZygnY2Fubm90IHB1bGwnLCBjd2QpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjbG9uZSA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWV4aXN0c1N5bmMoY3dkKSkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWy4uLidjbG9uZSAtYiBtYXN0ZXIgLS1zaW5nbGUtYnJhbmNoJy5zcGxpdCgnICcpLCBjb25maWcuZGVwbG95LnJlcG8sICcuZGVwbG95X2dpdCddLCB7XG4gICAgICAgIGN3ZDogX19kaXJuYW1lXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgYXdhaXQgY2xvbmUoKTtcbiAgZG9QdWxsKGN3ZCk7XG4gIGlmIChnaCkge1xuICAgIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaC5zdWJtb2R1bGUuZ2V0KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJtb2R1bGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdWIgPSBzdWJtb2R1bGVzW2ldO1xuXG4gICAgICBkb1B1bGwoc3ViLnJvb3QpO1xuICAgIH1cbiAgfVxuICBkb25lKCk7XG59XG5cbmZ1bmN0aW9uIHN0YXR1cyhkb25lPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm47XG4gIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChzdGF0dXNlcykgPT4ge1xuICAgIHN0YXR1c2VzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgbGV0IHN0ciA9ICcnO1xuXG4gICAgICBzd2l0Y2ggKGl0ZW0uY2hhbmdlcykge1xuICAgICAgICBjYXNlICdkZWxldGVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5yZWQoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnYWRkZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZWVuKGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21vZGlmaWVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy55ZWxsb3coaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndW50cmFja2VkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5ncmV5KGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgc3RyICs9IGl0ZW0uY2hhbmdlcztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgc3RyICs9ICcgJztcbiAgICAgIHN0ciArPSBpdGVtLnBhdGg7XG4gICAgICBMb2dnZXIubG9nKHN0cik7XG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIGRvbmUoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbW1pdCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1YikgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgY29uc3Qgbm93ID0gbW9tZW50KCkudHooZ2V0Q29uZmlnKCkudGltZXpvbmUpLmZvcm1hdCgnTExMJyk7XG4gIGNvbnN0IGNvbW1pdFJvb3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBnaXRodWIuc3RhdHVzKCkudGhlbigoY2hhbmdlcykgPT4ge1xuICAgICAgICBMb2dnZXIubG9nKCdjaGFuZ2VzJywgY2hhbmdlcy5sZW5ndGgsIHRvVW5peChnaXRodWIuY3dkKS5yZXBsYWNlKHRvVW5peChwcm9jZXNzLmN3ZCgpKSwgJycpKTtcbiAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGdpdGh1Yi5hZGQoJy1BJykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBnaXRodWIuY29tbWl0KCd1cGRhdGUgc2l0ZSAnICsgbm93KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBjb21taXRTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSkge1xuICAgICAgICBjb25zdCBpbmZvID0gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICAgICAgY29uc3QgY29tbWl0U3VibW9kdWxlQ2hpbGQgPSBhc3luYyAoc3ViOiAodHlwZW9mIGluZm8pW251bWJlcl0pID0+IHtcbiAgICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBuZXcgZ2l0SGVscGVyKHN1Yi5yb290KTtcbiAgICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHN1Ym1vZHVsZS5zdGF0dXMoKTtcbiAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmFkZCgnLUEnKTtcbiAgICAgICAgICAgIGF3YWl0IHN1Ym1vZHVsZS5jb21taXQoYHVwZGF0ZSAke3N1Yi5wYXRofSAke25vd31gLCAnYW0nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGl0ZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlSXQpID0+IHtcbiAgICAgICAgICAgIC8vIHJlc29sdmUgZGlyZWN0bHkgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm8gbWFkZSBjaGFuZ2VzXG4gICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPT09IDApIHJldHVybiByZXNvbHZlSXQobnVsbCk7XG4gICAgICAgICAgICBjb21taXRTdWJtb2R1bGVDaGlsZChpbmZvWzBdKVxuICAgICAgICAgICAgICAuY2F0Y2gobm9vcClcbiAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGluZm8uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAvLyByZS1pdGVyYXRlIHdoZW4gc3VibW9kdWxlIGl0ZW1zIG5vdCBjb21taXR0ZWRcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPiAwKSByZXR1cm4gaXRlcmF0ZSgpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmVzIGFsbFxuICAgICAgICAgICAgICAgIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGl0ZXJhdGUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb21taXRTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oY29tbWl0Um9vdClcbiAgICAgIC50aGVuKCgpID0+IHJlc29sdmUobnVsbCkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbm9vcCgpIHtcbiAgLy9cbn1cblxuZnVuY3Rpb24gcHVzaCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1Yikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBzdWJtb2R1bGVzID0gZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSA/IGdpdGh1Yi5zdWJtb2R1bGUuZ2V0KCkgOiBbXTtcbiAgY29uc3QgcHVzaFN1Ym1vZHVsZSA9IGZ1bmN0aW9uIChzdWJtb2R1bGU6ICh0eXBlb2Ygc3VibW9kdWxlcylbbnVtYmVyXSkge1xuICAgIGNvbnN0IHsgdXJsLCBicmFuY2gsIHJvb3QgfSA9IHN1Ym1vZHVsZTtcbiAgICBpZiAoIXN1Ym1vZHVsZS5naXRodWIpIHtcbiAgICAgIHN1Ym1vZHVsZS5naXRodWIgPSBuZXcgZ2l0SGVscGVyKHJvb3QpO1xuICAgIH1cbiAgICBjb25zdCB7IGdpdGh1YiB9ID0gc3VibW9kdWxlO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgIGNvbnN0IHNldFIgPSAoKSA9PiBnaXRodWIuc2V0cmVtb3RlKHVybCk7XG4gICAgICBjb25zdCBzZXRCID0gKCkgPT4gZ2l0aHViLnNldGJyYW5jaChicmFuY2gpO1xuICAgICAgUHJvbWlzZS5hbGwoW3NldFIoKSwgc2V0QigpXSkudGhlbigoKSA9PiB7XG4gICAgICAgIGdpdGh1Yi5jYW5QdXNoKCkudGhlbigoYWxsb3dlZCkgPT4ge1xuICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKHJvb3QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgLy8gcHVzaCB0aGVuIHJlc29sdmVcbiAgICAgICAgICAgIGdpdGh1Yi5wdXNoKGZhbHNlLCB7IHN0ZGlvOiAncGlwZScgfSkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICdjaGFuZ2VzIG5vdCBzdGFnZWQnKTtcbiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGNoYW5nZXMgbm90IHN0YWdlZFxuICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdpdGh1Yi5pc1VwVG9EYXRlKCkudGhlbigodXBkYXRlZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgTG9nZ2VyLmxvZygnc3VibW9kdWxlJywgd29ya3NwYWNlKHJvb3QpLCAndXBkYXRlZCcsIHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBpcyB1cCB0byBkYXRlXG4gICAgICAgICAgICAgICAgICByZXNvbHZlUHVzaChudWxsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBpdGVyYXRlU3VibW9kdWxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgaWYgKHN1Ym1vZHVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBzdWJtb2R1bGVzLnNoaWZ0KCk7XG4gICAgICAgIGlmIChzdWJtb2R1bGUpIHtcbiAgICAgICAgICBwdXNoU3VibW9kdWxlKHN1Ym1vZHVsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGl0ZXJhdGVTdWJtb2R1bGUoKS50aGVuKHJlc29sdmUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGl0ZXJhdGVTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVQdXNoKSA9PiB7XG4gICAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgICBMb2dnZXIubG9nKHdvcmtzcGFjZShnaXRodWIuY3dkKSwgJ2NhbiBwdXNoJywgYWxsb3dlZCk7XG4gICAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgICBnaXRodWIucHVzaCgpLnRoZW4ocmVzb2x2ZVB1c2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNvbHZlKTtcbiAgICAvL3B1c2hTdWJtb2R1bGUoc3VibW9kdWxlc1sxXSkudGhlbihyZXNvbHZlKTtcbiAgfSk7XG59XG5cbmd1bHAudGFzaygnZGVwbG95OnB1c2gnLCBwdXNoKTtcbmd1bHAudGFzaygnZGVwbG95OnN0YXR1cycsIHN0YXR1cyk7XG5ndWxwLnRhc2soJ2RlcGxveTpjb21taXQnLCBjb21taXQpO1xuZ3VscC50YXNrKCdkZXBsb3k6cHVsbCcsIHB1bGwpO1xuXG4vKipcbiAqIGdldCByZWxhdGl2ZSBwYXRoIGZyb20gd29ya3NwYWNlXG4gKiBAcGFyYW0gc3RyXG4gKiBAcmV0dXJuc1xuICovXG5mdW5jdGlvbiB3b3Jrc3BhY2Uoc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRvVW5peChzdHIpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJyk7XG59XG5cbi8vIGRlcGxveVxuZ3VscC50YXNrKCdkZXBsb3knLCBndWxwLnNlcmllcygnZGVwbG95OnB1bGwnLCAnZGVwbG95OmNvcHknLCAnc2FmZWxpbmsnLCAnZGVwbG95OmNvbW1pdCcsICdkZXBsb3k6cHVzaCcpKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/29/gulpdeploy_294088671a308604e99e2f253a1fa5cc.map","wrapperLength":82},"result":{"scriptId":"10700","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39671,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39668,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5mZWVkLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEseUJBQXVFO0FBQ3ZFLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXdCO0FBQ3hCLHVDQUFtRDtBQUNuRCxzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLHNFQUErQztBQUMvQyxxQ0FBb0Q7QUFFcEQsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUIsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsVUFBVSxJQUFJO0lBQzlCLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sUUFBUSxHQUFHLElBQUksY0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQ25CLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUFHO2dCQUM3QixPQUFPLHdCQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztZQUVILFNBQVMsS0FBSyxDQUFDLE9BQTZCLEVBQUUsSUFBMEI7Z0JBQ3RFLElBQU0sUUFBUSxHQUFHLGtCQUFRLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQVksRUFBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRXZFLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6QyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUIsS0FBSyxHQUFHLEtBQUssQ0FB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SSxDQUFDLFNBQVMsSUFBSSwwRkFBNEUsT0FBTyxpQkFBYSxDQUFDO2lCQUN6SDtnQkFDRCxzQkFBc0I7Z0JBQ3RCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sZ0JBQVksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO29CQUNyRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsMEJBQXdCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUM1RDtvQkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw0RkFBOEUsT0FBTyxrQkFBYyxDQUFDO2lCQUM1SDtnQkFDRCx1RUFBdUU7WUFDekUsQ0FBQyxDQUFDLENBQ0g7aUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLElBQUksRUFBRSxFQUFOLENBQU0sQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLmZlZWQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGF0aE9yRmlsZURlc2NyaXB0b3IsIHJlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IsIGdyYXZhdGFyIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuZ3VscC50YXNrKCdmZWVkJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oY29uZmlnLmN3ZCk7XG5cbiAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgIGluc3RhbmNlLmxvYWQoKS50aGVuKCgpID0+IHtcbiAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIGJ1aWxkKHRtcGxTcmM6IFBhdGhPckZpbGVEZXNjcmlwdG9yLCBkZXN0OiBQYXRoT3JGaWxlRGVzY3JpcHRvcikge1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuXG4gICAgICAgIGxldCBwb3N0cyA9IGluc3RhbmNlLmxvY2Fscy5nZXQoJ3Bvc3RzJyk7XG4gICAgICAgIHBvc3RzID0gcG9zdHMuc29ydCgnLWRhdGUnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5maWx0ZXIoKHBvc3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gcG9zdC5kcmFmdCAhPT0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgeyBlbWFpbCwgZmVlZCwgdXJsOiB1cmxDZmcgfSA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgeyBpY29uOiBpY29uQ2ZnIH0gPSBmZWVkO1xuXG4gICAgICAgIGxldCB1cmwgPSB1cmxDZmc7XG4gICAgICAgIGlmICh1cmxbdXJsLmxlbmd0aCAtIDFdICE9PSAnLycpIHVybCArPSAnLyc7XG4gICAgICAgIC8vIHJlbW92ZSBicm9rZW4gaGV4byBsYW5nIHNob3J0Y29kZVxuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCc6bGFuZy8nKSkgdXJsID0gdXJsLnJlcGxhY2UoJy86bGFuZy8nLCAnLycpO1xuXG4gICAgICAgIGxldCBpY29uID0gJyc7XG4gICAgICAgIGlmIChpY29uQ2ZnKSBpY29uID0gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIGljb25DZmcpO1xuICAgICAgICBlbHNlIGlmIChlbWFpbCkgaWNvbiA9IGdyYXZhdGFyKGVtYWlsLCB7fSk7XG5cbiAgICAgICAgY29uc3QgZmVlZF91cmwgPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgJ3Jzcy54bWwnKTtcblxuICAgICAgICBjb25zdCBkYXRhID0gdGVtcGxhdGUucmVuZGVyKHtcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIGljb24sXG4gICAgICAgICAgcG9zdHMsXG4gICAgICAgICAgZmVlZF91cmxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd3JpdGVGaWxlU3luYyhkZXN0LCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGVtcGxhdGVSU1MgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfcnNzLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdFJTUyA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdyc3MueG1sJyk7XG4gICAgICBidWlsZCh0ZW1wbGF0ZVJTUywgZGVzdFJTUyk7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlQVRPTSA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9hdG9tLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdEFUT00gPSBqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnYXRvbS54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlQVRPTSwgZGVzdEFUT00pO1xuXG4gICAgICBjb25zdCBiYXNlVVJMID0gY29uZmlnLnVybC5lbmRzV2l0aCgnLycpID8gY29uZmlnLnVybCA6IGNvbmZpZy51cmwgKyAnLyc7XG5cbiAgICAgIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgZ3VscFxuICAgICAgICAuc3JjKCcqKi8qLmh0bWwnLCB7IGN3ZDogcHVibGljRGlyLCBpZ25vcmU6IGNvbW1vbklnbm9yZSB9KVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGF1dG8gZGlzY292ZXJ5IHJzc1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3Jzcy54bWxcIl1gKS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInJzcy1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9yc3MreG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCIgLz5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgYXRvbVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwiYXRvbS1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9hdG9tK3htbFwiIHJlbD1cImFsdGVybmF0ZVwiIGhyZWY9XCIke2Jhc2VVUkx9YXRvbS54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiBkb25lKCkpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/fb/gulpfeed_fbf9aaad66351334553810020391b0ff.map","wrapperLength":82},"result":{"scriptId":"10701","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13358,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13355,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673322432938,"runtime":4721,"slow":false,"start":1673322428217},"skipped":false,"testFilePath":"/home/runner/work/static-blog-generator/static-blog-generator/test/copy.test.ts","testResults":[{"ancestorTitles":["test copy post without label mapper","clean"],"duration":66,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["test copy post without label mapper","clean"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["test copy post without label mapper","copy"],"duration":1866,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["test copy post without label mapper","copy"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.util = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nexports.util = __importStar(require(\"./utils\"));\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0M7QUFBdEMsbUhBQUEsT0FBTyxPQUFlO0FBQy9CLHNEQUFnRTtBQUF2RCx5SEFBQSxPQUFPLE9BQWM7QUFDOUIsc0RBQStEO0FBQXRELHdIQUFBLE9BQU8sT0FBYTtBQUM3QiwyQ0FBOEQ7QUFBckQscUdBQUEsT0FBTyxPQUFBO0FBQUUsaUdBQUEsR0FBRyxPQUFBO0FBQUUsdUdBQUEsR0FBRyxPQUFhO0FBQ3ZDLHVDQUFnRDtBQUF2QyxtR0FBQSxPQUFPLE9BQVc7QUFDM0IsK0NBQXNFO0FBQTdELCtHQUFBLGVBQWUsT0FBQTtBQUFFLG1IQUFBLG1CQUFtQixPQUFBO0FBQzdDLHFEQUFnRTtBQUF2RCxvSUFBQSxPQUFPLE9BQW9CO0FBQ3BDLHVDQUE0RDtBQUFuRCx5R0FBQSxhQUFhLE9BQUE7QUFBRSxpSEFBQSxPQUFPLE9BQVE7QUFDdkMsb0NBQTJEO0FBQWxELG9HQUFBLFlBQVksT0FBQTtBQUFFLHNHQUFBLGNBQWMsT0FBQTtBQUNyQyx3Q0FBMkM7QUFBbEMsb0dBQUEsVUFBVSxPQUFBO0FBQ25CLGdEQUFnQztBQUNoQyx1Q0FBK0U7QUFBdEUscUdBQUEsWUFBWSxPQUFBO0FBQUUsMkdBQUEsa0JBQWtCLE9BQUE7QUFBRSxxR0FBQSxZQUFZLE9BQUE7QUFDdkQscUNBQW9DO0FBQTNCLDRGQUFBLElBQUksT0FBQTtBQUNiLCtDQUF5RDtBQUFoRCx1SEFBQSxPQUFPLE9BQWE7QUFDN0IscUNBQStEO0FBQXRELHVHQUFBLFlBQVksT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUFFLG9HQUFBLFNBQVMsT0FBQTtBQUUzQyxFQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB7IGRlZmF1bHQgYXMgQXBwbGljYXRpb24gfSBmcm9tICcuL2FwaSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBDYWNoZWQgfSBmcm9tICcuL2d1bHAtdXRpbHMvZ3VscC5jYWNoZSc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIGd1bHBEZWJ1ZyB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmRlYnVnJztcbmV4cG9ydCB7IGNsZWFuRGIsIGRlbCwgZGVsIGFzIGRlbGV0ZURpciB9IGZyb20gJy4vZ3VscC5jbGVhbic7XG5leHBvcnQgeyB0YXNrU2VvIGFzIGF1dG9TZW8gfSBmcm9tICcuL2d1bHAuc2VvJztcbmV4cG9ydCB7IGdlbmVyYXRlU2l0ZW1hcCwgaGV4b0dlbmVyYXRlU2l0ZW1hcCB9IGZyb20gJy4vZ3VscC5zaXRlbWFwJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc3RhbmRhbG9uZVJ1bm5lciB9IGZyb20gJy4vZ3VscC5zdGFuZGFsb25lJztcbmV4cG9ydCB7IGNvbW1pdFByb2plY3QsIGRlZmF1bHQgYXMgZ3VscCB9IGZyb20gJy4vZ3VscGZpbGUnO1xuZXhwb3J0IHsgY29weUFsbFBvc3RzLCBjb3B5U2luZ2xlUG9zdCB9IGZyb20gJy4vcG9zdC9jb3B5JztcbmV4cG9ydCB7IHVwZGF0ZVBvc3QgfSBmcm9tICcuL3Bvc3QvdXBkYXRlJztcbmV4cG9ydCAqIGFzIHV0aWwgZnJvbSAnLi91dGlscyc7XG5leHBvcnQgeyBhcnJheV9yYW5kb20sIGFycmF5X3JlbW92ZV9lbXB0eSwgYXJyYXlfdW5pcXVlIH0gZnJvbSAnLi91dGlscy9hcnJheSc7XG5leHBvcnQgeyBub29wIH0gZnJvbSAnLi91dGlscy9ub29wJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgc2NoZWR1bGVyIH0gZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuZXhwb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8vXG4iXSwidmVyc2lvbiI6M30=","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport * as util from './utils';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/09/index_09c0a821b29a6a45121212479559f319.map","wrapperLength":82},"result":{"scriptId":"11007","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":7904,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":7901,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1179,"endOffset":1260,"count":2},{"startOffset":1237,"endOffset":1257,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1946,"endOffset":2000,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2130,"endOffset":2191,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":2320,"endOffset":2381,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2497,"endOffset":2541,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2609,"endOffset":2649,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2723,"endOffset":2763,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2875,"endOffset":2917,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3045,"endOffset":3099,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3183,"endOffset":3241,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3376,"endOffset":3442,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3560,"endOffset":3608,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3677,"endOffset":3736,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3850,"endOffset":3893,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3972,"endOffset":4017,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4133,"endOffset":4176,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4342,"endOffset":4386,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4469,"endOffset":4519,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4596,"endOffset":4640,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4747,"endOffset":4782,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4904,"endOffset":4964,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5079,"endOffset":5125,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5199,"endOffset":5242,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":5316,"endOffset":5359,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar chain_1 = require(\"./utils/chain\");\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = (0, _config_1.getConfig)();\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, chain_1.chain)([{ callback: gulp_standalone_1.default }]); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, _this.config.public_dir)); };\n        /**\n         * Copy all **src-post** to **source/_posts** (run before generate)\n         * * see the method {@link pcopy.copyAllPosts}\n         * @returns\n         */\n        this.copy = function () { return (0, chain_1.chain)([{ callback: function () { return pcopy.copyAllPosts(undefined, _this.config); } }]); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        this.cwd = cwd;\n        (0, _config_1.fetchConfig)(cwd);\n        options = Object.assign(this.config, options || {}, { cwd: cwd });\n        this.config = (0, _config_1.setConfig)(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 3:\n                        if (!(opt === 'archive')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 5:\n                        if (!(opt === 'post')) return [3 /*break*/, 7];\n                        return [4 /*yield*/, cleaner.cleanGeneratedPosts().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        return [3 /*break*/, 9];\n                    case 7: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 8:\n                        _a.sent();\n                        _a.label = 9;\n                    case 9: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBd0I7QUFDeEIsK0JBQTZCO0FBRTdCLG9EQUF3QztBQUN4QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsdUNBQXNDO0FBQ3RDLHNEQUFnQztBQUNoQyxnRUFBMEM7QUFDMUMscUNBQThEO0FBRTlEO0lBTUU7OztPQUdHO0lBQ0gsYUFBWSxHQUFxQixFQUFFLE9BQXlDO1FBQTVFLGlCQVNDO1FBakJELFdBQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztRQUNyQixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQUN0QixjQUFTLEdBQUcsbUJBQVMsQ0FBQztRQXlCdEI7OztXQUdHO1FBQ0gsZUFBVSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLHlCQUFnQixFQUFFLENBQUMsQ0FBQyxFQUF2QyxDQUF1QyxDQUFDO1FBRTNEOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLEtBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBckQsQ0FBcUQsQ0FBQztRQUVsRTs7OztXQUlHO1FBQ0gsU0FBSSxHQUFHLGNBQU0sT0FBQSxJQUFBLGFBQUssRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLGNBQU0sT0FBQSxLQUFLLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxLQUFJLENBQUMsTUFBTSxDQUFDLEVBQTFDLENBQTBDLEVBQUUsQ0FBQyxDQUFDLEVBQXZFLENBQXVFLENBQUM7UUFFckY7OztX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RCxrQkFBZSxHQUFHLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBIZXhvIGZyb20gJ2hleG8nO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IE51bGxhYmxlIH0gZnJvbSAnLi9nbG9iYWxzJztcbmltcG9ydCAqIGFzIGNsZWFuZXIgZnJvbSAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgeyBjaGFpbiB9IGZyb20gJy4vdXRpbHMvY2hhaW4nO1xuaW1wb3J0IG5vb3AgZnJvbSAnLi91dGlscy9ub29wJztcbmltcG9ydCBzY2hlZHVsZXIgZnJvbSAnLi91dGlscy9zY2hlZHVsZXInO1xuaW1wb3J0IHsgZmV0Y2hDb25maWcsIGdldENvbmZpZywgc2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY2xhc3MgU0JHIHtcbiAgY3dkOiBzdHJpbmc7XG4gIGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBmZXRjaENvbmZpZyhjd2QpO1xuICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlnLCBvcHRpb25zIHx8IHt9LCB7IGN3ZCB9KTtcblxuICAgIHRoaXMuY29uZmlnID0gc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBjaGFpbihbeyBjYWxsYmFjazogc3RhbmRhbG9uZVJ1bm5lciB9XSk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCB0aGlzLmNvbmZpZy5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSA9ICgpID0+IGNoYWluKFt7IGNhbGxiYWNrOiAoKSA9PiBwY29weS5jb3B5QWxsUG9zdHModW5kZWZpbmVkLCB0aGlzLmNvbmZpZykgfV0pO1xuXG4gIC8qKlxuICAgKiBBbm9ueW1pemUgZXh0ZXJuYWwgbGlua3Mgb24gcHVibGljIGRpciAoX2NvbmZpZ195bWwucHVibGljX2RpcikgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gICAqIEByZXR1cm5zXG4gICAqL1xuICBzYWZlbGluayA9ICgpID0+IHRhc2tTYWZlbGluayhub29wLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIGdlbmVyYXRlIHNpdGUgd2l0aCBoZXhvXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZSgpIHtcbiAgICBjb25zdCBoZXhvID0gbmV3IEhleG8odGhpcy5jd2QpO1xuICAgIC8vIGhleG8gaW5pdFxuICAgIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8ubG9hZCgpLmNhdGNoKG5vb3ApO1xuICAgIC8vIGhleG8gZ2VuZXJhdGVcbiAgICBhd2FpdCBoZXhvLmNhbGwoJ2dlbmVyYXRlJykuY2F0Y2gobm9vcCk7XG4gICAgYXdhaXQgaGV4by5leGl0KCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlJyB8ICdkYXRhYmFzZScgfCAncG9zdCcpIHtcbiAgICBpZiAob3B0ID09PSAnYWxsJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbkRiKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSBpZiAob3B0ID09PSAnYXJjaGl2ZScpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ3Bvc3QnKSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuR2VuZXJhdGVkUG9zdHMoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU0JHO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport { chain } from './utils/chain';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { fetchConfig, getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = getConfig();\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    this.cwd = cwd;\n    fetchConfig(cwd);\n    options = Object.assign(this.config, options || {}, { cwd });\n\n    this.config = setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => chain([{ callback: standaloneRunner }]);\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, this.config.public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy = () => chain([{ callback: () => pcopy.copyAllPosts(undefined, this.config) }]);\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archive' | 'database' | 'post') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archive') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'post') {\n      await cleaner.cleanGeneratedPosts().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/a8/api_a829825f326b4691c16e18cc91565c70.map","wrapperLength":82},"result":{"scriptId":"11008","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":16899,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":16896,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":7},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":4},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":3},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":3},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":5},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":5},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":4},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4395,"endOffset":9162,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4488,"endOffset":6135,"count":1},{"startOffset":5851,"endOffset":5871,"count":0},{"startOffset":5990,"endOffset":5995,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4847,"endOffset":4932,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5078,"endOffset":5186,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.copy","ranges":[{"startOffset":5383,"endOffset":5510,"count":1}],"isBlockCoverage":true},{"functionName":"callback","ranges":[{"startOffset":5436,"endOffset":5503,"count":1}],"isBlockCoverage":true},{"functionName":"SBG.safelink","ranges":[{"startOffset":5677,"endOffset":5819,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":6153,"endOffset":6206,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":6225,"endOffset":6276,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6354,"endOffset":7447,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":7618,"endOffset":9143,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7682,"endOffset":9135,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":7733,"endOffset":9123,"count":5},{"startOffset":7805,"endOffset":7967,"count":1},{"startOffset":7883,"endOffset":7967,"count":0},{"startOffset":7988,"endOffset":8123,"count":0},{"startOffset":8144,"endOffset":8235,"count":0},{"startOffset":8256,"endOffset":8431,"count":1},{"startOffset":8338,"endOffset":8431,"count":0},{"startOffset":8452,"endOffset":8543,"count":0},{"startOffset":8564,"endOffset":8739,"count":1},{"startOffset":8643,"endOffset":8739,"count":0},{"startOffset":8760,"endOffset":8851,"count":0},{"startOffset":8872,"endOffset":8939,"count":1},{"startOffset":8960,"endOffset":9040,"count":1},{"startOffset":9061,"endOffset":9091,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHNEQUFnQztBQUNoQyxxQ0FBOEQ7QUFDOUQsOENBQXdCO0FBQ3hCLHlCQUF5QjtBQUN6QiwrQkFBNkI7QUFDN0IsNkJBQStCO0FBQy9CLHdEQUFrQztBQUNsQyxpQ0FBdUM7QUFDdkMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyxxQ0FBc0M7QUFFdEM7O0dBRUc7QUFDSCxTQUFzQixPQUFPLENBQUMsUUFBa0QsRUFBRSxLQUFnQjs7Ozs7O29CQUMxRixHQUFHLEdBQUcsSUFBQSxlQUFLLEVBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ3JCLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztvQkFDM0IsSUFBSSxPQUFPLE1BQU0sQ0FBQyxVQUFVLEtBQUssUUFBUSxFQUFFO3dCQUN6QyxJQUFBLGNBQVMsRUFBQyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHNCQUFzQixDQUFDLEVBQUUsSUFBQSxjQUFPLEVBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzt3QkFDckUsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO3FCQUN6RDtvQkFJRyxJQUFJLEdBQUc7d0JBQ1QsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQzt3QkFDN0MsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxXQUFXLENBQUM7d0JBQzdCLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsVUFBVSxDQUFDO3dCQUM1QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxF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QUUsZ0JBQWdCLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvQixjQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0FBQzdDLGNBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLGNBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5jbGVhbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZGRpciwgcm0sIFJtT3B0aW9ucyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB7IGluc3BlY3QgfSBmcm9tICd1dGlsJztcbmltcG9ydCBkZWJ1ZyBmcm9tICcuL3V0aWxzL2RlYnVnJztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBDbGVhbiBQcm9qZWN0IERhdGFiYXNlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5EYihjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSwgZmlsZXM/OiBzdHJpbmdbXSkge1xuICBjb25zdCBsb2cgPSBkZWJ1ZygnY2xlYW4nKTtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGlmICh0eXBlb2YgY29uZmlnLnNvdXJjZV9kaXIgIT09ICdzdHJpbmcnKSB7XG4gICAgd3JpdGVmaWxlKGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvY2xlYW4ubG9nJyksIGluc3BlY3QoY29uZmlnKSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjb25maWcuc291cmNlX2RpciBtdXN0IGJlIGNvbmZpZ3VyZWQnKTtcbiAgfVxuXG4gIC8vIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuXG4gIGxldCBkaXJzID0gW1xuICAgIGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnNvdXJjZV9kaXIsICdfcG9zdHMnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvY2FjaGUnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICd0bXAvZHVtcCcpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9sb2dzJyksXG4gICAgam9pbihjb25maWcuY3dkLCAnZGIuanNvbicpXG4gIF07XG4gIGlmIChBcnJheS5pc0FycmF5KGZpbGVzKSkgZGlycyA9IGRpcnMuY29uY2F0KGZpbGVzKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgZGlyID0gZGlyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICBsb2coJ2NsYW5pbmcnLCBkaXIpO1xuICAgICAgICBhd2FpdCBkZWwoZGlyKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIGxvZygnY2Fubm90IGRlbGV0ZScsIGRpcik7XG4gICAgfVxuICB9XG5cbiAgLypjb25zdCBoZXhvID0gbmV3IGhleG9MaWIoY29uZmlnLmN3ZCk7XG4gIGF3YWl0IGhleG8uaW5pdCgpLmNhdGNoKG5vb3ApO1xuICBhd2FpdCBoZXhvLmNhbGwoJ2NsZWFuJykuY2F0Y2gobm9vcCk7Ki9cblxuICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSByZXR1cm4gY2FsbGJhY2soKTtcblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIGRlbGV0ZSBmb2xkZXIgYXN5bmNcbiAqIEBwYXJhbSBwYXRoXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZGVsKHBhdGg6IHN0cmluZykge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgcm1PcHQ6IFJtT3B0aW9ucyA9IHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9O1xuICAgIGlmIChleGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIC8qaWYgKHN0YXRTeW5jKHBhdGgpLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgcm1kaXIocGF0aCwgeyBtYXhSZXRyaWVzOiAxMCB9KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm0ocGF0aCwgcm1PcHQpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9Ki9cbiAgICB9IGVsc2Uge1xuICAgICAgcmVzb2x2ZShuZXcgRXJyb3IocGF0aCArICcgbm90IGZvdW5kJykpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogY2xlYW4gb2xkIGFyY2hpdmVzIChjYXRlZ29yaWVzLCB0YWdzLCBwYWdpbmF0aW9uKSBmcm9tIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbk9sZEFyY2hpdmVzKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCBsb2duYW1lID0gJ2NsZWFuOicgKyBhbnNpQ29sb3JzLmdyZXkoJ2FyY2hpdmVzJyk7XG5cbiAgLy8gY2xlYW4gYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNcbiAgY29uc3QgYXJjaGl2ZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuYXJjaGl2ZV9kaXIpO1xuICBjb25zdCBjYXRlZ29yaWVzID0gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgY29uZmlnLmNhdGVnb3J5X2Rpcik7XG4gIGNvbnN0IHRhZ3MgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcudGFnX2Rpcik7XG4gIGNvbnN0IGZvbGRlcnMgPSBbYXJjaGl2ZXMsIHRhZ3MsIGNhdGVnb3JpZXNdLmZpbHRlcigoc3RyKSA9PiBleGlzdHNTeW5jKHN0cikpO1xuXG4gIC8vIHB1c2ggbGFuZ3VhZ2UgZm9sZGVyIHRvIGJlIGRlbGV0ZWQgZnJvbSBkZXBsb3kgZGlyXG4gIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5sYW5ndWFnZSkpIHtcbiAgICBjb25zdCBsYW5nRGlyID0gY29uZmlnLmxhbmd1YWdlLm1hcCgocGF0aCkgPT4gam9pbihjb25maWcuZGVwbG95LmRlcGxveURpciwgcGF0aCkpO1xuICAgIGZvbGRlcnMucHVzaCguLi5sYW5nRGlyKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnLmxhbmd1YWdlID09PSAnc3RyaW5nJyAmJiBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgIGZvbGRlcnMucHVzaChqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBTdHJpbmcoY29uZmlnLmxhbmd1YWdlKSkpO1xuICB9XG5cbiAgLy8gZGVsZXRlIHBhZ2luYXRpb25cbiAgY29uc3QgcGFnZXNEaXIgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCAncGFnZScpO1xuICBpZiAoZXhpc3RzU3luYyhwYWdlc0RpcikpIHtcbiAgICBjb25zdCBwYWdlcyA9IChhd2FpdCByZWFkZGlyKHBhZ2VzRGlyKSkuZmlsdGVyKChzdHIpID0+IC9eXFxkKyQvLnRlc3Qoc3RyKSkubWFwKChzdHIpID0+IGpvaW4ocGFnZXNEaXIsIHN0cikpO1xuICAgIGZvbGRlcnMucHVzaCguLi5wYWdlcyk7XG4gIH1cblxuICBjb25zdCBwcm9taXNlczogUHJvbWlzZTxhbnk+W10gPSBbXTtcblxuICAvLyBkdW1wIHRvIGZpbGVcbiAgY29uc3QgZHVtcGZpbGUgPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9jbGVhbi50eHQnKTtcbiAgd3JpdGVmaWxlKGR1bXBmaWxlLCBmb2xkZXJzLmpvaW4oRU9MKSk7XG4gIExvZ2dlci5sb2cobG9nbmFtZSwgJ2xpc3QgZGVsZXRlZCBmaWxlcycsIGR1bXBmaWxlKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGZvbGRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBwYXRoU3RyID0gZm9sZGVyc1tpXTtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmMocGF0aFN0cikpIHByb21pc2VzLnB1c2goZGVsKHBhdGhTdHIpLmNhdGNoKG5vb3ApKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuICB9XG5cbiAgY29uc3QgZmluaXNoTm93ID0gZnVuY3Rpb24gKGU6IGFueSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjbGVhbiBhcmNoaXZlcyBoYXMgc29tZSBlcnJvcycpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSBjYWxsYmFjaygpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH07XG5cbiAgYXdhaXQgQmx1ZWJpcmQuYWxsKHByb21pc2VzKS50aGVuKGZpbmlzaE5vdykuY2F0Y2goZmluaXNoTm93KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuR2VuZXJhdGVkUG9zdHMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIHJldHVybiBjbGVhbkRiKGNhbGxiYWNrLCBbam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpXSk7XG59XG5cbmd1bHAudGFzaygnY2xlYW46YXJjaGl2ZScsIGNsZWFuT2xkQXJjaGl2ZXMpO1xuZ3VscC50YXNrKCdjbGVhbjpkYicsIGNsZWFuRGIpO1xuZ3VscC50YXNrKCdjbGVhbjpwb3N0JywgY2xlYW5HZW5lcmF0ZWRQb3N0cyk7XG5ndWxwLnRhc2soJ2NsZWFuOmFsbCcsIGd1bHAuc2VyaWVzKCdjbGVhbjpkYicsICdjbGVhbjphcmNoaXZlJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/6b/gulpclean_6b5cfe0a3f5f375b9d7210604d22c51b.map","wrapperLength":82},"result":{"scriptId":"11583","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24224,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24221,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = exports.fetchConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexoPostParser = __importStar(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nfunction fetchConfig(fileYML) {\n    if (!fileYML.endsWith('_config.yml'))\n        fileYML += '/_config.yml';\n    var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n    setConfig((0, object_1.orderKeys)(configYML));\n    (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\nexports.fetchConfig = fetchConfig;\nfetchConfig((0, path_1.join)(process.cwd(), '_config.yml'));\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign(settledConfig || {}, obj);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nfunction getConfig() {\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : { submodule: [] };\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvX2NvbmZpZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBOEM7QUFDOUMsMEVBQXFDO0FBRXJDLCtEQUFtRDtBQUNuRCw2QkFBNEI7QUFDNUIsOENBQXdCO0FBQ3hCLHVDQUE4QztBQUM5QyxpQ0FBdUM7QUFDdkMseUNBQTJDO0FBNEQzQyxJQUFJLGFBQWEsR0FBRyxJQUFBLDJCQUFnQixHQUF5QixDQUFDO0FBRTlELFNBQWdCLFdBQVcsQ0FBQyxPQUFlO0lBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQztRQUFFLE9BQU8sSUFBSSxjQUFjLENBQUM7SUFDaEUsSUFBTSxTQUFTLEdBQUcsY0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDN0QsU0FBUyxDQUFDLElBQUEsa0JBQVMsRUFBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqRixDQUFDO0FBTEQsa0NBS0M7QUFFRCxXQUFXLENBQUMsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7QUFFaEQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRXhELGlDQUFpQztJQUNqQyxjQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hDLE9BQU8sU0FBUyxFQUFFLENBQUM7QUFDckIsQ0FBQztBQU5ELDhCQU1DO0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVM7SUFDdkIsYUFBYSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLElBQUksRUFBRSxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUM7SUFDakYsOEZBQThGO0lBQzlGLE9BQU8sYUFBeUIsQ0FBQztBQUNuQyxDQUFDO0FBSkQsOEJBSUM7QUFFRCxTQUFnQixZQUFZOztJQUMxQixJQUFNLFNBQVMsR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLFVBQVUsSUFBRyxNQUFBLGFBQWEsQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQSxJQUFJLEtBQUssQ0FBQyxDQUFDO0lBQzVGLElBQU0sTUFBTSxHQUFHLElBQUEsZUFBVSxFQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLDRCQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFFLEVBQUUsU0FBUyxFQUFFLEVBQVcsRUFBcUIsQ0FBQztJQUMzRyxPQUFPLEVBQUUsU0FBUyxXQUFBLEVBQUUsTUFBTSxRQUFBLEVBQUUsQ0FBQztBQUMvQixDQUFDO0FBSkQsb0NBSUM7QUFFRDs7Ozs7O0dBTUc7QUFDVSxRQUFBLFlBQVksR0FBRztJQUMxQixrQkFBa0I7SUFDbEIsc0JBQXNCO0lBQ3RCLDZCQUE2QjtJQUM3QiwwQ0FBMEM7SUFDMUMsaUJBQWlCO0lBQ2pCLGFBQWE7SUFDYixvQkFBb0I7SUFDcEIsV0FBVztJQUNYLGFBQWE7SUFDYixjQUFjO0lBQ2QsZUFBZTtJQUNmLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsMEJBQTBCO0lBQzFCLGdCQUFnQjtJQUNoQixvQkFBb0I7SUFDcEIsb0JBQW9CO0lBQ3BCLGFBQWE7SUFDYixPQUFPLENBQUMsWUFBWTtDQUNyQixDQUFDO0FBRUY7O0dBRUc7QUFDVSxRQUFBLGNBQWMsMENBQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLGtCQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxVQUFFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL19jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgKiBhcyBoZXhvUG9zdFBhcnNlciBmcm9tICdoZXhvLXBvc3QtcGFyc2VyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaENvbmZpZyhmaWxlWU1MOiBzdHJpbmcpIHtcbiAgaWYgKCFmaWxlWU1MLmVuZHNXaXRoKCdfY29uZmlnLnltbCcpKSBmaWxlWU1MICs9ICcvX2NvbmZpZy55bWwnO1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKHJlYWRGaWxlU3luYyhmaWxlWU1MLCAndXRmLTgnKSk7XG4gIHNldENvbmZpZyhvcmRlcktleXMoY29uZmlnWU1MKSk7XG4gIHdyaXRlZmlsZShqb2luKF9fZGlybmFtZSwgJ19jb25maWcuanNvbicpLCBKU09OLnN0cmluZ2lmeShjb25maWdZTUwsIG51bGwsIDIpKTtcbn1cblxuZmV0Y2hDb25maWcoam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKSk7XG5cbi8qKlxuICogQ29uZmlnIHNldHRlclxuICogKiB1c2VmdWwgZm9yIGplc3RcbiAqIEBwYXJhbSBvYmpcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldENvbmZpZyhvYmo6IFJlY29yZDxzdHJpbmcsIGFueT4gfCBQcm9qQ29uZikge1xuICBzZXR0bGVkQ29uZmlnID0gT2JqZWN0LmFzc2lnbihzZXR0bGVkQ29uZmlnIHx8IHt9LCBvYmopO1xuXG4gIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICBoZXhvUG9zdFBhcnNlci5zZXRDb25maWcoc2V0dGxlZENvbmZpZyk7XG4gIHJldHVybiBnZXRDb25maWcoKTtcbn1cblxuLyoqXG4gKiBDb25maWcgZ2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZygpIHtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXBsb3lDb25maWcoKSB7XG4gIGNvbnN0IGRlcGxveURpciA9IGpvaW4oc2V0dGxlZENvbmZpZy5jd2QsICcuZGVwbG95XycgKyBzZXR0bGVkQ29uZmlnLmRlcGxveT8udHlwZSB8fCAnZ2l0Jyk7XG4gIGNvbnN0IGdpdGh1YiA9IGV4aXN0c1N5bmMoZGVwbG95RGlyKSA/IG5ldyBnaXQoZGVwbG95RGlyKSA6ICh7IHN1Ym1vZHVsZTogW10gYXMgZ2l0W10gfSBhcyB1bmtub3duIGFzIGdpdCk7XG4gIHJldHVybiB7IGRlcGxveURpciwgZ2l0aHViIH07XG59XG5cbi8qKlxuICogY29tbW9uIGlnbm9yZSBmaWxlc1xuICogQGV4YW1wbGVcbiAqIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICogY29uc3QgZXhjbHVkZXMgPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gKiBleGNsdWRlcy5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gKi9cbmV4cG9ydCBjb25zdCBjb21tb25JZ25vcmUgPSBbXG4gICcqKi95YW5kZXhfKi5odG1sJywgLy8gc2tpcCB5YW5kZXggdmVyaWZpY2F0aW9uIGZpbGVcbiAgLy8gJyoqL2NvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovZGlzcXVzLWNvbW1lbnRzLmh0bWwnLFxuICAvLyAnKiovY29tbWVudC5odG1sJywgLy8gc2tpcCBjb21tZW50Lmh0bWxcbiAgJyoqL2Zhdmljb24uaHRtbCcsIC8vIHNraXAgZmF2aWNvblxuICAnKiovNDA0Lmh0bWwnLCAvLyBza2lwIDQwNFxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gc2tpcCBub2RlX21vZHVsZXNcbiAgJyoqL3RtcC8qKicsIC8vIHNraXAgdG1wXG4gICcqKi9idWlsZC8qKicsIC8vIHNraXAgYnVpbGRcbiAgJyoqLy5jYWNoZS8qKicsIC8vIHNraXAgY29tbW9uIGNhY2hlIGZvbGRlclxuICAnKiovLnZzY29kZS8qKicsIC8vIHNraXAgdnNjb2RlIGNvbmZpZ3VyYXRpb24gZm9sZGVyXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyBza2lwIGZyb250bWF0dGVyIHZzY29kZSBleHRlbnNpb25cbiAgJyoqL3BpbnRlcmVzdC0qLmh0bWwnLCAvLyBza2lwIHBpbnRlcmVzdCB2ZXJpZmljYXRpb24gZmlsZVxuICAnKiovXyouc3RhbmRhbG9uZS57anMsdHN9JywgLy8gc2tpcCBfZmlsZW5hbWUuc3RhbmRhbG9uZS5qc1xuICAnKiovZGVza3RvcC5pbmknLCAvLyB3aW5kb3dzIGRlc2t0b3AuaW5pXG4gICcqKi9ub2RlX21vZHVsZXMvKionLCAvLyBub2RlX21vZHVsZXNcbiAgJyoqLy5mcm9udG1hdHRlci8qKicsIC8vIHZzY29kZSBmcm9udG1hdHRlciBwbHVnaW5cbiAgJyoqLy5naXQqLyoqJywgLy8gYW55IGdpdCBjb25maWdzXG4gICcqKi8uKicgLy8gc2tpcCBkb3RzXG5dO1xuXG4vKipcbiAqIGFycmF5IG9mIGNvbmZpZy5leGNsdWRlLCBjb25maWcuaWdub3JlXG4gKi9cbmV4cG9ydCBjb25zdCBwcm9qZWN0SWdub3JlcyA9IFsuLi4oZ2V0Q29uZmlnKCkuc2tpcF9yZW5kZXIgfHwgW10pLCAuLi4oZ2V0Q29uZmlnKCkuaWdub3JlIHx8IFtdKV07XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport * as hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nexport function fetchConfig(fileYML: string) {\n  if (!fileYML.endsWith('_config.yml')) fileYML += '/_config.yml';\n  const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n  setConfig(orderKeys(configYML));\n  writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n}\n\nfetchConfig(join(process.cwd(), '_config.yml'));\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign(settledConfig || {}, obj);\n\n  // update hexo-post-parser config\n  hexoPostParser.setConfig(settledConfig);\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @returns\n */\nexport function getConfig() {\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : ({ submodule: [] as git[] } as unknown as git);\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/cd/_config_cdd6159bd7bcb99ef891db3f4cdffa50.map","wrapperLength":82},"result":{"scriptId":"12016","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13247,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13244,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":1161,"endOffset":1611,"count":2},{"startOffset":1255,"endOffset":1264,"count":0},{"startOffset":1342,"endOffset":1352,"count":0},{"startOffset":1379,"endOffset":1396,"count":0},{"startOffset":1407,"endOffset":1446,"count":0},{"startOffset":1504,"endOffset":1524,"count":0},{"startOffset":1526,"endOffset":1536,"count":0},{"startOffset":1572,"endOffset":1586,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":1665,"endOffset":1992,"count":2},{"startOffset":1733,"endOffset":1928,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2050,"endOffset":2131,"count":2},{"startOffset":2102,"endOffset":2107,"count":1},{"startOffset":2108,"endOffset":2128,"count":1}],"isBlockCoverage":true},{"functionName":"fetchConfig","ranges":[{"startOffset":2751,"endOffset":3102,"count":2},{"startOffset":2833,"endOffset":2859,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":3259,"endOffset":3454,"count":3},{"startOffset":3333,"endOffset":3338,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3544,"endOffset":3779,"count":609},{"startOffset":3629,"endOffset":3634,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3811,"endOffset":4174,"count":609},{"startOffset":3973,"endOffset":3981,"count":0},{"startOffset":3993,"endOffset":4001,"count":0},{"startOffset":4053,"endOffset":4098,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml = __importStar(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:name/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx5QkFBa0M7QUFDbEMsaURBQWtEO0FBQ2xELCtCQUFxQztBQUNyQyx5Q0FBNkI7QUFFN0I7OztHQUdHO0FBQ0gsU0FBZ0IsZ0JBQWdCO0lBQzlCLElBQU0saUJBQWlCLEdBQUc7UUFDeEIsT0FBTztRQUNQLEtBQUssRUFBRSxNQUFNO1FBQ2IsUUFBUSxFQUFFLEVBQUU7UUFDWixXQUFXLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNO1FBQ04sR0FBRyxFQUFFLG9CQUFvQjtRQUN6QixJQUFJLEVBQUUsR0FBRztRQUNULFNBQVMsRUFBRSwwQkFBMEI7UUFDckMsa0JBQWtCLEVBQUUsRUFBRTtRQUN0QixXQUFXLEVBQUU7WUFDWCxjQUFjLEVBQUUsSUFBSTtZQUNwQixhQUFhLEVBQUUsSUFBSTtTQUNwQjtRQUNELFlBQVk7UUFDWixVQUFVLEVBQUUsUUFBUTtRQUNwQixVQUFVLEVBQUUsUUFBUTtRQUNwQixPQUFPLEVBQUUsTUFBTTtRQUNmLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLFlBQVksRUFBRSxZQUFZO1FBQzFCLFFBQVEsRUFBRSxnQkFBZ0I7UUFDMUIsUUFBUSxFQUFFLE9BQU87UUFDakIsV0FBVyxFQUFFLEVBQUU7UUFDZixVQUFVO1FBQ1YsYUFBYSxFQUFFLFdBQVc7UUFDMUIsY0FBYyxFQUFFLE1BQU07UUFDdEIsU0FBUyxFQUFFLEtBQUs7UUFDaEIsYUFBYSxFQUFFO1lBQ2IsTUFBTSxFQUFFLElBQUk7WUFDWixLQUFLLEVBQUUsTUFBTTtZQUNiLE9BQU8sRUFBRSxFQUFFO1NBQ1o7UUFDRCxhQUFhLEVBQUUsQ0FBQztRQUNoQixhQUFhLEVBQUUsS0FBSztRQUNwQixpQkFBaUIsRUFBRSxLQUFLO1FBQ3hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLE1BQU0sRUFBRSxJQUFJO1FBQ1osa0JBQWtCLEVBQUUsY0FBYztRQUNsQyxTQUFTLEVBQUU7WUFDVCxXQUFXLEVBQUUsS0FBSztZQUNsQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtZQUNmLElBQUksRUFBRSxJQUFJO1lBQ1YsaUJBQWlCLEVBQUUsRUFBRTtZQUNyQixhQUFhLEVBQUUsS0FBSztZQUNwQixJQUFJLEVBQUUsS0FBSztTQUNaO1FBQ0QsT0FBTyxFQUFFO1lBQ1AsVUFBVSxFQUFFLElBQUk7WUFDaEIsV0FBVyxFQUFFLElBQUk7WUFDakIsV0FBVyxFQUFFLEVBQUU7U0FDaEI7UUFDRCxpQkFBaUI7UUFDakIsZ0JBQWdCLEVBQUUsZUFBZTtRQUNqQyxZQUFZLEVBQUUsRUFBRTtRQUNoQixPQUFPLEVBQUUsRUFBRTtRQUNYLHFCQUFxQjtRQUNyQixXQUFXLEVBQUUsWUFBWTtRQUN6QixXQUFXLEVBQUUsVUFBVTtRQUN2QixjQUFjLEVBQUUsT0FBTztRQUN2Qiw0Q0FBNEM7UUFDNUMsMEJBQTBCO1FBQzFCLGFBQWE7UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLGNBQWMsRUFBRSxNQUFNO1FBQ3RCLGFBQWE7UUFDYixLQUFLLEVBQUUsV0FBVztRQUNsQixNQUFNLEVBQUU7WUFDTixLQUFLLEVBQUUsS0FBSztTQUNiO1FBQ0QsYUFBYTtRQUNiLE1BQU0sRUFBRSxFQUFFO1FBRVYsK0JBQStCO1FBQy9CLE1BQU0sRUFBRSxFQUFFO1FBRVYsaUJBQWlCO1FBQ2pCLGNBQWMsRUFBRSxJQUFJO0tBQ3JCLENBQUM7SUFDRixJQUFNLGdCQUFnQixHQUFHO1FBQ3ZCLEdBQUcsRUFBRSxJQUFBLGNBQU0sRUFBQyxJQUFBLGlDQUFnQixFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQzdDLENBQUM7SUFDRixJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztJQUNyRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxDQUFvQyxDQUFDO0FBQzFHLENBQUM7QUF4RkQsNENBd0ZDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0Isb0JBQW9CO0lBQ2xDLE9BQU8sSUFBQSxpQkFBWSxFQUFDLElBQUEsWUFBSSxFQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMvRCxDQUFDO0FBRkQsb0RBRUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAqIGFzIHlhbWwgZnJvbSAneWFtbCc7XG5cbi8qKlxuICogZ2V0IGRlZmF1bHQgY29uZmlndXJhdGlvblxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWcoKSB7XG4gIGNvbnN0IGhleG9EZWZhdWx0Q29uZmlnID0ge1xuICAgIC8vIFNpdGVcbiAgICB0aXRsZTogJ0hleG8nLFxuICAgIHN1YnRpdGxlOiAnJyxcbiAgICBkZXNjcmlwdGlvbjogJycsXG4gICAgYXV0aG9yOiAnSm9obiBEb2UnLFxuICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIHRpbWV6b25lOiAnJyxcbiAgICAvLyBVUkxcbiAgICB1cmw6ICdodHRwOi8vZXhhbXBsZS5jb20nLFxuICAgIHJvb3Q6ICcvJyxcbiAgICBwZXJtYWxpbms6ICc6eWVhci86bW9udGgvOmRheS86bmFtZS8nLFxuICAgIHBlcm1hbGlua19kZWZhdWx0czoge30sXG4gICAgcHJldHR5X3VybHM6IHtcbiAgICAgIHRyYWlsaW5nX2luZGV4OiB0cnVlLFxuICAgICAgdHJhaWxpbmdfaHRtbDogdHJ1ZVxuICAgIH0sXG4gICAgLy8gRGlyZWN0b3J5XG4gICAgc291cmNlX2RpcjogJ3NvdXJjZScsXG4gICAgcHVibGljX2RpcjogJ3B1YmxpYycsXG4gICAgdGFnX2RpcjogJ3RhZ3MnLFxuICAgIGFyY2hpdmVfZGlyOiAnYXJjaGl2ZXMnLFxuICAgIGNhdGVnb3J5X2RpcjogJ2NhdGVnb3JpZXMnLFxuICAgIGNvZGVfZGlyOiAnZG93bmxvYWRzL2NvZGUnLFxuICAgIGkxOG5fZGlyOiAnOmxhbmcnLFxuICAgIHNraXBfcmVuZGVyOiBbXSxcbiAgICAvLyBXcml0aW5nXG4gICAgbmV3X3Bvc3RfbmFtZTogJzp0aXRsZS5tZCcsXG4gICAgZGVmYXVsdF9sYXlvdXQ6ICdwb3N0JyxcbiAgICB0aXRsZWNhc2U6IGZhbHNlLFxuICAgIGV4dGVybmFsX2xpbms6IHtcbiAgICAgIGVuYWJsZTogdHJ1ZSxcbiAgICAgIGZpZWxkOiAnc2l0ZScsXG4gICAgICBleGNsdWRlOiAnJ1xuICAgIH0sXG4gICAgZmlsZW5hbWVfY2FzZTogMCxcbiAgICByZW5kZXJfZHJhZnRzOiBmYWxzZSxcbiAgICBwb3N0X2Fzc2V0X2ZvbGRlcjogZmFsc2UsXG4gICAgcmVsYXRpdmVfbGluazogZmFsc2UsXG4gICAgZnV0dXJlOiB0cnVlLFxuICAgIHN5bnRheF9oaWdobGlnaHRlcjogJ2hpZ2hsaWdodC5qcycsXG4gICAgaGlnaGxpZ2h0OiB7XG4gICAgICBhdXRvX2RldGVjdDogZmFsc2UsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJyxcbiAgICAgIHdyYXA6IHRydWUsXG4gICAgICBleGNsdWRlX2xhbmd1YWdlczogW10sXG4gICAgICBsYW5ndWFnZV9hdHRyOiBmYWxzZSxcbiAgICAgIGhsanM6IGZhbHNlXG4gICAgfSxcbiAgICBwcmlzbWpzOiB7XG4gICAgICBwcmVwcm9jZXNzOiB0cnVlLFxuICAgICAgbGluZV9udW1iZXI6IHRydWUsXG4gICAgICB0YWJfcmVwbGFjZTogJydcbiAgICB9LFxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgZGVmYXVsdF9jYXRlZ29yeTogJ3VuY2F0ZWdvcml6ZWQnLFxuICAgIGNhdGVnb3J5X21hcDoge30sXG4gICAgdGFnX21hcDoge30sXG4gICAgLy8gRGF0ZSAvIFRpbWUgZm9ybWF0XG4gICAgZGF0ZV9mb3JtYXQ6ICdZWVlZLU1NLUREJyxcbiAgICB0aW1lX2Zvcm1hdDogJ0hIOm1tOnNzJyxcbiAgICB1cGRhdGVkX29wdGlvbjogJ210aW1lJyxcbiAgICAvLyAqIG10aW1lOiBmaWxlIG1vZGlmaWNhdGlvbiBkYXRlIChkZWZhdWx0KVxuICAgIC8vICogZW1wdHk6IG5vIG1vcmUgdXBkYXRlXG4gICAgLy8gUGFnaW5hdGlvblxuICAgIHBlcl9wYWdlOiAxMCxcbiAgICBwYWdpbmF0aW9uX2RpcjogJ3BhZ2UnLFxuICAgIC8vIEV4dGVuc2lvbnNcbiAgICB0aGVtZTogJ2xhbmRzY2FwZScsXG4gICAgc2VydmVyOiB7XG4gICAgICBjYWNoZTogZmFsc2VcbiAgICB9LFxuICAgIC8vIERlcGxveW1lbnRcbiAgICBkZXBsb3k6IHt9LFxuXG4gICAgLy8gaWdub3JlIGZpbGVzIGZyb20gcHJvY2Vzc2luZ1xuICAgIGlnbm9yZTogW10sXG5cbiAgICAvLyBDYXRlZ29yeSAmIFRhZ1xuICAgIG1ldGFfZ2VuZXJhdG9yOiB0cnVlXG4gIH07XG4gIGNvbnN0IHNiZ0RlZmF1bHRDb25maWcgPSB7XG4gICAgY3dkOiB0b1VuaXgodHJ1ZUNhc2VQYXRoU3luYyhwcm9jZXNzLmN3ZCgpKSlcbiAgfTtcbiAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShnZXREZWZhdWx0Q29uZmlnWWFtbCgpKTtcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oaGV4b0RlZmF1bHRDb25maWcsIHNiZ0RlZmF1bHRDb25maWcsIGNvbmZpZ1lNTCkgYXMgdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcbn1cblxuLyoqXG4gKiBnZXQgZGVmYXVsdCBfY29uZmlnLnltbFxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRDb25maWdZYW1sKCkge1xuICByZXR1cm4gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZy55bWwnKSwgJ3V0Zi04Jyk7XG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport * as yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:name/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/0f/defaults_0ff471d7851e1315103153ae541c865c.map","wrapperLength":82},"result":{"scriptId":"12937","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":10548,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":10545,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":29},{"startOffset":314,"endOffset":329,"count":0},{"startOffset":346,"endOffset":366,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":409,"endOffset":436,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":1},{"startOffset":889,"endOffset":900,"count":0},{"startOffset":962,"endOffset":1063,"count":29}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":1451,"endOffset":3888,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3981,"endOffset":4105,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQXFDO0FBQ3JDLHlCQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsOENBQXdCO0FBQ3hCLDREQUFrRDtBQUNsRCxzREFBZ0M7QUFFaEMsdUVBQWlEO0FBQ2pELGlDQUErQztBQUMvQywwREFBb0M7QUFDcEMscUNBQXNDO0FBRXRDOzs7OztHQUtHO0FBQ0gsU0FBZ0IsWUFBWSxDQUFDLEtBQW9ELEVBQUUsR0FBK0I7SUFBbEgsaUJBOEdDOztJQTdHQyxJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFVBQVUsR0FBRyxPQUFPLEdBQUcsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDM0UsSUFBTSxPQUFPLEdBQUcscUJBQVUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFbkQsd0JBQXdCO0lBQ3hCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQztJQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUU7UUFDbEMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQVUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO0tBQzFFO0lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRTtRQUMzQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGdCQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8s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LEdBQUcsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUN0QyxhQUFhO3dCQUNiLElBQUksRUFBRSxDQUFDOzs7O2FBQ1IsQ0FBQyxDQUNIO2FBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztLQUNoQztTQUFNO1FBQ0wsSUFBTSxPQUFPLEdBQUcsSUFBQSxzQkFBaUIsRUFBQyxjQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUseUJBQXlCLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sT0FBTyxDQUFDO0tBQ2hCO0FBQ0gsQ0FBQztBQTlHRCxvQ0E4R0M7QUFFRCxnQ0FBZ0M7QUFDaEMsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zYWZlbGluay50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBzZiwgeyBTYWZlbGlua09wdGlvbnMgfSBmcm9tICdzYWZlbGlua2lmeSc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgU3JjT3B0aW9ucyB9IGZyb20gJ3ZpbnlsLWZzJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCB7IGNyZWF0ZVdyaXRlU3RyZWFtIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogUHJvY2VzcyBTYWZlbGluayBvbiBEZXBsb3kgRGlyXG4gKiBAcGFyYW0gX2RvbmUgY2FsbGJhY2sgZnVuY3Rpb25cbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2FmZWxpbmsoX2RvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkPzogdW5kZWZpbmVkIHwgbnVsbCB8IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3Qgd29ya2luZ0RpciA9IHR5cGVvZiBjd2QgPT09ICdzdHJpbmcnID8gY3dkIDogY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGxvZ25hbWUgPSBhbnNpQ29sb3JzLmdyZWVuQnJpZ2h0KCdzYWZlbGluaycpO1xuXG4gIC8vIHNraXAgcHJvY2VzcyBzYWZlbGlua1xuICBsZXQgaGFzRXJyb3IgPSBmYWxzZTtcbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluaykge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdjb25maWcgc2FmZWxpbmsnLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5yZWRpcmVjdCkge1xuICAgIGhhc0Vycm9yID0gdHJ1ZTtcbiAgICBMb2dnZXIubG9nKGxvZ25hbWUsICdzYWZlbGluayByZWRpcmVjdG9yJywgYW5zaUNvbG9ycy5yZWQoJ25vdCBjb25maWd1cmVkJykpO1xuICB9XG4gIGlmICghY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsuZW5hYmxlKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgYW5zaUNvbG9ycy5yZWQoJ2Rpc2FibGVkJykpO1xuICB9XG5cbiAgaWYgKGV4aXN0c1N5bmMod29ya2luZ0RpcikgJiYgIWhhc0Vycm9yKSB7XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZ1NhZmVsaW5rOiBTYWZlbGlua09wdGlvbnMgJiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge1xuICAgICAgZW5hYmxlOiBmYWxzZSxcbiAgICAgIGV4Y2x1ZGU6IFtdIGFzIHN0cmluZ1tdLFxuICAgICAgcmVkaXJlY3Q6ICdodHRwczovL3d3dy53ZWJtYW5hamVtZW4uY29tL3BhZ2Uvc2FmZWxpbmsuaHRtbD91cmw9JyxcbiAgICAgIHBhc3N3b3JkOiAncm9vdCcsXG4gICAgICB0eXBlOiAnYmFzZTY0J1xuICAgIH07XG4gICAgY29uc3QgY29uZmlnU2FmZWxpbmsgPSBPYmplY3QuYXNzaWduKGRlZmF1bHRDb25maWdTYWZlbGluaywgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsgfHwge30pO1xuICAgIGxldCBiYXNlVVJMID0gJyc7XG4gICAgdHJ5IHtcbiAgICAgIGJhc2VVUkwgPSBuZXcgVVJMKGNvbmZpZy51cmwpLmhvc3Q7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvL1xuICAgIH1cblxuICAgIGNvbnN0IG9wdDogUGFydGlhbDxTYWZlbGlua09wdGlvbnM+ID0ge1xuICAgICAgLy8gZXhjbHVkZSBwYXR0ZXJucyAoZG9udCBhbm9ueW1pemUgdGhlc2UgcGF0dGVybnMpXG4gICAgICBleGNsdWRlOiBbXG4gICAgICAgIC4uLihjb25maWcuZXh0ZXJuYWxfbGluaz8uZXhjbHVkZSB8fCBbXSksXG4gICAgICAgIC9odHRwcz86XFwvXFwvPyg/OihbXipdKylcXC4pP3dlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIC8oW2EtejAtOV0oPzpbYS16MC05LV17MSw2MX1bYS16MC05XSk/Wy5dKSp3ZWJtYW5hamVtZW5cXC5jb20vLFxuICAgICAgICBiYXNlVVJMLFxuICAgICAgICAnd3d3LndlYm1hbmFqZW1lbi5jb20nLFxuICAgICAgICAnaHR0cHM6Ly9naXRodWIuY29tL2RpbWFzbGFuamFrYScsXG4gICAgICAgICdodHRwczovL2ZhY2Vib29rLmNvbS9kaW1hc2xhbmpha2ExJyxcbiAgICAgICAgJ2RpbWFzbGFuamFrYS5naXRodWIuaW8nLFxuICAgICAgICAuLi5jb25maWdTYWZlbGluay5leGNsdWRlXG4gICAgICBdLmZpbHRlcihmdW5jdGlvbiAoeCwgaSwgYSkge1xuICAgICAgICAvLyByZW1vdmUgZHVwbGljYXRlIGFuZCBlbXB0aWVzXG4gICAgICAgIHJldHVybiBhLmluZGV4T2YoeCkgPT09IGkgJiYgeC50b1N0cmluZygpLnRyaW0oKS5sZW5ndGggIT09IDA7XG4gICAgICB9KSxcbiAgICAgIHJlZGlyZWN0OiBbXSxcbiAgICAgIC8vcmVkaXJlY3Q6IFssIGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0XSxcbiAgICAgIHBhc3N3b3JkOiBjb25maWdTYWZlbGluay5wYXNzd29yZCB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5wYXNzd29yZCxcbiAgICAgIHR5cGU6IGNvbmZpZ1NhZmVsaW5rLnR5cGUgfHwgY29uZmlnLmV4dGVybmFsX2xpbmsuc2FmZWxpbmsudHlwZVxuICAgIH07XG5cbiAgICBpZiAoY29uZmlnU2FmZWxpbmsucmVkaXJlY3QpIHtcbiAgICAgIG9wdC5yZWRpcmVjdCA9IGNvbmZpZ1NhZmVsaW5rLnJlZGlyZWN0O1xuICAgIH1cblxuICAgIGNvbnN0IHNhZmVsaW5rID0gbmV3IHNmLnNhZmVsaW5rKG9wdCk7XG5cbiAgICBjb25zdCBndWxwb3B0OiBTcmNPcHRpb25zID0ge1xuICAgICAgY3dkOiB3b3JraW5nRGlyLFxuICAgICAgaWdub3JlOiBbXVxuICAgIH07XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKSkge1xuICAgICAgZ3VscG9wdC5pZ25vcmU/LmNvbmNhdCguLi5jb25maWcuZXh0ZXJuYWxfbGluay5leGNsdWRlKTtcbiAgICB9XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnU2FmZWxpbmsuZXhjbHVkZSkpIHtcbiAgICAgIGNvbnN0IGlnbm9yZSA9IGNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGUuZmlsdGVyKChzdHIpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzdHIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcmV0dXJuICEvXihodHRwcz86XFwvfHd3dy4pLy50ZXN0KHN0cik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSkgYXMgc3RyaW5nW107XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmlnbm9yZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGd1bHBcbiAgICAgIC5zcmMoWycqKi8qLntodG1sLGh0bX0nXSwgZ3VscG9wdClcbiAgICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2FmZWxpbmsnIH0pKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHRocm91Z2gyLm9iaihhc3luYyAoZmlsZSwgX2VuYywgbmV4dCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3BzXG4gICAgICAgICAgaWYgKGZpbGUuaXNOdWxsKCkgfHwgZmlsZS5pc0RpcmVjdG9yeSgpIHx8ICFmaWxlIHx8IGZpbGUuaXNTdHJlYW0oKSkgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgICAvLyBwcm9jZXNzXG4gICAgICAgICAgaWYgKGZpbGUuaXNCdWZmZXIoKSAmJiBCdWZmZXIuaXNCdWZmZXIoZmlsZS5jb250ZW50cykpIHtcbiAgICAgICAgICAgIC8vIGRvIHNhZmVsaW5raWZ5XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZmlsZS5jb250ZW50cy50b1N0cmluZygndXRmLTgnKTtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IGF3YWl0IHNhZmVsaW5rLnBhcnNlKGNvbnRlbnQpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJzZWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIC8vIExvZ2dlci5sb2cocGFyc2VkKTtcbiAgICAgICAgICAgICAgZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKHBhcnNlZCk7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0KG51bGwsIGZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcGFyc2UnLCBmaWxlLnBhdGgpO1xuICAgICAgICAgIC8vIGRyb3AgZmFpbHNcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAucGlwZShndWxwLmRlc3Qod29ya2luZ0RpcikpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHdzdHJlYW0gPSBjcmVhdGVXcml0ZVN0cmVhbShwYXRoLmpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9lcnJvcnMvc2FmZWxpbmsubG9nJykpO1xuICAgIHJldHVybiB3c3RyZWFtO1xuICB9XG59XG5cbi8vIHNhZmVsaW5raWZ5IHRoZSBkZXBsb3kgZm9sZGVyXG5ndWxwLnRhc2soJ3NhZmVsaW5rJywgdGFza1NhZmVsaW5rKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4c/gulpsafelink_4c61ebd17a40a0e391c444500ad6c5a4.map","wrapperLength":82},"result":{"scriptId":"12941","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21175,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zZW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLHVFQUFpRDtBQUNqRCwwREFBb0M7QUFDcEMscUNBQWtFO0FBRWxFOzs7R0FHRztBQUNILFNBQWdCLE9BQU8sQ0FBQyxLQUFtRCxFQUFFLEdBQVc7SUFDdEYsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxNQUFNLEdBQWEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUM3RSxNQUFNLENBQUMsSUFBSSxPQUFYLE1BQU0sMkJBQVMsc0JBQVksV0FBRTtJQUM3QixPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxjQUFjLENBQUMsRUFBRSxFQUFFLEdBQUcsS0FBQSxFQUFFLE1BQU0sUUFBQSxFQUFFLENBQUM7U0FDekQsSUFBSSxDQUFDLElBQUEsb0JBQVUsRUFBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ2pDLElBQUksQ0FDSCxJQUFBLGtCQUFPLEVBQUMsVUFBVSxJQUFJO1FBQWQsaUJBMkJQO1FBMUJDLGlCQUFpQjtRQUNqQixJQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFFO1lBQ2hCLElBQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDNUIsSUFBTSxLQUFLLEdBQUcsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFLLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRLENBQUM7Z0JBQ3RFLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9CO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxtQkFBbUI7UUFDbkIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztRQUNqRSxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNqQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDO2dCQUN4RSxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQzthQUNqQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0JBQWdCO1FBQ2hCLFdBQVc7UUFDWCxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNqQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBVSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxjQUFPLEVBQUUsQ0FBQyxNQUFNLGVBQUssSUFBSSxDQUFFLENBQUMsQ0FBQztTQUM1RTtJQUNILENBQUMsQ0FBQyxDQUNIO1NBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMxQixDQUFDO0FBdENELDBCQXNDQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO0lBQ1AsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLE9BQU8sT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNlby50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5zaUNvbG9ycyBmcm9tICdhbnNpLWNvbG9ycyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBndWxwRG9tIGZyb20gJ2d1bHAtZG9tJztcbmltcG9ydCBndWxwQ2FjaGVkIGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBkZXBsb3lDb25maWcsIGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogQXV0byBzZW8gcnVubmVyXG4gKiBAcGFyYW0gY3dkIHdvcmtpbmcgZGlyZWN0b3J5IHRvIHNjYW4gaHRtbCdzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YXNrU2VvKF9kb25lOiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgbnVsbCB8IHVuZGVmaW5lZCwgY3dkOiBzdHJpbmcpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGlnbm9yZTogc3RyaW5nW10gPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdWRlKSA/IGNvbmZpZy5leGNsdWRlIDogW107XG4gIGlnbm9yZS5wdXNoKC4uLmNvbW1vbklnbm9yZSk7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoue2h0bSxodG1sfScsICcqLntodG1sLGh0bX0nXSwgeyBjd2QsIGlnbm9yZSB9KVxuICAgIC5waXBlKGd1bHBDYWNoZWQoeyBuYW1lOiAnc2VvJyB9KSlcbiAgICAucGlwZShcbiAgICAgIGd1bHBEb20oZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgLy8gZml4IGFsdCBpbWFnZXNcbiAgICAgICAgY29uc3QgaW1hZ2VzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmNdJykpO1xuICAgICAgICBpbWFnZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ2FsdCcpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gQWx0JztcbiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnYWx0JywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZml4IHRpdGxlIGlmcmFtZVxuICAgICAgICBjb25zdCBpZnJhbWVzID0gQXJyYXkuZnJvbSh0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lmcmFtZVtzcmNdJykpO1xuICAgICAgICBpZnJhbWVzLmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgICAgY29uc3QgYWx0ID0gZWwuZ2V0QXR0cmlidXRlKCd0aXRsZScpO1xuICAgICAgICAgIGlmICghYWx0IHx8IGFsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gdGhpcy50aXRsZSArICcgLSAnICsgZWwuZ2V0QXR0cmlidXRlKCdzcmMnKSB8fCAnTm8gVGl0bGUnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCd0aXRsZScsIHRpdGxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdBUk5JTkcgTUFLRVJcbiAgICAgICAgLy8gY291bnQgSDFcbiAgICAgICAgY29uc3QgaDEgPSB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2gxJyk7XG4gICAgICAgIGlmIChoMS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyhhbnNpQ29sb3JzLnllbGxvd0JyaWdodCgnW1dBUk5dJyksIGBIMSAoJHtoMS5sZW5ndGh9KSAke3BhdGh9YCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgKVxuICAgIC5waXBlKGd1bHAuZGVzdChjd2QpKTtcbn1cblxuZ3VscC50YXNrKCdzZW8nLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgcmV0dXJuIHRhc2tTZW8obnVsbCwgZGVwbG95RGlyKTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/e0/gulpseo_e04b91fb9cd501fddd96cd3618e1374f.map","wrapperLength":82},"result":{"scriptId":"12990","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8792,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8789,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zdGFuZGFsb25lLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNERBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QixzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLDBEQUFvQztBQUNwQyx5Q0FBNkM7QUFDN0MscUNBQXNDO0FBRXRDOzs7R0FHRztBQUNILFNBQVMsZ0JBQWdCO0lBQ3ZCLGdCQUFNLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7SUFDaEQsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxxQkFBcUIsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1NBQ2xHLElBQUksQ0FDSCxrQkFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFnQixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7Ozs7Ozt3QkFDM0MsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUN4RCxLQUFBLENBQUEsS0FBQSxnQkFBTSxDQUFBLENBQUMsR0FBRyxDQUFBOzt3QkFBUyxxQkFBTSxJQUFBLG9CQUFXLEVBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUE7O3dCQUFwRSxjQUFXLG1CQUFRLFNBQWlELEVBQUUsRUFBQyxDQUFDO3dCQUN4RSxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQ2xELEtBQUssR0FBRyxJQUFBLHFCQUFLLEVBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7d0JBQy9ELEtBQUssQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFOzRCQUNoQixZQUFZOzRCQUNaLElBQUksRUFBRSxDQUFDO3dCQUNULENBQUMsQ0FBQyxDQUFDOzs7OztLQUNKLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLElBQUEsWUFBSSxFQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7U0FDeEQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNYLGdCQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBRS9DLGtCQUFlLGdCQUFnQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuc3RhbmRhbG9uZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc3Bhd24gZnJvbSAnY3Jvc3Mtc3Bhd24nO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgdGhyb3VnaDIgZnJvbSAndGhyb3VnaDInO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgcmVwbGFjZVBhdGggfSBmcm9tICcuL3V0aWxzL3N0cmluZyc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIHJ1biBhbGwgXyouc3RhbmRhbG9uZS5qcyBpbnNpZGUgc3JjLXBvc3RzIChfY29uZmlnX3ltbC5wb3N0X2RpcilcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHN0YW5kYWxvbmVSdW5uZXIoKSB7XG4gIExvZ2dlci5sb2coJ1tzdGFuZGFsb25lXSBSdW5uaW5nIHNjcmlwdHMuLi5cXG4nKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAnKiovXyouc3RhbmRhbG9uZS5qcycpLCB7IGN3ZDogZ2V0Q29uZmlnKCkuY3dkLCBpZ25vcmU6IFsnKiovdG1wLyoqJ10gfSlcbiAgICAucGlwZShcbiAgICAgIHRocm91Z2gyLm9iaihhc3luYyBmdW5jdGlvbiAoZmlsZSwgX2VuYywgbmV4dCkge1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBpbnB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBMb2dnZXIubG9nKGBub2RlICR7YXdhaXQgcmVwbGFjZVBhdGgoZmlsZS5wYXRoLCBnZXRDb25maWcoKS5jd2QsICcnKX1gKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnPScucmVwZWF0KDEwKSArICcgb3VwdXQgJyArICc9Jy5yZXBlYXQoMTApKTtcbiAgICAgICAgY29uc3QgY2hpbGQgPSBzcGF3bignbm9kZScsIFtmaWxlLnBhdGhdLCB7IHN0ZGlvOiAnaW5oZXJpdCcgfSk7XG4gICAgICAgIGNoaWxkLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAvLyBkcm9wIGZpbGVcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCAndG1wL3N0YW5kYWxvbmUnKSkpXG4gICAgLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIExvZ2dlci5sb2coJ1xcbltzdGFuZGFsb25lXSBzdG9wcGVkJyk7XG4gICAgfSk7XG59XG5cbmd1bHAudGFzaygncG9zdDpzdGFuZGFsb25lJywgc3RhbmRhbG9uZVJ1bm5lcik7XG5cbmV4cG9ydCBkZWZhdWx0IHN0YW5kYWxvbmVSdW5uZXI7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/4b/gulpstandalone_4b97cf5f5ca3169df9a2ad9287d555ef.map","wrapperLength":82},"result":{"scriptId":"13447","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8832,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8829,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5zaXRlbWFwLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBZ0M7QUFDaEMscUNBQXdDO0FBQ3hDLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXVDO0FBQ3ZDLHVDQUF5QztBQUN6QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHlCQUF5QjtBQUN6QixtREFBc0Q7QUFDdEQsK0JBQTZCO0FBQzdCLHFDQUFxQztBQUNyQyx1Q0FBaUU7QUFDakUsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMsc0VBQStDO0FBQy9DLHFDQUErRDtBQUUvRDs7OztFQUlFO0FBQ0YsSUFBSSxRQUFRLEdBQUcsRUFBYyxDQUFDO0FBQzlCLElBQU0sT0FBTyxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7QUFDbEMsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUI7Ozs7O0dBS0c7QUFDSCxTQUFnQixlQUFlLENBQUMsR0FBK0IsRUFBRSxJQUFRO0lBQXpFLGlCQTZEQztJQTdEZ0UscUJBQUEsRUFBQSxRQUFRO0lBQ3ZFLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBb0M7UUFDdkQsSUFBTSxRQUFRLEdBQXlDLEVBQUUsQ0FBQztRQUMxRCxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsRUFBRTtZQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLENBQ1gsSUFBQSxxQ0FBbUIsRUFBQyxHQUFHLEVBQUU7Z0JBQ3ZCLElBQUksTUFBQTthQUNMLENBQUMsQ0FDSCxDQUFDO1NBQ0g7YUFBTTtZQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBQSxtQkFB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QztxQkFDMUQsSUFBSSxDQUNILElBQUEsa0JBQU8sRUFBQztvQkFDTix5QkFBeUI7b0JBQ3pCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sbUJBQWUsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO3dCQUN4RSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsNkJBQTJCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUMvRDt3QkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw2RkFBK0UsT0FBTyxxQkFBaUIsQ0FBQztxQkFDaEk7b0JBQ0QsdUVBQXVFO2dCQUN6RSxDQUFDLENBQUMsQ0FDSDtxQkFDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztxQkFDMUIsSUFBSSxDQUFDLEtBQUssRUFBRSxjQUFNLE9BQUEsT0FBTyxFQUFFLEVBQVQsQ0FBUyxDQUFDLENBQUM7WUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQWpHRCxrREFpR0M7QUFFRCxTQUFTLE9BQU8sQ0FBQyxJQUFZLEVBQUUsUUFBb0M7SUFDakUsT0FBTyxvQkFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO0lBQ25CLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQUMsT0FBTztRQUMxQixtQkFBbUIsRUFBRSxDQUFDLElBQUksQ0FBQztZQUN6QixPQUFPLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLnNpdGVtYXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBoZXhvIH0gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG1pY3JvbWF0Y2ggZnJvbSAnbWljcm9tYXRjaCc7XG5pbXBvcnQgbnVuanVja3MgZnJvbSAnbnVuanVja3MnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHsgc2l0ZW1hcENyYXdsZXJBc3luYyB9IGZyb20gJ3NpdGVtYXAtY3Jhd2xlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgeW9hc3RTZW8gfSBmcm9tICcuL3NpdGVtYXAnO1xuaW1wb3J0IHsgYXJyYXlfcmVtb3ZlX2VtcHR5LCBhcnJheV91bmlxdWUgfSBmcm9tICcuL3V0aWxzL2FycmF5JztcbmltcG9ydCB7IHdyaXRlZmlsZSB9IGZyb20gJy4vdXRpbHMvZm0nO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKlxuLy8gcmVhZCBleGlzdGluZyBzaXRlbWFwLnR4dFxuY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbmxldCBzaXRlbWFwcyA9IGV4aXN0c1N5bmMoc2l0ZW1hcFRYVCkgPyBhcnJheV9yZW1vdmVfZW1wdHkocmVhZEZpbGVTeW5jKHNpdGVtYXBUWFQsICd1dGYtOCcpLnNwbGl0KC9cXHI/XFxuL2dtKSkgOiBbXTtcbiovXG5sZXQgc2l0ZW1hcHMgPSBbXSBhcyBzdHJpbmdbXTtcbmNvbnN0IGNyYXdsZWQgPSBuZXcgU2V0PHN0cmluZz4oKTtcbmNvbnN0IGVudiA9IGVudk51bmp1Y2tzKCk7XG5cbi8qKlxuICogU2l0ZW1hcCBHZW5lcmF0b3JcbiAqIEBwYXJhbSB1cmwgdXJsIHRvIGNyYXdsXG4gKiBAcGFyYW0gZGVlcCBjcmF3bCBkZWVwZXIgbiB0aW1lc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2l0ZW1hcCh1cmw/OiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkLCBkZWVwID0gMCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoc2l0ZW1hcHM6IHN0cmluZ1tdKSA9PiBhbnkpID0+IHtcbiAgICBjb25zdCBwcm9taXNlczogQmx1ZWJpcmQ8UmVjb3JkPHN0cmluZywgc3RyaW5nW10+PltdID0gW107XG4gICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyh1cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjcmF3bGVkLmFkZChnZXRDb25maWcoKS51cmwpO1xuICAgICAgcHJvbWlzZXMucHVzaChcbiAgICAgICAgc2l0ZW1hcENyYXdsZXJBc3luYyhnZXRDb25maWcoKS51cmwsIHtcbiAgICAgICAgICBkZWVwXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICBCbHVlYmlyZC5hbGwocHJvbWlzZXMpXG4gICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICBjb25zdCBtYXBwZWQgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBzaXRlbWFwQ3Jhd2xlckFzeW5jPjtcbiAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChzaXRlbWFwKSA9PiB7XG4gICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gc2l0ZW1hcCkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gc2l0ZW1hcFtrZXldO1xuICAgICAgICAgICAgaWYgKGtleSBpbiBtYXBwZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1hcHBlZFtrZXldID0gdmFsdWVzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSBhcnJheV91bmlxdWUodmFsdWVzLmNvbmNhdChtYXBwZWRba2V5XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICBjb25zdCBzYXZldG8gPSBqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAuanNvbicpO1xuICAgICAgICB3cml0ZWZpbGUoc2F2ZXRvLCBKU09OLnN0cmluZ2lmeShtYXBwZWQsIG51bGwsIDIpKTtcblxuICAgICAgICAvLyByZXR1cm5cbiAgICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICAgIH0pXG4gICAgICAudGhlbihhc3luYyAocmVzdWx0cykgPT4ge1xuICAgICAgICBzaXRlbWFwcyA9IGFycmF5X3VuaXF1ZShhcnJheV9yZW1vdmVfZW1wdHkoT2JqZWN0LnZhbHVlcyhyZXN1bHRzKS5mbGF0KDEpLmNvbmNhdChzaXRlbWFwcykpKS5zb3J0KGZ1bmN0aW9uIChcbiAgICAgICAgICBhLFxuICAgICAgICAgIGJcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA8IGIgPyAtMSA6IDE7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGVlcDsgaSsrKSB7XG4gICAgICAgICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHNpdGVtYXBzLmxlbmd0aDsgaWkrKykge1xuICAgICAgICAgICAgY29uc3QgdXJsID0gc2l0ZW1hcHNbaWldO1xuICAgICAgICAgICAgaWYgKGNyYXdsZWQuaGFzKHVybCkgfHwgLy4oanN8dHN8Y3NzfHNjc3N8dHh0fHBkZnxwbmd8anBlP2d8Z2lmfHdlYnApJC9naS50ZXN0KHVybCkpIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICBjcmF3bGVkLmFkZCh1cmwpO1xuICAgICAgICAgICAgTG9nZ2VyLmxvZygnW2RlcHRoXScsIGlpLCB1cmwpO1xuICAgICAgICAgICAgYXdhaXQgZ2VuZXJhdGVTaXRlbWFwKHVybCwgZGVlcCkudGhlbigoKSA9PiB3cml0ZVNpdGVtYXAoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgd3JpdGVTaXRlbWFwKHJlc29sdmUpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG4vKipcbiAqIHdyaXRlIHRoZSBzaXRlbWFwXG4gKiBAcGFyYW0gY2FsbGJhY2tcbiAqL1xuZnVuY3Rpb24gd3JpdGVTaXRlbWFwKGNhbGxiYWNrPzogKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnkpIHtcbiAgbGV0IGNiID0gbm9vcDtcbiAgaWYgKGNhbGxiYWNrKSBjYiA9ICgpID0+IGNhbGxiYWNrKHNpdGVtYXBzKTtcbiAgY29uc3Qgc2l0ZW1hcFRYVCA9IGpvaW4oZ2V0Q29uZmlnKCkuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyIHx8ICdwdWJsaWMnLCAnc2l0ZW1hcC50eHQnKTtcbiAgd3JpdGVmaWxlKHNpdGVtYXBUWFQsIGFycmF5X3JlbW92ZV9lbXB0eShzaXRlbWFwcykuam9pbihFT0wpKTtcbiAgY2IuYXBwbHkodGhpcyk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZW1hcE9wdGlvbnMge1xuICBwYXRoOiBzdHJpbmdbXTtcbiAgdGFnczogYm9vbGVhbjtcbiAgY2F0ZWdvcmllczogYm9vbGVhbjtcbiAgcmVsOiBib29sZWFuO1xuICB5b2FzdDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleG9HZW5lcmF0ZVNpdGVtYXAoKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBoZXhvKGdldENvbmZpZygpLmN3ZCk7XG4gICAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBlbnYuYWRkRmlsdGVyKCdmb3JtYXRVcmwnLCAoc3RyKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgY29uZmlnID0gc2V0Q29uZmlnKGluc3RhbmNlLmNvbmZpZyk7XG4gICAgICAgIC8vIGFzc2lnbiBkZWZhdWx0IGNvbmZpZ1xuICAgICAgICBjb25zdCBzaXRlbWFwOiBTaXRlbWFwT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAgeyByZWw6IGZhbHNlLCB0YWdzOiBmYWxzZSwgY2F0ZWdvcmllczogZmFsc2UsIHBhdGg6IFsnc2l0ZW1hcC50eHQnLCAnc2l0ZW1hcC54bWwnXSB9LFxuICAgICAgICAgIGNvbmZpZy5zaXRlbWFwXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gQnVpbGQgWW9hc3QgU0VPIHNpdGVtYXBcbiAgICAgICAgLy8gd2hlbiBjb25maWcueW9hc3QgZGVmaW5lZFxuICAgICAgICBpZiAoc2l0ZW1hcC55b2FzdCkge1xuICAgICAgICAgIHJldHVybiB5b2FzdFNlbyhpbnN0YW5jZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNvbmZpZy5zaXRlbWFwKSByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIGNvbnN0IGxvY2FscyA9IGluc3RhbmNlLmxvY2FscztcbiAgICAgICAgY29uc3QgeyBza2lwX3JlbmRlciB9ID0gY29uZmlnO1xuXG4gICAgICAgIGlmICghc2l0ZW1hcC50YWdzIHx8ICFzaXRlbWFwLmNhdGVnb3JpZXMpIHtcbiAgICAgICAgICByZXR1cm4gTG9nZ2VyLmxvZygnW3NpdGVtYXBdIGNvbmZpZy5zaXRlbWFwLnRhZ3Mgb3IgY29uZmlnLnNpdGVtYXAuY2F0ZWdvcmllcyBub3QgY29uZmlndXJlZCBpbiBfY29uZmlnLnltbCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNraXBSZW5kZXJMaXN0ID0gWycqKi8qLmpzJywgJyoqLyouY3NzJywgJyoqLy5naXQqJ107XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2tpcF9yZW5kZXIpKSB7XG4gICAgICAgICAgc2tpcFJlbmRlckxpc3QucHVzaCguLi5za2lwX3JlbmRlcik7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNraXBfcmVuZGVyID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGlmIChza2lwX3JlbmRlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKHNraXBfcmVuZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwb3N0cyA9IFsuLi5sb2NhbHMuZ2V0KCdwYWdlcycpLnRvQXJyYXkoKSwgLi4ubG9jYWxzLmdldCgncG9zdHMnKS50b0FycmF5KCldXG4gICAgICAgICAgLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBvc3Quc2l0ZW1hcCAhPT0gZmFsc2UgJiYgIWlzTWF0Y2gocG9zdC5zb3VyY2UsIHNraXBSZW5kZXJMaXN0KTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgICBpZiAoYi51cGRhdGVkICYmIGEudXBkYXRlZCkgcmV0dXJuIGIudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCkgLSBhLnVwZGF0ZWQudG9EYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHBvc3RzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRtcGxTcmMgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBudW5qdWNrcy5jb21waWxlKHJlYWRGaWxlU3luYyh0bXBsU3JjLCAndXRmLTgnKSwgZW52KTtcbiAgICAgICAgY29uc3QgeyB0YWdzOiB0YWdzQ2ZnLCBjYXRlZ29yaWVzOiBjYXRzQ2ZnLCByZWw6IHJlbENmZyB9ID0gc2l0ZW1hcDtcbiAgICAgICAgbGV0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBzTm93OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHRhZ3M6IHRhZ3NDZmcgPyBsb2NhbHMuZ2V0KCd0YWdzJykudG9BcnJheSgpIDogW10sXG4gICAgICAgICAgY2F0ZWdvcmllczogY2F0c0NmZyA/IGxvY2Fscy5nZXQoJ2NhdGVnb3JpZXMnKS50b0FycmF5KCkgOiBbXVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZW1vdmUgYmxhbmsgbmV3bGluZXNcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxccypbXFxyXFxuXS9nbSwgJ1xcbicpO1xuXG4gICAgICAgIC8vZGF0YSA9IHByZXR0aWVyLmZvcm1hdChkYXRhLCB7IHBhcnNlcjogJ3htbCcsIHBsdWdpbnM6IFt4bWxwbHVnaW5dLCBlbmRPZkxpbmU6ICdsZicgfSk7XG5cbiAgICAgICAgLy8gZHVtcFxuICAgICAgICB3cml0ZWZpbGUoam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wL2R1bXAvc2l0ZW1hcC9zaXRlbWFwLnhtbCcpLCBkYXRhKTtcblxuICAgICAgICAvLyB3cml0ZVxuICAgICAgICBjb25zdCBzaXRlbWFwWG1sID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnc2l0ZW1hcC54bWwnKTtcbiAgICAgICAgd3JpdGVmaWxlKHNpdGVtYXBYbWwsIGRhdGEpO1xuICAgICAgICBpbnN0YW5jZS5sb2cuaW5mbygnc2l0ZW1hcCB3cml0dGVuJywgc2l0ZW1hcFhtbCk7XG5cbiAgICAgICAgaWYgKCFyZWxDZmcpIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcbiAgICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihnZXRDb25maWcoKS5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyKTtcbiAgICAgICAgZ3VscFxuICAgICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgLy8gYXV0byBkaXNjb3Zlcnkgc2l0ZW1hcFxuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIke2Jhc2VVUkx9c2l0ZW1hcC54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInNpdGVtYXAtc2l0ZS11cmxcIiB0eXBlPVwiYXBwbGljYXRpb24vdGV4dCt4bWxcIiByZWw9XCJzaXRlbWFwXCIgaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiIC8+YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IHJlc29sdmUoKSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGlzTWF0Y2gocGF0aDogc3RyaW5nLCBwYXR0ZXJuczogc3RyaW5nIHwgcmVhZG9ubHkgc3RyaW5nW10pIHtcbiAgcmV0dXJuIG1pY3JvbWF0Y2guaXNNYXRjaChwYXRoLCBwYXR0ZXJucyk7XG59XG5cbmd1bHAudGFzaygnc2l0ZW1hcCcsICgpID0+IHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGhleG9HZW5lcmF0ZVNpdGVtYXAoKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/3c/gulpsitemap_3c8d9f84ead1fc6d91aa70a109950e6b.map","wrapperLength":82},"result":{"scriptId":"13452","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33956,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33953,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscGZpbGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOENBQXdCO0FBQ3hCLHVDQUFrQztBQUNsQywrQkFBNkI7QUFDN0Isd0JBQXNCO0FBQ3RCLHlCQUF1QjtBQUN2Qix1QkFBcUI7QUFDckIsMkJBQXlCO0FBQ3pCLHNCQUFvQjtBQUNwQix1QkFBcUI7QUFDckIsNkJBQTJCO0FBQzNCLDBEQUFvQztBQUVwQyx5QkFBeUI7QUFDekIsU0FBZ0IsYUFBYSxDQUFDLE1BQWlDO0lBQzdELElBQU0sT0FBTyxHQUFHLENBQUMsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFdBQVcsQ0FBQyxFQUFFLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxRQUFRLENBQUMsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqRyxJQUFNLE1BQU0sR0FBRztRQUNiLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUFFLE9BQU8sTUFBTSxFQUFFLENBQUM7UUFDckMsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLElBQU0sR0FBRyxHQUFHO1lBQ1YsR0FBRyxFQUFFLE1BQU07WUFDWCxLQUFLLEVBQUUsU0FBUztTQUNqQixDQUFDO1FBQ0YsT0FBTyxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFPLEdBQUcsQ0FBQzthQUN6QyxJQUFJLENBQUMsY0FBTSxPQUFBLElBQUEsaUJBQUssRUFBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQU8sR0FBRyxDQUFDLEVBQWhFLENBQWdFLENBQUM7YUFDNUUsS0FBSyxDQUFDLFVBQUMsQ0FBQztZQUNQLElBQUksQ0FBQyxZQUFZLEtBQUs7Z0JBQUUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUM7YUFDRCxPQUFPLENBQUM7WUFDUCxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDaEIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztJQUNGLE9BQU8sTUFBTSxFQUFFLENBQUM7QUFDbEIsQ0FBQztBQXBCRCxzQ0FvQkM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBRTNDLGtCQUFlLGNBQUksQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwZmlsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5kZXBsb3knO1xuaW1wb3J0ICcuL2d1bHAuZmVlZCc7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgJy4vZ3VscC5zZW8nO1xuaW1wb3J0ICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgJy4vZ3VscC5zdGFuZGFsb25lJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuXG4vLyBjb21taXQgY3VycmVudCBwcm9qZWN0XG5leHBvcnQgZnVuY3Rpb24gY29tbWl0UHJvamVjdChmaW5pc2g6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgZ2l0RGlycyA9IFtqb2luKHByb2Nlc3MuY3dkKCksICdzcmMtcG9zdHMnKSwgam9pbihwcm9jZXNzLmN3ZCgpLCAnc291cmNlJyksIHByb2Nlc3MuY3dkKCldO1xuICBjb25zdCBjb21taXQgPSAoKSA9PiB7XG4gICAgaWYgKCFnaXREaXJzLmxlbmd0aCkgcmV0dXJuIGZpbmlzaCgpO1xuICAgIGNvbnN0IGdpdERpciA9IGdpdERpcnNbMF07XG4gICAgY29uc3Qgb3B0ID0ge1xuICAgICAgY3dkOiBnaXREaXIsXG4gICAgICBzdGRpbzogJ2luaGVyaXQnXG4gICAgfTtcbiAgICByZXR1cm4gc3Bhd24oJ2dpdCcsIFsnYWRkJywgJy1BJ10sIDxhbnk+b3B0KVxuICAgICAgLnRoZW4oKCkgPT4gc3Bhd24oJ2dpdCcsIFsnY29tbWl0JywgJy1tJywgJ3VwZGF0ZSAnICsgbmV3IERhdGUoKV0sIDxhbnk+b3B0KSlcbiAgICAgIC5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEVycm9yKSBMb2dnZXIubG9nKGUubWVzc2FnZSwgZ2l0RGlyKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGdpdERpcnMuc2hpZnQoKTtcbiAgICAgICAgY29tbWl0KCk7XG4gICAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIGNvbW1pdCgpO1xufVxuXG5ndWxwLnRhc2soJ3Byb2plY3QtY29tbWl0JywgY29tbWl0UHJvamVjdCk7XG5cbmV4cG9ydCBkZWZhdWx0IGd1bHA7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/49/gulpfile_49358b99439a29678d73729f1ed5c86f.map","wrapperLength":82},"result":{"scriptId":"13801","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4983,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4980,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5kZXBsb3kudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMseUJBQWdDO0FBQ2hDLDBFQUEwRDtBQUMxRCx1REFBMkQ7QUFDM0QsOENBQWtEO0FBQ2xELG9FQUFxQztBQUNyQywrQkFBcUM7QUFDckMsd0JBQXNCO0FBQ3RCLDJCQUF5QjtBQUN6QiwwREFBb0M7QUFDcEMscUNBQW9EO0FBRXBEOzs7R0FHRztBQUNILFNBQWdCLE9BQU87SUFDYixJQUFBLFNBQVMsR0FBSyxJQUFBLHNCQUFZLEdBQUUsVUFBbkIsQ0FBb0I7SUFDckMsSUFBTSxTQUFTLEdBQUcsSUFBQSxZQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzlELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLHFCQUFxQixDQUFDLEVBQUU7UUFDaEUsR0FBRyxFQUFFLFNBQVM7UUFDZCxHQUFHLEVBQUUsSUFBSTtLQUNWLENBQUM7U0FDRCxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztTQUMxQixFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBVkQsMEJBVUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixZQUFZO0lBQzFCLE9BQU8sSUFBSSxrQkFBUSxDQUFDLFVBQVUsT0FBTztRQUNuQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQixD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QVc7SUFDNUIsT0FBTyxJQUFBLGNBQU0sRUFBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBQSxjQUFNLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDeEQsQ0FBQztBQUVELFNBQVM7QUFDVCxjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3JjL2d1bHAuZGVwbG95LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyBnaXRIZWxwZXIgfSBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IHsgc3Bhd25Bc3luYyB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlci9kaXN0L3NwYXduJztcbmltcG9ydCBndWxwLCB7IFRhc2tGdW5jdGlvbkNhbGxiYWNrIH0gZnJvbSAnZ3VscCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5pbXBvcnQgeyBqb2luLCB0b1VuaXggfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb3B5R2VuKCkge1xuICBjb25zdCB7IGRlcGxveURpciB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgZ2V0Q29uZmlnKCkucHVibGljX2Rpcik7XG4gIHJldHVybiBndWxwXG4gICAgLnNyYyhbJyoqLyoqJywgJyEqKi8uZ2l0KicsICchKiovdG1wLyoqJywgJyEqKi9ub2RlX21vZHVsZXMvKionXSwge1xuICAgICAgY3dkOiBwdWJsaWNEaXIsXG4gICAgICBkb3Q6IHRydWVcbiAgICB9KVxuICAgIC5waXBlKGd1bHAuZGVzdChkZXBsb3lEaXIpKVxuICAgIC5vbignZXJyb3InLCBjb25zb2xlLnRyYWNlKTtcbn1cblxuLyoqXG4gKiBhc3luY2hyb25vdXMgY29weSBnZW5lcmF0ZWQgZmlsZXMgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIHRvIGRlcGxveSBkaXIgKHJ1biBhZnRlciBnZW5lcmF0ZWQpXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gYXN5bmNDb3B5R2VuKCkge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKGZ1bmN0aW9uIChyZXNvbHZlKSB7XG4gICAgY29weUdlbigpLm9uY2UoJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4vLyBjb3B5IHB1YmxpYyB0byAuZGVwbG95X2dpdFxuZ3VscC50YXNrKCdkZXBsb3k6Y29weScsIGNvcHlHZW4pO1xuXG4vKipcbiAqIGdpdCBwdWxsIG9uIGRlcGxveSBkaXJcbiAqIEBwYXJhbSBkb25lXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHB1bGwoZG9uZTogVGFza0Z1bmN0aW9uQ2FsbGJhY2spIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGN3ZCA9IGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyO1xuICBjb25zdCBnaCA9IGNvbmZpZy5kZXBsb3kuZ2l0aHViO1xuICBjb25zdCBkb1B1bGwgPSBhc3luYyAoY3dkOiBzdHJpbmcpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydjb25maWcnLCAncHVsbC5yZWJhc2UnLCAnZmFsc2UnXSwge1xuICAgICAgICBjd2RcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIExvZ2dlci5sb2coZS5tZXNzYWdlLCBzdWIucm9vdCk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIExvZ2dlci5sb2coJ3B1bGxpbmcnLCBjd2QpO1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWydwdWxsJywgJy1YJywgJ3RoZWlycyddLCB7XG4gICAgICAgIGN3ZCxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgTG9nZ2VyLmxvZygnY2Fubm90IHB1bGwnLCBjd2QpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjbG9uZSA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWV4aXN0c1N5bmMoY3dkKSkge1xuICAgICAgYXdhaXQgc3Bhd25Bc3luYygnZ2l0JywgWy4uLidjbG9uZSAtYiBtYXN0ZXIgLS1zaW5nbGUtYnJhbmNoJy5zcGxpdCgnICcpLCBjb25maWcuZGVwbG95LnJlcG8sICcuZGVwbG95X2dpdCddLCB7XG4gICAgICAgIGN3ZDogX19kaXJuYW1lXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgYXdhaXQgY2xvbmUoKTtcbiAgZG9QdWxsKGN3ZCk7XG4gIGlmIChnaCkge1xuICAgIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaC5zdWJtb2R1bGUuZ2V0KCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJtb2R1bGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBzdWIgPSBzdWJtb2R1bGVzW2ldO1xuXG4gICAgICBkb1B1bGwoc3ViLnJvb3QpO1xuICAgIH1cbiAgfVxuICBkb25lKCk7XG59XG5cbmZ1bmN0aW9uIHN0YXR1cyhkb25lPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm47XG4gIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChzdGF0dXNlcykgPT4ge1xuICAgIHN0YXR1c2VzLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgbGV0IHN0ciA9ICcnO1xuXG4gICAgICBzd2l0Y2ggKGl0ZW0uY2hhbmdlcykge1xuICAgICAgICBjYXNlICdkZWxldGVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5yZWQoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnYWRkZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZWVuKGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ21vZGlmaWVkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy55ZWxsb3coaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAndW50cmFja2VkJzpcbiAgICAgICAgICBzdHIgKz0gYW5zaUNvbG9ycy5ncmV5KGl0ZW0uY2hhbmdlcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgc3RyICs9IGl0ZW0uY2hhbmdlcztcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgc3RyICs9ICcgJztcbiAgICAgIHN0ciArPSBpdGVtLnBhdGg7XG4gICAgICBMb2dnZXIubG9nKHN0cik7XG4gICAgfSk7XG5cbiAgICBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIGRvbmUoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbW1pdCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1YikgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgY29uc3Qgbm93ID0gbW9tZW50KCkudHooZ2V0Q29uZmlnKCkudGltZXpvbmUpLmZvcm1hdCgnTExMJyk7XG4gIGNvbnN0IGNvbW1pdFJvb3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBnaXRodWIuc3RhdHVzKCkudGhlbigoY2hhbmdlcykgPT4ge1xuICAgICAgICBMb2dnZXIubG9nKCdjaGFuZ2VzJywgY2hhbmdlcy5sZW5ndGgsIHRvVW5peChnaXRodWIuY3dkKS5yZXBsYWNlKHRvVW5peChwcm9jZXNzLmN3ZCgpKSwgJycpKTtcbiAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGdpdGh1Yi5hZGQoJy1BJykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBnaXRodWIuY29tbWl0KCd1cGRhdGUgc2l0ZSAnICsgbm93KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBjb21taXRTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSkge1xuICAgICAgICBjb25zdCBpbmZvID0gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICAgICAgY29uc3QgY29tbWl0U3VibW9kdWxlQ2hpbGQgPSBhc3luYyAoc3ViOiAodHlwZW9mIGluZm8pW251bWJlcl0pID0+IHtcbiAgICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBuZXcgZ2l0SGVscGVyKHN1Yi5yb290KTtcbiAgICAgICAgICBjb25zdCBpdGVtcyA9IGF3YWl0IHN1Ym1vZHVsZS5zdGF0dXMoKTtcbiAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmFkZCgnLUEnKTtcbiAgICAgICAgICAgIGF3YWl0IHN1Ym1vZHVsZS5jb21taXQoYHVwZGF0ZSAke3N1Yi5wYXRofSAke25vd31gLCAnYW0nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGl0ZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlSXQpID0+IHtcbiAgICAgICAgICAgIC8vIHJlc29sdmUgZGlyZWN0bHkgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm8gbWFkZSBjaGFuZ2VzXG4gICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPT09IDApIHJldHVybiByZXNvbHZlSXQobnVsbCk7XG4gICAgICAgICAgICBjb21taXRTdWJtb2R1bGVDaGlsZChpbmZvWzBdKVxuICAgICAgICAgICAgICAuY2F0Y2gobm9vcClcbiAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGluZm8uc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAvLyByZS1pdGVyYXRlIHdoZW4gc3VibW9kdWxlIGl0ZW1zIG5vdCBjb21taXR0ZWRcbiAgICAgICAgICAgICAgICBpZiAoaW5mby5sZW5ndGggPiAwKSByZXR1cm4gaXRlcmF0ZSgpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmVzIGFsbFxuICAgICAgICAgICAgICAgIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGl0ZXJhdGUoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb21taXRTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oY29tbWl0Um9vdClcbiAgICAgIC50aGVuKCgpID0+IHJlc29sdmUobnVsbCkpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbm9vcCgpIHtcbiAgLy9cbn1cblxuZnVuY3Rpb24gcHVzaCgpIHtcbiAgY29uc3QgeyBnaXRodWIgfSA9IGRlcGxveUNvbmZpZygpO1xuICBpZiAoIWdpdGh1Yikge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBzdWJtb2R1bGVzID0gZ2l0aHViLnN1Ym1vZHVsZS5oYXNTdWJtb2R1bGUoKSA/IGdpdGh1Yi5zdWJtb2R1bGUuZ2V0KCkgOiBbXTtcbiAgY29uc3QgcHVzaFN1Ym1vZHVsZSA9IGZ1bmN0aW9uIChzdWJtb2R1bGU6ICh0eXBlb2Ygc3VibW9kdWxlcylbbnVtYmVyXSkge1xuICAgIGNvbnN0IHsgdXJsLCBicmFuY2gsIHJvb3QgfSA9IHN1Ym1vZHVsZTtcbiAgICBpZiAoIXN1Ym1vZHVsZS5naXRodWIpIHtcbiAgICAgIHN1Ym1vZHVsZS5naXRodWIgPSBuZXcgZ2l0SGVscGVyKHJvb3QpO1xuICAgIH1cbiAgICBjb25zdCB7IGdpdGh1YiB9ID0gc3VibW9kdWxlO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgIGNvbnN0IHNldFIgPSAoKSA9PiBnaXRodWIuc2V0cmVtb3RlKHVybCk7XG4gICAgICBjb25zdCBzZXRCID0gKCkgPT4gZ2l0aHViLnNldGJyYW5jaChicmFuY2gpO1xuICAgICAgUHJvbWlzZS5hbGwoW3NldFIoKSwgc2V0QigpXSkudGhlbigoKSA9PiB7XG4gICAgICAgIGdpdGh1Yi5jYW5QdXNoKCkudGhlbigoYWxsb3dlZCkgPT4ge1xuICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKHJvb3QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgLy8gcHVzaCB0aGVuIHJlc29sdmVcbiAgICAgICAgICAgIGdpdGh1Yi5wdXNoKGZhbHNlLCB7IHN0ZGlvOiAncGlwZScgfSkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICdjaGFuZ2VzIG5vdCBzdGFnZWQnKTtcbiAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGNoYW5nZXMgbm90IHN0YWdlZFxuICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGdpdGh1Yi5pc1VwVG9EYXRlKCkudGhlbigodXBkYXRlZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgTG9nZ2VyLmxvZygnc3VibW9kdWxlJywgd29ya3NwYWNlKHJvb3QpLCAndXBkYXRlZCcsIHVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZSBpcyB1cCB0byBkYXRlXG4gICAgICAgICAgICAgICAgICByZXNvbHZlUHVzaChudWxsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBpdGVyYXRlU3VibW9kdWxlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgaWYgKHN1Ym1vZHVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzdWJtb2R1bGUgPSBzdWJtb2R1bGVzLnNoaWZ0KCk7XG4gICAgICAgIGlmIChzdWJtb2R1bGUpIHtcbiAgICAgICAgICBwdXNoU3VibW9kdWxlKHN1Ym1vZHVsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGl0ZXJhdGVTdWJtb2R1bGUoKS50aGVuKHJlc29sdmUpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGl0ZXJhdGVTdWJtb2R1bGUoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVQdXNoKSA9PiB7XG4gICAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgICBMb2dnZXIubG9nKHdvcmtzcGFjZShnaXRodWIuY3dkKSwgJ2NhbiBwdXNoJywgYWxsb3dlZCk7XG4gICAgICAgICAgICBpZiAoYWxsb3dlZCkge1xuICAgICAgICAgICAgICBnaXRodWIucHVzaCgpLnRoZW4ocmVzb2x2ZVB1c2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNvbHZlKTtcbiAgICAvL3B1c2hTdWJtb2R1bGUoc3VibW9kdWxlc1sxXSkudGhlbihyZXNvbHZlKTtcbiAgfSk7XG59XG5cbmd1bHAudGFzaygnZGVwbG95OnB1c2gnLCBwdXNoKTtcbmd1bHAudGFzaygnZGVwbG95OnN0YXR1cycsIHN0YXR1cyk7XG5ndWxwLnRhc2soJ2RlcGxveTpjb21taXQnLCBjb21taXQpO1xuZ3VscC50YXNrKCdkZXBsb3k6cHVsbCcsIHB1bGwpO1xuXG4vKipcbiAqIGdldCByZWxhdGl2ZSBwYXRoIGZyb20gd29ya3NwYWNlXG4gKiBAcGFyYW0gc3RyXG4gKiBAcmV0dXJuc1xuICovXG5mdW5jdGlvbiB3b3Jrc3BhY2Uoc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRvVW5peChzdHIpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJyk7XG59XG5cbi8vIGRlcGxveVxuZ3VscC50YXNrKCdkZXBsb3knLCBndWxwLnNlcmllcygnZGVwbG95OnB1bGwnLCAnZGVwbG95OmNvcHknLCAnc2FmZWxpbmsnLCAnZGVwbG95OmNvbW1pdCcsICdkZXBsb3k6cHVzaCcpKTtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/29/gulpdeploy_294088671a308604e99e2f253a1fa5cc.map","wrapperLength":82},"result":{"scriptId":"13802","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39671,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39668,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3N0YXRpYy1ibG9nLWdlbmVyYXRvci9zcmMvZ3VscC5mZWVkLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEseUJBQXVFO0FBQ3ZFLDhDQUF3QjtBQUN4QixzREFBK0I7QUFDL0IsOENBQXdCO0FBQ3hCLHVDQUFtRDtBQUNuRCxzREFBZ0M7QUFDaEMsK0JBQTZCO0FBQzdCLHNFQUErQztBQUMvQyxxQ0FBb0Q7QUFFcEQsSUFBTSxHQUFHLEdBQUcsSUFBQSxzQkFBVyxHQUFFLENBQUM7QUFFMUIsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsVUFBVSxJQUFJO0lBQzlCLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sUUFBUSxHQUFHLElBQUksY0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQ25CLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUFHO2dCQUM3QixPQUFPLHdCQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQztZQUVILFNBQVMsS0FBSyxDQUFDLE9BQTZCLEVBQUUsSUFBMEI7Z0JBQ3RFLElBQU0sUUFBUSxHQUFHLGtCQUFRLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQVksRUFBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRXZFLElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUN6QyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUIsS0FBSyxHQUFHLEtBQUssQ0FB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SSxDQUFDLFNBQVMsSUFBSSwwRkFBNEUsT0FBTyxpQkFBYSxDQUFDO2lCQUN6SDtnQkFDRCxzQkFBc0I7Z0JBQ3RCLElBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHNCQUFjLE9BQU8sZ0JBQVksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDO29CQUNyRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsMEJBQXdCLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUM1RDtvQkFDQSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSw0RkFBOEUsT0FBTyxrQkFBYyxDQUFDO2lCQUM1SDtnQkFDRCx1RUFBdUU7WUFDekUsQ0FBQyxDQUFDLENBQ0g7aUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLElBQUksRUFBRSxFQUFOLENBQU0sQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9zdGF0aWMtYmxvZy1nZW5lcmF0b3Ivc3RhdGljLWJsb2ctZ2VuZXJhdG9yL3NyYy9ndWxwLmZlZWQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGF0aE9yRmlsZURlc2NyaXB0b3IsIHJlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgeyBmdWxsX3VybF9mb3IsIGdyYXZhdGFyIH0gZnJvbSAnaGV4by11dGlsJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IGVudk51bmp1Y2tzIGZyb20gJy4vdXRpbHMvbnVuanVja3MtZW52JztcbmltcG9ydCB7IGNvbW1vbklnbm9yZSwgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuZ3VscC50YXNrKCdmZWVkJywgZnVuY3Rpb24gKGRvbmUpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oY29uZmlnLmN3ZCk7XG5cbiAgaW5zdGFuY2UuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgIGluc3RhbmNlLmxvYWQoKS50aGVuKCgpID0+IHtcbiAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgcmV0dXJuIGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCBzdHIpO1xuICAgICAgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIGJ1aWxkKHRtcGxTcmM6IFBhdGhPckZpbGVEZXNjcmlwdG9yLCBkZXN0OiBQYXRoT3JGaWxlRGVzY3JpcHRvcikge1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuXG4gICAgICAgIGxldCBwb3N0cyA9IGluc3RhbmNlLmxvY2Fscy5nZXQoJ3Bvc3RzJyk7XG4gICAgICAgIHBvc3RzID0gcG9zdHMuc29ydCgnLWRhdGUnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5maWx0ZXIoKHBvc3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gcG9zdC5kcmFmdCAhPT0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgeyBlbWFpbCwgZmVlZCwgdXJsOiB1cmxDZmcgfSA9IGNvbmZpZztcbiAgICAgICAgY29uc3QgeyBpY29uOiBpY29uQ2ZnIH0gPSBmZWVkO1xuXG4gICAgICAgIGxldCB1cmwgPSB1cmxDZmc7XG4gICAgICAgIGlmICh1cmxbdXJsLmxlbmd0aCAtIDFdICE9PSAnLycpIHVybCArPSAnLyc7XG4gICAgICAgIC8vIHJlbW92ZSBicm9rZW4gaGV4byBsYW5nIHNob3J0Y29kZVxuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCc6bGFuZy8nKSkgdXJsID0gdXJsLnJlcGxhY2UoJy86bGFuZy8nLCAnLycpO1xuXG4gICAgICAgIGxldCBpY29uID0gJyc7XG4gICAgICAgIGlmIChpY29uQ2ZnKSBpY29uID0gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIGljb25DZmcpO1xuICAgICAgICBlbHNlIGlmIChlbWFpbCkgaWNvbiA9IGdyYXZhdGFyKGVtYWlsLCB7fSk7XG5cbiAgICAgICAgY29uc3QgZmVlZF91cmwgPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgJ3Jzcy54bWwnKTtcblxuICAgICAgICBjb25zdCBkYXRhID0gdGVtcGxhdGUucmVuZGVyKHtcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgdXJsLFxuICAgICAgICAgIGljb24sXG4gICAgICAgICAgcG9zdHMsXG4gICAgICAgICAgZmVlZF91cmxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd3JpdGVGaWxlU3luYyhkZXN0LCBkYXRhKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdGVtcGxhdGVSU1MgPSBqb2luKF9fZGlybmFtZSwgJ19jb25maWdfdGVtcGxhdGVfcnNzLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdFJTUyA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdyc3MueG1sJyk7XG4gICAgICBidWlsZCh0ZW1wbGF0ZVJTUywgZGVzdFJTUyk7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlQVRPTSA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9hdG9tLnhtbCcpO1xuICAgICAgY29uc3QgZGVzdEFUT00gPSBqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5wdWJsaWNfZGlyLCAnYXRvbS54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlQVRPTSwgZGVzdEFUT00pO1xuXG4gICAgICBjb25zdCBiYXNlVVJMID0gY29uZmlnLnVybC5lbmRzV2l0aCgnLycpID8gY29uZmlnLnVybCA6IGNvbmZpZy51cmwgKyAnLyc7XG5cbiAgICAgIGNvbnN0IHB1YmxpY0RpciA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgZ3VscFxuICAgICAgICAuc3JjKCcqKi8qLmh0bWwnLCB7IGN3ZDogcHVibGljRGlyLCBpZ25vcmU6IGNvbW1vbklnbm9yZSB9KVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBndWxwRG9tKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGF1dG8gZGlzY292ZXJ5IHJzc1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3Jzcy54bWxcIl1gKS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aGlzLmhlYWQuaW5uZXJIVE1MICs9IGA8bGluayBpZD1cInJzcy1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9yc3MreG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1yc3MueG1sXCIgLz5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgYXRvbVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIi9hdG9tLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwiYXRvbS1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi9hdG9tK3htbFwiIHJlbD1cImFsdGVybmF0ZVwiIGhyZWY9XCIke2Jhc2VVUkx9YXRvbS54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RoaXMucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdLnNldEF0dHJpYnV0ZSgnZGF0YS12ZXJzaW9uJywgJzEuMCcpO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICAgLnBpcGUoZ3VscC5kZXN0KHB1YmxpY0RpcikpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiBkb25lKCkpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"/home/runner/work/static-blog-generator/static-blog-generator/tmp/jest/jest-transform-cache-5da399b68bfbd9508298e5c1a7fc0ebc-57ee97693e12897f2e1746fb4faeafbf/fb/gulpfeed_fbf9aaad66351334553810020391b0ff.map","wrapperLength":82},"result":{"scriptId":"13803","url":"/home/runner/work/static-blog-generator/static-blog-generator/src/gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13358,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13355,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]}],"wasInterrupted":false,"config":{"bail":0,"changedFilesWithAncestor":false,"ci":true,"collectCoverage":true,"collectCoverageFrom":["src/*.{js,ts}","!**/node_modules/**","!**/vendor/**","!**/test/**","!**/*.test.{js,ts}"],"coverageDirectory":"/home/runner/work/static-blog-generator/static-blog-generator/coverage","coverageProvider":"v8","coverageReporters":["json","text","lcov","clover"],"detectLeaks":false,"detectOpenHandles":true,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":false,"json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":1,"noStackTrace":false,"nonFlagArgs":[],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["/home/runner/work/static-blog-generator/static-blog-generator/node_modules/jest-html-reporters/index.js",{"publicPath":"./coverage/html-report","filename":"report.html","openReport":false}]],"rootDir":"/home/runner/work/static-blog-generator/static-blog-generator","runTestsByPath":false,"seed":-1844425543,"skipFilter":false,"snapshotFormat":{"escapeString":false,"printBasicPrototype":false},"testFailureExitCode":1,"testPathPattern":"","testSequencer":"/home/runner/work/static-blog-generator/static-blog-generator/node_modules/@jest/test-sequencer/build/index.js","updateSnapshot":"none","useStderr":false,"verbose":false,"watch":false,"watchAll":false,"watchman":true,"coverageLinkPath":"../lcov-report/index.html"},"endTime":1673322433012,"_reporterOptions":{"publicPath":"./coverage/html-report","filename":"report.html","expand":false,"pageTitle":"","hideIcon":false,"testCommand":"npx jest","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false,"urlForTestFiles":""},"attachInfos":{}})