window.jest_html_reporters_callback__({"numFailedTestSuites":0,"numFailedTests":0,"numPassedTestSuites":4,"numPassedTests":23,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":4,"numTotalTests":23,"startTime":1673237788801,"success":false,"testResults":[{"leaks":false,"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673237817175,"runtime":27977,"slow":true,"start":1673237789198},"skipped":false,"testFilePath":"D:\\Repositories\\static-blog-generator\\test\\permalink-yyyy-mm-title.test.ts","testResults":[{"ancestorTitles":["permalink","/:year/:month/:title/","clean"],"duration":272,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["permalink","/:year/:month/:title/","clean"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["permalink","/:year/:month/:title/","copy"],"duration":6096,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["permalink","/:year/:month/:title/","copy"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"},{"ancestorTitles":["permalink","/:year/:month/:title/","validate"],"duration":282,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ validate post with custom permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post with custom permalink"},{"ancestorTitles":["permalink","/:year/:month/:title/","validate"],"duration":77,"failureDetails":[],"failureMessages":[],"fullName":"permalink /:year/:month/:title/ validate post without permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post without permalink"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGluZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUErQztBQUF0QyxtSEFBQSxPQUFPLE9BQWU7QUFDL0Isc0RBQWdFO0FBQXZELHlIQUFBLE9BQU8sT0FBYztBQUM5QixzREFBK0Q7QUFBdEQsd0hBQUEsT0FBTyxPQUFhO0FBQzdCLDJDQUE4RDtBQUFyRCxxR0FBQSxPQUFPLE9BQUE7QUFBRSxpR0FBQSxHQUFHLE9BQUE7QUFBRSx1R0FBQSxHQUFHLE9BQWE7QUFDdkMsdUNBQWdEO0FBQXZDLG1HQUFBLE9BQU8sT0FBVztBQUMzQiwrQ0FBc0U7QUFBN0QsK0dBQUEsZUFBZSxPQUFBO0FBQUUsbUhBQUEsbUJBQW1CLE9BQUE7QUFDN0MscURBQWdFO0FBQXZELG9JQUFBLE9BQU8sT0FBb0I7QUFDcEMsdUNBQTREO0FBQW5ELHlHQUFBLGFBQWEsT0FBQTtBQUFFLGlIQUFBLE9BQU8sT0FBUTtBQUN2QyxvQ0FBMkQ7QUFBbEQsb0dBQUEsWUFBWSxPQUFBO0FBQUUsc0dBQUEsY0FBYyxPQUFBO0FBQ3JDLHdDQUEyQztBQUFsQyxvR0FBQSxVQUFVLE9BQUE7QUFDbkIsdUNBQStFO0FBQXRFLHFHQUFBLFlBQVksT0FBQTtBQUFFLDJHQUFBLGtCQUFrQixPQUFBO0FBQUUscUdBQUEsWUFBWSxPQUFBO0FBQ3ZELHFDQUFvQztBQUEzQiw0RkFBQSxJQUFJLE9BQUE7QUFDYiwrQ0FBeUQ7QUFBaEQsdUhBQUEsT0FBTyxPQUFhO0FBQzdCLHFDQUErRDtBQUF0RCx1R0FBQSxZQUFZLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFFM0MsRUFBRSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgZGVmYXVsdCBhcyBBcHBsaWNhdGlvbiB9IGZyb20gJy4vYXBpJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscENhY2hlZCB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscERlYnVnIH0gZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuZGVidWcnO1xuZXhwb3J0IHsgY2xlYW5EYiwgZGVsLCBkZWwgYXMgZGVsZXRlRGlyIH0gZnJvbSAnLi9ndWxwLmNsZWFuJztcbmV4cG9ydCB7IHRhc2tTZW8gYXMgYXV0b1NlbyB9IGZyb20gJy4vZ3VscC5zZW8nO1xuZXhwb3J0IHsgZ2VuZXJhdGVTaXRlbWFwLCBoZXhvR2VuZXJhdGVTaXRlbWFwIH0gZnJvbSAnLi9ndWxwLnNpdGVtYXAnO1xuZXhwb3J0IHsgZGVmYXVsdCBhcyBzdGFuZGFsb25lUnVubmVyIH0gZnJvbSAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuZXhwb3J0IHsgY29tbWl0UHJvamVjdCwgZGVmYXVsdCBhcyBndWxwIH0gZnJvbSAnLi9ndWxwZmlsZSc7XG5leHBvcnQgeyBjb3B5QWxsUG9zdHMsIGNvcHlTaW5nbGVQb3N0IH0gZnJvbSAnLi9wb3N0L2NvcHknO1xuZXhwb3J0IHsgdXBkYXRlUG9zdCB9IGZyb20gJy4vcG9zdC91cGRhdGUnO1xuZXhwb3J0IHsgYXJyYXlfcmFuZG9tLCBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuZXhwb3J0IHsgbm9vcCB9IGZyb20gJy4vdXRpbHMvbm9vcCc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIHNjaGVkdWxlciB9IGZyb20gJy4vdXRpbHMvc2NoZWR1bGVyJztcbmV4cG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vL1xuIl0sInZlcnNpb24iOjN9","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/11/index_11ca8584e92c62acbf7dbcbf146ed11f.map","wrapperLength":82},"result":{"scriptId":"2630","url":"D:\\Repositories\\static-blog-generator\\src\\index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":6665,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":6662,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":210,"endOffset":230,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":904,"endOffset":958,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1088,"endOffset":1149,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1278,"endOffset":1339,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1455,"endOffset":1499,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1567,"endOffset":1607,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1681,"endOffset":1721,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1833,"endOffset":1875,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2003,"endOffset":2057,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2141,"endOffset":2199,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2334,"endOffset":2400,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2518,"endOffset":2566,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2635,"endOffset":2694,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2808,"endOffset":2851,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2930,"endOffset":2975,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3091,"endOffset":3134,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3251,"endOffset":3295,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3378,"endOffset":3428,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3505,"endOffset":3549,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3656,"endOffset":3691,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3813,"endOffset":3873,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3988,"endOffset":4034,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4108,"endOffset":4151,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4225,"endOffset":4268,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_deploy_1 = require(\"./gulp.deploy\");\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = {};\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, gulp_standalone_1.default)(); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        if (!options)\n            options = (0, _config_1.getConfig)();\n        this.cwd = cwd;\n        options.cwd = cwd;\n        this.config = this.setConfig(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * Copy all **src-post** to **source/_posts** (run before generate)\n     * * see the method {@link pcopy.copyAllPosts}\n     * @returns\n     */\n    SBG.prototype.copy = function () {\n        return new bluebird_1.default(function (resolve, reject) {\n            pcopy\n                .copyAllPosts()\n                .once('end', function () { return resolve(); })\n                .once('error', reject);\n        });\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SBG.prototype.deploy = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var config, github;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: \n                    // run generate task\n                    return [4 /*yield*/, this.generate()];\n                    case 1:\n                        // run generate task\n                        _a.sent();\n                        // copy generated files to deployment directory\n                        return [4 /*yield*/, (0, gulp_deploy_1.asyncCopyGen)()];\n                    case 2:\n                        // copy generated files to deployment directory\n                        _a.sent();\n                        config = (0, _config_1.getConfig)();\n                        github = config.deploy.github;\n                        if (!github)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, github.init().catch(noop_1.default)];\n                    case 3:\n                        _a.sent();\n                        return [4 /*yield*/, github.setremote(config.repo).catch(noop_1.default)];\n                    case 4:\n                        _a.sent();\n                        return [4 /*yield*/, github.setuser(config.username).catch(noop_1.default)];\n                    case 5:\n                        _a.sent();\n                        return [4 /*yield*/, github.setemail(config.email).catch(noop_1.default)];\n                    case 6:\n                        _a.sent();\n                        return [4 /*yield*/, github.setbranch(config.branch).catch(noop_1.default)];\n                    case 7:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 3:\n                        if (!(opt === 'archives')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 5: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        _a.label = 7;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGFwaS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QiwrQkFBNkI7QUFFN0Isb0RBQXdDO0FBQ3hDLDZDQUE2QztBQUM3QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLGdFQUEwQztBQUMxQyxxQ0FBaUQ7QUFFakQ7SUFNRTs7O09BR0c7SUFDSCxhQUFZLEdBQXFCLEVBQUUsT0FBeUM7UUFBNUUsaUJBUUM7UUFoQkQsV0FBTSxHQUFHLEVBQWtDLENBQUM7UUFDNUMsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUFDdEIsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUF3QnRCOzs7V0FHRztRQUNILGVBQVUsR0FBRyxjQUFNLE9BQUEsSUFBQSx5QkFBZ0IsR0FBRSxFQUFsQixDQUFrQixDQUFDO1FBRXRDOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQXJELENBQXFELENBQUM7UUFnQmxFOzs7V0FHRztRQUNILGFBQVEsR0FBRyxjQUFNLE9BQUEsSUFBQSw0QkFBWSxFQUFDLGNBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQTFELENBQTBELENBQUM7UUEvQzFFLElBQUksQ0FBQyxHQUFHO1lBQUUsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTztZQUFFLE9B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QUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEVBQUE7O3dCQUFqRCxTQUFpRCxDQUFDOzs7OztLQUNuRDtJQUVEOzs7O09BSUc7SUFDRyxtQkFBSyxHQUFYLFVBQVksR0FBcUM7Ozs7OzZCQUMzQyxDQUFBLEdBQUcsS0FBSyxLQUFLLENBQUEsRUFBYix3QkFBYTt3QkFDZixxQkFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBQTs7d0JBQTFDLFNBQTBDLENBQUM7d0JBQzNDLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs7NkJBQzNDLENBQUEsR0FBRyxLQUFLLFVBQVUsQ0FBQSxFQUFsQix3QkFBa0I7d0JBQzNCLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs0QkFFcEQscUJBQU0sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUExQyxTQUEwQyxDQUFDOzs7Ozs7S0FFOUM7SUFDSCxVQUFDO0FBQUQsQ0FBQyxBQXhHRCxJQXdHQztBQUVELGtCQUFlLEdBQUcsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgSGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyBOdWxsYWJsZSB9IGZyb20gJy4vZ2xvYmFscyc7XG5pbXBvcnQgKiBhcyBjbGVhbmVyIGZyb20gJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgeyBhc3luY0NvcHlHZW4gfSBmcm9tICcuL2d1bHAuZGVwbG95JztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHNjaGVkdWxlciBmcm9tICcuL3V0aWxzL3NjaGVkdWxlcic7XG5pbXBvcnQgeyBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbmNsYXNzIFNCRyB7XG4gIGN3ZDogc3RyaW5nO1xuICBjb25maWcgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBnZXRDb25maWc+O1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICBpZiAoIW9wdGlvbnMpIG9wdGlvbnMgPSBnZXRDb25maWcoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBvcHRpb25zLmN3ZCA9IGN3ZDtcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMuc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBzdGFuZGFsb25lUnVubmVyKCk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSgpIHtcbiAgICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoKSA9PiBhbnksIHJlamVjdDogKGVycjogRXJyb3IpID0+IGFueSkgPT4ge1xuICAgICAgcGNvcHlcbiAgICAgICAgLmNvcHlBbGxQb3N0cygpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiByZXNvbHZlKCkpXG4gICAgICAgIC5vbmNlKCdlcnJvcicsIHJlamVjdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQW5vbnltaXplIGV4dGVybmFsIGxpbmtzIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2FmZWxpbmsgPSAoKSA9PiB0YXNrU2FmZWxpbmsobm9vcCwgam9pbih0aGlzLmN3ZCwgZ2V0Q29uZmlnKCkucHVibGljX2RpcikpO1xuXG4gIC8qKlxuICAgKiBnZW5lcmF0ZSBzaXRlIHdpdGggaGV4b1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGUoKSB7XG4gICAgY29uc3QgaGV4byA9IG5ldyBIZXhvKHRoaXMuY3dkKTtcbiAgICAvLyBoZXhvIGluaXRcbiAgICBhd2FpdCBoZXhvLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBoZXhvLmxvYWQoKS5jYXRjaChub29wKTtcbiAgICAvLyBoZXhvIGdlbmVyYXRlXG4gICAgYXdhaXQgaGV4by5jYWxsKCdnZW5lcmF0ZScpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8uZXhpdCgpO1xuICB9XG5cbiAgYXN5bmMgZGVwbG95KCkge1xuICAgIC8vIHJ1biBnZW5lcmF0ZSB0YXNrXG4gICAgYXdhaXQgdGhpcy5nZW5lcmF0ZSgpO1xuICAgIC8vIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIHRvIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gICAgYXdhaXQgYXN5bmNDb3B5R2VuKCk7XG4gICAgLy8gZGVwbG95bWVudCBzdGFydFxuICAgIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBjb25maWcuZGVwbG95O1xuICAgIGlmICghZ2l0aHViKSByZXR1cm47XG4gICAgYXdhaXQgZ2l0aHViLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0cmVtb3RlKGNvbmZpZy5yZXBvKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0dXNlcihjb25maWcudXNlcm5hbWUpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRlbWFpbChjb25maWcuZW1haWwpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRicmFuY2goY29uZmlnLmJyYW5jaCkuY2F0Y2gobm9vcCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlcycgfCAnZGF0YWJhc2UnKSB7XG4gICAgaWYgKG9wdCA9PT0gJ2FsbCcpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ2FyY2hpdmVzJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuRGIoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNCRztcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { asyncCopyGen } from './gulp.deploy';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = {} as ReturnType<typeof getConfig>;\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    if (!options) options = getConfig();\n    this.cwd = cwd;\n    options.cwd = cwd;\n    this.config = this.setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => standaloneRunner();\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy() {\n    return new Bluebird((resolve: () => any, reject: (err: Error) => any) => {\n      pcopy\n        .copyAllPosts()\n        .once('end', () => resolve())\n        .once('error', reject);\n    });\n  }\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  async deploy() {\n    // run generate task\n    await this.generate();\n    // copy generated files to deployment directory\n    await asyncCopyGen();\n    // deployment start\n    const config = getConfig();\n    const { github } = config.deploy;\n    if (!github) return;\n    await github.init().catch(noop);\n    await github.setremote(config.repo).catch(noop);\n    await github.setuser(config.username).catch(noop);\n    await github.setemail(config.email).catch(noop);\n    await github.setbranch(config.branch).catch(noop);\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archives' | 'database') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archives') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/27/api_27977693f3bb9acc653b3d92027b188c.map","wrapperLength":82},"result":{"scriptId":"2631","url":"D:\\Repositories\\static-blog-generator\\src\\api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":20115,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":20112,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":6},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":3},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":2},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":2},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":4},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":4},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":5},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4456,"endOffset":10810,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4549,"endOffset":5806,"count":1},{"startOffset":5549,"endOffset":5569,"count":0},{"startOffset":5604,"endOffset":5641,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4884,"endOffset":4940,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5086,"endOffset":5208,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.safelink","ranges":[{"startOffset":5375,"endOffset":5517,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":5824,"endOffset":5877,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":5896,"endOffset":5947,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.copy","ranges":[{"startOffset":6129,"endOffset":6381,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6181,"endOffset":6373,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6289,"endOffset":6322,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6459,"endOffset":7552,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.deploy","ranges":[{"startOffset":7581,"endOffset":9402,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":9573,"endOffset":10791,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9637,"endOffset":10783,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9688,"endOffset":10771,"count":4},{"startOffset":9760,"endOffset":9922,"count":1},{"startOffset":9838,"endOffset":9922,"count":0},{"startOffset":9943,"endOffset":10078,"count":0},{"startOffset":10099,"endOffset":10190,"count":0},{"startOffset":10211,"endOffset":10387,"count":1},{"startOffset":10294,"endOffset":10387,"count":0},{"startOffset":10408,"endOffset":10499,"count":0},{"startOffset":10520,"endOffset":10587,"count":1},{"startOffset":10608,"endOffset":10688,"count":1},{"startOffset":10709,"endOffset":10739,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuY2xlYW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMscUNBQThEO0FBQzlELDhDQUF3QjtBQUN4Qix5QkFBeUI7QUFDekIsK0JBQTZCO0FBQzdCLDZCQUErQjtBQUMvQix3REFBa0M7QUFDbEMsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMscUNBQXNDO0FBRXRDOztHQUVHO0FBQ0gsU0FBc0IsT0FBTyxDQUFDLFFBQWtELEVBQUUsS0FBZ0I7Ozs7OztvQkFDMUYsR0FBRyxHQUFHLElBQUEsZUFBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUNyQixNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7b0JBQzNCLElBQUksT0FBTyxNQUFNLENBQUMsVUFBVSxLQUFLLFFBQVEsRUFBRTt3QkFDekMsSUFBQSxjQUFTLEVBQUMsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLElBQUEsY0FBTyxFQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7d0JBQ3JFLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztxQkFDekQ7b0JBSUcsSUFBSSxHQUFHO3dCQUNULElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUM7d0JBQzdDLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDO3dCQUM3QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQzt3QkFDNUIsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUM7d0JBQzVC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QUFDN0MsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDL0IsY0FBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLmNsZWFuLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCByZWFkZGlyLCBybSwgUm1PcHRpb25zIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IGRlYnVnIGZyb20gJy4vdXRpbHMvZGVidWcnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIENsZWFuIFByb2plY3QgRGF0YWJhc2VzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbkRiKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpLCBmaWxlcz86IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxvZyA9IGRlYnVnKCdjbGVhbicpO1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgaWYgKHR5cGVvZiBjb25maWcuc291cmNlX2RpciAhPT0gJ3N0cmluZycpIHtcbiAgICB3cml0ZWZpbGUoam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9jbGVhbi5sb2cnKSwgaW5zcGVjdChjb25maWcpKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbmZpZy5zb3VyY2VfZGlyIG11c3QgYmUgY29uZmlndXJlZCcpO1xuICB9XG5cbiAgLy8gY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG5cbiAgbGV0IGRpcnMgPSBbXG4gICAgam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9jYWNoZScpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9kdW1wJyksXG4gICAgam9pbihjb25maWcuY3dkLCAndG1wL2xvZ3MnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICdkYi5qc29uJylcbiAgXTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZmlsZXMpKSBkaXJzID0gZGlycy5jb25jYXQoZmlsZXMpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBkaXIgPSBkaXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICAgIGxvZygnY2xhbmluZycsIGRpcik7XG4gICAgICAgIGF3YWl0IGRlbChkaXIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2gge1xuICAgICAgbG9nKCdjYW5ub3QgZGVsZXRlJywgZGlyKTtcbiAgICB9XG4gIH1cblxuICAvKmNvbnN0IGhleG8gPSBuZXcgaGV4b0xpYihjb25maWcuY3dkKTtcbiAgYXdhaXQgaGV4by5pbml0KCkuY2F0Y2gobm9vcCk7XG4gIGF3YWl0IGhleG8uY2FsbCgnY2xlYW4nKS5jYXRjaChub29wKTsqL1xuXG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHJldHVybiBjYWxsYmFjaygpO1xuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogZGVsZXRlIGZvbGRlciBhc3luY1xuICogQHBhcmFtIHBhdGhcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWwocGF0aDogc3RyaW5nKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBybU9wdDogUm1PcHRpb25zID0geyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH07XG4gICAgaWYgKGV4aXN0c1N5bmMocGF0aCkpIHtcbiAgICAgIHJtKHBhdGgsIHJtT3B0KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgLyppZiAoc3RhdFN5bmMocGF0aCkuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICBybWRpcihwYXRoLCB7IG1heFJldHJpZXM6IDEwIH0pLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIH0qL1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlKG5ldyBFcnJvcihwYXRoICsgJyBub3QgZm91bmQnKSk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBjbGVhbiBvbGQgYXJjaGl2ZXMgKGNhdGVnb3JpZXMsIHRhZ3MsIHBhZ2luYXRpb24pIGZyb20gZGVwbG95bWVudCBkaXJlY3RvcnlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuT2xkQXJjaGl2ZXMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGxvZ25hbWUgPSAnY2xlYW46JyArIGFuc2lDb2xvcnMuZ3JleSgnYXJjaGl2ZXMnKTtcblxuICAvLyBjbGVhbiBhcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc1xuICBjb25zdCBhcmNoaXZlcyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy5hcmNoaXZlX2Rpcik7XG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuY2F0ZWdvcnlfZGlyKTtcbiAgY29uc3QgdGFncyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy50YWdfZGlyKTtcbiAgY29uc3QgZm9sZGVycyA9IFthcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc10uZmlsdGVyKChzdHIpID0+IGV4aXN0c1N5bmMoc3RyKSk7XG5cbiAgLy8gcHVzaCBsYW5ndWFnZSBmb2xkZXIgdG8gYmUgZGVsZXRlZCBmcm9tIGRlcGxveSBkaXJcbiAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmxhbmd1YWdlKSkge1xuICAgIGNvbnN0IGxhbmdEaXIgPSBjb25maWcubGFuZ3VhZ2UubWFwKChwYXRoKSA9PiBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBwYXRoKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLmxhbmdEaXIpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcubGFuZ3VhZ2UgPT09ICdzdHJpbmcnICYmIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgZm9sZGVycy5wdXNoKGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpKSk7XG4gIH1cblxuICAvLyBkZWxldGUgcGFnaW5hdGlvblxuICBjb25zdCBwYWdlc0RpciA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsICdwYWdlJyk7XG4gIGlmIChleGlzdHNTeW5jKHBhZ2VzRGlyKSkge1xuICAgIGNvbnN0IHBhZ2VzID0gKGF3YWl0IHJlYWRkaXIocGFnZXNEaXIpKS5maWx0ZXIoKHN0cikgPT4gL15cXGQrJC8udGVzdChzdHIpKS5tYXAoKHN0cikgPT4gam9pbihwYWdlc0Rpciwgc3RyKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLnBhZ2VzKTtcbiAgfVxuXG4gIGNvbnN0IHByb21pc2VzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG4gIC8vIGR1bXAgdG8gZmlsZVxuICBjb25zdCBkdW1wZmlsZSA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL2NsZWFuLnR4dCcpO1xuICB3cml0ZWZpbGUoZHVtcGZpbGUsIGZvbGRlcnMuam9pbihFT0wpKTtcbiAgTG9nZ2VyLmxvZyhsb2duYW1lLCAnbGlzdCBkZWxldGVkIGZpbGVzJywgZHVtcGZpbGUpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZm9sZGVycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBmb2xkZXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhwYXRoU3RyKSkgcHJvbWlzZXMucHVzaChkZWwocGF0aFN0cikuY2F0Y2gobm9vcCkpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy9cbiAgICB9XG4gIH1cblxuICBjb25zdCBmaW5pc2hOb3cgPSBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ2NsZWFuIGFyY2hpdmVzIGhhcyBzb21lIGVycm9zJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIGNhbGxiYWNrKCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBhd2FpdCBCbHVlYmlyZC5hbGwocHJvbWlzZXMpLnRoZW4oZmluaXNoTm93KS5jYXRjaChmaW5pc2hOb3cpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5HZW5lcmF0ZWRQb3N0cyhjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgcmV0dXJuIGNsZWFuRGIoY2FsbGJhY2ssIFtqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5zb3VyY2VfZGlyLCAnX3Bvc3RzJyldKTtcbn1cblxuZ3VscC50YXNrKCdjbGVhbjphcmNoaXZlJywgY2xlYW5PbGRBcmNoaXZlcyk7XG5ndWxwLnRhc2soJ2NsZWFuOmRiJywgY2xlYW5EYik7XG5ndWxwLnRhc2soJ2NsZWFuOnBvc3QnLCBjbGVhbkdlbmVyYXRlZFBvc3RzKTtcbmd1bHAudGFzaygnY2xlYW46YWxsJywgZ3VscC5zZXJpZXMoJ2NsZWFuOmRiJywgJ2NsZWFuOmFyY2hpdmUnKSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0e/gulpclean_0e73cdf97e0865d562e48a7ea63cce15.map","wrapperLength":82},"result":{"scriptId":"3239","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24169,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexo_post_parser_1 = __importDefault(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar true_case_path_1 = __importDefault(require(\"true-case-path\"));\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nvar fetched = {};\nvar fileYML = (0, path_1.join)(process.cwd(), '_config.yml');\nvar loadYml = function () {\n    if ((0, fs_1.existsSync)(fileYML)) {\n        fetched[fileYML] = true;\n        var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n        settledConfig = Object.assign({}, configYML, settledConfig);\n        // update hexo-post-parser config\n        hexo_post_parser_1.default.setConfig(settledConfig);\n        (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n    }\n};\nloadYml();\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign({}, settledConfig, obj);\n    fileYML = (0, path_1.join)(settledConfig.cwd, '_config.yml');\n    if (!fetched[fileYML]) {\n        if (settledConfig.cwd) {\n            // fix cwd\n            settledConfig.cwd = (0, upath_1.toUnix)(true_case_path_1.default.trueCasePathSync(settledConfig.cwd));\n        }\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nfunction getConfig(customFolder) {\n    if (typeof customFolder === 'string') {\n        fileYML = (0, path_1.join)(customFolder, '_config.yml');\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    settledConfig = (0, object_1.orderKeys)(settledConfig);\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\n// first fetch\nif (!fetched)\n    getConfig();\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : null;\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHlCQUE4QztBQUM5QywwRUFBcUM7QUFFckMsc0VBQThDO0FBQzlDLDZCQUE0QjtBQUM1QixrRUFBMEM7QUFDMUMsK0JBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBOEM7QUFDOUMsaUNBQXVDO0FBQ3ZDLHlDQUEyQztBQTREM0MsSUFBSSxhQUFhLEdBQUcsSUFBQSwyQkFBZ0IsR0FBeUIsQ0FBQztBQUU5RCxJQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDbkIsSUFBSSxPQUFPLEdBQUcsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ2pELElBQU0sT0FBTyxHQUFHO0lBQ2QsSUFBSSxJQUFBLGVBQVUsRUFBQyxPQUFPLENBQUMsRUFBRTtRQUN2QixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsSUFBQSxpQkFBWSxFQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdELGFBQWEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUQsaUNBQWlDO1FBQ2pDLDBCQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNoRjtBQUNILENBQUMsQ0FBQztBQUVGLE9BQU8sRUFBRSxDQUFDO0FBRVY7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3RELE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2pELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDckIsSUFBSSxhQUFhLENBQUMsR0FBRyxFQUFFO1lBQ3JCLFVBQVU7WUFDVixhQUFhLENBQUMsR0FBRyxHQUFHLElBQUEsY0FBTSxFQUFDLHdCQUFZLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDOUU7UUFDRCxPQUFPLEVBQUUsQ0FBQztRQUNWLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7S0FDekI7SUFFRCxPQUFPLFNBQVMsRUFBRSxDQUFDO0FBQ3JCLENBQUM7QUFiRCw4QkFhQztBQUVEOzs7OztHQUtHO0FBQ0gsU0FBZ0IsU0FBUyxDQUFDLFlBQXFCO0lBQzdDLElBQUksT0FBTyxZQUFZLEtBQUssUUFBUSxFQUFFO1FBQ3BDLE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUMsT0FBTyxFQUFFLENBQUM7UUFDVixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO0tBQ3pCO0lBQ0QsYUFBYSxHQUFHLElBQUEsa0JBQVMsRUFBQyxhQUFhLENBQUMsQ0FBQztJQUN6QyxhQUFhLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sSUFBSSxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUNqRiw4RkFBOEY7SUFDOUYsT0FBTyxhQUF5QixDQUFDO0FBQ25DLENBQUM7QUFWRCw4QkFVQztBQUVELGNBQWM7QUFDZCxJQUFJLENBQUMsT0FBTztJQUFFLFNBQVMsRUFBRSxDQUFDO0FBRTFCLFNBQWdCLFlBQVk7O0lBQzFCLElBQU0sU0FBUyxHQUFHLElBQUEsV0FBSSxFQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsVUFBVSxJQUFHLE1BQUEsYUFBYSxDQUFDLE1BQU0sMENBQUUsSUFBSSxDQUFBLElBQUksS0FBSyxDQUFDLENBQUM7SUFDNUYsSUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFVLEVBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksNEJBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pFLE9BQU8sRUFBRSxTQUFTLFdBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO0FBQy9CLENBQUM7QUFKRCxvQ0FJQztBQUVEOzs7Ozs7R0FNRztBQUNVLFFBQUEsWUFBWSxHQUFHO0lBQzFCLGtCQUFrQjtJQUNsQixzQkFBc0I7SUFDdEIsNkJBQTZCO0lBQzdCLDBDQUEwQztJQUMxQyxpQkFBaUI7SUFDakIsYUFBYTtJQUNiLG9CQUFvQjtJQUNwQixXQUFXO0lBQ1gsYUFBYTtJQUNiLGNBQWM7SUFDZCxlQUFlO0lBQ2Ysb0JBQW9CO0lBQ3BCLHFCQUFxQjtJQUNyQiwwQkFBMEI7SUFDMUIsZ0JBQWdCO0lBQ2hCLG9CQUFvQjtJQUNwQixvQkFBb0I7SUFDcEIsYUFBYTtJQUNiLE9BQU8sQ0FBQyxZQUFZO0NBQ3JCLENBQUM7QUFFRjs7R0FFRztBQUNVLFFBQUEsY0FBYywwQ0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsa0JBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLFVBQUUiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgaGV4b1Bvc3RQYXJzZXIgZnJvbSAnaGV4by1wb3N0LXBhcnNlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgdHJ1ZWNhc2VwYXRoIGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmNvbnN0IGZldGNoZWQgPSB7fTtcbmxldCBmaWxlWU1MID0gam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKTtcbmNvbnN0IGxvYWRZbWwgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChleGlzdHNTeW5jKGZpbGVZTUwpKSB7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gICAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShyZWFkRmlsZVN5bmMoZmlsZVlNTCwgJ3V0Zi04JykpO1xuICAgIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWdZTUwsIHNldHRsZWRDb25maWcpO1xuICAgIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICAgIGhleG9Qb3N0UGFyc2VyLnNldENvbmZpZyhzZXR0bGVkQ29uZmlnKTtcbiAgICB3cml0ZWZpbGUoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkoY29uZmlnWU1MLCBudWxsLCAyKSk7XG4gIH1cbn07XG5cbmxvYWRZbWwoKTtcblxuLyoqXG4gKiBDb25maWcgc2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHBhcmFtIG9ialxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29uZmlnKG9iajogUmVjb3JkPHN0cmluZywgYW55PiB8IFByb2pDb25mKSB7XG4gIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBzZXR0bGVkQ29uZmlnLCBvYmopO1xuICBmaWxlWU1MID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJ19jb25maWcueW1sJyk7XG4gIGlmICghZmV0Y2hlZFtmaWxlWU1MXSkge1xuICAgIGlmIChzZXR0bGVkQ29uZmlnLmN3ZCkge1xuICAgICAgLy8gZml4IGN3ZFxuICAgICAgc2V0dGxlZENvbmZpZy5jd2QgPSB0b1VuaXgodHJ1ZWNhc2VwYXRoLnRydWVDYXNlUGF0aFN5bmMoc2V0dGxlZENvbmZpZy5jd2QpKTtcbiAgICB9XG4gICAgbG9hZFltbCgpO1xuICAgIGZldGNoZWRbZmlsZVlNTF0gPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGdldENvbmZpZygpO1xufVxuXG4vKipcbiAqIENvbmZpZyBnZXR0ZXJcbiAqICogdXNlZnVsIGZvciBqZXN0XG4gKiBAcGFyYW0gY3VzdG9tRm9sZGVyIGxvYWQgZnJvbSBjdXN0b20gZm9sZGVyIGFuZCBhcHBseSB0byBjdXJyZW50IGNvbmZpZ1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZyhjdXN0b21Gb2xkZXI/OiBzdHJpbmcpIHtcbiAgaWYgKHR5cGVvZiBjdXN0b21Gb2xkZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgZmlsZVlNTCA9IGpvaW4oY3VzdG9tRm9sZGVyLCAnX2NvbmZpZy55bWwnKTtcbiAgICBsb2FkWW1sKCk7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gIH1cbiAgc2V0dGxlZENvbmZpZyA9IG9yZGVyS2V5cyhzZXR0bGVkQ29uZmlnKTtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbi8vIGZpcnN0IGZldGNoXG5pZiAoIWZldGNoZWQpIGdldENvbmZpZygpO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVwbG95Q29uZmlnKCkge1xuICBjb25zdCBkZXBsb3lEaXIgPSBqb2luKHNldHRsZWRDb25maWcuY3dkLCAnLmRlcGxveV8nICsgc2V0dGxlZENvbmZpZy5kZXBsb3k/LnR5cGUgfHwgJ2dpdCcpO1xuICBjb25zdCBnaXRodWIgPSBleGlzdHNTeW5jKGRlcGxveURpcikgPyBuZXcgZ2l0KGRlcGxveURpcikgOiBudWxsO1xuICByZXR1cm4geyBkZXBsb3lEaXIsIGdpdGh1YiB9O1xufVxuXG4vKipcbiAqIGNvbW1vbiBpZ25vcmUgZmlsZXNcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAqIGNvbnN0IGV4Y2x1ZGVzID0gQXJyYXkuaXNBcnJheShjb25maWcuZXhjbHVkZSkgPyBjb25maWcuZXhjbHVkZSA6IFtdO1xuICogZXhjbHVkZXMucHVzaCguLi5jb21tb25JZ25vcmUpO1xuICovXG5leHBvcnQgY29uc3QgY29tbW9uSWdub3JlID0gW1xuICAnKioveWFuZGV4XyouaHRtbCcsIC8vIHNraXAgeWFuZGV4IHZlcmlmaWNhdGlvbiBmaWxlXG4gIC8vICcqKi9jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2Rpc3F1cy1jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2NvbW1lbnQuaHRtbCcsIC8vIHNraXAgY29tbWVudC5odG1sXG4gICcqKi9mYXZpY29uLmh0bWwnLCAvLyBza2lwIGZhdmljb25cbiAgJyoqLzQwNC5odG1sJywgLy8gc2tpcCA0MDRcbiAgJyoqL25vZGVfbW9kdWxlcy8qKicsIC8vIHNraXAgbm9kZV9tb2R1bGVzXG4gICcqKi90bXAvKionLCAvLyBza2lwIHRtcFxuICAnKiovYnVpbGQvKionLCAvLyBza2lwIGJ1aWxkXG4gICcqKi8uY2FjaGUvKionLCAvLyBza2lwIGNvbW1vbiBjYWNoZSBmb2xkZXJcbiAgJyoqLy52c2NvZGUvKionLCAvLyBza2lwIHZzY29kZSBjb25maWd1cmF0aW9uIGZvbGRlclxuICAnKiovLmZyb250bWF0dGVyLyoqJywgLy8gc2tpcCBmcm9udG1hdHRlciB2c2NvZGUgZXh0ZW5zaW9uXG4gICcqKi9waW50ZXJlc3QtKi5odG1sJywgLy8gc2tpcCBwaW50ZXJlc3QgdmVyaWZpY2F0aW9uIGZpbGVcbiAgJyoqL18qLnN0YW5kYWxvbmUue2pzLHRzfScsIC8vIHNraXAgX2ZpbGVuYW1lLnN0YW5kYWxvbmUuanNcbiAgJyoqL2Rlc2t0b3AuaW5pJywgLy8gd2luZG93cyBkZXNrdG9wLmluaVxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gbm9kZV9tb2R1bGVzXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyB2c2NvZGUgZnJvbnRtYXR0ZXIgcGx1Z2luXG4gICcqKi8uZ2l0Ki8qKicsIC8vIGFueSBnaXQgY29uZmlnc1xuICAnKiovLionIC8vIHNraXAgZG90c1xuXTtcblxuLyoqXG4gKiBhcnJheSBvZiBjb25maWcuZXhjbHVkZSwgY29uZmlnLmlnbm9yZVxuICovXG5leHBvcnQgY29uc3QgcHJvamVjdElnbm9yZXMgPSBbLi4uKGdldENvbmZpZygpLnNraXBfcmVuZGVyIHx8IFtdKSwgLi4uKGdldENvbmZpZygpLmlnbm9yZSB8fCBbXSldO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport truecasepath from 'true-case-path';\nimport { toUnix } from 'upath';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nconst fetched = {};\nlet fileYML = join(process.cwd(), '_config.yml');\nconst loadYml = function () {\n  if (existsSync(fileYML)) {\n    fetched[fileYML] = true;\n    const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n    settledConfig = Object.assign({}, configYML, settledConfig);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n  }\n};\n\nloadYml();\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign({}, settledConfig, obj);\n  fileYML = join(settledConfig.cwd, '_config.yml');\n  if (!fetched[fileYML]) {\n    if (settledConfig.cwd) {\n      // fix cwd\n      settledConfig.cwd = toUnix(truecasepath.trueCasePathSync(settledConfig.cwd));\n    }\n    loadYml();\n    fetched[fileYML] = true;\n  }\n\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nexport function getConfig(customFolder?: string) {\n  if (typeof customFolder === 'string') {\n    fileYML = join(customFolder, '_config.yml');\n    loadYml();\n    fetched[fileYML] = true;\n  }\n  settledConfig = orderKeys(settledConfig);\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\n// first fetch\nif (!fetched) getConfig();\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : null;\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0f/_config_0f3f45dd644bddb8c0e53e47eddfc08f.map","wrapperLength":82},"result":{"scriptId":"3673","url":"D:\\Repositories\\static-blog-generator\\src\\_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":14732,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":14729,"count":1},{"startOffset":3588,"endOffset":3600,"count":0},{"startOffset":4818,"endOffset":4823,"count":0},{"startOffset":4862,"endOffset":4867,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":2},{"startOffset":228,"endOffset":237,"count":0},{"startOffset":315,"endOffset":325,"count":0},{"startOffset":352,"endOffset":369,"count":0},{"startOffset":380,"endOffset":419,"count":0},{"startOffset":477,"endOffset":497,"count":0},{"startOffset":499,"endOffset":509,"count":0},{"startOffset":545,"endOffset":559,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":2},{"startOffset":706,"endOffset":901,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":4},{"startOffset":1075,"endOffset":1080,"count":2},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"loadYml","ranges":[{"startOffset":1902,"endOffset":2367,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":2440,"endOffset":2884,"count":1},{"startOffset":2618,"endOffset":2858,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3049,"endOffset":3523,"count":82},{"startOffset":3126,"endOffset":3250,"count":0},{"startOffset":3373,"endOffset":3378,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3601,"endOffset":3951,"count":82},{"startOffset":3763,"endOffset":3771,"count":0},{"startOffset":3783,"endOffset":3791,"count":0},{"startOffset":3843,"endOffset":3888,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:title/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml_1.default.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGRlZmF1bHRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHlCQUFrQztBQUNsQyxpREFBa0Q7QUFDbEQsK0JBQXFDO0FBQ3JDLDhDQUF3QjtBQUV4Qjs7O0dBR0c7QUFDSCxTQUFnQixnQkFBZ0I7SUFDOUIsSUFBTSxpQkFBaUIsR0FBRztRQUN4QixPQUFPO1FBQ1AsS0FBSyxFQUFFLE1BQU07UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLFdBQVcsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLFVBQVU7UUFDbEIsUUFBUSxFQUFFLElBQUk7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU07UUFDTixHQUFHLEVBQUUsb0JBQW9CO1FBQ3pCLElBQUksRUFBRSxHQUFHO1FBQ1QsU0FBUyxFQUFFLDJCQUEyQjtRQUN0QyxrQkFBa0IsRUFBRSxFQUFFO1FBQ3RCLFdBQVcsRUFBRTtZQUNYLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLGFBQWEsRUFBRSxJQUFJO1NBQ3BCO1FBQ0QsWUFBWTtRQUNaLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLE9BQU8sRUFBRSxNQUFNO1FBQ2YsV0FBVyxFQUFFLFVBQVU7UUFDdkIsWUFBWSxFQUFFLFlBQVk7UUFDMUIsUUFBUSxFQUFFLGdCQUFnQjtRQUMxQixRQUFRLEVBQUUsT0FBTztRQUNqQixXQUFXLEVBQUUsRUFBRTtRQUNmLFVBQVU7UUFDVixhQUFhLEVBQUUsV0FBVztRQUMxQixjQUFjLEVBQUUsTUFBTTtRQUN0QixTQUFTLEVBQUUsS0FBSztRQUNoQixhQUFhLEVBQUU7WUFDYixNQUFNLEVBQUUsSUFBSTtZQUNaLEtBQUssRUFBRSxNQUFNO1lBQ2IsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsYUFBYSxFQUFFLEtBQUs7UUFDcEIsTUFBTSxFQUFFLElBQUk7UUFDWixrQkFBa0IsRUFBRSxjQUFjO1FBQ2xDLFNBQVMsRUFBRTtZQUNULFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFdBQVcsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLElBQUk7WUFDVixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLGFBQWEsRUFBRSxLQUFLO1lBQ3BCLElBQUksRUFBRSxLQUFLO1NBQ1o7UUFDRCxPQUFPLEVBQUU7WUFDUCxVQUFVLEVBQUUsSUFBSTtZQUNoQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtTQUNoQjtRQUNELGlCQUFpQjtRQUNqQixnQkFBZ0IsRUFBRSxlQUFlO1FBQ2pDLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE9BQU8sRUFBRSxFQUFFO1FBQ1gscUJBQXFCO1FBQ3JCLFdBQVcsRUFBRSxZQUFZO1FBQ3pCLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLGNBQWMsRUFBRSxPQUFPO1FBQ3ZCLDRDQUE0QztRQUM1QywwQkFBMEI7UUFDMUIsYUFBYTtRQUNiLFFBQVEsRUFBRSxFQUFFO1FBQ1osY0FBYyxFQUFFLE1BQU07UUFDdEIsYUFBYTtRQUNiLEtBQUssRUFBRSxXQUFXO1FBQ2xCLE1BQU0sRUFBRTtZQUNOLEtBQUssRUFBRSxLQUFLO1NBQ2I7UUFDRCxhQUFhO1FBQ2IsTUFBTSxFQUFFLEVBQUU7UUFFViwrQkFBK0I7UUFDL0IsTUFBTSxFQUFFLEVBQUU7UUFFVixpQkFBaUI7UUFDakIsY0FBYyxFQUFFLElBQUk7S0FDckIsQ0FBQztJQUNGLElBQU0sZ0JBQWdCLEdBQUc7UUFDdkIsR0FBRyxFQUFFLElBQUEsY0FBTSxFQUFDLElBQUEsaUNBQWdCLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7S0FDN0MsQ0FBQztJQUNGLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQW9DLENBQUM7QUFDMUcsQ0FBQztBQXhGRCw0Q0F3RkM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixvQkFBb0I7SUFDbEMsT0FBTyxJQUFBLGlCQUFZLEVBQUMsSUFBQSxZQUFJLEVBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFGRCxvREFFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuXG4vKipcbiAqIGdldCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0Q29uZmlnKCkge1xuICBjb25zdCBoZXhvRGVmYXVsdENvbmZpZyA9IHtcbiAgICAvLyBTaXRlXG4gICAgdGl0bGU6ICdIZXhvJyxcbiAgICBzdWJ0aXRsZTogJycsXG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIGF1dGhvcjogJ0pvaG4gRG9lJyxcbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICB0aW1lem9uZTogJycsXG4gICAgLy8gVVJMXG4gICAgdXJsOiAnaHR0cDovL2V4YW1wbGUuY29tJyxcbiAgICByb290OiAnLycsXG4gICAgcGVybWFsaW5rOiAnOnllYXIvOm1vbnRoLzpkYXkvOnRpdGxlLycsXG4gICAgcGVybWFsaW5rX2RlZmF1bHRzOiB7fSxcbiAgICBwcmV0dHlfdXJsczoge1xuICAgICAgdHJhaWxpbmdfaW5kZXg6IHRydWUsXG4gICAgICB0cmFpbGluZ19odG1sOiB0cnVlXG4gICAgfSxcbiAgICAvLyBEaXJlY3RvcnlcbiAgICBzb3VyY2VfZGlyOiAnc291cmNlJyxcbiAgICBwdWJsaWNfZGlyOiAncHVibGljJyxcbiAgICB0YWdfZGlyOiAndGFncycsXG4gICAgYXJjaGl2ZV9kaXI6ICdhcmNoaXZlcycsXG4gICAgY2F0ZWdvcnlfZGlyOiAnY2F0ZWdvcmllcycsXG4gICAgY29kZV9kaXI6ICdkb3dubG9hZHMvY29kZScsXG4gICAgaTE4bl9kaXI6ICc6bGFuZycsXG4gICAgc2tpcF9yZW5kZXI6IFtdLFxuICAgIC8vIFdyaXRpbmdcbiAgICBuZXdfcG9zdF9uYW1lOiAnOnRpdGxlLm1kJyxcbiAgICBkZWZhdWx0X2xheW91dDogJ3Bvc3QnLFxuICAgIHRpdGxlY2FzZTogZmFsc2UsXG4gICAgZXh0ZXJuYWxfbGluazoge1xuICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgZmllbGQ6ICdzaXRlJyxcbiAgICAgIGV4Y2x1ZGU6ICcnXG4gICAgfSxcbiAgICBmaWxlbmFtZV9jYXNlOiAwLFxuICAgIHJlbmRlcl9kcmFmdHM6IGZhbHNlLFxuICAgIHBvc3RfYXNzZXRfZm9sZGVyOiBmYWxzZSxcbiAgICByZWxhdGl2ZV9saW5rOiBmYWxzZSxcbiAgICBmdXR1cmU6IHRydWUsXG4gICAgc3ludGF4X2hpZ2hsaWdodGVyOiAnaGlnaGxpZ2h0LmpzJyxcbiAgICBoaWdobGlnaHQ6IHtcbiAgICAgIGF1dG9fZGV0ZWN0OiBmYWxzZSxcbiAgICAgIGxpbmVfbnVtYmVyOiB0cnVlLFxuICAgICAgdGFiX3JlcGxhY2U6ICcnLFxuICAgICAgd3JhcDogdHJ1ZSxcbiAgICAgIGV4Y2x1ZGVfbGFuZ3VhZ2VzOiBbXSxcbiAgICAgIGxhbmd1YWdlX2F0dHI6IGZhbHNlLFxuICAgICAgaGxqczogZmFsc2VcbiAgICB9LFxuICAgIHByaXNtanM6IHtcbiAgICAgIHByZXByb2Nlc3M6IHRydWUsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJ1xuICAgIH0sXG4gICAgLy8gQ2F0ZWdvcnkgJiBUYWdcbiAgICBkZWZhdWx0X2NhdGVnb3J5OiAndW5jYXRlZ29yaXplZCcsXG4gICAgY2F0ZWdvcnlfbWFwOiB7fSxcbiAgICB0YWdfbWFwOiB7fSxcbiAgICAvLyBEYXRlIC8gVGltZSBmb3JtYXRcbiAgICBkYXRlX2Zvcm1hdDogJ1lZWVktTU0tREQnLFxuICAgIHRpbWVfZm9ybWF0OiAnSEg6bW06c3MnLFxuICAgIHVwZGF0ZWRfb3B0aW9uOiAnbXRpbWUnLFxuICAgIC8vICogbXRpbWU6IGZpbGUgbW9kaWZpY2F0aW9uIGRhdGUgKGRlZmF1bHQpXG4gICAgLy8gKiBlbXB0eTogbm8gbW9yZSB1cGRhdGVcbiAgICAvLyBQYWdpbmF0aW9uXG4gICAgcGVyX3BhZ2U6IDEwLFxuICAgIHBhZ2luYXRpb25fZGlyOiAncGFnZScsXG4gICAgLy8gRXh0ZW5zaW9uc1xuICAgIHRoZW1lOiAnbGFuZHNjYXBlJyxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgIGNhY2hlOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gRGVwbG95bWVudFxuICAgIGRlcGxveToge30sXG5cbiAgICAvLyBpZ25vcmUgZmlsZXMgZnJvbSBwcm9jZXNzaW5nXG4gICAgaWdub3JlOiBbXSxcblxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgbWV0YV9nZW5lcmF0b3I6IHRydWVcbiAgfTtcbiAgY29uc3Qgc2JnRGVmYXVsdENvbmZpZyA9IHtcbiAgICBjd2Q6IHRvVW5peCh0cnVlQ2FzZVBhdGhTeW5jKHByb2Nlc3MuY3dkKCkpKVxuICB9O1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKGdldERlZmF1bHRDb25maWdZYW1sKCkpO1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihoZXhvRGVmYXVsdENvbmZpZywgc2JnRGVmYXVsdENvbmZpZywgY29uZmlnWU1MKSBhcyB0eXBlb2YgaW1wb3J0KCcuL19jb25maWcuanNvbicpO1xufVxuXG4vKipcbiAqIGdldCBkZWZhdWx0IF9jb25maWcueW1sXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdENvbmZpZ1lhbWwoKSB7XG4gIHJldHVybiByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLnltbCcpLCAndXRmLTgnKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:title/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/9d/defaults_9d90978728a2f8c36350e6b522c45e0e.map","wrapperLength":82},"result":{"scriptId":"4595","url":"D:\\Repositories\\static-blog-generator\\src\\defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":9592,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":9589,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":1},{"startOffset":204,"endOffset":209,"count":0}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":568,"endOffset":3016,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3109,"endOffset":3233,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZGVwbG95LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLHlCQUFnQztBQUNoQywwRUFBMEQ7QUFDMUQsdURBQTJEO0FBQzNELDhDQUFrRDtBQUNsRCxvRUFBcUM7QUFDckMsK0JBQXFDO0FBQ3JDLHdCQUFzQjtBQUN0QiwyQkFBeUI7QUFDekIsMERBQW9DO0FBQ3BDLHFDQUFvRDtBQUVwRDs7O0dBR0c7QUFDSCxTQUFnQixPQUFPO0lBQ2IsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLElBQU0sU0FBUyxHQUFHLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5RCxPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxxQkFBcUIsQ0FBQyxFQUFFO1FBQ2hFLEdBQUcsRUFBRSxTQUFTO1FBQ2QsR0FBRyxFQUFFLElBQUk7S0FDVixDQUFDO1NBQ0QsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDMUIsRUFBRSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQVZELDBCQVVDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0IsWUFBWTtJQUMxQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFVLE9BQU87UUFDbkMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNwQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxD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QUFNLEVBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUEsY0FBTSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsY0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxlQUFlLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5kZXBsb3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuc2lDb2xvcnMgZnJvbSAnYW5zaS1jb2xvcnMnO1xuaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGdpdEhlbHBlciB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlcic7XG5pbXBvcnQgeyBzcGF3bkFzeW5jIH0gZnJvbSAnZ2l0LWNvbW1hbmQtaGVscGVyL2Rpc3Qvc3Bhd24nO1xuaW1wb3J0IGd1bHAsIHsgVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfSBmcm9tICdndWxwJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIChfY29uZmlnX3ltbC5wdWJsaWNfZGlyKSB0byBkZXBsb3kgZGlyIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvcHlHZW4oKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgY29uc3QgcHVibGljRGlyID0gam9pbihwcm9jZXNzLmN3ZCgpLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKionLCAnISoqLy5naXQqJywgJyEqKi90bXAvKionLCAnISoqL25vZGVfbW9kdWxlcy8qKiddLCB7XG4gICAgICBjd2Q6IHB1YmxpY0RpcixcbiAgICAgIGRvdDogdHJ1ZVxuICAgIH0pXG4gICAgLnBpcGUoZ3VscC5kZXN0KGRlcGxveURpcikpXG4gICAgLm9uKCdlcnJvcicsIGNvbnNvbGUudHJhY2UpO1xufVxuXG4vKipcbiAqIGFzeW5jaHJvbm91cyBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3luY0NvcHlHZW4oKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBjb3B5R2VuKCkub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbi8vIGNvcHkgcHVibGljIHRvIC5kZXBsb3lfZ2l0XG5ndWxwLnRhc2soJ2RlcGxveTpjb3B5JywgY29weUdlbik7XG5cbi8qKlxuICogZ2l0IHB1bGwgb24gZGVwbG95IGRpclxuICogQHBhcmFtIGRvbmVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVsbChkb25lOiBUYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgY3dkID0gY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGdoID0gY29uZmlnLmRlcGxveS5naXRodWI7XG4gIGNvbnN0IGRvUHVsbCA9IGFzeW5jIChjd2Q6IHN0cmluZykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ2NvbmZpZycsICdwdWxsLnJlYmFzZScsICdmYWxzZSddLCB7XG4gICAgICAgIGN3ZFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gTG9nZ2VyLmxvZyhlLm1lc3NhZ2UsIHN1Yi5yb290KTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgTG9nZ2VyLmxvZygncHVsbGluZycsIGN3ZCk7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ3B1bGwnLCAnLVgnLCAndGhlaXJzJ10sIHtcbiAgICAgICAgY3dkLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcHVsbCcsIGN3ZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNsb25lID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghZXhpc3RzU3luYyhjd2QpKSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbLi4uJ2Nsb25lIC1iIG1hc3RlciAtLXNpbmdsZS1icmFuY2gnLnNwbGl0KCcgJyksIGNvbmZpZy5kZXBsb3kucmVwbywgJy5kZXBsb3lfZ2l0J10sIHtcbiAgICAgICAgY3dkOiBfX2Rpcm5hbWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBhd2FpdCBjbG9uZSgpO1xuICBkb1B1bGwoY3dkKTtcbiAgaWYgKGdoKSB7XG4gICAgY29uc3Qgc3VibW9kdWxlcyA9IGdoLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1Ym1vZHVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN1YiA9IHN1Ym1vZHVsZXNbaV07XG5cbiAgICAgIGRvUHVsbChzdWIucm9vdCk7XG4gICAgfVxuICB9XG4gIGRvbmUoKTtcbn1cblxuZnVuY3Rpb24gc3RhdHVzKGRvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrKSB7XG4gIGNvbnN0IHsgZ2l0aHViIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgaWYgKCFnaXRodWIpIHJldHVybjtcbiAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKHN0YXR1c2VzKSA9PiB7XG4gICAgc3RhdHVzZXMubWFwKChpdGVtKSA9PiB7XG4gICAgICBsZXQgc3RyID0gJyc7XG5cbiAgICAgIHN3aXRjaCAoaXRlbS5jaGFuZ2VzKSB7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnJlZChpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhZGRlZCc6XG4gICAgICAgICAgc3RyICs9IGFuc2lDb2xvcnMuZ3JlZW4oaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbW9kaWZpZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnllbGxvdyhpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd1bnRyYWNrZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZXkoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBzdHIgKz0gaXRlbS5jaGFuZ2VzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBzdHIgKz0gJyAnO1xuICAgICAgc3RyICs9IGl0ZW0ucGF0aDtcbiAgICAgIExvZ2dlci5sb2coc3RyKTtcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2YgZG9uZSA9PT0gJ2Z1bmN0aW9uJykgZG9uZSgpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY29tbWl0KCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICBjb25zdCBub3cgPSBtb21lbnQoKS50eihnZXRDb25maWcoKS50aW1lem9uZSkuZm9ybWF0KCdMTEwnKTtcbiAgY29uc3QgY29tbWl0Um9vdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgIExvZ2dlci5sb2coJ2NoYW5nZXMnLCBjaGFuZ2VzLmxlbmd0aCwgdG9Vbml4KGdpdGh1Yi5jd2QpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJykpO1xuICAgICAgICBpZiAoY2hhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZ2l0aHViLmFkZCgnLUEnKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGdpdGh1Yi5jb21taXQoJ3VwZGF0ZSBzaXRlICcgKyBub3cpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGNvbW1pdFN1Ym1vZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGlmIChnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpKSB7XG4gICAgICAgIGNvbnN0IGluZm8gPSBnaXRodWIuc3VibW9kdWxlLmdldCgpO1xuICAgICAgICBjb25zdCBjb21taXRTdWJtb2R1bGVDaGlsZCA9IGFzeW5jIChzdWI6ICh0eXBlb2YgaW5mbylbbnVtYmVyXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IG5ldyBnaXRIZWxwZXIoc3ViLnJvb3QpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgc3VibW9kdWxlLnN0YXR1cygpO1xuICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCBzdWJtb2R1bGUuYWRkKCctQScpO1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmNvbW1pdChgdXBkYXRlICR7c3ViLnBhdGh9ICR7bm93fWAsICdhbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaXRlcmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVJdCkgPT4ge1xuICAgICAgICAgICAgLy8gcmVzb2x2ZSBkaXJlY3RseSB3aGVuIHN1Ym1vZHVsZSBpdGVtcyBubyBtYWRlIGNoYW5nZXNcbiAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgIGNvbW1pdFN1Ym1vZHVsZUNoaWxkKGluZm9bMF0pXG4gICAgICAgICAgICAgIC5jYXRjaChub29wKVxuICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIC8vIHJlLWl0ZXJhdGUgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm90IGNvbW1pdHRlZFxuICAgICAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA+IDApIHJldHVybiBpdGVyYXRlKCk7XG4gICAgICAgICAgICAgICAgLy8gcmVzb2x2ZXMgYWxsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZUl0KG51bGwpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaXRlcmF0ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbW1pdFN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihjb21taXRSb290KVxuICAgICAgLnRoZW4oKCkgPT4gcmVzb2x2ZShudWxsKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBub29wKCkge1xuICAvL1xufVxuXG5mdW5jdGlvbiBwdXNoKCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpID8gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKSA6IFtdO1xuICBjb25zdCBwdXNoU3VibW9kdWxlID0gZnVuY3Rpb24gKHN1Ym1vZHVsZTogKHR5cGVvZiBzdWJtb2R1bGVzKVtudW1iZXJdKSB7XG4gICAgY29uc3QgeyB1cmwsIGJyYW5jaCwgcm9vdCB9ID0gc3VibW9kdWxlO1xuICAgIGlmICghc3VibW9kdWxlLmdpdGh1Yikge1xuICAgICAgc3VibW9kdWxlLmdpdGh1YiA9IG5ldyBnaXRIZWxwZXIocm9vdCk7XG4gICAgfVxuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBzdWJtb2R1bGU7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlUHVzaCkgPT4ge1xuICAgICAgY29uc3Qgc2V0UiA9ICgpID0+IGdpdGh1Yi5zZXRyZW1vdGUodXJsKTtcbiAgICAgIGNvbnN0IHNldEIgPSAoKSA9PiBnaXRodWIuc2V0YnJhbmNoKGJyYW5jaCk7XG4gICAgICBQcm9taXNlLmFsbChbc2V0UigpLCBzZXRCKCldKS50aGVuKCgpID0+IHtcbiAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyh3b3Jrc3BhY2Uocm9vdCksICdjYW4gcHVzaCcsIGFsbG93ZWQpO1xuICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAvLyBwdXNoIHRoZW4gcmVzb2x2ZVxuICAgICAgICAgICAgZ2l0aHViLnB1c2goZmFsc2UsIHsgc3RkaW86ICdwaXBlJyB9KS50aGVuKHJlc29sdmVQdXNoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKGNoYW5nZXMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIExvZ2dlci5sb2coJ3N1Ym1vZHVsZScsIHdvcmtzcGFjZShyb290KSwgJ2NoYW5nZXMgbm90IHN0YWdlZCcpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgY2hhbmdlcyBub3Qgc3RhZ2VkXG4gICAgICAgICAgICAgICAgcmVzb2x2ZVB1c2gobnVsbCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2l0aHViLmlzVXBUb0RhdGUoKS50aGVuKCh1cGRhdGVkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICd1cGRhdGVkJywgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGlzIHVwIHRvIGRhdGVcbiAgICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGl0ZXJhdGVTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IHN1Ym1vZHVsZXMuc2hpZnQoKTtcbiAgICAgICAgaWYgKHN1Ym1vZHVsZSkge1xuICAgICAgICAgIHB1c2hTdWJtb2R1bGUoc3VibW9kdWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJtb2R1bGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgaXRlcmF0ZVN1Ym1vZHVsZSgpLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgaXRlcmF0ZVN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgICAgICBnaXRodWIuY2FuUHVzaCgpLnRoZW4oKGFsbG93ZWQpID0+IHtcbiAgICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKGdpdGh1Yi5jd2QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAgIGdpdGh1Yi5wdXNoKCkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUpO1xuICAgIC8vcHVzaFN1Ym1vZHVsZShzdWJtb2R1bGVzWzFdKS50aGVuKHJlc29sdmUpO1xuICB9KTtcbn1cblxuZ3VscC50YXNrKCdkZXBsb3k6cHVzaCcsIHB1c2gpO1xuZ3VscC50YXNrKCdkZXBsb3k6c3RhdHVzJywgc3RhdHVzKTtcbmd1bHAudGFzaygnZGVwbG95OmNvbW1pdCcsIGNvbW1pdCk7XG5ndWxwLnRhc2soJ2RlcGxveTpwdWxsJywgcHVsbCk7XG5cbi8qKlxuICogZ2V0IHJlbGF0aXZlIHBhdGggZnJvbSB3b3Jrc3BhY2VcbiAqIEBwYXJhbSBzdHJcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHdvcmtzcGFjZShzdHI6IHN0cmluZykge1xuICByZXR1cm4gdG9Vbml4KHN0cikucmVwbGFjZSh0b1VuaXgocHJvY2Vzcy5jd2QoKSksICcnKTtcbn1cblxuLy8gZGVwbG95XG5ndWxwLnRhc2soJ2RlcGxveScsIGd1bHAuc2VyaWVzKCdkZXBsb3k6cHVsbCcsICdkZXBsb3k6Y29weScsICdzYWZlbGluaycsICdkZXBsb3k6Y29tbWl0JywgJ2RlcGxveTpwdXNoJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/90/gulpdeploy_90b84dd58a01145dad19e958e2ead383.map","wrapperLength":82},"result":{"scriptId":"4599","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39615,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39612,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2FmZWxpbmsudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyx5QkFBZ0M7QUFDaEMsOENBQXdCO0FBQ3hCLDhDQUF3QjtBQUN4Qiw0REFBa0Q7QUFDbEQsc0RBQWdDO0FBRWhDLHVFQUFpRDtBQUNqRCxpQ0FBK0M7QUFDL0MsMERBQW9DO0FBQ3BDLHFDQUFzQztBQUV0Qzs7Ozs7R0FLRztBQUNILFNBQWdCLFlBQVksQ0FBQyxLQUFvRCxFQUFFLEdBQStCO0lBQWxILGlCQThHQzs7SUE3R0MsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxVQUFVLEdBQUcsT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO0lBQzNFLElBQU0sT0FBTyxHQUFHLHFCQUFVLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRW5ELHdCQUF3QjtJQUN4QixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFO1FBQ2xDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLHFCQUFVLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztLQUMxRTtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDM0MsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUscUJB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LElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDdEMsYUFBYTt3QkFDYixJQUFJLEVBQUUsQ0FBQzs7OzthQUNSLENBQUMsQ0FDSDthQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7S0FDaEM7U0FBTTtRQUNMLElBQU0sT0FBTyxHQUFHLElBQUEsc0JBQWlCLEVBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLENBQUMsQ0FBQztRQUNwRixPQUFPLE9BQU8sQ0FBQztLQUNoQjtBQUNILENBQUM7QUE5R0Qsb0NBOEdDO0FBRUQsZ0NBQWdDO0FBQ2hDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLnNhZmVsaW5rLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNmLCB7IFNhZmVsaW5rT3B0aW9ucyB9IGZyb20gJ3NhZmVsaW5raWZ5JztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBTcmNPcHRpb25zIH0gZnJvbSAndmlueWwtZnMnO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IHsgY3JlYXRlV3JpdGVTdHJlYW0gfSBmcm9tICcuL3V0aWxzL2ZtJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBQcm9jZXNzIFNhZmVsaW5rIG9uIERlcGxveSBEaXJcbiAqIEBwYXJhbSBfZG9uZSBjYWxsYmFjayBmdW5jdGlvblxuICogQHBhcmFtIGN3ZCB3b3JraW5nIGRpcmVjdG9yeSB0byBzY2FuIGh0bWwnc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTYWZlbGluayhfZG9uZT86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q/OiB1bmRlZmluZWQgfCBudWxsIHwgc3RyaW5nKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCB3b3JraW5nRGlyID0gdHlwZW9mIGN3ZCA9PT0gJ3N0cmluZycgPyBjd2QgOiBjb25maWcuZGVwbG95LmRlcGxveURpcjtcbiAgY29uc3QgbG9nbmFtZSA9IGFuc2lDb2xvcnMuZ3JlZW5CcmlnaHQoJ3NhZmVsaW5rJyk7XG5cbiAgLy8gc2tpcCBwcm9jZXNzIHNhZmVsaW5rXG4gIGxldCBoYXNFcnJvciA9IGZhbHNlO1xuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ2NvbmZpZyBzYWZlbGluaycsIGFuc2lDb2xvcnMucmVkKCdub3QgY29uZmlndXJlZCcpKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnJlZGlyZWN0KSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ3NhZmVsaW5rIHJlZGlyZWN0b3InLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5lbmFibGUpIHtcbiAgICBoYXNFcnJvciA9IHRydWU7XG4gICAgTG9nZ2VyLmxvZyhsb2duYW1lLCBhbnNpQ29sb3JzLnJlZCgnZGlzYWJsZWQnKSk7XG4gIH1cblxuICBpZiAoZXhpc3RzU3luYyh3b3JraW5nRGlyKSAmJiAhaGFzRXJyb3IpIHtcbiAgICBjb25zdCBkZWZhdWx0Q29uZmlnU2FmZWxpbms6IFNhZmVsaW5rT3B0aW9ucyAmIFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICBlbmFibGU6IGZhbHNlLFxuICAgICAgZXhjbHVkZTogW10gYXMgc3RyaW5nW10sXG4gICAgICByZWRpcmVjdDogJ2h0dHBzOi8vd3d3LndlYm1hbmFqZW1lbi5jb20vcGFnZS9zYWZlbGluay5odG1sP3VybD0nLFxuICAgICAgcGFzc3dvcmQ6ICdyb290JyxcbiAgICAgIHR5cGU6ICdiYXNlNjQnXG4gICAgfTtcbiAgICBjb25zdCBjb25maWdTYWZlbGluayA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENvbmZpZ1NhZmVsaW5rLCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluayB8fCB7fSk7XG4gICAgbGV0IGJhc2VVUkwgPSAnJztcbiAgICB0cnkge1xuICAgICAgYmFzZVVSTCA9IG5ldyBVUkwoY29uZmlnLnVybCkuaG9zdDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuXG4gICAgY29uc3Qgb3B0OiBQYXJ0aWFsPFNhZmVsaW5rT3B0aW9ucz4gPSB7XG4gICAgICAvLyBleGNsdWRlIHBhdHRlcm5zIChkb250IGFub255bWl6ZSB0aGVzZSBwYXR0ZXJucylcbiAgICAgIGV4Y2x1ZGU6IFtcbiAgICAgICAgLi4uKGNvbmZpZy5leHRlcm5hbF9saW5rPy5leGNsdWRlIHx8IFtdKSxcbiAgICAgICAgL2h0dHBzPzpcXC9cXC8/KD86KFteKl0rKVxcLik/d2VibWFuYWplbWVuXFwuY29tLyxcbiAgICAgICAgLyhbYS16MC05XSg/OlthLXowLTktXXsxLDYxfVthLXowLTldKT9bLl0pKndlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIGJhc2VVUkwsXG4gICAgICAgICd3d3cud2VibWFuYWplbWVuLmNvbScsXG4gICAgICAgICdodHRwczovL2dpdGh1Yi5jb20vZGltYXNsYW5qYWthJyxcbiAgICAgICAgJ2h0dHBzOi8vZmFjZWJvb2suY29tL2RpbWFzbGFuamFrYTEnLFxuICAgICAgICAnZGltYXNsYW5qYWthLmdpdGh1Yi5pbycsXG4gICAgICAgIC4uLmNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGVcbiAgICAgIF0uZmlsdGVyKGZ1bmN0aW9uICh4LCBpLCBhKSB7XG4gICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGUgYW5kIGVtcHRpZXNcbiAgICAgICAgcmV0dXJuIGEuaW5kZXhPZih4KSA9PT0gaSAmJiB4LnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMDtcbiAgICAgIH0pLFxuICAgICAgcmVkaXJlY3Q6IFtdLFxuICAgICAgLy9yZWRpcmVjdDogWywgY29uZmlnU2FmZWxpbmsucmVkaXJlY3RdLFxuICAgICAgcGFzc3dvcmQ6IGNvbmZpZ1NhZmVsaW5rLnBhc3N3b3JkIHx8IGNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnBhc3N3b3JkLFxuICAgICAgdHlwZTogY29uZmlnU2FmZWxpbmsudHlwZSB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay50eXBlXG4gICAgfTtcblxuICAgIGlmIChjb25maWdTYWZlbGluay5yZWRpcmVjdCkge1xuICAgICAgb3B0LnJlZGlyZWN0ID0gY29uZmlnU2FmZWxpbmsucmVkaXJlY3Q7XG4gICAgfVxuXG4gICAgY29uc3Qgc2FmZWxpbmsgPSBuZXcgc2Yuc2FmZWxpbmsob3B0KTtcblxuICAgIGNvbnN0IGd1bHBvcHQ6IFNyY09wdGlvbnMgPSB7XG4gICAgICBjd2Q6IHdvcmtpbmdEaXIsXG4gICAgICBpZ25vcmU6IFtdXG4gICAgfTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpKSB7XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWdTYWZlbGluay5leGNsdWRlKSkge1xuICAgICAgY29uc3QgaWdub3JlID0gY29uZmlnU2FmZWxpbmsuZXhjbHVkZS5maWx0ZXIoKHN0cikgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gIS9eKGh0dHBzPzpcXC98d3d3LikvLnRlc3Qoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KSBhcyBzdHJpbmdbXTtcbiAgICAgIGd1bHBvcHQuaWdub3JlPy5jb25jYXQoLi4uaWdub3JlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3VscFxuICAgICAgLnNyYyhbJyoqLyoue2h0bWwsaHRtfSddLCBndWxwb3B0KVxuICAgICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzYWZlbGluaycgfSkpXG4gICAgICAucGlwZShcbiAgICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIChmaWxlLCBfZW5jLCBuZXh0KSA9PiB7XG4gICAgICAgICAgLy8gZHJvcHNcbiAgICAgICAgICBpZiAoZmlsZS5pc051bGwoKSB8fCBmaWxlLmlzRGlyZWN0b3J5KCkgfHwgIWZpbGUgfHwgZmlsZS5pc1N0cmVhbSgpKSByZXR1cm4gbmV4dCgpO1xuICAgICAgICAgIC8vIHByb2Nlc3NcbiAgICAgICAgICBpZiAoZmlsZS5pc0J1ZmZlcigpICYmIEJ1ZmZlci5pc0J1ZmZlcihmaWxlLmNvbnRlbnRzKSkge1xuICAgICAgICAgICAgLy8gZG8gc2FmZWxpbmtpZnlcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCd1dGYtOCcpO1xuICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgc2FmZWxpbmsucGFyc2UoY29udGVudCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcnNlZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgLy8gTG9nZ2VyLmxvZyhwYXJzZWQpO1xuICAgICAgICAgICAgICBmaWxlLmNvbnRlbnRzID0gQnVmZmVyLmZyb20ocGFyc2VkKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQobnVsbCwgZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIExvZ2dlci5sb2coJ2Nhbm5vdCBwYXJzZScsIGZpbGUucGF0aCk7XG4gICAgICAgICAgLy8gZHJvcCBmYWlsc1xuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5waXBlKGd1bHAuZGVzdCh3b3JraW5nRGlyKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgd3N0cmVhbSA9IGNyZWF0ZVdyaXRlU3RyZWFtKHBhdGguam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9zYWZlbGluay5sb2cnKSk7XG4gICAgcmV0dXJuIHdzdHJlYW07XG4gIH1cbn1cblxuLy8gc2FmZWxpbmtpZnkgdGhlIGRlcGxveSBmb2xkZXJcbmd1bHAudGFzaygnc2FmZWxpbmsnLCB0YXNrU2FmZWxpbmspO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/16/gulpsafelink_164c92c7edb79d3cef122f73272620d8.map","wrapperLength":82},"result":{"scriptId":"4600","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21119,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21116,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsOENBQXdCO0FBQ3hCLHNEQUErQjtBQUMvQix1RUFBaUQ7QUFDakQsMERBQW9DO0FBQ3BDLHFDQUFrRTtBQUVsRTs7O0dBR0c7QUFDSCxTQUFnQixPQUFPLENBQUMsS0FBbUQsRUFBRSxHQUFXO0lBQ3RGLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sTUFBTSxHQUFhLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0UsTUFBTSxDQUFDLElBQUksT0FBWCxNQUFNLDJCQUFTLHNCQUFZLFdBQUU7SUFDN0IsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsY0FBYyxDQUFDLEVBQUUsRUFBRSxHQUFHLEtBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO1NBQ3pELElBQUksQ0FBQyxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNqQyxJQUFJLENBQ0gsSUFBQSxrQkFBTyxFQUFDLFVBQVUsSUFBSTtRQUFkLGlCQTJCUDtRQTFCQyxpQkFBaUI7UUFDakIsSUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNoQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDO2dCQUN0RSxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQzthQUMvQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsbUJBQW1CO1FBQ25CLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDakUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEVBQUU7WUFDakIsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUM1QixJQUFNLEtBQUssR0FBRyxLQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLFVBQVUsQ0FBQztnQkFDeEUsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDakM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILGdCQUFnQjtRQUNoQixXQUFXO1FBQ1gsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMscUJBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEVBQUUsY0FBTyxFQUFFLENBQUMsTUFBTSxlQUFLLElBQUksQ0FBRSxDQUFDLENBQUM7U0FDNUU7SUFDSCxDQUFDLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQXRDRCwwQkFzQ0M7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtJQUNQLElBQUEsU0FBUyxHQUFLLElBQUEsc0JBQVksR0FBRSxVQUFuQixDQUFvQjtJQUNyQyxPQUFPLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBjb21tb25JZ25vcmUsIGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBBdXRvIHNlbyBydW5uZXJcbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTZW8oX2RvbmU6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q6IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaWdub3JlOiBzdHJpbmdbXSA9IEFycmF5LmlzQXJyYXkoY29uZmlnLmV4Y2x1ZGUpID8gY29uZmlnLmV4Y2x1ZGUgOiBbXTtcbiAgaWdub3JlLnB1c2goLi4uY29tbW9uSWdub3JlKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKi57aHRtLGh0bWx9JywgJyoue2h0bWwsaHRtfSddLCB7IGN3ZCwgaWdub3JlIH0pXG4gICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzZW8nIH0pKVxuICAgIC5waXBlKFxuICAgICAgZ3VscERvbShmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAvLyBmaXggYWx0IGltYWdlc1xuICAgICAgICBjb25zdCBpbWFnZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW1nW3NyY10nKSk7XG4gICAgICAgIGltYWdlcy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFsdCA9IGVsLmdldEF0dHJpYnV0ZSgnYWx0Jyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBBbHQnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdhbHQnLCB0aXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBmaXggdGl0bGUgaWZyYW1lXG4gICAgICAgIGNvbnN0IGlmcmFtZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaWZyYW1lW3NyY10nKSk7XG4gICAgICAgIGlmcmFtZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBUaXRsZSc7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV0FSTklORyBNQUtFUlxuICAgICAgICAvLyBjb3VudCBIMVxuICAgICAgICBjb25zdCBoMSA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaDEnKTtcbiAgICAgICAgaWYgKGgxLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBMb2dnZXIubG9nKGFuc2lDb2xvcnMueWVsbG93QnJpZ2h0KCdbV0FSTl0nKSwgYEgxICgke2gxLmxlbmd0aH0pICR7cGF0aH1gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGN3ZCkpO1xufVxuXG5ndWxwLnRhc2soJ3NlbycsIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgeyBkZXBsb3lEaXIgfSA9IGRlcGxveUNvbmZpZygpO1xuICByZXR1cm4gdGFza1NlbyhudWxsLCBkZXBsb3lEaXIpO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/ee/gulpseo_ee59cff135689a98b46d52951c185d0d.map","wrapperLength":82},"result":{"scriptId":"4649","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8740,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8737,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc3RhbmRhbG9uZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QiwwREFBb0M7QUFDcEMseUNBQTZDO0FBQzdDLHFDQUFzQztBQUV0Qzs7O0dBR0c7QUFDSCxTQUFTLGdCQUFnQjtJQUN2QixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ2hELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUscUJBQXFCLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztTQUNsRyxJQUFJLENBQ0gsa0JBQVEsQ0FBQyxHQUFHLENBQUMsVUFBZ0IsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJOzs7Ozs7d0JBQzNDLGdCQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzt3QkFDeEQsS0FBQSxDQUFBLEtBQUEsZ0JBQU0sQ0FBQSxDQUFDLEdBQUcsQ0FBQTs7d0JBQVMscUJBQU0sSUFBQSxvQkFBVyxFQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBQSxtQkFBUyxHQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFBOzt3QkFBcEUsY0FBVyxtQkFBUSxTQUFpRCxFQUFFLEVBQUMsQ0FBQzt3QkFDeEUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNsRCxLQUFLLEdBQUcsSUFBQSxxQkFBSyxFQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO3dCQUMvRCxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRTs0QkFDaEIsWUFBWTs0QkFDWixJQUFJLEVBQUUsQ0FBQzt3QkFDVCxDQUFDLENBQUMsQ0FBQzs7Ozs7S0FDSixDQUFDLENBQ0g7U0FDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1NBQ3hELElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDWCxnQkFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUUvQyxrQkFBZSxnQkFBZ0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5zdGFuZGFsb25lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyByZXBsYWNlUGF0aCB9IGZyb20gJy4vdXRpbHMvc3RyaW5nJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogcnVuIGFsbCBfKi5zdGFuZGFsb25lLmpzIGluc2lkZSBzcmMtcG9zdHMgKF9jb25maWdfeW1sLnBvc3RfZGlyKVxuICogQHJldHVybnNcbiAqL1xuZnVuY3Rpb24gc3RhbmRhbG9uZVJ1bm5lcigpIHtcbiAgTG9nZ2VyLmxvZygnW3N0YW5kYWxvbmVdIFJ1bm5pbmcgc2NyaXB0cy4uLlxcbicpO1xuICByZXR1cm4gZ3VscFxuICAgIC5zcmMoam9pbihnZXRDb25maWcoKS5jd2QsICcqKi9fKi5zdGFuZGFsb25lLmpzJyksIHsgY3dkOiBnZXRDb25maWcoKS5jd2QsIGlnbm9yZTogWycqKi90bXAvKionXSB9KVxuICAgIC5waXBlKFxuICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIGZ1bmN0aW9uIChmaWxlLCBfZW5jLCBuZXh0KSB7XG4gICAgICAgIExvZ2dlci5sb2coJz0nLnJlcGVhdCgxMCkgKyAnIGlucHV0ICcgKyAnPScucmVwZWF0KDEwKSk7XG4gICAgICAgIExvZ2dlci5sb2coYG5vZGUgJHthd2FpdCByZXBsYWNlUGF0aChmaWxlLnBhdGgsIGdldENvbmZpZygpLmN3ZCwgJycpfWApO1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBvdXB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXduKCdub2RlJywgW2ZpbGUucGF0aF0sIHsgc3RkaW86ICdpbmhlcml0JyB9KTtcbiAgICAgICAgY2hpbGQub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3AgZmlsZVxuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIClcbiAgICAucGlwZShndWxwLmRlc3Qoam9pbihnZXRDb25maWcoKS5jd2QsICd0bXAvc3RhbmRhbG9uZScpKSlcbiAgICAub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgTG9nZ2VyLmxvZygnXFxuW3N0YW5kYWxvbmVdIHN0b3BwZWQnKTtcbiAgICB9KTtcbn1cblxuZ3VscC50YXNrKCdwb3N0OnN0YW5kYWxvbmUnLCBzdGFuZGFsb25lUnVubmVyKTtcblxuZXhwb3J0IGRlZmF1bHQgc3RhbmRhbG9uZVJ1bm5lcjtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/70/gulpstandalone_70a88f15ac851281d69271b2b48c84eb.map","wrapperLength":82},"result":{"scriptId":"4655","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8780,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8777,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLHFDQUF3QztBQUN4Qyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF1QztBQUN2Qyx1Q0FBeUM7QUFDekMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyx5QkFBeUI7QUFDekIsbURBQXNEO0FBQ3RELCtCQUE2QjtBQUM3QixxQ0FBcUM7QUFDckMsdUNBQWlFO0FBQ2pFLGlDQUF1QztBQUN2QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHNFQUErQztBQUMvQyxxQ0FBK0Q7QUFFL0Q7Ozs7RUFJRTtBQUNGLElBQUksUUFBUSxHQUFHLEVBQWMsQ0FBQztBQUM5QixJQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO0FBQ2xDLElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCOzs7OztHQUtHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLEdBQStCLEVBQUUsSUFBUTtJQUF6RSxpQkE2REM7SUE3RGdFLHFCQUFBLEVBQUEsUUFBUTtJQUN2RSxPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQW9DO1FBQ3ZELElBQU0sUUFBUSxHQUF5QyxFQUFFLENBQUM7UUFDMUQsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7WUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixRQUFRLENBQUMsSUFBSSxDQUNYLElBQUEscUNBQW1CLEVBQUMsR0FBRyxFQUFFO2dCQUN2QixJQUFJLE1BQUE7YUFDTCxDQUFDLENBQ0gsQ0FBQztTQUNIO2FBQU07WUFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsQ0FB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QUFBLGtCQUFPLEVBQUM7b0JBQ04seUJBQXlCO29CQUN6QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLG1CQUFlLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQzt3QkFDeEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDZCQUEyQixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDL0Q7d0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNkZBQStFLE9BQU8scUJBQWlCLENBQUM7cUJBQ2hJO29CQUNELHVFQUF1RTtnQkFDekUsQ0FBQyxDQUFDLENBQ0g7cUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7cUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLE9BQU8sRUFBRSxFQUFULENBQVMsQ0FBQyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFqR0Qsa0RBaUdDO0FBRUQsU0FBUyxPQUFPLENBQUMsSUFBWSxFQUFFLFFBQW9DO0lBQ2pFLE9BQU8sb0JBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtJQUNuQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQU87UUFDMUIsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGhleG8gfSBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciB9IGZyb20gJ2hleG8tdXRpbCc7XG5pbXBvcnQgbWljcm9tYXRjaCBmcm9tICdtaWNyb21hdGNoJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBzaXRlbWFwQ3Jhd2xlckFzeW5jIH0gZnJvbSAnc2l0ZW1hcC1jcmF3bGVyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyB5b2FzdFNlbyB9IGZyb20gJy4vc2l0ZW1hcCc7XG5pbXBvcnQgeyBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qXG4vLyByZWFkIGV4aXN0aW5nIHNpdGVtYXAudHh0XG5jb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xubGV0IHNpdGVtYXBzID0gZXhpc3RzU3luYyhzaXRlbWFwVFhUKSA/IGFycmF5X3JlbW92ZV9lbXB0eShyZWFkRmlsZVN5bmMoc2l0ZW1hcFRYVCwgJ3V0Zi04Jykuc3BsaXQoL1xccj9cXG4vZ20pKSA6IFtdO1xuKi9cbmxldCBzaXRlbWFwcyA9IFtdIGFzIHN0cmluZ1tdO1xuY29uc3QgY3Jhd2xlZCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuLyoqXG4gKiBTaXRlbWFwIEdlbmVyYXRvclxuICogQHBhcmFtIHVybCB1cmwgdG8gY3Jhd2xcbiAqIEBwYXJhbSBkZWVwIGNyYXdsIGRlZXBlciBuIHRpbWVzXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTaXRlbWFwKHVybD86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsIGRlZXAgPSAwKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmU6IChzaXRlbWFwczogc3RyaW5nW10pID0+IGFueSkgPT4ge1xuICAgIGNvbnN0IHByb21pc2VzOiBCbHVlYmlyZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4+W10gPSBbXTtcbiAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKHVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNyYXdsZWQuYWRkKGdldENvbmZpZygpLnVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKGdldENvbmZpZygpLnVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIEJsdWViaXJkLmFsbChwcm9taXNlcylcbiAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hcHBlZCA9IHt9IGFzIFJldHVyblR5cGU8dHlwZW9mIHNpdGVtYXBDcmF3bGVyQXN5bmM+O1xuICAgICAgICByZXN1bHRzLmZvckVhY2goKHNpdGVtYXApID0+IHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBzaXRlbWFwKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBzaXRlbWFwW2tleV07XG4gICAgICAgICAgICBpZiAoa2V5IGluIG1hcHBlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSB2YWx1ZXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBtYXBwZWRba2V5XSA9IGFycmF5X3VuaXF1ZSh2YWx1ZXMuY29uY2F0KG1hcHBlZFtrZXldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIGNvbnN0IHNhdmV0byA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL3NpdGVtYXAvc2l0ZW1hcC5qc29uJyk7XG4gICAgICAgIHdyaXRlZmlsZShzYXZldG8sIEpTT04uc3RyaW5naWZ5KG1hcHBlZCwgbnVsbCwgMikpO1xuXG4gICAgICAgIC8vIHJldHVyblxuICAgICAgICByZXR1cm4gbWFwcGVkO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGFzeW5jIChyZXN1bHRzKSA9PiB7XG4gICAgICAgIHNpdGVtYXBzID0gYXJyYXlfdW5pcXVlKGFycmF5X3JlbW92ZV9lbXB0eShPYmplY3QudmFsdWVzKHJlc3VsdHMpLmZsYXQoMSkuY29uY2F0KHNpdGVtYXBzKSkpLnNvcnQoZnVuY3Rpb24gKFxuICAgICAgICAgIGEsXG4gICAgICAgICAgYlxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IDAgOiBhIDwgYiA/IC0xIDogMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWVwOyBpKyspIHtcbiAgICAgICAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgc2l0ZW1hcHMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBzaXRlbWFwc1tpaV07XG4gICAgICAgICAgICBpZiAoY3Jhd2xlZC5oYXModXJsKSB8fCAvLihqc3x0c3xjc3N8c2Nzc3x0eHR8cGRmfHBuZ3xqcGU/Z3xnaWZ8d2VicCkkL2dpLnRlc3QodXJsKSkgY29udGludWU7XG5cbiAgICAgICAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICAgICAgICBMb2dnZXIubG9nKCdbZGVwdGhdJywgaWksIHVybCk7XG4gICAgICAgICAgICBhd2FpdCBnZW5lcmF0ZVNpdGVtYXAodXJsLCBkZWVwKS50aGVuKCgpID0+IHdyaXRlU2l0ZW1hcCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB3cml0ZVNpdGVtYXAocmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8qKlxuICogd3JpdGUgdGhlIHNpdGVtYXBcbiAqIEBwYXJhbSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiB3cml0ZVNpdGVtYXAoY2FsbGJhY2s/OiAoLi4uYXJnczogYW55W10pID0+IGFueSkge1xuICBsZXQgY2IgPSBub29wO1xuICBpZiAoY2FsbGJhY2spIGNiID0gKCkgPT4gY2FsbGJhY2soc2l0ZW1hcHMpO1xuICBjb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xuICB3cml0ZWZpbGUoc2l0ZW1hcFRYVCwgYXJyYXlfcmVtb3ZlX2VtcHR5KHNpdGVtYXBzKS5qb2luKEVPTCkpO1xuICBjYi5hcHBseSh0aGlzKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaXRlbWFwT3B0aW9ucyB7XG4gIHBhdGg6IHN0cmluZ1tdO1xuICB0YWdzOiBib29sZWFuO1xuICBjYXRlZ29yaWVzOiBib29sZWFuO1xuICByZWw6IGJvb2xlYW47XG4gIHlvYXN0OiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4b0dlbmVyYXRlU2l0ZW1hcCgpIHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oZ2V0Q29uZmlnKCkuY3dkKTtcbiAgICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICBpbnN0YW5jZS5sb2FkKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb25maWcgPSBzZXRDb25maWcoaW5zdGFuY2UuY29uZmlnKTtcbiAgICAgICAgLy8gYXNzaWduIGRlZmF1bHQgY29uZmlnXG4gICAgICAgIGNvbnN0IHNpdGVtYXA6IFNpdGVtYXBPcHRpb25zID0gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICB7IHJlbDogZmFsc2UsIHRhZ3M6IGZhbHNlLCBjYXRlZ29yaWVzOiBmYWxzZSwgcGF0aDogWydzaXRlbWFwLnR4dCcsICdzaXRlbWFwLnhtbCddIH0sXG4gICAgICAgICAgY29uZmlnLnNpdGVtYXBcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCdWlsZCBZb2FzdCBTRU8gc2l0ZW1hcFxuICAgICAgICAvLyB3aGVuIGNvbmZpZy55b2FzdCBkZWZpbmVkXG4gICAgICAgIGlmIChzaXRlbWFwLnlvYXN0KSB7XG4gICAgICAgICAgcmV0dXJuIHlvYXN0U2VvKGluc3RhbmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLnNpdGVtYXApIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAgbm90IGNvbmZpZ3VyZWQgaW4gX2NvbmZpZy55bWwnKTtcbiAgICAgICAgY29uc3QgbG9jYWxzID0gaW5zdGFuY2UubG9jYWxzO1xuICAgICAgICBjb25zdCB7IHNraXBfcmVuZGVyIH0gPSBjb25maWc7XG5cbiAgICAgICAgaWYgKCFzaXRlbWFwLnRhZ3MgfHwgIXNpdGVtYXAuY2F0ZWdvcmllcykge1xuICAgICAgICAgIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAudGFncyBvciBjb25maWcuc2l0ZW1hcC5jYXRlZ29yaWVzIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2tpcFJlbmRlckxpc3QgPSBbJyoqLyouanMnLCAnKiovKi5jc3MnLCAnKiovLmdpdConXTtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShza2lwX3JlbmRlcikpIHtcbiAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKC4uLnNraXBfcmVuZGVyKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2tpcF9yZW5kZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaWYgKHNraXBfcmVuZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNraXBSZW5kZXJMaXN0LnB1c2goc2tpcF9yZW5kZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvc3RzID0gWy4uLmxvY2Fscy5nZXQoJ3BhZ2VzJykudG9BcnJheSgpLCAuLi5sb2NhbHMuZ2V0KCdwb3N0cycpLnRvQXJyYXkoKV1cbiAgICAgICAgICAuZmlsdGVyKChwb3N0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcG9zdC5zaXRlbWFwICE9PSBmYWxzZSAmJiAhaXNNYXRjaChwb3N0LnNvdXJjZSwgc2tpcFJlbmRlckxpc3QpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnVwZGF0ZWQgJiYgYS51cGRhdGVkKSByZXR1cm4gYi51cGRhdGVkLnRvRGF0ZSgpLmdldFRpbWUoKSAtIGEudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAocG9zdHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdG1wbFNyYyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9zaXRlbWFwLnhtbCcpO1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuICAgICAgICBjb25zdCB7IHRhZ3M6IHRhZ3NDZmcsIGNhdGVnb3JpZXM6IGNhdHNDZmcsIHJlbDogcmVsQ2ZnIH0gPSBzaXRlbWFwO1xuICAgICAgICBsZXQgZGF0YSA9IHRlbXBsYXRlLnJlbmRlcih7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIHBvc3RzLFxuICAgICAgICAgIHNOb3c6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdGFnczogdGFnc0NmZyA/IGxvY2Fscy5nZXQoJ3RhZ3MnKS50b0FycmF5KCkgOiBbXSxcbiAgICAgICAgICBjYXRlZ29yaWVzOiBjYXRzQ2ZnID8gbG9jYWxzLmdldCgnY2F0ZWdvcmllcycpLnRvQXJyYXkoKSA6IFtdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlbW92ZSBibGFuayBuZXdsaW5lc1xuICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9eXFxzKltcXHJcXG5dL2dtLCAnXFxuJyk7XG5cbiAgICAgICAgLy9kYXRhID0gcHJldHRpZXIuZm9ybWF0KGRhdGEsIHsgcGFyc2VyOiAneG1sJywgcGx1Z2luczogW3htbHBsdWdpbl0sIGVuZE9mTGluZTogJ2xmJyB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIHdyaXRlZmlsZShqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAueG1sJyksIGRhdGEpO1xuXG4gICAgICAgIC8vIHdyaXRlXG4gICAgICAgIGNvbnN0IHNpdGVtYXBYbWwgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdzaXRlbWFwLnhtbCcpO1xuICAgICAgICB3cml0ZWZpbGUoc2l0ZW1hcFhtbCwgZGF0YSk7XG4gICAgICAgIGluc3RhbmNlLmxvZy5pbmZvKCdzaXRlbWFwIHdyaXR0ZW4nLCBzaXRlbWFwWG1sKTtcblxuICAgICAgICBpZiAoIXJlbENmZykgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgY29uc3QgYmFzZVVSTCA9IGNvbmZpZy51cmwuZW5kc1dpdGgoJy8nKSA/IGNvbmZpZy51cmwgOiBjb25maWcudXJsICsgJy8nO1xuICAgICAgICBjb25zdCBwdWJsaWNEaXIgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgICBndWxwXG4gICAgICAgICAgLnNyYygnKiovKi5odG1sJywgeyBjd2Q6IHB1YmxpY0RpciwgaWdub3JlOiBjb21tb25JZ25vcmUgfSlcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBzaXRlbWFwXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3NpdGVtYXAueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwic2l0ZW1hcC1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi90ZXh0K3htbFwiIHJlbD1cInNpdGVtYXBcIiBocmVmPVwiJHtiYXNlVVJMfXNpdGVtYXAueG1sXCIgLz5gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgICAub25jZSgnZW5kJywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaXNNYXRjaChwYXRoOiBzdHJpbmcsIHBhdHRlcm5zOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSkge1xuICByZXR1cm4gbWljcm9tYXRjaC5pc01hdGNoKHBhdGgsIHBhdHRlcm5zKTtcbn1cblxuZ3VscC50YXNrKCdzaXRlbWFwJywgKCkgPT4ge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgaGV4b0dlbmVyYXRlU2l0ZW1hcCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/e1/gulpsitemap_e101e74aed6d774c00756f77ebed36bd.map","wrapperLength":82},"result":{"scriptId":"4659","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33900,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33897,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDhDQUF3QjtBQUN4Qix1Q0FBa0M7QUFDbEMsK0JBQTZCO0FBQzdCLHdCQUFzQjtBQUN0Qix5QkFBdUI7QUFDdkIsdUJBQXFCO0FBQ3JCLDJCQUF5QjtBQUN6QixzQkFBb0I7QUFDcEIsdUJBQXFCO0FBQ3JCLDZCQUEyQjtBQUMzQiwwREFBb0M7QUFFcEMseUJBQXlCO0FBQ3pCLFNBQWdCLGFBQWEsQ0FBQyxNQUFpQztJQUM3RCxJQUFNLE9BQU8sR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxXQUFXLENBQUMsRUFBRSxJQUFBLFlBQUksRUFBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDakcsSUFBTSxNQUFNLEdBQUc7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU07WUFBRSxPQUFPLE1BQU0sRUFBRSxDQUFDO1FBQ3JDLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFNLEdBQUcsR0FBRztZQUNWLEdBQUcsRUFBRSxNQUFNO1lBQ1gsS0FBSyxFQUFFLFNBQVM7U0FDakIsQ0FBQztRQUNGLE9BQU8sSUFBQSxpQkFBSyxFQUFDLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBTyxHQUFHLENBQUM7YUFDekMsSUFBSSxDQUFDLGNBQU0sT0FBQSxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxFQUFPLEdBQUcsQ0FBQyxFQUFoRSxDQUFnRSxDQUFDO2FBQzVFLEtBQUssQ0FBQyxVQUFDLENBQUM7WUFDUCxJQUFJLENBQUMsWUFBWSxLQUFLO2dCQUFFLGdCQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDO2FBQ0QsT0FBTyxDQUFDO1lBQ1AsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2hCLE1BQU0sRUFBRSxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUM7SUFDRixPQUFPLE1BQU0sRUFBRSxDQUFDO0FBQ2xCLENBQUM7QUFwQkQsc0NBb0JDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUUzQyxrQkFBZSxjQUFJLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgc3Bhd24gfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLmRlcGxveSc7XG5pbXBvcnQgJy4vZ3VscC5mZWVkJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgJy4vcG9zdC9jb3B5JztcbmltcG9ydCAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5cbi8vIGNvbW1pdCBjdXJyZW50IHByb2plY3RcbmV4cG9ydCBmdW5jdGlvbiBjb21taXRQcm9qZWN0KGZpbmlzaDogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBnaXREaXJzID0gW2pvaW4ocHJvY2Vzcy5jd2QoKSwgJ3NyYy1wb3N0cycpLCBqb2luKHByb2Nlc3MuY3dkKCksICdzb3VyY2UnKSwgcHJvY2Vzcy5jd2QoKV07XG4gIGNvbnN0IGNvbW1pdCA9ICgpID0+IHtcbiAgICBpZiAoIWdpdERpcnMubGVuZ3RoKSByZXR1cm4gZmluaXNoKCk7XG4gICAgY29uc3QgZ2l0RGlyID0gZ2l0RGlyc1swXTtcbiAgICBjb25zdCBvcHQgPSB7XG4gICAgICBjd2Q6IGdpdERpcixcbiAgICAgIHN0ZGlvOiAnaW5oZXJpdCdcbiAgICB9O1xuICAgIHJldHVybiBzcGF3bignZ2l0JywgWydhZGQnLCAnLUEnXSwgPGFueT5vcHQpXG4gICAgICAudGhlbigoKSA9PiBzcGF3bignZ2l0JywgWydjb21taXQnLCAnLW0nLCAndXBkYXRlICcgKyBuZXcgRGF0ZSgpXSwgPGFueT5vcHQpKVxuICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIExvZ2dlci5sb2coZS5tZXNzYWdlLCBnaXREaXIpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgZ2l0RGlycy5zaGlmdCgpO1xuICAgICAgICBjb21taXQoKTtcbiAgICAgIH0pO1xuICB9O1xuICByZXR1cm4gY29tbWl0KCk7XG59XG5cbmd1bHAudGFzaygncHJvamVjdC1jb21taXQnLCBjb21taXRQcm9qZWN0KTtcblxuZXhwb3J0IGRlZmF1bHQgZ3VscDtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/c0/gulpfile_c0c9f96e795586c702c83946161b1950.map","wrapperLength":82},"result":{"scriptId":"5008","url":"D:\\Repositories\\static-blog-generator\\src\\gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4931,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4928,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlCQUF1RTtBQUN2RSw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBbUQ7QUFDbkQsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QixzRUFBK0M7QUFDL0MscUNBQW9EO0FBRXBELElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCLGNBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsSUFBSTtJQUM5QixJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFFBQVEsR0FBRyxJQUFJLGNBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQztRQUNuQixRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFVBQUMsR0FBRztnQkFDN0IsT0FBTyx3QkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUM7WUFFSCxTQUFTLEtBQUssQ0FBQyxPQUE2QixFQUFFLElBQTBCO2dCQUN0RSxJQUFNLFFBQVEsR0FBRyxrQkFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUV2RSxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDekMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzVCLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFB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QTRFLE9BQU8saUJBQWEsQ0FBQztpQkFDekg7Z0JBQ0Qsc0JBQXNCO2dCQUN0QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLGdCQUFZLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQztvQkFDckUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDBCQUF3QixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDNUQ7b0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNEZBQThFLE9BQU8sa0JBQWMsQ0FBQztpQkFDNUg7Z0JBQ0QsdUVBQXVFO1lBQ3pFLENBQUMsQ0FBQyxDQUNIO2lCQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUMxQixJQUFJLENBQUMsS0FBSyxFQUFFLGNBQU0sT0FBQSxJQUFJLEVBQUUsRUFBTixDQUFNLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXRoT3JGaWxlRGVzY3JpcHRvciwgcmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgaGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciwgZ3JhdmF0YXIgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG51bmp1Y2tzIGZyb20gJ251bmp1Y2tzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG5jb25zdCBlbnYgPSBlbnZOdW5qdWNrcygpO1xuXG5ndWxwLnRhc2soJ2ZlZWQnLCBmdW5jdGlvbiAoZG9uZSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaW5zdGFuY2UgPSBuZXcgaGV4byhjb25maWcuY3dkKTtcblxuICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oKCkgPT4ge1xuICAgICAgZW52LmFkZEZpbHRlcignZm9ybWF0VXJsJywgKHN0cikgPT4ge1xuICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICB9KTtcblxuICAgICAgZnVuY3Rpb24gYnVpbGQodG1wbFNyYzogUGF0aE9yRmlsZURlc2NyaXB0b3IsIGRlc3Q6IFBhdGhPckZpbGVEZXNjcmlwdG9yKSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gbnVuanVja3MuY29tcGlsZShyZWFkRmlsZVN5bmModG1wbFNyYywgJ3V0Zi04JyksIGVudik7XG5cbiAgICAgICAgbGV0IHBvc3RzID0gaW5zdGFuY2UubG9jYWxzLmdldCgncG9zdHMnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5zb3J0KCctZGF0ZScpO1xuICAgICAgICBwb3N0cyA9IHBvc3RzLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwb3N0LmRyYWZ0ICE9PSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB7IGVtYWlsLCBmZWVkLCB1cmw6IHVybENmZyB9ID0gY29uZmlnO1xuICAgICAgICBjb25zdCB7IGljb246IGljb25DZmcgfSA9IGZlZWQ7XG5cbiAgICAgICAgbGV0IHVybCA9IHVybENmZztcbiAgICAgICAgaWYgKHVybFt1cmwubGVuZ3RoIC0gMV0gIT09ICcvJykgdXJsICs9ICcvJztcbiAgICAgICAgLy8gcmVtb3ZlIGJyb2tlbiBoZXhvIGxhbmcgc2hvcnRjb2RlXG4gICAgICAgIGlmICh1cmwuaW5jbHVkZXMoJzpsYW5nLycpKSB1cmwgPSB1cmwucmVwbGFjZSgnLzpsYW5nLycsICcvJyk7XG5cbiAgICAgICAgbGV0IGljb24gPSAnJztcbiAgICAgICAgaWYgKGljb25DZmcpIGljb24gPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgaWNvbkNmZyk7XG4gICAgICAgIGVsc2UgaWYgKGVtYWlsKSBpY29uID0gZ3JhdmF0YXIoZW1haWwsIHt9KTtcblxuICAgICAgICBjb25zdCBmZWVkX3VybCA9IGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCAncnNzLnhtbCcpO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgaWNvbixcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBmZWVkX3VybFxuICAgICAgICB9KTtcblxuICAgICAgICB3cml0ZUZpbGVTeW5jKGRlc3QsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVJTUyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9yc3MueG1sJyk7XG4gICAgICBjb25zdCBkZXN0UlNTID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2RpciwgJ3Jzcy54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlUlNTLCBkZXN0UlNTKTtcblxuICAgICAgY29uc3QgdGVtcGxhdGVBVE9NID0gam9pbihfX2Rpcm5hbWUsICdfY29uZmlnX3RlbXBsYXRlX2F0b20ueG1sJyk7XG4gICAgICBjb25zdCBkZXN0QVRPTSA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdhdG9tLnhtbCcpO1xuICAgICAgYnVpbGQodGVtcGxhdGVBVE9NLCBkZXN0QVRPTSk7XG5cbiAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcblxuICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG4gICAgICBndWxwXG4gICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgcnNzXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIvcnNzLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwicnNzLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL3Jzcyt4bWxcIiByZWw9XCJhbHRlcm5hdGVcIiBocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBhdG9tXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfWF0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL2F0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5oZWFkLmlubmVySFRNTCArPSBgPGxpbmsgaWQ9XCJhdG9tLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL2F0b20reG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiIC8+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IGRvbmUoKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/21/gulpfeed_218d054d70d3561ba89867e4695c6976.map","wrapperLength":82},"result":{"scriptId":"5009","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13306,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13303,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":6,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673237839682,"runtime":21789,"slow":true,"start":1673237817893},"skipped":false,"testFilePath":"D:\\Repositories\\static-blog-generator\\test\\permalink-title.test.ts","testResults":[{"ancestorTitles":["permalink",":title.html","clean"],"duration":292,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["permalink",":title.html","clean"],"duration":16,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["permalink",":title.html","copy"],"duration":12407,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["permalink",":title.html","copy"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"},{"ancestorTitles":["permalink",":title.html","validate"],"duration":418,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html validate post with custom permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post with custom permalink"},{"ancestorTitles":["permalink",":title.html","validate"],"duration":71,"failureDetails":[],"failureMessages":[],"fullName":"permalink :title.html validate post without permalink","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"post without permalink"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGluZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUErQztBQUF0QyxtSEFBQSxPQUFPLE9BQWU7QUFDL0Isc0RBQWdFO0FBQXZELHlIQUFBLE9BQU8sT0FBYztBQUM5QixzREFBK0Q7QUFBdEQsd0hBQUEsT0FBTyxPQUFhO0FBQzdCLDJDQUE4RDtBQUFyRCxxR0FBQSxPQUFPLE9BQUE7QUFBRSxpR0FBQSxHQUFHLE9BQUE7QUFBRSx1R0FBQSxHQUFHLE9BQWE7QUFDdkMsdUNBQWdEO0FBQXZDLG1HQUFBLE9BQU8sT0FBVztBQUMzQiwrQ0FBc0U7QUFBN0QsK0dBQUEsZUFBZSxPQUFBO0FBQUUsbUhBQUEsbUJBQW1CLE9BQUE7QUFDN0MscURBQWdFO0FBQXZELG9JQUFBLE9BQU8sT0FBb0I7QUFDcEMsdUNBQTREO0FBQW5ELHlHQUFBLGFBQWEsT0FBQTtBQUFFLGlIQUFBLE9BQU8sT0FBUTtBQUN2QyxvQ0FBMkQ7QUFBbEQsb0dBQUEsWUFBWSxPQUFBO0FBQUUsc0dBQUEsY0FBYyxPQUFBO0FBQ3JDLHdDQUEyQztBQUFsQyxvR0FBQSxVQUFVLE9BQUE7QUFDbkIsdUNBQStFO0FBQXRFLHFHQUFBLFlBQVksT0FBQTtBQUFFLDJHQUFBLGtCQUFrQixPQUFBO0FBQUUscUdBQUEsWUFBWSxPQUFBO0FBQ3ZELHFDQUFvQztBQUEzQiw0RkFBQSxJQUFJLE9BQUE7QUFDYiwrQ0FBeUQ7QUFBaEQsdUhBQUEsT0FBTyxPQUFhO0FBQzdCLHFDQUErRDtBQUF0RCx1R0FBQSxZQUFZLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFFM0MsRUFBRSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgZGVmYXVsdCBhcyBBcHBsaWNhdGlvbiB9IGZyb20gJy4vYXBpJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscENhY2hlZCB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscERlYnVnIH0gZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuZGVidWcnO1xuZXhwb3J0IHsgY2xlYW5EYiwgZGVsLCBkZWwgYXMgZGVsZXRlRGlyIH0gZnJvbSAnLi9ndWxwLmNsZWFuJztcbmV4cG9ydCB7IHRhc2tTZW8gYXMgYXV0b1NlbyB9IGZyb20gJy4vZ3VscC5zZW8nO1xuZXhwb3J0IHsgZ2VuZXJhdGVTaXRlbWFwLCBoZXhvR2VuZXJhdGVTaXRlbWFwIH0gZnJvbSAnLi9ndWxwLnNpdGVtYXAnO1xuZXhwb3J0IHsgZGVmYXVsdCBhcyBzdGFuZGFsb25lUnVubmVyIH0gZnJvbSAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuZXhwb3J0IHsgY29tbWl0UHJvamVjdCwgZGVmYXVsdCBhcyBndWxwIH0gZnJvbSAnLi9ndWxwZmlsZSc7XG5leHBvcnQgeyBjb3B5QWxsUG9zdHMsIGNvcHlTaW5nbGVQb3N0IH0gZnJvbSAnLi9wb3N0L2NvcHknO1xuZXhwb3J0IHsgdXBkYXRlUG9zdCB9IGZyb20gJy4vcG9zdC91cGRhdGUnO1xuZXhwb3J0IHsgYXJyYXlfcmFuZG9tLCBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuZXhwb3J0IHsgbm9vcCB9IGZyb20gJy4vdXRpbHMvbm9vcCc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIHNjaGVkdWxlciB9IGZyb20gJy4vdXRpbHMvc2NoZWR1bGVyJztcbmV4cG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vL1xuIl0sInZlcnNpb24iOjN9","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/11/index_11ca8584e92c62acbf7dbcbf146ed11f.map","wrapperLength":82},"result":{"scriptId":"6345","url":"D:\\Repositories\\static-blog-generator\\src\\index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":6665,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":6662,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":210,"endOffset":230,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":904,"endOffset":958,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1088,"endOffset":1149,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1278,"endOffset":1339,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1455,"endOffset":1499,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1567,"endOffset":1607,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1681,"endOffset":1721,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1833,"endOffset":1875,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2003,"endOffset":2057,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2141,"endOffset":2199,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2334,"endOffset":2400,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2518,"endOffset":2566,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2635,"endOffset":2694,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2808,"endOffset":2851,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2930,"endOffset":2975,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3091,"endOffset":3134,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3251,"endOffset":3295,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3378,"endOffset":3428,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3505,"endOffset":3549,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3656,"endOffset":3691,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3813,"endOffset":3873,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3988,"endOffset":4034,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4108,"endOffset":4151,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4225,"endOffset":4268,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_deploy_1 = require(\"./gulp.deploy\");\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = {};\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, gulp_standalone_1.default)(); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        if (!options)\n            options = (0, _config_1.getConfig)();\n        this.cwd = cwd;\n        options.cwd = cwd;\n        this.config = this.setConfig(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * Copy all **src-post** to **source/_posts** (run before generate)\n     * * see the method {@link pcopy.copyAllPosts}\n     * @returns\n     */\n    SBG.prototype.copy = function () {\n        return new bluebird_1.default(function (resolve, reject) {\n            pcopy\n                .copyAllPosts()\n                .once('end', function () { return resolve(); })\n                .once('error', reject);\n        });\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SBG.prototype.deploy = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var config, github;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: \n                    // run generate task\n                    return [4 /*yield*/, this.generate()];\n                    case 1:\n                        // run generate task\n                        _a.sent();\n                        // copy generated files to deployment directory\n                        return [4 /*yield*/, (0, gulp_deploy_1.asyncCopyGen)()];\n                    case 2:\n                        // copy generated files to deployment directory\n                        _a.sent();\n                        config = (0, _config_1.getConfig)();\n                        github = config.deploy.github;\n                        if (!github)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, github.init().catch(noop_1.default)];\n                    case 3:\n                        _a.sent();\n                        return [4 /*yield*/, github.setremote(config.repo).catch(noop_1.default)];\n                    case 4:\n                        _a.sent();\n                        return [4 /*yield*/, github.setuser(config.username).catch(noop_1.default)];\n                    case 5:\n                        _a.sent();\n                        return [4 /*yield*/, github.setemail(config.email).catch(noop_1.default)];\n                    case 6:\n                        _a.sent();\n                        return [4 /*yield*/, github.setbranch(config.branch).catch(noop_1.default)];\n                    case 7:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 3:\n                        if (!(opt === 'archives')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 5: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        _a.label = 7;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGFwaS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QiwrQkFBNkI7QUFFN0Isb0RBQXdDO0FBQ3hDLDZDQUE2QztBQUM3QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLGdFQUEwQztBQUMxQyxxQ0FBaUQ7QUFFakQ7SUFNRTs7O09BR0c7SUFDSCxhQUFZLEdBQXFCLEVBQUUsT0FBeUM7UUFBNUUsaUJBUUM7UUFoQkQsV0FBTSxHQUFHLEVBQWtDLENBQUM7UUFDNUMsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUFDdEIsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUF3QnRCOzs7V0FHRztRQUNILGVBQVUsR0FBRyxjQUFNLE9BQUEsSUFBQSx5QkFBZ0IsR0FBRSxFQUFsQixDQUFrQixDQUFDO1FBRXRDOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQXJELENBQXFELENBQUM7UUFnQmxFOzs7V0FHRztRQUNILGFBQVEsR0FBRyxjQUFNLE9BQUEsSUFBQSw0QkFBWSxFQUFDLGNBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQTFELENBQTBELENBQUM7UUEvQzFFLElBQUksQ0FBQyxHQUFHO1lBQUUsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTztZQUFFLE9B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QUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEVBQUE7O3dCQUFqRCxTQUFpRCxDQUFDOzs7OztLQUNuRDtJQUVEOzs7O09BSUc7SUFDRyxtQkFBSyxHQUFYLFVBQVksR0FBcUM7Ozs7OzZCQUMzQyxDQUFBLEdBQUcsS0FBSyxLQUFLLENBQUEsRUFBYix3QkFBYTt3QkFDZixxQkFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBQTs7d0JBQTFDLFNBQTBDLENBQUM7d0JBQzNDLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs7NkJBQzNDLENBQUEsR0FBRyxLQUFLLFVBQVUsQ0FBQSxFQUFsQix3QkFBa0I7d0JBQzNCLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs0QkFFcEQscUJBQU0sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUExQyxTQUEwQyxDQUFDOzs7Ozs7S0FFOUM7SUFDSCxVQUFDO0FBQUQsQ0FBQyxBQXhHRCxJQXdHQztBQUVELGtCQUFlLEdBQUcsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgSGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyBOdWxsYWJsZSB9IGZyb20gJy4vZ2xvYmFscyc7XG5pbXBvcnQgKiBhcyBjbGVhbmVyIGZyb20gJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgeyBhc3luY0NvcHlHZW4gfSBmcm9tICcuL2d1bHAuZGVwbG95JztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHNjaGVkdWxlciBmcm9tICcuL3V0aWxzL3NjaGVkdWxlcic7XG5pbXBvcnQgeyBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbmNsYXNzIFNCRyB7XG4gIGN3ZDogc3RyaW5nO1xuICBjb25maWcgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBnZXRDb25maWc+O1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICBpZiAoIW9wdGlvbnMpIG9wdGlvbnMgPSBnZXRDb25maWcoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBvcHRpb25zLmN3ZCA9IGN3ZDtcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMuc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBzdGFuZGFsb25lUnVubmVyKCk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSgpIHtcbiAgICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoKSA9PiBhbnksIHJlamVjdDogKGVycjogRXJyb3IpID0+IGFueSkgPT4ge1xuICAgICAgcGNvcHlcbiAgICAgICAgLmNvcHlBbGxQb3N0cygpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiByZXNvbHZlKCkpXG4gICAgICAgIC5vbmNlKCdlcnJvcicsIHJlamVjdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQW5vbnltaXplIGV4dGVybmFsIGxpbmtzIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2FmZWxpbmsgPSAoKSA9PiB0YXNrU2FmZWxpbmsobm9vcCwgam9pbih0aGlzLmN3ZCwgZ2V0Q29uZmlnKCkucHVibGljX2RpcikpO1xuXG4gIC8qKlxuICAgKiBnZW5lcmF0ZSBzaXRlIHdpdGggaGV4b1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGUoKSB7XG4gICAgY29uc3QgaGV4byA9IG5ldyBIZXhvKHRoaXMuY3dkKTtcbiAgICAvLyBoZXhvIGluaXRcbiAgICBhd2FpdCBoZXhvLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBoZXhvLmxvYWQoKS5jYXRjaChub29wKTtcbiAgICAvLyBoZXhvIGdlbmVyYXRlXG4gICAgYXdhaXQgaGV4by5jYWxsKCdnZW5lcmF0ZScpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8uZXhpdCgpO1xuICB9XG5cbiAgYXN5bmMgZGVwbG95KCkge1xuICAgIC8vIHJ1biBnZW5lcmF0ZSB0YXNrXG4gICAgYXdhaXQgdGhpcy5nZW5lcmF0ZSgpO1xuICAgIC8vIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIHRvIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gICAgYXdhaXQgYXN5bmNDb3B5R2VuKCk7XG4gICAgLy8gZGVwbG95bWVudCBzdGFydFxuICAgIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBjb25maWcuZGVwbG95O1xuICAgIGlmICghZ2l0aHViKSByZXR1cm47XG4gICAgYXdhaXQgZ2l0aHViLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0cmVtb3RlKGNvbmZpZy5yZXBvKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0dXNlcihjb25maWcudXNlcm5hbWUpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRlbWFpbChjb25maWcuZW1haWwpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRicmFuY2goY29uZmlnLmJyYW5jaCkuY2F0Y2gobm9vcCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlcycgfCAnZGF0YWJhc2UnKSB7XG4gICAgaWYgKG9wdCA9PT0gJ2FsbCcpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ2FyY2hpdmVzJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuRGIoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNCRztcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { asyncCopyGen } from './gulp.deploy';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = {} as ReturnType<typeof getConfig>;\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    if (!options) options = getConfig();\n    this.cwd = cwd;\n    options.cwd = cwd;\n    this.config = this.setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => standaloneRunner();\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy() {\n    return new Bluebird((resolve: () => any, reject: (err: Error) => any) => {\n      pcopy\n        .copyAllPosts()\n        .once('end', () => resolve())\n        .once('error', reject);\n    });\n  }\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  async deploy() {\n    // run generate task\n    await this.generate();\n    // copy generated files to deployment directory\n    await asyncCopyGen();\n    // deployment start\n    const config = getConfig();\n    const { github } = config.deploy;\n    if (!github) return;\n    await github.init().catch(noop);\n    await github.setremote(config.repo).catch(noop);\n    await github.setuser(config.username).catch(noop);\n    await github.setemail(config.email).catch(noop);\n    await github.setbranch(config.branch).catch(noop);\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archives' | 'database') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archives') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/27/api_27977693f3bb9acc653b3d92027b188c.map","wrapperLength":82},"result":{"scriptId":"6346","url":"D:\\Repositories\\static-blog-generator\\src\\api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":20115,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":20112,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":6},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":3},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":2},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":2},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":4},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":4},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":5},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4456,"endOffset":10810,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4549,"endOffset":5806,"count":1},{"startOffset":5549,"endOffset":5569,"count":0},{"startOffset":5604,"endOffset":5641,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4884,"endOffset":4940,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5086,"endOffset":5208,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.safelink","ranges":[{"startOffset":5375,"endOffset":5517,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":5824,"endOffset":5877,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":5896,"endOffset":5947,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.copy","ranges":[{"startOffset":6129,"endOffset":6381,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6181,"endOffset":6373,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6289,"endOffset":6322,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6459,"endOffset":7552,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.deploy","ranges":[{"startOffset":7581,"endOffset":9402,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":9573,"endOffset":10791,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9637,"endOffset":10783,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9688,"endOffset":10771,"count":4},{"startOffset":9760,"endOffset":9922,"count":1},{"startOffset":9838,"endOffset":9922,"count":0},{"startOffset":9943,"endOffset":10078,"count":0},{"startOffset":10099,"endOffset":10190,"count":0},{"startOffset":10211,"endOffset":10387,"count":1},{"startOffset":10294,"endOffset":10387,"count":0},{"startOffset":10408,"endOffset":10499,"count":0},{"startOffset":10520,"endOffset":10587,"count":1},{"startOffset":10608,"endOffset":10688,"count":1},{"startOffset":10709,"endOffset":10739,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuY2xlYW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMscUNBQThEO0FBQzlELDhDQUF3QjtBQUN4Qix5QkFBeUI7QUFDekIsK0JBQTZCO0FBQzdCLDZCQUErQjtBQUMvQix3REFBa0M7QUFDbEMsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMscUNBQXNDO0FBRXRDOztHQUVHO0FBQ0gsU0FBc0IsT0FBTyxDQUFDLFFBQWtELEVBQUUsS0FBZ0I7Ozs7OztvQkFDMUYsR0FBRyxHQUFHLElBQUEsZUFBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUNyQixNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7b0JBQzNCLElBQUksT0FBTyxNQUFNLENBQUMsVUFBVSxLQUFLLFFBQVEsRUFBRTt3QkFDekMsSUFBQSxjQUFTLEVBQUMsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLElBQUEsY0FBTyxFQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7d0JBQ3JFLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztxQkFDekQ7b0JBSUcsSUFBSSxHQUFHO3dCQUNULElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUM7d0JBQzdDLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDO3dCQUM3QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQzt3QkFDNUIsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUM7d0JBQzVC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QUFDN0MsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDL0IsY0FBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLmNsZWFuLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCByZWFkZGlyLCBybSwgUm1PcHRpb25zIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IGRlYnVnIGZyb20gJy4vdXRpbHMvZGVidWcnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIENsZWFuIFByb2plY3QgRGF0YWJhc2VzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbkRiKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpLCBmaWxlcz86IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxvZyA9IGRlYnVnKCdjbGVhbicpO1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgaWYgKHR5cGVvZiBjb25maWcuc291cmNlX2RpciAhPT0gJ3N0cmluZycpIHtcbiAgICB3cml0ZWZpbGUoam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9jbGVhbi5sb2cnKSwgaW5zcGVjdChjb25maWcpKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbmZpZy5zb3VyY2VfZGlyIG11c3QgYmUgY29uZmlndXJlZCcpO1xuICB9XG5cbiAgLy8gY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG5cbiAgbGV0IGRpcnMgPSBbXG4gICAgam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9jYWNoZScpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9kdW1wJyksXG4gICAgam9pbihjb25maWcuY3dkLCAndG1wL2xvZ3MnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICdkYi5qc29uJylcbiAgXTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZmlsZXMpKSBkaXJzID0gZGlycy5jb25jYXQoZmlsZXMpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBkaXIgPSBkaXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICAgIGxvZygnY2xhbmluZycsIGRpcik7XG4gICAgICAgIGF3YWl0IGRlbChkaXIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2gge1xuICAgICAgbG9nKCdjYW5ub3QgZGVsZXRlJywgZGlyKTtcbiAgICB9XG4gIH1cblxuICAvKmNvbnN0IGhleG8gPSBuZXcgaGV4b0xpYihjb25maWcuY3dkKTtcbiAgYXdhaXQgaGV4by5pbml0KCkuY2F0Y2gobm9vcCk7XG4gIGF3YWl0IGhleG8uY2FsbCgnY2xlYW4nKS5jYXRjaChub29wKTsqL1xuXG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHJldHVybiBjYWxsYmFjaygpO1xuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogZGVsZXRlIGZvbGRlciBhc3luY1xuICogQHBhcmFtIHBhdGhcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWwocGF0aDogc3RyaW5nKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBybU9wdDogUm1PcHRpb25zID0geyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH07XG4gICAgaWYgKGV4aXN0c1N5bmMocGF0aCkpIHtcbiAgICAgIHJtKHBhdGgsIHJtT3B0KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgLyppZiAoc3RhdFN5bmMocGF0aCkuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICBybWRpcihwYXRoLCB7IG1heFJldHJpZXM6IDEwIH0pLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIH0qL1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlKG5ldyBFcnJvcihwYXRoICsgJyBub3QgZm91bmQnKSk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBjbGVhbiBvbGQgYXJjaGl2ZXMgKGNhdGVnb3JpZXMsIHRhZ3MsIHBhZ2luYXRpb24pIGZyb20gZGVwbG95bWVudCBkaXJlY3RvcnlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuT2xkQXJjaGl2ZXMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGxvZ25hbWUgPSAnY2xlYW46JyArIGFuc2lDb2xvcnMuZ3JleSgnYXJjaGl2ZXMnKTtcblxuICAvLyBjbGVhbiBhcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc1xuICBjb25zdCBhcmNoaXZlcyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy5hcmNoaXZlX2Rpcik7XG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuY2F0ZWdvcnlfZGlyKTtcbiAgY29uc3QgdGFncyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy50YWdfZGlyKTtcbiAgY29uc3QgZm9sZGVycyA9IFthcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc10uZmlsdGVyKChzdHIpID0+IGV4aXN0c1N5bmMoc3RyKSk7XG5cbiAgLy8gcHVzaCBsYW5ndWFnZSBmb2xkZXIgdG8gYmUgZGVsZXRlZCBmcm9tIGRlcGxveSBkaXJcbiAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmxhbmd1YWdlKSkge1xuICAgIGNvbnN0IGxhbmdEaXIgPSBjb25maWcubGFuZ3VhZ2UubWFwKChwYXRoKSA9PiBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBwYXRoKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLmxhbmdEaXIpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcubGFuZ3VhZ2UgPT09ICdzdHJpbmcnICYmIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgZm9sZGVycy5wdXNoKGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpKSk7XG4gIH1cblxuICAvLyBkZWxldGUgcGFnaW5hdGlvblxuICBjb25zdCBwYWdlc0RpciA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsICdwYWdlJyk7XG4gIGlmIChleGlzdHNTeW5jKHBhZ2VzRGlyKSkge1xuICAgIGNvbnN0IHBhZ2VzID0gKGF3YWl0IHJlYWRkaXIocGFnZXNEaXIpKS5maWx0ZXIoKHN0cikgPT4gL15cXGQrJC8udGVzdChzdHIpKS5tYXAoKHN0cikgPT4gam9pbihwYWdlc0Rpciwgc3RyKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLnBhZ2VzKTtcbiAgfVxuXG4gIGNvbnN0IHByb21pc2VzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG4gIC8vIGR1bXAgdG8gZmlsZVxuICBjb25zdCBkdW1wZmlsZSA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL2NsZWFuLnR4dCcpO1xuICB3cml0ZWZpbGUoZHVtcGZpbGUsIGZvbGRlcnMuam9pbihFT0wpKTtcbiAgTG9nZ2VyLmxvZyhsb2duYW1lLCAnbGlzdCBkZWxldGVkIGZpbGVzJywgZHVtcGZpbGUpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZm9sZGVycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBmb2xkZXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhwYXRoU3RyKSkgcHJvbWlzZXMucHVzaChkZWwocGF0aFN0cikuY2F0Y2gobm9vcCkpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy9cbiAgICB9XG4gIH1cblxuICBjb25zdCBmaW5pc2hOb3cgPSBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ2NsZWFuIGFyY2hpdmVzIGhhcyBzb21lIGVycm9zJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIGNhbGxiYWNrKCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBhd2FpdCBCbHVlYmlyZC5hbGwocHJvbWlzZXMpLnRoZW4oZmluaXNoTm93KS5jYXRjaChmaW5pc2hOb3cpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5HZW5lcmF0ZWRQb3N0cyhjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgcmV0dXJuIGNsZWFuRGIoY2FsbGJhY2ssIFtqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5zb3VyY2VfZGlyLCAnX3Bvc3RzJyldKTtcbn1cblxuZ3VscC50YXNrKCdjbGVhbjphcmNoaXZlJywgY2xlYW5PbGRBcmNoaXZlcyk7XG5ndWxwLnRhc2soJ2NsZWFuOmRiJywgY2xlYW5EYik7XG5ndWxwLnRhc2soJ2NsZWFuOnBvc3QnLCBjbGVhbkdlbmVyYXRlZFBvc3RzKTtcbmd1bHAudGFzaygnY2xlYW46YWxsJywgZ3VscC5zZXJpZXMoJ2NsZWFuOmRiJywgJ2NsZWFuOmFyY2hpdmUnKSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0e/gulpclean_0e73cdf97e0865d562e48a7ea63cce15.map","wrapperLength":82},"result":{"scriptId":"6920","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24169,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexo_post_parser_1 = __importDefault(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar true_case_path_1 = __importDefault(require(\"true-case-path\"));\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nvar fetched = {};\nvar fileYML = (0, path_1.join)(process.cwd(), '_config.yml');\nvar loadYml = function () {\n    if ((0, fs_1.existsSync)(fileYML)) {\n        fetched[fileYML] = true;\n        var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n        settledConfig = Object.assign({}, configYML, settledConfig);\n        // update hexo-post-parser config\n        hexo_post_parser_1.default.setConfig(settledConfig);\n        (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n    }\n};\nloadYml();\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign({}, settledConfig, obj);\n    fileYML = (0, path_1.join)(settledConfig.cwd, '_config.yml');\n    if (!fetched[fileYML]) {\n        if (settledConfig.cwd) {\n            // fix cwd\n            settledConfig.cwd = (0, upath_1.toUnix)(true_case_path_1.default.trueCasePathSync(settledConfig.cwd));\n        }\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nfunction getConfig(customFolder) {\n    if (typeof customFolder === 'string') {\n        fileYML = (0, path_1.join)(customFolder, '_config.yml');\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    settledConfig = (0, object_1.orderKeys)(settledConfig);\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\n// first fetch\nif (!fetched)\n    getConfig();\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : null;\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHlCQUE4QztBQUM5QywwRUFBcUM7QUFFckMsc0VBQThDO0FBQzlDLDZCQUE0QjtBQUM1QixrRUFBMEM7QUFDMUMsK0JBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBOEM7QUFDOUMsaUNBQXVDO0FBQ3ZDLHlDQUEyQztBQTREM0MsSUFBSSxhQUFhLEdBQUcsSUFBQSwyQkFBZ0IsR0FBeUIsQ0FBQztBQUU5RCxJQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDbkIsSUFBSSxPQUFPLEdBQUcsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ2pELElBQU0sT0FBTyxHQUFHO0lBQ2QsSUFBSSxJQUFBLGVBQVUsRUFBQyxPQUFPLENBQUMsRUFBRTtRQUN2QixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsSUFBQSxpQkFBWSxFQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdELGFBQWEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUQsaUNBQWlDO1FBQ2pDLDBCQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNoRjtBQUNILENBQUMsQ0FBQztBQUVGLE9BQU8sRUFBRSxDQUFDO0FBRVY7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3RELE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2pELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDckIsSUFBSSxhQUFhLENBQUMsR0FBRyxFQUFFO1lBQ3JCLFVBQVU7WUFDVixhQUFhLENBQUMsR0FBRyxHQUFHLElBQUEsY0FBTSxFQUFDLHdCQUFZLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDOUU7UUFDRCxPQUFPLEVBQUUsQ0FBQztRQUNWLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7S0FDekI7SUFFRCxPQUFPLFNBQVMsRUFBRSxDQUFDO0FBQ3JCLENBQUM7QUFiRCw4QkFhQztBQUVEOzs7OztHQUtHO0FBQ0gsU0FBZ0IsU0FBUyxDQUFDLFlBQXFCO0lBQzdDLElBQUksT0FBTyxZQUFZLEtBQUssUUFBUSxFQUFFO1FBQ3BDLE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUMsT0FBTyxFQUFFLENBQUM7UUFDVixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO0tBQ3pCO0lBQ0QsYUFBYSxHQUFHLElBQUEsa0JBQVMsRUFBQyxhQUFhLENBQUMsQ0FBQztJQUN6QyxhQUFhLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sSUFBSSxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUNqRiw4RkFBOEY7SUFDOUYsT0FBTyxhQUF5QixDQUFDO0FBQ25DLENBQUM7QUFWRCw4QkFVQztBQUVELGNBQWM7QUFDZCxJQUFJLENBQUMsT0FBTztJQUFFLFNBQVMsRUFBRSxDQUFDO0FBRTFCLFNBQWdCLFlBQVk7O0lBQzFCLElBQU0sU0FBUyxHQUFHLElBQUEsV0FBSSxFQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsVUFBVSxJQUFHLE1BQUEsYUFBYSxDQUFDLE1BQU0sMENBQUUsSUFBSSxDQUFBLElBQUksS0FBSyxDQUFDLENBQUM7SUFDNUYsSUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFVLEVBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksNEJBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pFLE9BQU8sRUFBRSxTQUFTLFdBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO0FBQy9CLENBQUM7QUFKRCxvQ0FJQztBQUVEOzs7Ozs7R0FNRztBQUNVLFFBQUEsWUFBWSxHQUFHO0lBQzFCLGtCQUFrQjtJQUNsQixzQkFBc0I7SUFDdEIsNkJBQTZCO0lBQzdCLDBDQUEwQztJQUMxQyxpQkFBaUI7SUFDakIsYUFBYTtJQUNiLG9CQUFvQjtJQUNwQixXQUFXO0lBQ1gsYUFBYTtJQUNiLGNBQWM7SUFDZCxlQUFlO0lBQ2Ysb0JBQW9CO0lBQ3BCLHFCQUFxQjtJQUNyQiwwQkFBMEI7SUFDMUIsZ0JBQWdCO0lBQ2hCLG9CQUFvQjtJQUNwQixvQkFBb0I7SUFDcEIsYUFBYTtJQUNiLE9BQU8sQ0FBQyxZQUFZO0NBQ3JCLENBQUM7QUFFRjs7R0FFRztBQUNVLFFBQUEsY0FBYywwQ0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsa0JBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLFVBQUUiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgaGV4b1Bvc3RQYXJzZXIgZnJvbSAnaGV4by1wb3N0LXBhcnNlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgdHJ1ZWNhc2VwYXRoIGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmNvbnN0IGZldGNoZWQgPSB7fTtcbmxldCBmaWxlWU1MID0gam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKTtcbmNvbnN0IGxvYWRZbWwgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChleGlzdHNTeW5jKGZpbGVZTUwpKSB7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gICAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShyZWFkRmlsZVN5bmMoZmlsZVlNTCwgJ3V0Zi04JykpO1xuICAgIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWdZTUwsIHNldHRsZWRDb25maWcpO1xuICAgIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICAgIGhleG9Qb3N0UGFyc2VyLnNldENvbmZpZyhzZXR0bGVkQ29uZmlnKTtcbiAgICB3cml0ZWZpbGUoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkoY29uZmlnWU1MLCBudWxsLCAyKSk7XG4gIH1cbn07XG5cbmxvYWRZbWwoKTtcblxuLyoqXG4gKiBDb25maWcgc2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHBhcmFtIG9ialxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29uZmlnKG9iajogUmVjb3JkPHN0cmluZywgYW55PiB8IFByb2pDb25mKSB7XG4gIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBzZXR0bGVkQ29uZmlnLCBvYmopO1xuICBmaWxlWU1MID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJ19jb25maWcueW1sJyk7XG4gIGlmICghZmV0Y2hlZFtmaWxlWU1MXSkge1xuICAgIGlmIChzZXR0bGVkQ29uZmlnLmN3ZCkge1xuICAgICAgLy8gZml4IGN3ZFxuICAgICAgc2V0dGxlZENvbmZpZy5jd2QgPSB0b1VuaXgodHJ1ZWNhc2VwYXRoLnRydWVDYXNlUGF0aFN5bmMoc2V0dGxlZENvbmZpZy5jd2QpKTtcbiAgICB9XG4gICAgbG9hZFltbCgpO1xuICAgIGZldGNoZWRbZmlsZVlNTF0gPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGdldENvbmZpZygpO1xufVxuXG4vKipcbiAqIENvbmZpZyBnZXR0ZXJcbiAqICogdXNlZnVsIGZvciBqZXN0XG4gKiBAcGFyYW0gY3VzdG9tRm9sZGVyIGxvYWQgZnJvbSBjdXN0b20gZm9sZGVyIGFuZCBhcHBseSB0byBjdXJyZW50IGNvbmZpZ1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZyhjdXN0b21Gb2xkZXI/OiBzdHJpbmcpIHtcbiAgaWYgKHR5cGVvZiBjdXN0b21Gb2xkZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgZmlsZVlNTCA9IGpvaW4oY3VzdG9tRm9sZGVyLCAnX2NvbmZpZy55bWwnKTtcbiAgICBsb2FkWW1sKCk7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gIH1cbiAgc2V0dGxlZENvbmZpZyA9IG9yZGVyS2V5cyhzZXR0bGVkQ29uZmlnKTtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbi8vIGZpcnN0IGZldGNoXG5pZiAoIWZldGNoZWQpIGdldENvbmZpZygpO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVwbG95Q29uZmlnKCkge1xuICBjb25zdCBkZXBsb3lEaXIgPSBqb2luKHNldHRsZWRDb25maWcuY3dkLCAnLmRlcGxveV8nICsgc2V0dGxlZENvbmZpZy5kZXBsb3k/LnR5cGUgfHwgJ2dpdCcpO1xuICBjb25zdCBnaXRodWIgPSBleGlzdHNTeW5jKGRlcGxveURpcikgPyBuZXcgZ2l0KGRlcGxveURpcikgOiBudWxsO1xuICByZXR1cm4geyBkZXBsb3lEaXIsIGdpdGh1YiB9O1xufVxuXG4vKipcbiAqIGNvbW1vbiBpZ25vcmUgZmlsZXNcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAqIGNvbnN0IGV4Y2x1ZGVzID0gQXJyYXkuaXNBcnJheShjb25maWcuZXhjbHVkZSkgPyBjb25maWcuZXhjbHVkZSA6IFtdO1xuICogZXhjbHVkZXMucHVzaCguLi5jb21tb25JZ25vcmUpO1xuICovXG5leHBvcnQgY29uc3QgY29tbW9uSWdub3JlID0gW1xuICAnKioveWFuZGV4XyouaHRtbCcsIC8vIHNraXAgeWFuZGV4IHZlcmlmaWNhdGlvbiBmaWxlXG4gIC8vICcqKi9jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2Rpc3F1cy1jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2NvbW1lbnQuaHRtbCcsIC8vIHNraXAgY29tbWVudC5odG1sXG4gICcqKi9mYXZpY29uLmh0bWwnLCAvLyBza2lwIGZhdmljb25cbiAgJyoqLzQwNC5odG1sJywgLy8gc2tpcCA0MDRcbiAgJyoqL25vZGVfbW9kdWxlcy8qKicsIC8vIHNraXAgbm9kZV9tb2R1bGVzXG4gICcqKi90bXAvKionLCAvLyBza2lwIHRtcFxuICAnKiovYnVpbGQvKionLCAvLyBza2lwIGJ1aWxkXG4gICcqKi8uY2FjaGUvKionLCAvLyBza2lwIGNvbW1vbiBjYWNoZSBmb2xkZXJcbiAgJyoqLy52c2NvZGUvKionLCAvLyBza2lwIHZzY29kZSBjb25maWd1cmF0aW9uIGZvbGRlclxuICAnKiovLmZyb250bWF0dGVyLyoqJywgLy8gc2tpcCBmcm9udG1hdHRlciB2c2NvZGUgZXh0ZW5zaW9uXG4gICcqKi9waW50ZXJlc3QtKi5odG1sJywgLy8gc2tpcCBwaW50ZXJlc3QgdmVyaWZpY2F0aW9uIGZpbGVcbiAgJyoqL18qLnN0YW5kYWxvbmUue2pzLHRzfScsIC8vIHNraXAgX2ZpbGVuYW1lLnN0YW5kYWxvbmUuanNcbiAgJyoqL2Rlc2t0b3AuaW5pJywgLy8gd2luZG93cyBkZXNrdG9wLmluaVxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gbm9kZV9tb2R1bGVzXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyB2c2NvZGUgZnJvbnRtYXR0ZXIgcGx1Z2luXG4gICcqKi8uZ2l0Ki8qKicsIC8vIGFueSBnaXQgY29uZmlnc1xuICAnKiovLionIC8vIHNraXAgZG90c1xuXTtcblxuLyoqXG4gKiBhcnJheSBvZiBjb25maWcuZXhjbHVkZSwgY29uZmlnLmlnbm9yZVxuICovXG5leHBvcnQgY29uc3QgcHJvamVjdElnbm9yZXMgPSBbLi4uKGdldENvbmZpZygpLnNraXBfcmVuZGVyIHx8IFtdKSwgLi4uKGdldENvbmZpZygpLmlnbm9yZSB8fCBbXSldO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport truecasepath from 'true-case-path';\nimport { toUnix } from 'upath';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nconst fetched = {};\nlet fileYML = join(process.cwd(), '_config.yml');\nconst loadYml = function () {\n  if (existsSync(fileYML)) {\n    fetched[fileYML] = true;\n    const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n    settledConfig = Object.assign({}, configYML, settledConfig);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n  }\n};\n\nloadYml();\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign({}, settledConfig, obj);\n  fileYML = join(settledConfig.cwd, '_config.yml');\n  if (!fetched[fileYML]) {\n    if (settledConfig.cwd) {\n      // fix cwd\n      settledConfig.cwd = toUnix(truecasepath.trueCasePathSync(settledConfig.cwd));\n    }\n    loadYml();\n    fetched[fileYML] = true;\n  }\n\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nexport function getConfig(customFolder?: string) {\n  if (typeof customFolder === 'string') {\n    fileYML = join(customFolder, '_config.yml');\n    loadYml();\n    fetched[fileYML] = true;\n  }\n  settledConfig = orderKeys(settledConfig);\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\n// first fetch\nif (!fetched) getConfig();\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : null;\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0f/_config_0f3f45dd644bddb8c0e53e47eddfc08f.map","wrapperLength":82},"result":{"scriptId":"7353","url":"D:\\Repositories\\static-blog-generator\\src\\_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":14732,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":14729,"count":1},{"startOffset":3588,"endOffset":3600,"count":0},{"startOffset":4818,"endOffset":4823,"count":0},{"startOffset":4862,"endOffset":4867,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":2},{"startOffset":228,"endOffset":237,"count":0},{"startOffset":315,"endOffset":325,"count":0},{"startOffset":352,"endOffset":369,"count":0},{"startOffset":380,"endOffset":419,"count":0},{"startOffset":477,"endOffset":497,"count":0},{"startOffset":499,"endOffset":509,"count":0},{"startOffset":545,"endOffset":559,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":2},{"startOffset":706,"endOffset":901,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":4},{"startOffset":1075,"endOffset":1080,"count":2},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"loadYml","ranges":[{"startOffset":1902,"endOffset":2367,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":2440,"endOffset":2884,"count":1},{"startOffset":2618,"endOffset":2858,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3049,"endOffset":3523,"count":82},{"startOffset":3126,"endOffset":3250,"count":0},{"startOffset":3373,"endOffset":3378,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3601,"endOffset":3951,"count":82},{"startOffset":3763,"endOffset":3771,"count":0},{"startOffset":3783,"endOffset":3791,"count":0},{"startOffset":3843,"endOffset":3888,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:title/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml_1.default.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGRlZmF1bHRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHlCQUFrQztBQUNsQyxpREFBa0Q7QUFDbEQsK0JBQXFDO0FBQ3JDLDhDQUF3QjtBQUV4Qjs7O0dBR0c7QUFDSCxTQUFnQixnQkFBZ0I7SUFDOUIsSUFBTSxpQkFBaUIsR0FBRztRQUN4QixPQUFPO1FBQ1AsS0FBSyxFQUFFLE1BQU07UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLFdBQVcsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLFVBQVU7UUFDbEIsUUFBUSxFQUFFLElBQUk7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU07UUFDTixHQUFHLEVBQUUsb0JBQW9CO1FBQ3pCLElBQUksRUFBRSxHQUFHO1FBQ1QsU0FBUyxFQUFFLDJCQUEyQjtRQUN0QyxrQkFBa0IsRUFBRSxFQUFFO1FBQ3RCLFdBQVcsRUFBRTtZQUNYLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLGFBQWEsRUFBRSxJQUFJO1NBQ3BCO1FBQ0QsWUFBWTtRQUNaLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLE9BQU8sRUFBRSxNQUFNO1FBQ2YsV0FBVyxFQUFFLFVBQVU7UUFDdkIsWUFBWSxFQUFFLFlBQVk7UUFDMUIsUUFBUSxFQUFFLGdCQUFnQjtRQUMxQixRQUFRLEVBQUUsT0FBTztRQUNqQixXQUFXLEVBQUUsRUFBRTtRQUNmLFVBQVU7UUFDVixhQUFhLEVBQUUsV0FBVztRQUMxQixjQUFjLEVBQUUsTUFBTTtRQUN0QixTQUFTLEVBQUUsS0FBSztRQUNoQixhQUFhLEVBQUU7WUFDYixNQUFNLEVBQUUsSUFBSTtZQUNaLEtBQUssRUFBRSxNQUFNO1lBQ2IsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsYUFBYSxFQUFFLEtBQUs7UUFDcEIsTUFBTSxFQUFFLElBQUk7UUFDWixrQkFBa0IsRUFBRSxjQUFjO1FBQ2xDLFNBQVMsRUFBRTtZQUNULFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFdBQVcsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLElBQUk7WUFDVixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLGFBQWEsRUFBRSxLQUFLO1lBQ3BCLElBQUksRUFBRSxLQUFLO1NBQ1o7UUFDRCxPQUFPLEVBQUU7WUFDUCxVQUFVLEVBQUUsSUFBSTtZQUNoQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtTQUNoQjtRQUNELGlCQUFpQjtRQUNqQixnQkFBZ0IsRUFBRSxlQUFlO1FBQ2pDLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE9BQU8sRUFBRSxFQUFFO1FBQ1gscUJBQXFCO1FBQ3JCLFdBQVcsRUFBRSxZQUFZO1FBQ3pCLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLGNBQWMsRUFBRSxPQUFPO1FBQ3ZCLDRDQUE0QztRQUM1QywwQkFBMEI7UUFDMUIsYUFBYTtRQUNiLFFBQVEsRUFBRSxFQUFFO1FBQ1osY0FBYyxFQUFFLE1BQU07UUFDdEIsYUFBYTtRQUNiLEtBQUssRUFBRSxXQUFXO1FBQ2xCLE1BQU0sRUFBRTtZQUNOLEtBQUssRUFBRSxLQUFLO1NBQ2I7UUFDRCxhQUFhO1FBQ2IsTUFBTSxFQUFFLEVBQUU7UUFFViwrQkFBK0I7UUFDL0IsTUFBTSxFQUFFLEVBQUU7UUFFVixpQkFBaUI7UUFDakIsY0FBYyxFQUFFLElBQUk7S0FDckIsQ0FBQztJQUNGLElBQU0sZ0JBQWdCLEdBQUc7UUFDdkIsR0FBRyxFQUFFLElBQUEsY0FBTSxFQUFDLElBQUEsaUNBQWdCLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7S0FDN0MsQ0FBQztJQUNGLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQW9DLENBQUM7QUFDMUcsQ0FBQztBQXhGRCw0Q0F3RkM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixvQkFBb0I7SUFDbEMsT0FBTyxJQUFBLGlCQUFZLEVBQUMsSUFBQSxZQUFJLEVBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFGRCxvREFFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuXG4vKipcbiAqIGdldCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0Q29uZmlnKCkge1xuICBjb25zdCBoZXhvRGVmYXVsdENvbmZpZyA9IHtcbiAgICAvLyBTaXRlXG4gICAgdGl0bGU6ICdIZXhvJyxcbiAgICBzdWJ0aXRsZTogJycsXG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIGF1dGhvcjogJ0pvaG4gRG9lJyxcbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICB0aW1lem9uZTogJycsXG4gICAgLy8gVVJMXG4gICAgdXJsOiAnaHR0cDovL2V4YW1wbGUuY29tJyxcbiAgICByb290OiAnLycsXG4gICAgcGVybWFsaW5rOiAnOnllYXIvOm1vbnRoLzpkYXkvOnRpdGxlLycsXG4gICAgcGVybWFsaW5rX2RlZmF1bHRzOiB7fSxcbiAgICBwcmV0dHlfdXJsczoge1xuICAgICAgdHJhaWxpbmdfaW5kZXg6IHRydWUsXG4gICAgICB0cmFpbGluZ19odG1sOiB0cnVlXG4gICAgfSxcbiAgICAvLyBEaXJlY3RvcnlcbiAgICBzb3VyY2VfZGlyOiAnc291cmNlJyxcbiAgICBwdWJsaWNfZGlyOiAncHVibGljJyxcbiAgICB0YWdfZGlyOiAndGFncycsXG4gICAgYXJjaGl2ZV9kaXI6ICdhcmNoaXZlcycsXG4gICAgY2F0ZWdvcnlfZGlyOiAnY2F0ZWdvcmllcycsXG4gICAgY29kZV9kaXI6ICdkb3dubG9hZHMvY29kZScsXG4gICAgaTE4bl9kaXI6ICc6bGFuZycsXG4gICAgc2tpcF9yZW5kZXI6IFtdLFxuICAgIC8vIFdyaXRpbmdcbiAgICBuZXdfcG9zdF9uYW1lOiAnOnRpdGxlLm1kJyxcbiAgICBkZWZhdWx0X2xheW91dDogJ3Bvc3QnLFxuICAgIHRpdGxlY2FzZTogZmFsc2UsXG4gICAgZXh0ZXJuYWxfbGluazoge1xuICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgZmllbGQ6ICdzaXRlJyxcbiAgICAgIGV4Y2x1ZGU6ICcnXG4gICAgfSxcbiAgICBmaWxlbmFtZV9jYXNlOiAwLFxuICAgIHJlbmRlcl9kcmFmdHM6IGZhbHNlLFxuICAgIHBvc3RfYXNzZXRfZm9sZGVyOiBmYWxzZSxcbiAgICByZWxhdGl2ZV9saW5rOiBmYWxzZSxcbiAgICBmdXR1cmU6IHRydWUsXG4gICAgc3ludGF4X2hpZ2hsaWdodGVyOiAnaGlnaGxpZ2h0LmpzJyxcbiAgICBoaWdobGlnaHQ6IHtcbiAgICAgIGF1dG9fZGV0ZWN0OiBmYWxzZSxcbiAgICAgIGxpbmVfbnVtYmVyOiB0cnVlLFxuICAgICAgdGFiX3JlcGxhY2U6ICcnLFxuICAgICAgd3JhcDogdHJ1ZSxcbiAgICAgIGV4Y2x1ZGVfbGFuZ3VhZ2VzOiBbXSxcbiAgICAgIGxhbmd1YWdlX2F0dHI6IGZhbHNlLFxuICAgICAgaGxqczogZmFsc2VcbiAgICB9LFxuICAgIHByaXNtanM6IHtcbiAgICAgIHByZXByb2Nlc3M6IHRydWUsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJ1xuICAgIH0sXG4gICAgLy8gQ2F0ZWdvcnkgJiBUYWdcbiAgICBkZWZhdWx0X2NhdGVnb3J5OiAndW5jYXRlZ29yaXplZCcsXG4gICAgY2F0ZWdvcnlfbWFwOiB7fSxcbiAgICB0YWdfbWFwOiB7fSxcbiAgICAvLyBEYXRlIC8gVGltZSBmb3JtYXRcbiAgICBkYXRlX2Zvcm1hdDogJ1lZWVktTU0tREQnLFxuICAgIHRpbWVfZm9ybWF0OiAnSEg6bW06c3MnLFxuICAgIHVwZGF0ZWRfb3B0aW9uOiAnbXRpbWUnLFxuICAgIC8vICogbXRpbWU6IGZpbGUgbW9kaWZpY2F0aW9uIGRhdGUgKGRlZmF1bHQpXG4gICAgLy8gKiBlbXB0eTogbm8gbW9yZSB1cGRhdGVcbiAgICAvLyBQYWdpbmF0aW9uXG4gICAgcGVyX3BhZ2U6IDEwLFxuICAgIHBhZ2luYXRpb25fZGlyOiAncGFnZScsXG4gICAgLy8gRXh0ZW5zaW9uc1xuICAgIHRoZW1lOiAnbGFuZHNjYXBlJyxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgIGNhY2hlOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gRGVwbG95bWVudFxuICAgIGRlcGxveToge30sXG5cbiAgICAvLyBpZ25vcmUgZmlsZXMgZnJvbSBwcm9jZXNzaW5nXG4gICAgaWdub3JlOiBbXSxcblxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgbWV0YV9nZW5lcmF0b3I6IHRydWVcbiAgfTtcbiAgY29uc3Qgc2JnRGVmYXVsdENvbmZpZyA9IHtcbiAgICBjd2Q6IHRvVW5peCh0cnVlQ2FzZVBhdGhTeW5jKHByb2Nlc3MuY3dkKCkpKVxuICB9O1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKGdldERlZmF1bHRDb25maWdZYW1sKCkpO1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihoZXhvRGVmYXVsdENvbmZpZywgc2JnRGVmYXVsdENvbmZpZywgY29uZmlnWU1MKSBhcyB0eXBlb2YgaW1wb3J0KCcuL19jb25maWcuanNvbicpO1xufVxuXG4vKipcbiAqIGdldCBkZWZhdWx0IF9jb25maWcueW1sXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdENvbmZpZ1lhbWwoKSB7XG4gIHJldHVybiByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLnltbCcpLCAndXRmLTgnKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:title/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/9d/defaults_9d90978728a2f8c36350e6b522c45e0e.map","wrapperLength":82},"result":{"scriptId":"8274","url":"D:\\Repositories\\static-blog-generator\\src\\defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":9592,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":9589,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":1},{"startOffset":204,"endOffset":209,"count":0}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":568,"endOffset":3016,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3109,"endOffset":3233,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZGVwbG95LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLHlCQUFnQztBQUNoQywwRUFBMEQ7QUFDMUQsdURBQTJEO0FBQzNELDhDQUFrRDtBQUNsRCxvRUFBcUM7QUFDckMsK0JBQXFDO0FBQ3JDLHdCQUFzQjtBQUN0QiwyQkFBeUI7QUFDekIsMERBQW9DO0FBQ3BDLHFDQUFvRDtBQUVwRDs7O0dBR0c7QUFDSCxTQUFnQixPQUFPO0lBQ2IsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLElBQU0sU0FBUyxHQUFHLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5RCxPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxxQkFBcUIsQ0FBQyxFQUFFO1FBQ2hFLEdBQUcsRUFBRSxTQUFTO1FBQ2QsR0FBRyxFQUFFLElBQUk7S0FDVixDQUFDO1NBQ0QsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDMUIsRUFBRSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQVZELDBCQVVDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0IsWUFBWTtJQUMxQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFVLE9BQU87UUFDbkMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNwQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxD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QUFNLEVBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUEsY0FBTSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsY0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxlQUFlLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5kZXBsb3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuc2lDb2xvcnMgZnJvbSAnYW5zaS1jb2xvcnMnO1xuaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGdpdEhlbHBlciB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlcic7XG5pbXBvcnQgeyBzcGF3bkFzeW5jIH0gZnJvbSAnZ2l0LWNvbW1hbmQtaGVscGVyL2Rpc3Qvc3Bhd24nO1xuaW1wb3J0IGd1bHAsIHsgVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfSBmcm9tICdndWxwJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIChfY29uZmlnX3ltbC5wdWJsaWNfZGlyKSB0byBkZXBsb3kgZGlyIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvcHlHZW4oKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgY29uc3QgcHVibGljRGlyID0gam9pbihwcm9jZXNzLmN3ZCgpLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKionLCAnISoqLy5naXQqJywgJyEqKi90bXAvKionLCAnISoqL25vZGVfbW9kdWxlcy8qKiddLCB7XG4gICAgICBjd2Q6IHB1YmxpY0RpcixcbiAgICAgIGRvdDogdHJ1ZVxuICAgIH0pXG4gICAgLnBpcGUoZ3VscC5kZXN0KGRlcGxveURpcikpXG4gICAgLm9uKCdlcnJvcicsIGNvbnNvbGUudHJhY2UpO1xufVxuXG4vKipcbiAqIGFzeW5jaHJvbm91cyBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3luY0NvcHlHZW4oKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBjb3B5R2VuKCkub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbi8vIGNvcHkgcHVibGljIHRvIC5kZXBsb3lfZ2l0XG5ndWxwLnRhc2soJ2RlcGxveTpjb3B5JywgY29weUdlbik7XG5cbi8qKlxuICogZ2l0IHB1bGwgb24gZGVwbG95IGRpclxuICogQHBhcmFtIGRvbmVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVsbChkb25lOiBUYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgY3dkID0gY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGdoID0gY29uZmlnLmRlcGxveS5naXRodWI7XG4gIGNvbnN0IGRvUHVsbCA9IGFzeW5jIChjd2Q6IHN0cmluZykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ2NvbmZpZycsICdwdWxsLnJlYmFzZScsICdmYWxzZSddLCB7XG4gICAgICAgIGN3ZFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gTG9nZ2VyLmxvZyhlLm1lc3NhZ2UsIHN1Yi5yb290KTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgTG9nZ2VyLmxvZygncHVsbGluZycsIGN3ZCk7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ3B1bGwnLCAnLVgnLCAndGhlaXJzJ10sIHtcbiAgICAgICAgY3dkLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcHVsbCcsIGN3ZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNsb25lID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghZXhpc3RzU3luYyhjd2QpKSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbLi4uJ2Nsb25lIC1iIG1hc3RlciAtLXNpbmdsZS1icmFuY2gnLnNwbGl0KCcgJyksIGNvbmZpZy5kZXBsb3kucmVwbywgJy5kZXBsb3lfZ2l0J10sIHtcbiAgICAgICAgY3dkOiBfX2Rpcm5hbWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBhd2FpdCBjbG9uZSgpO1xuICBkb1B1bGwoY3dkKTtcbiAgaWYgKGdoKSB7XG4gICAgY29uc3Qgc3VibW9kdWxlcyA9IGdoLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1Ym1vZHVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN1YiA9IHN1Ym1vZHVsZXNbaV07XG5cbiAgICAgIGRvUHVsbChzdWIucm9vdCk7XG4gICAgfVxuICB9XG4gIGRvbmUoKTtcbn1cblxuZnVuY3Rpb24gc3RhdHVzKGRvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrKSB7XG4gIGNvbnN0IHsgZ2l0aHViIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgaWYgKCFnaXRodWIpIHJldHVybjtcbiAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKHN0YXR1c2VzKSA9PiB7XG4gICAgc3RhdHVzZXMubWFwKChpdGVtKSA9PiB7XG4gICAgICBsZXQgc3RyID0gJyc7XG5cbiAgICAgIHN3aXRjaCAoaXRlbS5jaGFuZ2VzKSB7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnJlZChpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhZGRlZCc6XG4gICAgICAgICAgc3RyICs9IGFuc2lDb2xvcnMuZ3JlZW4oaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbW9kaWZpZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnllbGxvdyhpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd1bnRyYWNrZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZXkoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBzdHIgKz0gaXRlbS5jaGFuZ2VzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBzdHIgKz0gJyAnO1xuICAgICAgc3RyICs9IGl0ZW0ucGF0aDtcbiAgICAgIExvZ2dlci5sb2coc3RyKTtcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2YgZG9uZSA9PT0gJ2Z1bmN0aW9uJykgZG9uZSgpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY29tbWl0KCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICBjb25zdCBub3cgPSBtb21lbnQoKS50eihnZXRDb25maWcoKS50aW1lem9uZSkuZm9ybWF0KCdMTEwnKTtcbiAgY29uc3QgY29tbWl0Um9vdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgIExvZ2dlci5sb2coJ2NoYW5nZXMnLCBjaGFuZ2VzLmxlbmd0aCwgdG9Vbml4KGdpdGh1Yi5jd2QpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJykpO1xuICAgICAgICBpZiAoY2hhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZ2l0aHViLmFkZCgnLUEnKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGdpdGh1Yi5jb21taXQoJ3VwZGF0ZSBzaXRlICcgKyBub3cpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGNvbW1pdFN1Ym1vZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGlmIChnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpKSB7XG4gICAgICAgIGNvbnN0IGluZm8gPSBnaXRodWIuc3VibW9kdWxlLmdldCgpO1xuICAgICAgICBjb25zdCBjb21taXRTdWJtb2R1bGVDaGlsZCA9IGFzeW5jIChzdWI6ICh0eXBlb2YgaW5mbylbbnVtYmVyXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IG5ldyBnaXRIZWxwZXIoc3ViLnJvb3QpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgc3VibW9kdWxlLnN0YXR1cygpO1xuICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCBzdWJtb2R1bGUuYWRkKCctQScpO1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmNvbW1pdChgdXBkYXRlICR7c3ViLnBhdGh9ICR7bm93fWAsICdhbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaXRlcmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVJdCkgPT4ge1xuICAgICAgICAgICAgLy8gcmVzb2x2ZSBkaXJlY3RseSB3aGVuIHN1Ym1vZHVsZSBpdGVtcyBubyBtYWRlIGNoYW5nZXNcbiAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgIGNvbW1pdFN1Ym1vZHVsZUNoaWxkKGluZm9bMF0pXG4gICAgICAgICAgICAgIC5jYXRjaChub29wKVxuICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIC8vIHJlLWl0ZXJhdGUgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm90IGNvbW1pdHRlZFxuICAgICAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA+IDApIHJldHVybiBpdGVyYXRlKCk7XG4gICAgICAgICAgICAgICAgLy8gcmVzb2x2ZXMgYWxsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZUl0KG51bGwpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaXRlcmF0ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbW1pdFN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihjb21taXRSb290KVxuICAgICAgLnRoZW4oKCkgPT4gcmVzb2x2ZShudWxsKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBub29wKCkge1xuICAvL1xufVxuXG5mdW5jdGlvbiBwdXNoKCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpID8gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKSA6IFtdO1xuICBjb25zdCBwdXNoU3VibW9kdWxlID0gZnVuY3Rpb24gKHN1Ym1vZHVsZTogKHR5cGVvZiBzdWJtb2R1bGVzKVtudW1iZXJdKSB7XG4gICAgY29uc3QgeyB1cmwsIGJyYW5jaCwgcm9vdCB9ID0gc3VibW9kdWxlO1xuICAgIGlmICghc3VibW9kdWxlLmdpdGh1Yikge1xuICAgICAgc3VibW9kdWxlLmdpdGh1YiA9IG5ldyBnaXRIZWxwZXIocm9vdCk7XG4gICAgfVxuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBzdWJtb2R1bGU7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlUHVzaCkgPT4ge1xuICAgICAgY29uc3Qgc2V0UiA9ICgpID0+IGdpdGh1Yi5zZXRyZW1vdGUodXJsKTtcbiAgICAgIGNvbnN0IHNldEIgPSAoKSA9PiBnaXRodWIuc2V0YnJhbmNoKGJyYW5jaCk7XG4gICAgICBQcm9taXNlLmFsbChbc2V0UigpLCBzZXRCKCldKS50aGVuKCgpID0+IHtcbiAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyh3b3Jrc3BhY2Uocm9vdCksICdjYW4gcHVzaCcsIGFsbG93ZWQpO1xuICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAvLyBwdXNoIHRoZW4gcmVzb2x2ZVxuICAgICAgICAgICAgZ2l0aHViLnB1c2goZmFsc2UsIHsgc3RkaW86ICdwaXBlJyB9KS50aGVuKHJlc29sdmVQdXNoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKGNoYW5nZXMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIExvZ2dlci5sb2coJ3N1Ym1vZHVsZScsIHdvcmtzcGFjZShyb290KSwgJ2NoYW5nZXMgbm90IHN0YWdlZCcpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgY2hhbmdlcyBub3Qgc3RhZ2VkXG4gICAgICAgICAgICAgICAgcmVzb2x2ZVB1c2gobnVsbCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2l0aHViLmlzVXBUb0RhdGUoKS50aGVuKCh1cGRhdGVkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICd1cGRhdGVkJywgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGlzIHVwIHRvIGRhdGVcbiAgICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGl0ZXJhdGVTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IHN1Ym1vZHVsZXMuc2hpZnQoKTtcbiAgICAgICAgaWYgKHN1Ym1vZHVsZSkge1xuICAgICAgICAgIHB1c2hTdWJtb2R1bGUoc3VibW9kdWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJtb2R1bGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgaXRlcmF0ZVN1Ym1vZHVsZSgpLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgaXRlcmF0ZVN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgICAgICBnaXRodWIuY2FuUHVzaCgpLnRoZW4oKGFsbG93ZWQpID0+IHtcbiAgICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKGdpdGh1Yi5jd2QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAgIGdpdGh1Yi5wdXNoKCkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUpO1xuICAgIC8vcHVzaFN1Ym1vZHVsZShzdWJtb2R1bGVzWzFdKS50aGVuKHJlc29sdmUpO1xuICB9KTtcbn1cblxuZ3VscC50YXNrKCdkZXBsb3k6cHVzaCcsIHB1c2gpO1xuZ3VscC50YXNrKCdkZXBsb3k6c3RhdHVzJywgc3RhdHVzKTtcbmd1bHAudGFzaygnZGVwbG95OmNvbW1pdCcsIGNvbW1pdCk7XG5ndWxwLnRhc2soJ2RlcGxveTpwdWxsJywgcHVsbCk7XG5cbi8qKlxuICogZ2V0IHJlbGF0aXZlIHBhdGggZnJvbSB3b3Jrc3BhY2VcbiAqIEBwYXJhbSBzdHJcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHdvcmtzcGFjZShzdHI6IHN0cmluZykge1xuICByZXR1cm4gdG9Vbml4KHN0cikucmVwbGFjZSh0b1VuaXgocHJvY2Vzcy5jd2QoKSksICcnKTtcbn1cblxuLy8gZGVwbG95XG5ndWxwLnRhc2soJ2RlcGxveScsIGd1bHAuc2VyaWVzKCdkZXBsb3k6cHVsbCcsICdkZXBsb3k6Y29weScsICdzYWZlbGluaycsICdkZXBsb3k6Y29tbWl0JywgJ2RlcGxveTpwdXNoJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/90/gulpdeploy_90b84dd58a01145dad19e958e2ead383.map","wrapperLength":82},"result":{"scriptId":"8278","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39615,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39612,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2FmZWxpbmsudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyx5QkFBZ0M7QUFDaEMsOENBQXdCO0FBQ3hCLDhDQUF3QjtBQUN4Qiw0REFBa0Q7QUFDbEQsc0RBQWdDO0FBRWhDLHVFQUFpRDtBQUNqRCxpQ0FBK0M7QUFDL0MsMERBQW9DO0FBQ3BDLHFDQUFzQztBQUV0Qzs7Ozs7R0FLRztBQUNILFNBQWdCLFlBQVksQ0FBQyxLQUFvRCxFQUFFLEdBQStCO0lBQWxILGlCQThHQzs7SUE3R0MsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxVQUFVLEdBQUcsT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO0lBQzNFLElBQU0sT0FBTyxHQUFHLHFCQUFVLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRW5ELHdCQUF3QjtJQUN4QixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFO1FBQ2xDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLHFCQUFVLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztLQUMxRTtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDM0MsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUscUJB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LElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDdEMsYUFBYTt3QkFDYixJQUFJLEVBQUUsQ0FBQzs7OzthQUNSLENBQUMsQ0FDSDthQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7S0FDaEM7U0FBTTtRQUNMLElBQU0sT0FBTyxHQUFHLElBQUEsc0JBQWlCLEVBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLENBQUMsQ0FBQztRQUNwRixPQUFPLE9BQU8sQ0FBQztLQUNoQjtBQUNILENBQUM7QUE5R0Qsb0NBOEdDO0FBRUQsZ0NBQWdDO0FBQ2hDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLnNhZmVsaW5rLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNmLCB7IFNhZmVsaW5rT3B0aW9ucyB9IGZyb20gJ3NhZmVsaW5raWZ5JztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBTcmNPcHRpb25zIH0gZnJvbSAndmlueWwtZnMnO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IHsgY3JlYXRlV3JpdGVTdHJlYW0gfSBmcm9tICcuL3V0aWxzL2ZtJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBQcm9jZXNzIFNhZmVsaW5rIG9uIERlcGxveSBEaXJcbiAqIEBwYXJhbSBfZG9uZSBjYWxsYmFjayBmdW5jdGlvblxuICogQHBhcmFtIGN3ZCB3b3JraW5nIGRpcmVjdG9yeSB0byBzY2FuIGh0bWwnc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTYWZlbGluayhfZG9uZT86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q/OiB1bmRlZmluZWQgfCBudWxsIHwgc3RyaW5nKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCB3b3JraW5nRGlyID0gdHlwZW9mIGN3ZCA9PT0gJ3N0cmluZycgPyBjd2QgOiBjb25maWcuZGVwbG95LmRlcGxveURpcjtcbiAgY29uc3QgbG9nbmFtZSA9IGFuc2lDb2xvcnMuZ3JlZW5CcmlnaHQoJ3NhZmVsaW5rJyk7XG5cbiAgLy8gc2tpcCBwcm9jZXNzIHNhZmVsaW5rXG4gIGxldCBoYXNFcnJvciA9IGZhbHNlO1xuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ2NvbmZpZyBzYWZlbGluaycsIGFuc2lDb2xvcnMucmVkKCdub3QgY29uZmlndXJlZCcpKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnJlZGlyZWN0KSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ3NhZmVsaW5rIHJlZGlyZWN0b3InLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5lbmFibGUpIHtcbiAgICBoYXNFcnJvciA9IHRydWU7XG4gICAgTG9nZ2VyLmxvZyhsb2duYW1lLCBhbnNpQ29sb3JzLnJlZCgnZGlzYWJsZWQnKSk7XG4gIH1cblxuICBpZiAoZXhpc3RzU3luYyh3b3JraW5nRGlyKSAmJiAhaGFzRXJyb3IpIHtcbiAgICBjb25zdCBkZWZhdWx0Q29uZmlnU2FmZWxpbms6IFNhZmVsaW5rT3B0aW9ucyAmIFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICBlbmFibGU6IGZhbHNlLFxuICAgICAgZXhjbHVkZTogW10gYXMgc3RyaW5nW10sXG4gICAgICByZWRpcmVjdDogJ2h0dHBzOi8vd3d3LndlYm1hbmFqZW1lbi5jb20vcGFnZS9zYWZlbGluay5odG1sP3VybD0nLFxuICAgICAgcGFzc3dvcmQ6ICdyb290JyxcbiAgICAgIHR5cGU6ICdiYXNlNjQnXG4gICAgfTtcbiAgICBjb25zdCBjb25maWdTYWZlbGluayA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENvbmZpZ1NhZmVsaW5rLCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluayB8fCB7fSk7XG4gICAgbGV0IGJhc2VVUkwgPSAnJztcbiAgICB0cnkge1xuICAgICAgYmFzZVVSTCA9IG5ldyBVUkwoY29uZmlnLnVybCkuaG9zdDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuXG4gICAgY29uc3Qgb3B0OiBQYXJ0aWFsPFNhZmVsaW5rT3B0aW9ucz4gPSB7XG4gICAgICAvLyBleGNsdWRlIHBhdHRlcm5zIChkb250IGFub255bWl6ZSB0aGVzZSBwYXR0ZXJucylcbiAgICAgIGV4Y2x1ZGU6IFtcbiAgICAgICAgLi4uKGNvbmZpZy5leHRlcm5hbF9saW5rPy5leGNsdWRlIHx8IFtdKSxcbiAgICAgICAgL2h0dHBzPzpcXC9cXC8/KD86KFteKl0rKVxcLik/d2VibWFuYWplbWVuXFwuY29tLyxcbiAgICAgICAgLyhbYS16MC05XSg/OlthLXowLTktXXsxLDYxfVthLXowLTldKT9bLl0pKndlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIGJhc2VVUkwsXG4gICAgICAgICd3d3cud2VibWFuYWplbWVuLmNvbScsXG4gICAgICAgICdodHRwczovL2dpdGh1Yi5jb20vZGltYXNsYW5qYWthJyxcbiAgICAgICAgJ2h0dHBzOi8vZmFjZWJvb2suY29tL2RpbWFzbGFuamFrYTEnLFxuICAgICAgICAnZGltYXNsYW5qYWthLmdpdGh1Yi5pbycsXG4gICAgICAgIC4uLmNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGVcbiAgICAgIF0uZmlsdGVyKGZ1bmN0aW9uICh4LCBpLCBhKSB7XG4gICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGUgYW5kIGVtcHRpZXNcbiAgICAgICAgcmV0dXJuIGEuaW5kZXhPZih4KSA9PT0gaSAmJiB4LnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMDtcbiAgICAgIH0pLFxuICAgICAgcmVkaXJlY3Q6IFtdLFxuICAgICAgLy9yZWRpcmVjdDogWywgY29uZmlnU2FmZWxpbmsucmVkaXJlY3RdLFxuICAgICAgcGFzc3dvcmQ6IGNvbmZpZ1NhZmVsaW5rLnBhc3N3b3JkIHx8IGNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnBhc3N3b3JkLFxuICAgICAgdHlwZTogY29uZmlnU2FmZWxpbmsudHlwZSB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay50eXBlXG4gICAgfTtcblxuICAgIGlmIChjb25maWdTYWZlbGluay5yZWRpcmVjdCkge1xuICAgICAgb3B0LnJlZGlyZWN0ID0gY29uZmlnU2FmZWxpbmsucmVkaXJlY3Q7XG4gICAgfVxuXG4gICAgY29uc3Qgc2FmZWxpbmsgPSBuZXcgc2Yuc2FmZWxpbmsob3B0KTtcblxuICAgIGNvbnN0IGd1bHBvcHQ6IFNyY09wdGlvbnMgPSB7XG4gICAgICBjd2Q6IHdvcmtpbmdEaXIsXG4gICAgICBpZ25vcmU6IFtdXG4gICAgfTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpKSB7XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWdTYWZlbGluay5leGNsdWRlKSkge1xuICAgICAgY29uc3QgaWdub3JlID0gY29uZmlnU2FmZWxpbmsuZXhjbHVkZS5maWx0ZXIoKHN0cikgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gIS9eKGh0dHBzPzpcXC98d3d3LikvLnRlc3Qoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KSBhcyBzdHJpbmdbXTtcbiAgICAgIGd1bHBvcHQuaWdub3JlPy5jb25jYXQoLi4uaWdub3JlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3VscFxuICAgICAgLnNyYyhbJyoqLyoue2h0bWwsaHRtfSddLCBndWxwb3B0KVxuICAgICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzYWZlbGluaycgfSkpXG4gICAgICAucGlwZShcbiAgICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIChmaWxlLCBfZW5jLCBuZXh0KSA9PiB7XG4gICAgICAgICAgLy8gZHJvcHNcbiAgICAgICAgICBpZiAoZmlsZS5pc051bGwoKSB8fCBmaWxlLmlzRGlyZWN0b3J5KCkgfHwgIWZpbGUgfHwgZmlsZS5pc1N0cmVhbSgpKSByZXR1cm4gbmV4dCgpO1xuICAgICAgICAgIC8vIHByb2Nlc3NcbiAgICAgICAgICBpZiAoZmlsZS5pc0J1ZmZlcigpICYmIEJ1ZmZlci5pc0J1ZmZlcihmaWxlLmNvbnRlbnRzKSkge1xuICAgICAgICAgICAgLy8gZG8gc2FmZWxpbmtpZnlcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCd1dGYtOCcpO1xuICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgc2FmZWxpbmsucGFyc2UoY29udGVudCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcnNlZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgLy8gTG9nZ2VyLmxvZyhwYXJzZWQpO1xuICAgICAgICAgICAgICBmaWxlLmNvbnRlbnRzID0gQnVmZmVyLmZyb20ocGFyc2VkKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQobnVsbCwgZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIExvZ2dlci5sb2coJ2Nhbm5vdCBwYXJzZScsIGZpbGUucGF0aCk7XG4gICAgICAgICAgLy8gZHJvcCBmYWlsc1xuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5waXBlKGd1bHAuZGVzdCh3b3JraW5nRGlyKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgd3N0cmVhbSA9IGNyZWF0ZVdyaXRlU3RyZWFtKHBhdGguam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9zYWZlbGluay5sb2cnKSk7XG4gICAgcmV0dXJuIHdzdHJlYW07XG4gIH1cbn1cblxuLy8gc2FmZWxpbmtpZnkgdGhlIGRlcGxveSBmb2xkZXJcbmd1bHAudGFzaygnc2FmZWxpbmsnLCB0YXNrU2FmZWxpbmspO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/16/gulpsafelink_164c92c7edb79d3cef122f73272620d8.map","wrapperLength":82},"result":{"scriptId":"8279","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21119,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21116,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsOENBQXdCO0FBQ3hCLHNEQUErQjtBQUMvQix1RUFBaUQ7QUFDakQsMERBQW9DO0FBQ3BDLHFDQUFrRTtBQUVsRTs7O0dBR0c7QUFDSCxTQUFnQixPQUFPLENBQUMsS0FBbUQsRUFBRSxHQUFXO0lBQ3RGLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sTUFBTSxHQUFhLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0UsTUFBTSxDQUFDLElBQUksT0FBWCxNQUFNLDJCQUFTLHNCQUFZLFdBQUU7SUFDN0IsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsY0FBYyxDQUFDLEVBQUUsRUFBRSxHQUFHLEtBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO1NBQ3pELElBQUksQ0FBQyxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNqQyxJQUFJLENBQ0gsSUFBQSxrQkFBTyxFQUFDLFVBQVUsSUFBSTtRQUFkLGlCQTJCUDtRQTFCQyxpQkFBaUI7UUFDakIsSUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNoQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDO2dCQUN0RSxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQzthQUMvQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsbUJBQW1CO1FBQ25CLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDakUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEVBQUU7WUFDakIsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUM1QixJQUFNLEtBQUssR0FBRyxLQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLFVBQVUsQ0FBQztnQkFDeEUsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDakM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILGdCQUFnQjtRQUNoQixXQUFXO1FBQ1gsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMscUJBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEVBQUUsY0FBTyxFQUFFLENBQUMsTUFBTSxlQUFLLElBQUksQ0FBRSxDQUFDLENBQUM7U0FDNUU7SUFDSCxDQUFDLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQXRDRCwwQkFzQ0M7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtJQUNQLElBQUEsU0FBUyxHQUFLLElBQUEsc0JBQVksR0FBRSxVQUFuQixDQUFvQjtJQUNyQyxPQUFPLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBjb21tb25JZ25vcmUsIGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBBdXRvIHNlbyBydW5uZXJcbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTZW8oX2RvbmU6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q6IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaWdub3JlOiBzdHJpbmdbXSA9IEFycmF5LmlzQXJyYXkoY29uZmlnLmV4Y2x1ZGUpID8gY29uZmlnLmV4Y2x1ZGUgOiBbXTtcbiAgaWdub3JlLnB1c2goLi4uY29tbW9uSWdub3JlKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKi57aHRtLGh0bWx9JywgJyoue2h0bWwsaHRtfSddLCB7IGN3ZCwgaWdub3JlIH0pXG4gICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzZW8nIH0pKVxuICAgIC5waXBlKFxuICAgICAgZ3VscERvbShmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAvLyBmaXggYWx0IGltYWdlc1xuICAgICAgICBjb25zdCBpbWFnZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW1nW3NyY10nKSk7XG4gICAgICAgIGltYWdlcy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFsdCA9IGVsLmdldEF0dHJpYnV0ZSgnYWx0Jyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBBbHQnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdhbHQnLCB0aXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBmaXggdGl0bGUgaWZyYW1lXG4gICAgICAgIGNvbnN0IGlmcmFtZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaWZyYW1lW3NyY10nKSk7XG4gICAgICAgIGlmcmFtZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBUaXRsZSc7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV0FSTklORyBNQUtFUlxuICAgICAgICAvLyBjb3VudCBIMVxuICAgICAgICBjb25zdCBoMSA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaDEnKTtcbiAgICAgICAgaWYgKGgxLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBMb2dnZXIubG9nKGFuc2lDb2xvcnMueWVsbG93QnJpZ2h0KCdbV0FSTl0nKSwgYEgxICgke2gxLmxlbmd0aH0pICR7cGF0aH1gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGN3ZCkpO1xufVxuXG5ndWxwLnRhc2soJ3NlbycsIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgeyBkZXBsb3lEaXIgfSA9IGRlcGxveUNvbmZpZygpO1xuICByZXR1cm4gdGFza1NlbyhudWxsLCBkZXBsb3lEaXIpO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/ee/gulpseo_ee59cff135689a98b46d52951c185d0d.map","wrapperLength":82},"result":{"scriptId":"8328","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8740,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8737,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc3RhbmRhbG9uZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QiwwREFBb0M7QUFDcEMseUNBQTZDO0FBQzdDLHFDQUFzQztBQUV0Qzs7O0dBR0c7QUFDSCxTQUFTLGdCQUFnQjtJQUN2QixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ2hELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUscUJBQXFCLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztTQUNsRyxJQUFJLENBQ0gsa0JBQVEsQ0FBQyxHQUFHLENBQUMsVUFBZ0IsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJOzs7Ozs7d0JBQzNDLGdCQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzt3QkFDeEQsS0FBQSxDQUFBLEtBQUEsZ0JBQU0sQ0FBQSxDQUFDLEdBQUcsQ0FBQTs7d0JBQVMscUJBQU0sSUFBQSxvQkFBVyxFQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBQSxtQkFBUyxHQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFBOzt3QkFBcEUsY0FBVyxtQkFBUSxTQUFpRCxFQUFFLEVBQUMsQ0FBQzt3QkFDeEUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNsRCxLQUFLLEdBQUcsSUFBQSxxQkFBSyxFQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO3dCQUMvRCxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRTs0QkFDaEIsWUFBWTs0QkFDWixJQUFJLEVBQUUsQ0FBQzt3QkFDVCxDQUFDLENBQUMsQ0FBQzs7Ozs7S0FDSixDQUFDLENBQ0g7U0FDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1NBQ3hELElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDWCxnQkFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUUvQyxrQkFBZSxnQkFBZ0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5zdGFuZGFsb25lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyByZXBsYWNlUGF0aCB9IGZyb20gJy4vdXRpbHMvc3RyaW5nJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogcnVuIGFsbCBfKi5zdGFuZGFsb25lLmpzIGluc2lkZSBzcmMtcG9zdHMgKF9jb25maWdfeW1sLnBvc3RfZGlyKVxuICogQHJldHVybnNcbiAqL1xuZnVuY3Rpb24gc3RhbmRhbG9uZVJ1bm5lcigpIHtcbiAgTG9nZ2VyLmxvZygnW3N0YW5kYWxvbmVdIFJ1bm5pbmcgc2NyaXB0cy4uLlxcbicpO1xuICByZXR1cm4gZ3VscFxuICAgIC5zcmMoam9pbihnZXRDb25maWcoKS5jd2QsICcqKi9fKi5zdGFuZGFsb25lLmpzJyksIHsgY3dkOiBnZXRDb25maWcoKS5jd2QsIGlnbm9yZTogWycqKi90bXAvKionXSB9KVxuICAgIC5waXBlKFxuICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIGZ1bmN0aW9uIChmaWxlLCBfZW5jLCBuZXh0KSB7XG4gICAgICAgIExvZ2dlci5sb2coJz0nLnJlcGVhdCgxMCkgKyAnIGlucHV0ICcgKyAnPScucmVwZWF0KDEwKSk7XG4gICAgICAgIExvZ2dlci5sb2coYG5vZGUgJHthd2FpdCByZXBsYWNlUGF0aChmaWxlLnBhdGgsIGdldENvbmZpZygpLmN3ZCwgJycpfWApO1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBvdXB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXduKCdub2RlJywgW2ZpbGUucGF0aF0sIHsgc3RkaW86ICdpbmhlcml0JyB9KTtcbiAgICAgICAgY2hpbGQub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3AgZmlsZVxuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIClcbiAgICAucGlwZShndWxwLmRlc3Qoam9pbihnZXRDb25maWcoKS5jd2QsICd0bXAvc3RhbmRhbG9uZScpKSlcbiAgICAub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgTG9nZ2VyLmxvZygnXFxuW3N0YW5kYWxvbmVdIHN0b3BwZWQnKTtcbiAgICB9KTtcbn1cblxuZ3VscC50YXNrKCdwb3N0OnN0YW5kYWxvbmUnLCBzdGFuZGFsb25lUnVubmVyKTtcblxuZXhwb3J0IGRlZmF1bHQgc3RhbmRhbG9uZVJ1bm5lcjtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/70/gulpstandalone_70a88f15ac851281d69271b2b48c84eb.map","wrapperLength":82},"result":{"scriptId":"8334","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8780,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8777,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLHFDQUF3QztBQUN4Qyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF1QztBQUN2Qyx1Q0FBeUM7QUFDekMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyx5QkFBeUI7QUFDekIsbURBQXNEO0FBQ3RELCtCQUE2QjtBQUM3QixxQ0FBcUM7QUFDckMsdUNBQWlFO0FBQ2pFLGlDQUF1QztBQUN2QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHNFQUErQztBQUMvQyxxQ0FBK0Q7QUFFL0Q7Ozs7RUFJRTtBQUNGLElBQUksUUFBUSxHQUFHLEVBQWMsQ0FBQztBQUM5QixJQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO0FBQ2xDLElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCOzs7OztHQUtHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLEdBQStCLEVBQUUsSUFBUTtJQUF6RSxpQkE2REM7SUE3RGdFLHFCQUFBLEVBQUEsUUFBUTtJQUN2RSxPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQW9DO1FBQ3ZELElBQU0sUUFBUSxHQUF5QyxFQUFFLENBQUM7UUFDMUQsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7WUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixRQUFRLENBQUMsSUFBSSxDQUNYLElBQUEscUNBQW1CLEVBQUMsR0FBRyxFQUFFO2dCQUN2QixJQUFJLE1BQUE7YUFDTCxDQUFDLENBQ0gsQ0FBQztTQUNIO2FBQU07WUFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsQ0FB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QUFBLGtCQUFPLEVBQUM7b0JBQ04seUJBQXlCO29CQUN6QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLG1CQUFlLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQzt3QkFDeEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDZCQUEyQixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDL0Q7d0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNkZBQStFLE9BQU8scUJBQWlCLENBQUM7cUJBQ2hJO29CQUNELHVFQUF1RTtnQkFDekUsQ0FBQyxDQUFDLENBQ0g7cUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7cUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLE9BQU8sRUFBRSxFQUFULENBQVMsQ0FBQyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFqR0Qsa0RBaUdDO0FBRUQsU0FBUyxPQUFPLENBQUMsSUFBWSxFQUFFLFFBQW9DO0lBQ2pFLE9BQU8sb0JBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtJQUNuQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQU87UUFDMUIsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGhleG8gfSBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciB9IGZyb20gJ2hleG8tdXRpbCc7XG5pbXBvcnQgbWljcm9tYXRjaCBmcm9tICdtaWNyb21hdGNoJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBzaXRlbWFwQ3Jhd2xlckFzeW5jIH0gZnJvbSAnc2l0ZW1hcC1jcmF3bGVyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyB5b2FzdFNlbyB9IGZyb20gJy4vc2l0ZW1hcCc7XG5pbXBvcnQgeyBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qXG4vLyByZWFkIGV4aXN0aW5nIHNpdGVtYXAudHh0XG5jb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xubGV0IHNpdGVtYXBzID0gZXhpc3RzU3luYyhzaXRlbWFwVFhUKSA/IGFycmF5X3JlbW92ZV9lbXB0eShyZWFkRmlsZVN5bmMoc2l0ZW1hcFRYVCwgJ3V0Zi04Jykuc3BsaXQoL1xccj9cXG4vZ20pKSA6IFtdO1xuKi9cbmxldCBzaXRlbWFwcyA9IFtdIGFzIHN0cmluZ1tdO1xuY29uc3QgY3Jhd2xlZCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuLyoqXG4gKiBTaXRlbWFwIEdlbmVyYXRvclxuICogQHBhcmFtIHVybCB1cmwgdG8gY3Jhd2xcbiAqIEBwYXJhbSBkZWVwIGNyYXdsIGRlZXBlciBuIHRpbWVzXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTaXRlbWFwKHVybD86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsIGRlZXAgPSAwKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmU6IChzaXRlbWFwczogc3RyaW5nW10pID0+IGFueSkgPT4ge1xuICAgIGNvbnN0IHByb21pc2VzOiBCbHVlYmlyZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4+W10gPSBbXTtcbiAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKHVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNyYXdsZWQuYWRkKGdldENvbmZpZygpLnVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKGdldENvbmZpZygpLnVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIEJsdWViaXJkLmFsbChwcm9taXNlcylcbiAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hcHBlZCA9IHt9IGFzIFJldHVyblR5cGU8dHlwZW9mIHNpdGVtYXBDcmF3bGVyQXN5bmM+O1xuICAgICAgICByZXN1bHRzLmZvckVhY2goKHNpdGVtYXApID0+IHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBzaXRlbWFwKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBzaXRlbWFwW2tleV07XG4gICAgICAgICAgICBpZiAoa2V5IGluIG1hcHBlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSB2YWx1ZXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBtYXBwZWRba2V5XSA9IGFycmF5X3VuaXF1ZSh2YWx1ZXMuY29uY2F0KG1hcHBlZFtrZXldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIGNvbnN0IHNhdmV0byA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL3NpdGVtYXAvc2l0ZW1hcC5qc29uJyk7XG4gICAgICAgIHdyaXRlZmlsZShzYXZldG8sIEpTT04uc3RyaW5naWZ5KG1hcHBlZCwgbnVsbCwgMikpO1xuXG4gICAgICAgIC8vIHJldHVyblxuICAgICAgICByZXR1cm4gbWFwcGVkO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGFzeW5jIChyZXN1bHRzKSA9PiB7XG4gICAgICAgIHNpdGVtYXBzID0gYXJyYXlfdW5pcXVlKGFycmF5X3JlbW92ZV9lbXB0eShPYmplY3QudmFsdWVzKHJlc3VsdHMpLmZsYXQoMSkuY29uY2F0KHNpdGVtYXBzKSkpLnNvcnQoZnVuY3Rpb24gKFxuICAgICAgICAgIGEsXG4gICAgICAgICAgYlxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IDAgOiBhIDwgYiA/IC0xIDogMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWVwOyBpKyspIHtcbiAgICAgICAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgc2l0ZW1hcHMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBzaXRlbWFwc1tpaV07XG4gICAgICAgICAgICBpZiAoY3Jhd2xlZC5oYXModXJsKSB8fCAvLihqc3x0c3xjc3N8c2Nzc3x0eHR8cGRmfHBuZ3xqcGU/Z3xnaWZ8d2VicCkkL2dpLnRlc3QodXJsKSkgY29udGludWU7XG5cbiAgICAgICAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICAgICAgICBMb2dnZXIubG9nKCdbZGVwdGhdJywgaWksIHVybCk7XG4gICAgICAgICAgICBhd2FpdCBnZW5lcmF0ZVNpdGVtYXAodXJsLCBkZWVwKS50aGVuKCgpID0+IHdyaXRlU2l0ZW1hcCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB3cml0ZVNpdGVtYXAocmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8qKlxuICogd3JpdGUgdGhlIHNpdGVtYXBcbiAqIEBwYXJhbSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiB3cml0ZVNpdGVtYXAoY2FsbGJhY2s/OiAoLi4uYXJnczogYW55W10pID0+IGFueSkge1xuICBsZXQgY2IgPSBub29wO1xuICBpZiAoY2FsbGJhY2spIGNiID0gKCkgPT4gY2FsbGJhY2soc2l0ZW1hcHMpO1xuICBjb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xuICB3cml0ZWZpbGUoc2l0ZW1hcFRYVCwgYXJyYXlfcmVtb3ZlX2VtcHR5KHNpdGVtYXBzKS5qb2luKEVPTCkpO1xuICBjYi5hcHBseSh0aGlzKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaXRlbWFwT3B0aW9ucyB7XG4gIHBhdGg6IHN0cmluZ1tdO1xuICB0YWdzOiBib29sZWFuO1xuICBjYXRlZ29yaWVzOiBib29sZWFuO1xuICByZWw6IGJvb2xlYW47XG4gIHlvYXN0OiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4b0dlbmVyYXRlU2l0ZW1hcCgpIHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oZ2V0Q29uZmlnKCkuY3dkKTtcbiAgICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICBpbnN0YW5jZS5sb2FkKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb25maWcgPSBzZXRDb25maWcoaW5zdGFuY2UuY29uZmlnKTtcbiAgICAgICAgLy8gYXNzaWduIGRlZmF1bHQgY29uZmlnXG4gICAgICAgIGNvbnN0IHNpdGVtYXA6IFNpdGVtYXBPcHRpb25zID0gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICB7IHJlbDogZmFsc2UsIHRhZ3M6IGZhbHNlLCBjYXRlZ29yaWVzOiBmYWxzZSwgcGF0aDogWydzaXRlbWFwLnR4dCcsICdzaXRlbWFwLnhtbCddIH0sXG4gICAgICAgICAgY29uZmlnLnNpdGVtYXBcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCdWlsZCBZb2FzdCBTRU8gc2l0ZW1hcFxuICAgICAgICAvLyB3aGVuIGNvbmZpZy55b2FzdCBkZWZpbmVkXG4gICAgICAgIGlmIChzaXRlbWFwLnlvYXN0KSB7XG4gICAgICAgICAgcmV0dXJuIHlvYXN0U2VvKGluc3RhbmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLnNpdGVtYXApIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAgbm90IGNvbmZpZ3VyZWQgaW4gX2NvbmZpZy55bWwnKTtcbiAgICAgICAgY29uc3QgbG9jYWxzID0gaW5zdGFuY2UubG9jYWxzO1xuICAgICAgICBjb25zdCB7IHNraXBfcmVuZGVyIH0gPSBjb25maWc7XG5cbiAgICAgICAgaWYgKCFzaXRlbWFwLnRhZ3MgfHwgIXNpdGVtYXAuY2F0ZWdvcmllcykge1xuICAgICAgICAgIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAudGFncyBvciBjb25maWcuc2l0ZW1hcC5jYXRlZ29yaWVzIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2tpcFJlbmRlckxpc3QgPSBbJyoqLyouanMnLCAnKiovKi5jc3MnLCAnKiovLmdpdConXTtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShza2lwX3JlbmRlcikpIHtcbiAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKC4uLnNraXBfcmVuZGVyKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2tpcF9yZW5kZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaWYgKHNraXBfcmVuZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNraXBSZW5kZXJMaXN0LnB1c2goc2tpcF9yZW5kZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvc3RzID0gWy4uLmxvY2Fscy5nZXQoJ3BhZ2VzJykudG9BcnJheSgpLCAuLi5sb2NhbHMuZ2V0KCdwb3N0cycpLnRvQXJyYXkoKV1cbiAgICAgICAgICAuZmlsdGVyKChwb3N0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcG9zdC5zaXRlbWFwICE9PSBmYWxzZSAmJiAhaXNNYXRjaChwb3N0LnNvdXJjZSwgc2tpcFJlbmRlckxpc3QpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnVwZGF0ZWQgJiYgYS51cGRhdGVkKSByZXR1cm4gYi51cGRhdGVkLnRvRGF0ZSgpLmdldFRpbWUoKSAtIGEudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAocG9zdHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdG1wbFNyYyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9zaXRlbWFwLnhtbCcpO1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuICAgICAgICBjb25zdCB7IHRhZ3M6IHRhZ3NDZmcsIGNhdGVnb3JpZXM6IGNhdHNDZmcsIHJlbDogcmVsQ2ZnIH0gPSBzaXRlbWFwO1xuICAgICAgICBsZXQgZGF0YSA9IHRlbXBsYXRlLnJlbmRlcih7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIHBvc3RzLFxuICAgICAgICAgIHNOb3c6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdGFnczogdGFnc0NmZyA/IGxvY2Fscy5nZXQoJ3RhZ3MnKS50b0FycmF5KCkgOiBbXSxcbiAgICAgICAgICBjYXRlZ29yaWVzOiBjYXRzQ2ZnID8gbG9jYWxzLmdldCgnY2F0ZWdvcmllcycpLnRvQXJyYXkoKSA6IFtdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlbW92ZSBibGFuayBuZXdsaW5lc1xuICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9eXFxzKltcXHJcXG5dL2dtLCAnXFxuJyk7XG5cbiAgICAgICAgLy9kYXRhID0gcHJldHRpZXIuZm9ybWF0KGRhdGEsIHsgcGFyc2VyOiAneG1sJywgcGx1Z2luczogW3htbHBsdWdpbl0sIGVuZE9mTGluZTogJ2xmJyB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIHdyaXRlZmlsZShqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAueG1sJyksIGRhdGEpO1xuXG4gICAgICAgIC8vIHdyaXRlXG4gICAgICAgIGNvbnN0IHNpdGVtYXBYbWwgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdzaXRlbWFwLnhtbCcpO1xuICAgICAgICB3cml0ZWZpbGUoc2l0ZW1hcFhtbCwgZGF0YSk7XG4gICAgICAgIGluc3RhbmNlLmxvZy5pbmZvKCdzaXRlbWFwIHdyaXR0ZW4nLCBzaXRlbWFwWG1sKTtcblxuICAgICAgICBpZiAoIXJlbENmZykgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgY29uc3QgYmFzZVVSTCA9IGNvbmZpZy51cmwuZW5kc1dpdGgoJy8nKSA/IGNvbmZpZy51cmwgOiBjb25maWcudXJsICsgJy8nO1xuICAgICAgICBjb25zdCBwdWJsaWNEaXIgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgICBndWxwXG4gICAgICAgICAgLnNyYygnKiovKi5odG1sJywgeyBjd2Q6IHB1YmxpY0RpciwgaWdub3JlOiBjb21tb25JZ25vcmUgfSlcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBzaXRlbWFwXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3NpdGVtYXAueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwic2l0ZW1hcC1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi90ZXh0K3htbFwiIHJlbD1cInNpdGVtYXBcIiBocmVmPVwiJHtiYXNlVVJMfXNpdGVtYXAueG1sXCIgLz5gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgICAub25jZSgnZW5kJywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaXNNYXRjaChwYXRoOiBzdHJpbmcsIHBhdHRlcm5zOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSkge1xuICByZXR1cm4gbWljcm9tYXRjaC5pc01hdGNoKHBhdGgsIHBhdHRlcm5zKTtcbn1cblxuZ3VscC50YXNrKCdzaXRlbWFwJywgKCkgPT4ge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgaGV4b0dlbmVyYXRlU2l0ZW1hcCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/e1/gulpsitemap_e101e74aed6d774c00756f77ebed36bd.map","wrapperLength":82},"result":{"scriptId":"8338","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33900,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33897,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDhDQUF3QjtBQUN4Qix1Q0FBa0M7QUFDbEMsK0JBQTZCO0FBQzdCLHdCQUFzQjtBQUN0Qix5QkFBdUI7QUFDdkIsdUJBQXFCO0FBQ3JCLDJCQUF5QjtBQUN6QixzQkFBb0I7QUFDcEIsdUJBQXFCO0FBQ3JCLDZCQUEyQjtBQUMzQiwwREFBb0M7QUFFcEMseUJBQXlCO0FBQ3pCLFNBQWdCLGFBQWEsQ0FBQyxNQUFpQztJQUM3RCxJQUFNLE9BQU8sR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxXQUFXLENBQUMsRUFBRSxJQUFBLFlBQUksRUFBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDakcsSUFBTSxNQUFNLEdBQUc7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU07WUFBRSxPQUFPLE1BQU0sRUFBRSxDQUFDO1FBQ3JDLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFNLEdBQUcsR0FBRztZQUNWLEdBQUcsRUFBRSxNQUFNO1lBQ1gsS0FBSyxFQUFFLFNBQVM7U0FDakIsQ0FBQztRQUNGLE9BQU8sSUFBQSxpQkFBSyxFQUFDLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBTyxHQUFHLENBQUM7YUFDekMsSUFBSSxDQUFDLGNBQU0sT0FBQSxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxFQUFPLEdBQUcsQ0FBQyxFQUFoRSxDQUFnRSxDQUFDO2FBQzVFLEtBQUssQ0FBQyxVQUFDLENBQUM7WUFDUCxJQUFJLENBQUMsWUFBWSxLQUFLO2dCQUFFLGdCQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDO2FBQ0QsT0FBTyxDQUFDO1lBQ1AsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2hCLE1BQU0sRUFBRSxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUM7SUFDRixPQUFPLE1BQU0sRUFBRSxDQUFDO0FBQ2xCLENBQUM7QUFwQkQsc0NBb0JDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUUzQyxrQkFBZSxjQUFJLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgc3Bhd24gfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLmRlcGxveSc7XG5pbXBvcnQgJy4vZ3VscC5mZWVkJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgJy4vcG9zdC9jb3B5JztcbmltcG9ydCAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5cbi8vIGNvbW1pdCBjdXJyZW50IHByb2plY3RcbmV4cG9ydCBmdW5jdGlvbiBjb21taXRQcm9qZWN0KGZpbmlzaDogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBnaXREaXJzID0gW2pvaW4ocHJvY2Vzcy5jd2QoKSwgJ3NyYy1wb3N0cycpLCBqb2luKHByb2Nlc3MuY3dkKCksICdzb3VyY2UnKSwgcHJvY2Vzcy5jd2QoKV07XG4gIGNvbnN0IGNvbW1pdCA9ICgpID0+IHtcbiAgICBpZiAoIWdpdERpcnMubGVuZ3RoKSByZXR1cm4gZmluaXNoKCk7XG4gICAgY29uc3QgZ2l0RGlyID0gZ2l0RGlyc1swXTtcbiAgICBjb25zdCBvcHQgPSB7XG4gICAgICBjd2Q6IGdpdERpcixcbiAgICAgIHN0ZGlvOiAnaW5oZXJpdCdcbiAgICB9O1xuICAgIHJldHVybiBzcGF3bignZ2l0JywgWydhZGQnLCAnLUEnXSwgPGFueT5vcHQpXG4gICAgICAudGhlbigoKSA9PiBzcGF3bignZ2l0JywgWydjb21taXQnLCAnLW0nLCAndXBkYXRlICcgKyBuZXcgRGF0ZSgpXSwgPGFueT5vcHQpKVxuICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIExvZ2dlci5sb2coZS5tZXNzYWdlLCBnaXREaXIpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgZ2l0RGlycy5zaGlmdCgpO1xuICAgICAgICBjb21taXQoKTtcbiAgICAgIH0pO1xuICB9O1xuICByZXR1cm4gY29tbWl0KCk7XG59XG5cbmd1bHAudGFzaygncHJvamVjdC1jb21taXQnLCBjb21taXRQcm9qZWN0KTtcblxuZXhwb3J0IGRlZmF1bHQgZ3VscDtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/c0/gulpfile_c0c9f96e795586c702c83946161b1950.map","wrapperLength":82},"result":{"scriptId":"8687","url":"D:\\Repositories\\static-blog-generator\\src\\gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4931,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4928,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlCQUF1RTtBQUN2RSw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBbUQ7QUFDbkQsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QixzRUFBK0M7QUFDL0MscUNBQW9EO0FBRXBELElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCLGNBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsSUFBSTtJQUM5QixJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFFBQVEsR0FBRyxJQUFJLGNBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQztRQUNuQixRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFVBQUMsR0FBRztnQkFDN0IsT0FBTyx3QkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUM7WUFFSCxTQUFTLEtBQUssQ0FBQyxPQUE2QixFQUFFLElBQTBCO2dCQUN0RSxJQUFNLFFBQVEsR0FBRyxrQkFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUV2RSxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDekMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzVCLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFB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QTRFLE9BQU8saUJBQWEsQ0FBQztpQkFDekg7Z0JBQ0Qsc0JBQXNCO2dCQUN0QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLGdCQUFZLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQztvQkFDckUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDBCQUF3QixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDNUQ7b0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNEZBQThFLE9BQU8sa0JBQWMsQ0FBQztpQkFDNUg7Z0JBQ0QsdUVBQXVFO1lBQ3pFLENBQUMsQ0FBQyxDQUNIO2lCQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUMxQixJQUFJLENBQUMsS0FBSyxFQUFFLGNBQU0sT0FBQSxJQUFJLEVBQUUsRUFBTixDQUFNLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXRoT3JGaWxlRGVzY3JpcHRvciwgcmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgaGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciwgZ3JhdmF0YXIgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG51bmp1Y2tzIGZyb20gJ251bmp1Y2tzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG5jb25zdCBlbnYgPSBlbnZOdW5qdWNrcygpO1xuXG5ndWxwLnRhc2soJ2ZlZWQnLCBmdW5jdGlvbiAoZG9uZSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaW5zdGFuY2UgPSBuZXcgaGV4byhjb25maWcuY3dkKTtcblxuICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oKCkgPT4ge1xuICAgICAgZW52LmFkZEZpbHRlcignZm9ybWF0VXJsJywgKHN0cikgPT4ge1xuICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICB9KTtcblxuICAgICAgZnVuY3Rpb24gYnVpbGQodG1wbFNyYzogUGF0aE9yRmlsZURlc2NyaXB0b3IsIGRlc3Q6IFBhdGhPckZpbGVEZXNjcmlwdG9yKSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gbnVuanVja3MuY29tcGlsZShyZWFkRmlsZVN5bmModG1wbFNyYywgJ3V0Zi04JyksIGVudik7XG5cbiAgICAgICAgbGV0IHBvc3RzID0gaW5zdGFuY2UubG9jYWxzLmdldCgncG9zdHMnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5zb3J0KCctZGF0ZScpO1xuICAgICAgICBwb3N0cyA9IHBvc3RzLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwb3N0LmRyYWZ0ICE9PSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB7IGVtYWlsLCBmZWVkLCB1cmw6IHVybENmZyB9ID0gY29uZmlnO1xuICAgICAgICBjb25zdCB7IGljb246IGljb25DZmcgfSA9IGZlZWQ7XG5cbiAgICAgICAgbGV0IHVybCA9IHVybENmZztcbiAgICAgICAgaWYgKHVybFt1cmwubGVuZ3RoIC0gMV0gIT09ICcvJykgdXJsICs9ICcvJztcbiAgICAgICAgLy8gcmVtb3ZlIGJyb2tlbiBoZXhvIGxhbmcgc2hvcnRjb2RlXG4gICAgICAgIGlmICh1cmwuaW5jbHVkZXMoJzpsYW5nLycpKSB1cmwgPSB1cmwucmVwbGFjZSgnLzpsYW5nLycsICcvJyk7XG5cbiAgICAgICAgbGV0IGljb24gPSAnJztcbiAgICAgICAgaWYgKGljb25DZmcpIGljb24gPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgaWNvbkNmZyk7XG4gICAgICAgIGVsc2UgaWYgKGVtYWlsKSBpY29uID0gZ3JhdmF0YXIoZW1haWwsIHt9KTtcblxuICAgICAgICBjb25zdCBmZWVkX3VybCA9IGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCAncnNzLnhtbCcpO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgaWNvbixcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBmZWVkX3VybFxuICAgICAgICB9KTtcblxuICAgICAgICB3cml0ZUZpbGVTeW5jKGRlc3QsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVJTUyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9yc3MueG1sJyk7XG4gICAgICBjb25zdCBkZXN0UlNTID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2RpciwgJ3Jzcy54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlUlNTLCBkZXN0UlNTKTtcblxuICAgICAgY29uc3QgdGVtcGxhdGVBVE9NID0gam9pbihfX2Rpcm5hbWUsICdfY29uZmlnX3RlbXBsYXRlX2F0b20ueG1sJyk7XG4gICAgICBjb25zdCBkZXN0QVRPTSA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdhdG9tLnhtbCcpO1xuICAgICAgYnVpbGQodGVtcGxhdGVBVE9NLCBkZXN0QVRPTSk7XG5cbiAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcblxuICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG4gICAgICBndWxwXG4gICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgcnNzXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIvcnNzLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwicnNzLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL3Jzcyt4bWxcIiByZWw9XCJhbHRlcm5hdGVcIiBocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBhdG9tXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfWF0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL2F0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5oZWFkLmlubmVySFRNTCArPSBgPGxpbmsgaWQ9XCJhdG9tLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL2F0b20reG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiIC8+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IGRvbmUoKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/21/gulpfeed_218d054d70d3561ba89867e4695c6976.map","wrapperLength":82},"result":{"scriptId":"8688","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13306,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13303,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":7,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673237858751,"runtime":18764,"slow":true,"start":1673237839987},"skipped":false,"testFilePath":"D:\\Repositories\\static-blog-generator\\test\\copy-with-mapper.test.ts","testResults":[{"ancestorTitles":["test copy post with label mapper","clean"],"duration":653,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["test copy post with label mapper","clean"],"duration":22,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["test copy post with label mapper","copy"],"duration":6932,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["test copy post with label mapper","copy"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"},{"ancestorTitles":["test copy post with label mapper","validate mapped"],"duration":356,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper validate mapped label lowercase","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"label lowercase"},{"ancestorTitles":["test copy post with label mapper","validate mapped"],"duration":80,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper validate mapped label assign (add label based on config.tags|categories.assign key)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"label assign (add label based on config.tags|categories.assign key)"},{"ancestorTitles":["test copy post with label mapper","validate mapped"],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"test copy post with label mapper validate mapped label mapper (label replacer)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"label mapper (label replacer)"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGluZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUErQztBQUF0QyxtSEFBQSxPQUFPLE9BQWU7QUFDL0Isc0RBQWdFO0FBQXZELHlIQUFBLE9BQU8sT0FBYztBQUM5QixzREFBK0Q7QUFBdEQsd0hBQUEsT0FBTyxPQUFhO0FBQzdCLDJDQUE4RDtBQUFyRCxxR0FBQSxPQUFPLE9BQUE7QUFBRSxpR0FBQSxHQUFHLE9BQUE7QUFBRSx1R0FBQSxHQUFHLE9BQWE7QUFDdkMsdUNBQWdEO0FBQXZDLG1HQUFBLE9BQU8sT0FBVztBQUMzQiwrQ0FBc0U7QUFBN0QsK0dBQUEsZUFBZSxPQUFBO0FBQUUsbUhBQUEsbUJBQW1CLE9BQUE7QUFDN0MscURBQWdFO0FBQXZELG9JQUFBLE9BQU8sT0FBb0I7QUFDcEMsdUNBQTREO0FBQW5ELHlHQUFBLGFBQWEsT0FBQTtBQUFFLGlIQUFBLE9BQU8sT0FBUTtBQUN2QyxvQ0FBMkQ7QUFBbEQsb0dBQUEsWUFBWSxPQUFBO0FBQUUsc0dBQUEsY0FBYyxPQUFBO0FBQ3JDLHdDQUEyQztBQUFsQyxvR0FBQSxVQUFVLE9BQUE7QUFDbkIsdUNBQStFO0FBQXRFLHFHQUFBLFlBQVksT0FBQTtBQUFFLDJHQUFBLGtCQUFrQixPQUFBO0FBQUUscUdBQUEsWUFBWSxPQUFBO0FBQ3ZELHFDQUFvQztBQUEzQiw0RkFBQSxJQUFJLE9BQUE7QUFDYiwrQ0FBeUQ7QUFBaEQsdUhBQUEsT0FBTyxPQUFhO0FBQzdCLHFDQUErRDtBQUF0RCx1R0FBQSxZQUFZLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFFM0MsRUFBRSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgZGVmYXVsdCBhcyBBcHBsaWNhdGlvbiB9IGZyb20gJy4vYXBpJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscENhY2hlZCB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscERlYnVnIH0gZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuZGVidWcnO1xuZXhwb3J0IHsgY2xlYW5EYiwgZGVsLCBkZWwgYXMgZGVsZXRlRGlyIH0gZnJvbSAnLi9ndWxwLmNsZWFuJztcbmV4cG9ydCB7IHRhc2tTZW8gYXMgYXV0b1NlbyB9IGZyb20gJy4vZ3VscC5zZW8nO1xuZXhwb3J0IHsgZ2VuZXJhdGVTaXRlbWFwLCBoZXhvR2VuZXJhdGVTaXRlbWFwIH0gZnJvbSAnLi9ndWxwLnNpdGVtYXAnO1xuZXhwb3J0IHsgZGVmYXVsdCBhcyBzdGFuZGFsb25lUnVubmVyIH0gZnJvbSAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuZXhwb3J0IHsgY29tbWl0UHJvamVjdCwgZGVmYXVsdCBhcyBndWxwIH0gZnJvbSAnLi9ndWxwZmlsZSc7XG5leHBvcnQgeyBjb3B5QWxsUG9zdHMsIGNvcHlTaW5nbGVQb3N0IH0gZnJvbSAnLi9wb3N0L2NvcHknO1xuZXhwb3J0IHsgdXBkYXRlUG9zdCB9IGZyb20gJy4vcG9zdC91cGRhdGUnO1xuZXhwb3J0IHsgYXJyYXlfcmFuZG9tLCBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuZXhwb3J0IHsgbm9vcCB9IGZyb20gJy4vdXRpbHMvbm9vcCc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIHNjaGVkdWxlciB9IGZyb20gJy4vdXRpbHMvc2NoZWR1bGVyJztcbmV4cG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vL1xuIl0sInZlcnNpb24iOjN9","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/11/index_11ca8584e92c62acbf7dbcbf146ed11f.map","wrapperLength":82},"result":{"scriptId":"10010","url":"D:\\Repositories\\static-blog-generator\\src\\index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":6665,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":6662,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":210,"endOffset":230,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":904,"endOffset":958,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1088,"endOffset":1149,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1278,"endOffset":1339,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1455,"endOffset":1499,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1567,"endOffset":1607,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1681,"endOffset":1721,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1833,"endOffset":1875,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2003,"endOffset":2057,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2141,"endOffset":2199,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2334,"endOffset":2400,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2518,"endOffset":2566,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2635,"endOffset":2694,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2808,"endOffset":2851,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2930,"endOffset":2975,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3091,"endOffset":3134,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3251,"endOffset":3295,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3378,"endOffset":3428,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3505,"endOffset":3549,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3656,"endOffset":3691,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3813,"endOffset":3873,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3988,"endOffset":4034,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4108,"endOffset":4151,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4225,"endOffset":4268,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_deploy_1 = require(\"./gulp.deploy\");\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = {};\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, gulp_standalone_1.default)(); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        if (!options)\n            options = (0, _config_1.getConfig)();\n        this.cwd = cwd;\n        options.cwd = cwd;\n        this.config = this.setConfig(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * Copy all **src-post** to **source/_posts** (run before generate)\n     * * see the method {@link pcopy.copyAllPosts}\n     * @returns\n     */\n    SBG.prototype.copy = function () {\n        return new bluebird_1.default(function (resolve, reject) {\n            pcopy\n                .copyAllPosts()\n                .once('end', function () { return resolve(); })\n                .once('error', reject);\n        });\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SBG.prototype.deploy = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var config, github;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: \n                    // run generate task\n                    return [4 /*yield*/, this.generate()];\n                    case 1:\n                        // run generate task\n                        _a.sent();\n                        // copy generated files to deployment directory\n                        return [4 /*yield*/, (0, gulp_deploy_1.asyncCopyGen)()];\n                    case 2:\n                        // copy generated files to deployment directory\n                        _a.sent();\n                        config = (0, _config_1.getConfig)();\n                        github = config.deploy.github;\n                        if (!github)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, github.init().catch(noop_1.default)];\n                    case 3:\n                        _a.sent();\n                        return [4 /*yield*/, github.setremote(config.repo).catch(noop_1.default)];\n                    case 4:\n                        _a.sent();\n                        return [4 /*yield*/, github.setuser(config.username).catch(noop_1.default)];\n                    case 5:\n                        _a.sent();\n                        return [4 /*yield*/, github.setemail(config.email).catch(noop_1.default)];\n                    case 6:\n                        _a.sent();\n                        return [4 /*yield*/, github.setbranch(config.branch).catch(noop_1.default)];\n                    case 7:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 3:\n                        if (!(opt === 'archives')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 5: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        _a.label = 7;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGFwaS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QiwrQkFBNkI7QUFFN0Isb0RBQXdDO0FBQ3hDLDZDQUE2QztBQUM3QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLGdFQUEwQztBQUMxQyxxQ0FBaUQ7QUFFakQ7SUFNRTs7O09BR0c7SUFDSCxhQUFZLEdBQXFCLEVBQUUsT0FBeUM7UUFBNUUsaUJBUUM7UUFoQkQsV0FBTSxHQUFHLEVBQWtDLENBQUM7UUFDNUMsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUFDdEIsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUF3QnRCOzs7V0FHRztRQUNILGVBQVUsR0FBRyxjQUFNLE9BQUEsSUFBQSx5QkFBZ0IsR0FBRSxFQUFsQixDQUFrQixDQUFDO1FBRXRDOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQXJELENBQXFELENBQUM7UUFnQmxFOzs7V0FHRztRQUNILGFBQVEsR0FBRyxjQUFNLE9BQUEsSUFBQSw0QkFBWSxFQUFDLGNBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQTFELENBQTBELENBQUM7UUEvQzFFLElBQUksQ0FBQyxHQUFHO1lBQUUsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTztZQUFFLE9B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QUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEVBQUE7O3dCQUFqRCxTQUFpRCxDQUFDOzs7OztLQUNuRDtJQUVEOzs7O09BSUc7SUFDRyxtQkFBSyxHQUFYLFVBQVksR0FBcUM7Ozs7OzZCQUMzQyxDQUFBLEdBQUcsS0FBSyxLQUFLLENBQUEsRUFBYix3QkFBYTt3QkFDZixxQkFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBQTs7d0JBQTFDLFNBQTBDLENBQUM7d0JBQzNDLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs7NkJBQzNDLENBQUEsR0FBRyxLQUFLLFVBQVUsQ0FBQSxFQUFsQix3QkFBa0I7d0JBQzNCLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs0QkFFcEQscUJBQU0sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUExQyxTQUEwQyxDQUFDOzs7Ozs7S0FFOUM7SUFDSCxVQUFDO0FBQUQsQ0FBQyxBQXhHRCxJQXdHQztBQUVELGtCQUFlLEdBQUcsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgSGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyBOdWxsYWJsZSB9IGZyb20gJy4vZ2xvYmFscyc7XG5pbXBvcnQgKiBhcyBjbGVhbmVyIGZyb20gJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgeyBhc3luY0NvcHlHZW4gfSBmcm9tICcuL2d1bHAuZGVwbG95JztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHNjaGVkdWxlciBmcm9tICcuL3V0aWxzL3NjaGVkdWxlcic7XG5pbXBvcnQgeyBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbmNsYXNzIFNCRyB7XG4gIGN3ZDogc3RyaW5nO1xuICBjb25maWcgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBnZXRDb25maWc+O1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICBpZiAoIW9wdGlvbnMpIG9wdGlvbnMgPSBnZXRDb25maWcoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBvcHRpb25zLmN3ZCA9IGN3ZDtcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMuc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBzdGFuZGFsb25lUnVubmVyKCk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSgpIHtcbiAgICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoKSA9PiBhbnksIHJlamVjdDogKGVycjogRXJyb3IpID0+IGFueSkgPT4ge1xuICAgICAgcGNvcHlcbiAgICAgICAgLmNvcHlBbGxQb3N0cygpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiByZXNvbHZlKCkpXG4gICAgICAgIC5vbmNlKCdlcnJvcicsIHJlamVjdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQW5vbnltaXplIGV4dGVybmFsIGxpbmtzIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2FmZWxpbmsgPSAoKSA9PiB0YXNrU2FmZWxpbmsobm9vcCwgam9pbih0aGlzLmN3ZCwgZ2V0Q29uZmlnKCkucHVibGljX2RpcikpO1xuXG4gIC8qKlxuICAgKiBnZW5lcmF0ZSBzaXRlIHdpdGggaGV4b1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGUoKSB7XG4gICAgY29uc3QgaGV4byA9IG5ldyBIZXhvKHRoaXMuY3dkKTtcbiAgICAvLyBoZXhvIGluaXRcbiAgICBhd2FpdCBoZXhvLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBoZXhvLmxvYWQoKS5jYXRjaChub29wKTtcbiAgICAvLyBoZXhvIGdlbmVyYXRlXG4gICAgYXdhaXQgaGV4by5jYWxsKCdnZW5lcmF0ZScpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8uZXhpdCgpO1xuICB9XG5cbiAgYXN5bmMgZGVwbG95KCkge1xuICAgIC8vIHJ1biBnZW5lcmF0ZSB0YXNrXG4gICAgYXdhaXQgdGhpcy5nZW5lcmF0ZSgpO1xuICAgIC8vIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIHRvIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gICAgYXdhaXQgYXN5bmNDb3B5R2VuKCk7XG4gICAgLy8gZGVwbG95bWVudCBzdGFydFxuICAgIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBjb25maWcuZGVwbG95O1xuICAgIGlmICghZ2l0aHViKSByZXR1cm47XG4gICAgYXdhaXQgZ2l0aHViLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0cmVtb3RlKGNvbmZpZy5yZXBvKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0dXNlcihjb25maWcudXNlcm5hbWUpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRlbWFpbChjb25maWcuZW1haWwpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRicmFuY2goY29uZmlnLmJyYW5jaCkuY2F0Y2gobm9vcCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlcycgfCAnZGF0YWJhc2UnKSB7XG4gICAgaWYgKG9wdCA9PT0gJ2FsbCcpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ2FyY2hpdmVzJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuRGIoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNCRztcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { asyncCopyGen } from './gulp.deploy';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = {} as ReturnType<typeof getConfig>;\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    if (!options) options = getConfig();\n    this.cwd = cwd;\n    options.cwd = cwd;\n    this.config = this.setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => standaloneRunner();\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy() {\n    return new Bluebird((resolve: () => any, reject: (err: Error) => any) => {\n      pcopy\n        .copyAllPosts()\n        .once('end', () => resolve())\n        .once('error', reject);\n    });\n  }\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  async deploy() {\n    // run generate task\n    await this.generate();\n    // copy generated files to deployment directory\n    await asyncCopyGen();\n    // deployment start\n    const config = getConfig();\n    const { github } = config.deploy;\n    if (!github) return;\n    await github.init().catch(noop);\n    await github.setremote(config.repo).catch(noop);\n    await github.setuser(config.username).catch(noop);\n    await github.setemail(config.email).catch(noop);\n    await github.setbranch(config.branch).catch(noop);\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archives' | 'database') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archives') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/27/api_27977693f3bb9acc653b3d92027b188c.map","wrapperLength":82},"result":{"scriptId":"10011","url":"D:\\Repositories\\static-blog-generator\\src\\api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":20115,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":20112,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":6},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":3},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":2},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":2},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":4},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":4},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":5},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4456,"endOffset":10810,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4549,"endOffset":5806,"count":1},{"startOffset":5549,"endOffset":5569,"count":0},{"startOffset":5604,"endOffset":5641,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4884,"endOffset":4940,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5086,"endOffset":5208,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.safelink","ranges":[{"startOffset":5375,"endOffset":5517,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":5824,"endOffset":5877,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":5896,"endOffset":5947,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.copy","ranges":[{"startOffset":6129,"endOffset":6381,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6181,"endOffset":6373,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6289,"endOffset":6322,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6459,"endOffset":7552,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.deploy","ranges":[{"startOffset":7581,"endOffset":9402,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":9573,"endOffset":10791,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9637,"endOffset":10783,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9688,"endOffset":10771,"count":4},{"startOffset":9760,"endOffset":9922,"count":1},{"startOffset":9838,"endOffset":9922,"count":0},{"startOffset":9943,"endOffset":10078,"count":0},{"startOffset":10099,"endOffset":10190,"count":0},{"startOffset":10211,"endOffset":10387,"count":1},{"startOffset":10294,"endOffset":10387,"count":0},{"startOffset":10408,"endOffset":10499,"count":0},{"startOffset":10520,"endOffset":10587,"count":1},{"startOffset":10608,"endOffset":10688,"count":1},{"startOffset":10709,"endOffset":10739,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuY2xlYW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMscUNBQThEO0FBQzlELDhDQUF3QjtBQUN4Qix5QkFBeUI7QUFDekIsK0JBQTZCO0FBQzdCLDZCQUErQjtBQUMvQix3REFBa0M7QUFDbEMsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMscUNBQXNDO0FBRXRDOztHQUVHO0FBQ0gsU0FBc0IsT0FBTyxDQUFDLFFBQWtELEVBQUUsS0FBZ0I7Ozs7OztvQkFDMUYsR0FBRyxHQUFHLElBQUEsZUFBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUNyQixNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7b0JBQzNCLElBQUksT0FBTyxNQUFNLENBQUMsVUFBVSxLQUFLLFFBQVEsRUFBRTt3QkFDekMsSUFBQSxjQUFTLEVBQUMsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLElBQUEsY0FBTyxFQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7d0JBQ3JFLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztxQkFDekQ7b0JBSUcsSUFBSSxHQUFHO3dCQUNULElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUM7d0JBQzdDLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDO3dCQUM3QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQzt3QkFDNUIsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUM7d0JBQzVC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QUFDN0MsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDL0IsY0FBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLmNsZWFuLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCByZWFkZGlyLCBybSwgUm1PcHRpb25zIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IGRlYnVnIGZyb20gJy4vdXRpbHMvZGVidWcnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIENsZWFuIFByb2plY3QgRGF0YWJhc2VzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbkRiKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpLCBmaWxlcz86IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxvZyA9IGRlYnVnKCdjbGVhbicpO1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgaWYgKHR5cGVvZiBjb25maWcuc291cmNlX2RpciAhPT0gJ3N0cmluZycpIHtcbiAgICB3cml0ZWZpbGUoam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9jbGVhbi5sb2cnKSwgaW5zcGVjdChjb25maWcpKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbmZpZy5zb3VyY2VfZGlyIG11c3QgYmUgY29uZmlndXJlZCcpO1xuICB9XG5cbiAgLy8gY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG5cbiAgbGV0IGRpcnMgPSBbXG4gICAgam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9jYWNoZScpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9kdW1wJyksXG4gICAgam9pbihjb25maWcuY3dkLCAndG1wL2xvZ3MnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICdkYi5qc29uJylcbiAgXTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZmlsZXMpKSBkaXJzID0gZGlycy5jb25jYXQoZmlsZXMpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBkaXIgPSBkaXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICAgIGxvZygnY2xhbmluZycsIGRpcik7XG4gICAgICAgIGF3YWl0IGRlbChkaXIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2gge1xuICAgICAgbG9nKCdjYW5ub3QgZGVsZXRlJywgZGlyKTtcbiAgICB9XG4gIH1cblxuICAvKmNvbnN0IGhleG8gPSBuZXcgaGV4b0xpYihjb25maWcuY3dkKTtcbiAgYXdhaXQgaGV4by5pbml0KCkuY2F0Y2gobm9vcCk7XG4gIGF3YWl0IGhleG8uY2FsbCgnY2xlYW4nKS5jYXRjaChub29wKTsqL1xuXG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHJldHVybiBjYWxsYmFjaygpO1xuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogZGVsZXRlIGZvbGRlciBhc3luY1xuICogQHBhcmFtIHBhdGhcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWwocGF0aDogc3RyaW5nKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBybU9wdDogUm1PcHRpb25zID0geyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH07XG4gICAgaWYgKGV4aXN0c1N5bmMocGF0aCkpIHtcbiAgICAgIHJtKHBhdGgsIHJtT3B0KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgLyppZiAoc3RhdFN5bmMocGF0aCkuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICBybWRpcihwYXRoLCB7IG1heFJldHJpZXM6IDEwIH0pLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIH0qL1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlKG5ldyBFcnJvcihwYXRoICsgJyBub3QgZm91bmQnKSk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBjbGVhbiBvbGQgYXJjaGl2ZXMgKGNhdGVnb3JpZXMsIHRhZ3MsIHBhZ2luYXRpb24pIGZyb20gZGVwbG95bWVudCBkaXJlY3RvcnlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuT2xkQXJjaGl2ZXMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGxvZ25hbWUgPSAnY2xlYW46JyArIGFuc2lDb2xvcnMuZ3JleSgnYXJjaGl2ZXMnKTtcblxuICAvLyBjbGVhbiBhcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc1xuICBjb25zdCBhcmNoaXZlcyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy5hcmNoaXZlX2Rpcik7XG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuY2F0ZWdvcnlfZGlyKTtcbiAgY29uc3QgdGFncyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy50YWdfZGlyKTtcbiAgY29uc3QgZm9sZGVycyA9IFthcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc10uZmlsdGVyKChzdHIpID0+IGV4aXN0c1N5bmMoc3RyKSk7XG5cbiAgLy8gcHVzaCBsYW5ndWFnZSBmb2xkZXIgdG8gYmUgZGVsZXRlZCBmcm9tIGRlcGxveSBkaXJcbiAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmxhbmd1YWdlKSkge1xuICAgIGNvbnN0IGxhbmdEaXIgPSBjb25maWcubGFuZ3VhZ2UubWFwKChwYXRoKSA9PiBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBwYXRoKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLmxhbmdEaXIpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcubGFuZ3VhZ2UgPT09ICdzdHJpbmcnICYmIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgZm9sZGVycy5wdXNoKGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpKSk7XG4gIH1cblxuICAvLyBkZWxldGUgcGFnaW5hdGlvblxuICBjb25zdCBwYWdlc0RpciA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsICdwYWdlJyk7XG4gIGlmIChleGlzdHNTeW5jKHBhZ2VzRGlyKSkge1xuICAgIGNvbnN0IHBhZ2VzID0gKGF3YWl0IHJlYWRkaXIocGFnZXNEaXIpKS5maWx0ZXIoKHN0cikgPT4gL15cXGQrJC8udGVzdChzdHIpKS5tYXAoKHN0cikgPT4gam9pbihwYWdlc0Rpciwgc3RyKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLnBhZ2VzKTtcbiAgfVxuXG4gIGNvbnN0IHByb21pc2VzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG4gIC8vIGR1bXAgdG8gZmlsZVxuICBjb25zdCBkdW1wZmlsZSA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL2NsZWFuLnR4dCcpO1xuICB3cml0ZWZpbGUoZHVtcGZpbGUsIGZvbGRlcnMuam9pbihFT0wpKTtcbiAgTG9nZ2VyLmxvZyhsb2duYW1lLCAnbGlzdCBkZWxldGVkIGZpbGVzJywgZHVtcGZpbGUpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZm9sZGVycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBmb2xkZXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhwYXRoU3RyKSkgcHJvbWlzZXMucHVzaChkZWwocGF0aFN0cikuY2F0Y2gobm9vcCkpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy9cbiAgICB9XG4gIH1cblxuICBjb25zdCBmaW5pc2hOb3cgPSBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ2NsZWFuIGFyY2hpdmVzIGhhcyBzb21lIGVycm9zJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIGNhbGxiYWNrKCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBhd2FpdCBCbHVlYmlyZC5hbGwocHJvbWlzZXMpLnRoZW4oZmluaXNoTm93KS5jYXRjaChmaW5pc2hOb3cpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5HZW5lcmF0ZWRQb3N0cyhjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgcmV0dXJuIGNsZWFuRGIoY2FsbGJhY2ssIFtqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5zb3VyY2VfZGlyLCAnX3Bvc3RzJyldKTtcbn1cblxuZ3VscC50YXNrKCdjbGVhbjphcmNoaXZlJywgY2xlYW5PbGRBcmNoaXZlcyk7XG5ndWxwLnRhc2soJ2NsZWFuOmRiJywgY2xlYW5EYik7XG5ndWxwLnRhc2soJ2NsZWFuOnBvc3QnLCBjbGVhbkdlbmVyYXRlZFBvc3RzKTtcbmd1bHAudGFzaygnY2xlYW46YWxsJywgZ3VscC5zZXJpZXMoJ2NsZWFuOmRiJywgJ2NsZWFuOmFyY2hpdmUnKSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0e/gulpclean_0e73cdf97e0865d562e48a7ea63cce15.map","wrapperLength":82},"result":{"scriptId":"10585","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24169,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexo_post_parser_1 = __importDefault(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar true_case_path_1 = __importDefault(require(\"true-case-path\"));\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nvar fetched = {};\nvar fileYML = (0, path_1.join)(process.cwd(), '_config.yml');\nvar loadYml = function () {\n    if ((0, fs_1.existsSync)(fileYML)) {\n        fetched[fileYML] = true;\n        var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n        settledConfig = Object.assign({}, configYML, settledConfig);\n        // update hexo-post-parser config\n        hexo_post_parser_1.default.setConfig(settledConfig);\n        (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n    }\n};\nloadYml();\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign({}, settledConfig, obj);\n    fileYML = (0, path_1.join)(settledConfig.cwd, '_config.yml');\n    if (!fetched[fileYML]) {\n        if (settledConfig.cwd) {\n            // fix cwd\n            settledConfig.cwd = (0, upath_1.toUnix)(true_case_path_1.default.trueCasePathSync(settledConfig.cwd));\n        }\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nfunction getConfig(customFolder) {\n    if (typeof customFolder === 'string') {\n        fileYML = (0, path_1.join)(customFolder, '_config.yml');\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    settledConfig = (0, object_1.orderKeys)(settledConfig);\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\n// first fetch\nif (!fetched)\n    getConfig();\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : null;\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHlCQUE4QztBQUM5QywwRUFBcUM7QUFFckMsc0VBQThDO0FBQzlDLDZCQUE0QjtBQUM1QixrRUFBMEM7QUFDMUMsK0JBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBOEM7QUFDOUMsaUNBQXVDO0FBQ3ZDLHlDQUEyQztBQTREM0MsSUFBSSxhQUFhLEdBQUcsSUFBQSwyQkFBZ0IsR0FBeUIsQ0FBQztBQUU5RCxJQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDbkIsSUFBSSxPQUFPLEdBQUcsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ2pELElBQU0sT0FBTyxHQUFHO0lBQ2QsSUFBSSxJQUFBLGVBQVUsRUFBQyxPQUFPLENBQUMsRUFBRTtRQUN2QixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsSUFBQSxpQkFBWSxFQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdELGFBQWEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUQsaUNBQWlDO1FBQ2pDLDBCQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNoRjtBQUNILENBQUMsQ0FBQztBQUVGLE9BQU8sRUFBRSxDQUFDO0FBRVY7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3RELE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2pELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDckIsSUFBSSxhQUFhLENBQUMsR0FBRyxFQUFFO1lBQ3JCLFVBQVU7WUFDVixhQUFhLENBQUMsR0FBRyxHQUFHLElBQUEsY0FBTSxFQUFDLHdCQUFZLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDOUU7UUFDRCxPQUFPLEVBQUUsQ0FBQztRQUNWLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7S0FDekI7SUFFRCxPQUFPLFNBQVMsRUFBRSxDQUFDO0FBQ3JCLENBQUM7QUFiRCw4QkFhQztBQUVEOzs7OztHQUtHO0FBQ0gsU0FBZ0IsU0FBUyxDQUFDLFlBQXFCO0lBQzdDLElBQUksT0FBTyxZQUFZLEtBQUssUUFBUSxFQUFFO1FBQ3BDLE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUMsT0FBTyxFQUFFLENBQUM7UUFDVixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO0tBQ3pCO0lBQ0QsYUFBYSxHQUFHLElBQUEsa0JBQVMsRUFBQyxhQUFhLENBQUMsQ0FBQztJQUN6QyxhQUFhLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sSUFBSSxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUNqRiw4RkFBOEY7SUFDOUYsT0FBTyxhQUF5QixDQUFDO0FBQ25DLENBQUM7QUFWRCw4QkFVQztBQUVELGNBQWM7QUFDZCxJQUFJLENBQUMsT0FBTztJQUFFLFNBQVMsRUFBRSxDQUFDO0FBRTFCLFNBQWdCLFlBQVk7O0lBQzFCLElBQU0sU0FBUyxHQUFHLElBQUEsV0FBSSxFQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsVUFBVSxJQUFHLE1BQUEsYUFBYSxDQUFDLE1BQU0sMENBQUUsSUFBSSxDQUFBLElBQUksS0FBSyxDQUFDLENBQUM7SUFDNUYsSUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFVLEVBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksNEJBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pFLE9BQU8sRUFBRSxTQUFTLFdBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO0FBQy9CLENBQUM7QUFKRCxvQ0FJQztBQUVEOzs7Ozs7R0FNRztBQUNVLFFBQUEsWUFBWSxHQUFHO0lBQzFCLGtCQUFrQjtJQUNsQixzQkFBc0I7SUFDdEIsNkJBQTZCO0lBQzdCLDBDQUEwQztJQUMxQyxpQkFBaUI7SUFDakIsYUFBYTtJQUNiLG9CQUFvQjtJQUNwQixXQUFXO0lBQ1gsYUFBYTtJQUNiLGNBQWM7SUFDZCxlQUFlO0lBQ2Ysb0JBQW9CO0lBQ3BCLHFCQUFxQjtJQUNyQiwwQkFBMEI7SUFDMUIsZ0JBQWdCO0lBQ2hCLG9CQUFvQjtJQUNwQixvQkFBb0I7SUFDcEIsYUFBYTtJQUNiLE9BQU8sQ0FBQyxZQUFZO0NBQ3JCLENBQUM7QUFFRjs7R0FFRztBQUNVLFFBQUEsY0FBYywwQ0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsa0JBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLFVBQUUiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgaGV4b1Bvc3RQYXJzZXIgZnJvbSAnaGV4by1wb3N0LXBhcnNlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgdHJ1ZWNhc2VwYXRoIGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmNvbnN0IGZldGNoZWQgPSB7fTtcbmxldCBmaWxlWU1MID0gam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKTtcbmNvbnN0IGxvYWRZbWwgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChleGlzdHNTeW5jKGZpbGVZTUwpKSB7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gICAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShyZWFkRmlsZVN5bmMoZmlsZVlNTCwgJ3V0Zi04JykpO1xuICAgIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWdZTUwsIHNldHRsZWRDb25maWcpO1xuICAgIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICAgIGhleG9Qb3N0UGFyc2VyLnNldENvbmZpZyhzZXR0bGVkQ29uZmlnKTtcbiAgICB3cml0ZWZpbGUoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkoY29uZmlnWU1MLCBudWxsLCAyKSk7XG4gIH1cbn07XG5cbmxvYWRZbWwoKTtcblxuLyoqXG4gKiBDb25maWcgc2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHBhcmFtIG9ialxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29uZmlnKG9iajogUmVjb3JkPHN0cmluZywgYW55PiB8IFByb2pDb25mKSB7XG4gIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBzZXR0bGVkQ29uZmlnLCBvYmopO1xuICBmaWxlWU1MID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJ19jb25maWcueW1sJyk7XG4gIGlmICghZmV0Y2hlZFtmaWxlWU1MXSkge1xuICAgIGlmIChzZXR0bGVkQ29uZmlnLmN3ZCkge1xuICAgICAgLy8gZml4IGN3ZFxuICAgICAgc2V0dGxlZENvbmZpZy5jd2QgPSB0b1VuaXgodHJ1ZWNhc2VwYXRoLnRydWVDYXNlUGF0aFN5bmMoc2V0dGxlZENvbmZpZy5jd2QpKTtcbiAgICB9XG4gICAgbG9hZFltbCgpO1xuICAgIGZldGNoZWRbZmlsZVlNTF0gPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGdldENvbmZpZygpO1xufVxuXG4vKipcbiAqIENvbmZpZyBnZXR0ZXJcbiAqICogdXNlZnVsIGZvciBqZXN0XG4gKiBAcGFyYW0gY3VzdG9tRm9sZGVyIGxvYWQgZnJvbSBjdXN0b20gZm9sZGVyIGFuZCBhcHBseSB0byBjdXJyZW50IGNvbmZpZ1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZyhjdXN0b21Gb2xkZXI/OiBzdHJpbmcpIHtcbiAgaWYgKHR5cGVvZiBjdXN0b21Gb2xkZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgZmlsZVlNTCA9IGpvaW4oY3VzdG9tRm9sZGVyLCAnX2NvbmZpZy55bWwnKTtcbiAgICBsb2FkWW1sKCk7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gIH1cbiAgc2V0dGxlZENvbmZpZyA9IG9yZGVyS2V5cyhzZXR0bGVkQ29uZmlnKTtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbi8vIGZpcnN0IGZldGNoXG5pZiAoIWZldGNoZWQpIGdldENvbmZpZygpO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVwbG95Q29uZmlnKCkge1xuICBjb25zdCBkZXBsb3lEaXIgPSBqb2luKHNldHRsZWRDb25maWcuY3dkLCAnLmRlcGxveV8nICsgc2V0dGxlZENvbmZpZy5kZXBsb3k/LnR5cGUgfHwgJ2dpdCcpO1xuICBjb25zdCBnaXRodWIgPSBleGlzdHNTeW5jKGRlcGxveURpcikgPyBuZXcgZ2l0KGRlcGxveURpcikgOiBudWxsO1xuICByZXR1cm4geyBkZXBsb3lEaXIsIGdpdGh1YiB9O1xufVxuXG4vKipcbiAqIGNvbW1vbiBpZ25vcmUgZmlsZXNcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAqIGNvbnN0IGV4Y2x1ZGVzID0gQXJyYXkuaXNBcnJheShjb25maWcuZXhjbHVkZSkgPyBjb25maWcuZXhjbHVkZSA6IFtdO1xuICogZXhjbHVkZXMucHVzaCguLi5jb21tb25JZ25vcmUpO1xuICovXG5leHBvcnQgY29uc3QgY29tbW9uSWdub3JlID0gW1xuICAnKioveWFuZGV4XyouaHRtbCcsIC8vIHNraXAgeWFuZGV4IHZlcmlmaWNhdGlvbiBmaWxlXG4gIC8vICcqKi9jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2Rpc3F1cy1jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2NvbW1lbnQuaHRtbCcsIC8vIHNraXAgY29tbWVudC5odG1sXG4gICcqKi9mYXZpY29uLmh0bWwnLCAvLyBza2lwIGZhdmljb25cbiAgJyoqLzQwNC5odG1sJywgLy8gc2tpcCA0MDRcbiAgJyoqL25vZGVfbW9kdWxlcy8qKicsIC8vIHNraXAgbm9kZV9tb2R1bGVzXG4gICcqKi90bXAvKionLCAvLyBza2lwIHRtcFxuICAnKiovYnVpbGQvKionLCAvLyBza2lwIGJ1aWxkXG4gICcqKi8uY2FjaGUvKionLCAvLyBza2lwIGNvbW1vbiBjYWNoZSBmb2xkZXJcbiAgJyoqLy52c2NvZGUvKionLCAvLyBza2lwIHZzY29kZSBjb25maWd1cmF0aW9uIGZvbGRlclxuICAnKiovLmZyb250bWF0dGVyLyoqJywgLy8gc2tpcCBmcm9udG1hdHRlciB2c2NvZGUgZXh0ZW5zaW9uXG4gICcqKi9waW50ZXJlc3QtKi5odG1sJywgLy8gc2tpcCBwaW50ZXJlc3QgdmVyaWZpY2F0aW9uIGZpbGVcbiAgJyoqL18qLnN0YW5kYWxvbmUue2pzLHRzfScsIC8vIHNraXAgX2ZpbGVuYW1lLnN0YW5kYWxvbmUuanNcbiAgJyoqL2Rlc2t0b3AuaW5pJywgLy8gd2luZG93cyBkZXNrdG9wLmluaVxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gbm9kZV9tb2R1bGVzXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyB2c2NvZGUgZnJvbnRtYXR0ZXIgcGx1Z2luXG4gICcqKi8uZ2l0Ki8qKicsIC8vIGFueSBnaXQgY29uZmlnc1xuICAnKiovLionIC8vIHNraXAgZG90c1xuXTtcblxuLyoqXG4gKiBhcnJheSBvZiBjb25maWcuZXhjbHVkZSwgY29uZmlnLmlnbm9yZVxuICovXG5leHBvcnQgY29uc3QgcHJvamVjdElnbm9yZXMgPSBbLi4uKGdldENvbmZpZygpLnNraXBfcmVuZGVyIHx8IFtdKSwgLi4uKGdldENvbmZpZygpLmlnbm9yZSB8fCBbXSldO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport truecasepath from 'true-case-path';\nimport { toUnix } from 'upath';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nconst fetched = {};\nlet fileYML = join(process.cwd(), '_config.yml');\nconst loadYml = function () {\n  if (existsSync(fileYML)) {\n    fetched[fileYML] = true;\n    const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n    settledConfig = Object.assign({}, configYML, settledConfig);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n  }\n};\n\nloadYml();\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign({}, settledConfig, obj);\n  fileYML = join(settledConfig.cwd, '_config.yml');\n  if (!fetched[fileYML]) {\n    if (settledConfig.cwd) {\n      // fix cwd\n      settledConfig.cwd = toUnix(truecasepath.trueCasePathSync(settledConfig.cwd));\n    }\n    loadYml();\n    fetched[fileYML] = true;\n  }\n\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nexport function getConfig(customFolder?: string) {\n  if (typeof customFolder === 'string') {\n    fileYML = join(customFolder, '_config.yml');\n    loadYml();\n    fetched[fileYML] = true;\n  }\n  settledConfig = orderKeys(settledConfig);\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\n// first fetch\nif (!fetched) getConfig();\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : null;\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0f/_config_0f3f45dd644bddb8c0e53e47eddfc08f.map","wrapperLength":82},"result":{"scriptId":"11018","url":"D:\\Repositories\\static-blog-generator\\src\\_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":14732,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":14729,"count":1},{"startOffset":3588,"endOffset":3600,"count":0},{"startOffset":4818,"endOffset":4823,"count":0},{"startOffset":4862,"endOffset":4867,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":2},{"startOffset":228,"endOffset":237,"count":0},{"startOffset":315,"endOffset":325,"count":0},{"startOffset":352,"endOffset":369,"count":0},{"startOffset":380,"endOffset":419,"count":0},{"startOffset":477,"endOffset":497,"count":0},{"startOffset":499,"endOffset":509,"count":0},{"startOffset":545,"endOffset":559,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":2},{"startOffset":706,"endOffset":901,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":4},{"startOffset":1075,"endOffset":1080,"count":2},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"loadYml","ranges":[{"startOffset":1902,"endOffset":2367,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":2440,"endOffset":2884,"count":1},{"startOffset":2618,"endOffset":2858,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3049,"endOffset":3523,"count":85},{"startOffset":3126,"endOffset":3250,"count":0},{"startOffset":3373,"endOffset":3378,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3601,"endOffset":3951,"count":85},{"startOffset":3763,"endOffset":3771,"count":0},{"startOffset":3783,"endOffset":3791,"count":0},{"startOffset":3843,"endOffset":3888,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:title/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml_1.default.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGRlZmF1bHRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHlCQUFrQztBQUNsQyxpREFBa0Q7QUFDbEQsK0JBQXFDO0FBQ3JDLDhDQUF3QjtBQUV4Qjs7O0dBR0c7QUFDSCxTQUFnQixnQkFBZ0I7SUFDOUIsSUFBTSxpQkFBaUIsR0FBRztRQUN4QixPQUFPO1FBQ1AsS0FBSyxFQUFFLE1BQU07UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLFdBQVcsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLFVBQVU7UUFDbEIsUUFBUSxFQUFFLElBQUk7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU07UUFDTixHQUFHLEVBQUUsb0JBQW9CO1FBQ3pCLElBQUksRUFBRSxHQUFHO1FBQ1QsU0FBUyxFQUFFLDJCQUEyQjtRQUN0QyxrQkFBa0IsRUFBRSxFQUFFO1FBQ3RCLFdBQVcsRUFBRTtZQUNYLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLGFBQWEsRUFBRSxJQUFJO1NBQ3BCO1FBQ0QsWUFBWTtRQUNaLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLE9BQU8sRUFBRSxNQUFNO1FBQ2YsV0FBVyxFQUFFLFVBQVU7UUFDdkIsWUFBWSxFQUFFLFlBQVk7UUFDMUIsUUFBUSxFQUFFLGdCQUFnQjtRQUMxQixRQUFRLEVBQUUsT0FBTztRQUNqQixXQUFXLEVBQUUsRUFBRTtRQUNmLFVBQVU7UUFDVixhQUFhLEVBQUUsV0FBVztRQUMxQixjQUFjLEVBQUUsTUFBTTtRQUN0QixTQUFTLEVBQUUsS0FBSztRQUNoQixhQUFhLEVBQUU7WUFDYixNQUFNLEVBQUUsSUFBSTtZQUNaLEtBQUssRUFBRSxNQUFNO1lBQ2IsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsYUFBYSxFQUFFLEtBQUs7UUFDcEIsTUFBTSxFQUFFLElBQUk7UUFDWixrQkFBa0IsRUFBRSxjQUFjO1FBQ2xDLFNBQVMsRUFBRTtZQUNULFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFdBQVcsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLElBQUk7WUFDVixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLGFBQWEsRUFBRSxLQUFLO1lBQ3BCLElBQUksRUFBRSxLQUFLO1NBQ1o7UUFDRCxPQUFPLEVBQUU7WUFDUCxVQUFVLEVBQUUsSUFBSTtZQUNoQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtTQUNoQjtRQUNELGlCQUFpQjtRQUNqQixnQkFBZ0IsRUFBRSxlQUFlO1FBQ2pDLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE9BQU8sRUFBRSxFQUFFO1FBQ1gscUJBQXFCO1FBQ3JCLFdBQVcsRUFBRSxZQUFZO1FBQ3pCLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLGNBQWMsRUFBRSxPQUFPO1FBQ3ZCLDRDQUE0QztRQUM1QywwQkFBMEI7UUFDMUIsYUFBYTtRQUNiLFFBQVEsRUFBRSxFQUFFO1FBQ1osY0FBYyxFQUFFLE1BQU07UUFDdEIsYUFBYTtRQUNiLEtBQUssRUFBRSxXQUFXO1FBQ2xCLE1BQU0sRUFBRTtZQUNOLEtBQUssRUFBRSxLQUFLO1NBQ2I7UUFDRCxhQUFhO1FBQ2IsTUFBTSxFQUFFLEVBQUU7UUFFViwrQkFBK0I7UUFDL0IsTUFBTSxFQUFFLEVBQUU7UUFFVixpQkFBaUI7UUFDakIsY0FBYyxFQUFFLElBQUk7S0FDckIsQ0FBQztJQUNGLElBQU0sZ0JBQWdCLEdBQUc7UUFDdkIsR0FBRyxFQUFFLElBQUEsY0FBTSxFQUFDLElBQUEsaUNBQWdCLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7S0FDN0MsQ0FBQztJQUNGLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQW9DLENBQUM7QUFDMUcsQ0FBQztBQXhGRCw0Q0F3RkM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixvQkFBb0I7SUFDbEMsT0FBTyxJQUFBLGlCQUFZLEVBQUMsSUFBQSxZQUFJLEVBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFGRCxvREFFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuXG4vKipcbiAqIGdldCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0Q29uZmlnKCkge1xuICBjb25zdCBoZXhvRGVmYXVsdENvbmZpZyA9IHtcbiAgICAvLyBTaXRlXG4gICAgdGl0bGU6ICdIZXhvJyxcbiAgICBzdWJ0aXRsZTogJycsXG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIGF1dGhvcjogJ0pvaG4gRG9lJyxcbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICB0aW1lem9uZTogJycsXG4gICAgLy8gVVJMXG4gICAgdXJsOiAnaHR0cDovL2V4YW1wbGUuY29tJyxcbiAgICByb290OiAnLycsXG4gICAgcGVybWFsaW5rOiAnOnllYXIvOm1vbnRoLzpkYXkvOnRpdGxlLycsXG4gICAgcGVybWFsaW5rX2RlZmF1bHRzOiB7fSxcbiAgICBwcmV0dHlfdXJsczoge1xuICAgICAgdHJhaWxpbmdfaW5kZXg6IHRydWUsXG4gICAgICB0cmFpbGluZ19odG1sOiB0cnVlXG4gICAgfSxcbiAgICAvLyBEaXJlY3RvcnlcbiAgICBzb3VyY2VfZGlyOiAnc291cmNlJyxcbiAgICBwdWJsaWNfZGlyOiAncHVibGljJyxcbiAgICB0YWdfZGlyOiAndGFncycsXG4gICAgYXJjaGl2ZV9kaXI6ICdhcmNoaXZlcycsXG4gICAgY2F0ZWdvcnlfZGlyOiAnY2F0ZWdvcmllcycsXG4gICAgY29kZV9kaXI6ICdkb3dubG9hZHMvY29kZScsXG4gICAgaTE4bl9kaXI6ICc6bGFuZycsXG4gICAgc2tpcF9yZW5kZXI6IFtdLFxuICAgIC8vIFdyaXRpbmdcbiAgICBuZXdfcG9zdF9uYW1lOiAnOnRpdGxlLm1kJyxcbiAgICBkZWZhdWx0X2xheW91dDogJ3Bvc3QnLFxuICAgIHRpdGxlY2FzZTogZmFsc2UsXG4gICAgZXh0ZXJuYWxfbGluazoge1xuICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgZmllbGQ6ICdzaXRlJyxcbiAgICAgIGV4Y2x1ZGU6ICcnXG4gICAgfSxcbiAgICBmaWxlbmFtZV9jYXNlOiAwLFxuICAgIHJlbmRlcl9kcmFmdHM6IGZhbHNlLFxuICAgIHBvc3RfYXNzZXRfZm9sZGVyOiBmYWxzZSxcbiAgICByZWxhdGl2ZV9saW5rOiBmYWxzZSxcbiAgICBmdXR1cmU6IHRydWUsXG4gICAgc3ludGF4X2hpZ2hsaWdodGVyOiAnaGlnaGxpZ2h0LmpzJyxcbiAgICBoaWdobGlnaHQ6IHtcbiAgICAgIGF1dG9fZGV0ZWN0OiBmYWxzZSxcbiAgICAgIGxpbmVfbnVtYmVyOiB0cnVlLFxuICAgICAgdGFiX3JlcGxhY2U6ICcnLFxuICAgICAgd3JhcDogdHJ1ZSxcbiAgICAgIGV4Y2x1ZGVfbGFuZ3VhZ2VzOiBbXSxcbiAgICAgIGxhbmd1YWdlX2F0dHI6IGZhbHNlLFxuICAgICAgaGxqczogZmFsc2VcbiAgICB9LFxuICAgIHByaXNtanM6IHtcbiAgICAgIHByZXByb2Nlc3M6IHRydWUsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJ1xuICAgIH0sXG4gICAgLy8gQ2F0ZWdvcnkgJiBUYWdcbiAgICBkZWZhdWx0X2NhdGVnb3J5OiAndW5jYXRlZ29yaXplZCcsXG4gICAgY2F0ZWdvcnlfbWFwOiB7fSxcbiAgICB0YWdfbWFwOiB7fSxcbiAgICAvLyBEYXRlIC8gVGltZSBmb3JtYXRcbiAgICBkYXRlX2Zvcm1hdDogJ1lZWVktTU0tREQnLFxuICAgIHRpbWVfZm9ybWF0OiAnSEg6bW06c3MnLFxuICAgIHVwZGF0ZWRfb3B0aW9uOiAnbXRpbWUnLFxuICAgIC8vICogbXRpbWU6IGZpbGUgbW9kaWZpY2F0aW9uIGRhdGUgKGRlZmF1bHQpXG4gICAgLy8gKiBlbXB0eTogbm8gbW9yZSB1cGRhdGVcbiAgICAvLyBQYWdpbmF0aW9uXG4gICAgcGVyX3BhZ2U6IDEwLFxuICAgIHBhZ2luYXRpb25fZGlyOiAncGFnZScsXG4gICAgLy8gRXh0ZW5zaW9uc1xuICAgIHRoZW1lOiAnbGFuZHNjYXBlJyxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgIGNhY2hlOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gRGVwbG95bWVudFxuICAgIGRlcGxveToge30sXG5cbiAgICAvLyBpZ25vcmUgZmlsZXMgZnJvbSBwcm9jZXNzaW5nXG4gICAgaWdub3JlOiBbXSxcblxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgbWV0YV9nZW5lcmF0b3I6IHRydWVcbiAgfTtcbiAgY29uc3Qgc2JnRGVmYXVsdENvbmZpZyA9IHtcbiAgICBjd2Q6IHRvVW5peCh0cnVlQ2FzZVBhdGhTeW5jKHByb2Nlc3MuY3dkKCkpKVxuICB9O1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKGdldERlZmF1bHRDb25maWdZYW1sKCkpO1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihoZXhvRGVmYXVsdENvbmZpZywgc2JnRGVmYXVsdENvbmZpZywgY29uZmlnWU1MKSBhcyB0eXBlb2YgaW1wb3J0KCcuL19jb25maWcuanNvbicpO1xufVxuXG4vKipcbiAqIGdldCBkZWZhdWx0IF9jb25maWcueW1sXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdENvbmZpZ1lhbWwoKSB7XG4gIHJldHVybiByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLnltbCcpLCAndXRmLTgnKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:title/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/9d/defaults_9d90978728a2f8c36350e6b522c45e0e.map","wrapperLength":82},"result":{"scriptId":"11939","url":"D:\\Repositories\\static-blog-generator\\src\\defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":9592,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":9589,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":1},{"startOffset":204,"endOffset":209,"count":0}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":568,"endOffset":3016,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3109,"endOffset":3233,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZGVwbG95LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLHlCQUFnQztBQUNoQywwRUFBMEQ7QUFDMUQsdURBQTJEO0FBQzNELDhDQUFrRDtBQUNsRCxvRUFBcUM7QUFDckMsK0JBQXFDO0FBQ3JDLHdCQUFzQjtBQUN0QiwyQkFBeUI7QUFDekIsMERBQW9DO0FBQ3BDLHFDQUFvRDtBQUVwRDs7O0dBR0c7QUFDSCxTQUFnQixPQUFPO0lBQ2IsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLElBQU0sU0FBUyxHQUFHLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5RCxPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxxQkFBcUIsQ0FBQyxFQUFFO1FBQ2hFLEdBQUcsRUFBRSxTQUFTO1FBQ2QsR0FBRyxFQUFFLElBQUk7S0FDVixDQUFDO1NBQ0QsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDMUIsRUFBRSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQVZELDBCQVVDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0IsWUFBWTtJQUMxQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFVLE9BQU87UUFDbkMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNwQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxD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QUFNLEVBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUEsY0FBTSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsY0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxlQUFlLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5kZXBsb3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuc2lDb2xvcnMgZnJvbSAnYW5zaS1jb2xvcnMnO1xuaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGdpdEhlbHBlciB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlcic7XG5pbXBvcnQgeyBzcGF3bkFzeW5jIH0gZnJvbSAnZ2l0LWNvbW1hbmQtaGVscGVyL2Rpc3Qvc3Bhd24nO1xuaW1wb3J0IGd1bHAsIHsgVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfSBmcm9tICdndWxwJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIChfY29uZmlnX3ltbC5wdWJsaWNfZGlyKSB0byBkZXBsb3kgZGlyIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvcHlHZW4oKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgY29uc3QgcHVibGljRGlyID0gam9pbihwcm9jZXNzLmN3ZCgpLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKionLCAnISoqLy5naXQqJywgJyEqKi90bXAvKionLCAnISoqL25vZGVfbW9kdWxlcy8qKiddLCB7XG4gICAgICBjd2Q6IHB1YmxpY0RpcixcbiAgICAgIGRvdDogdHJ1ZVxuICAgIH0pXG4gICAgLnBpcGUoZ3VscC5kZXN0KGRlcGxveURpcikpXG4gICAgLm9uKCdlcnJvcicsIGNvbnNvbGUudHJhY2UpO1xufVxuXG4vKipcbiAqIGFzeW5jaHJvbm91cyBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3luY0NvcHlHZW4oKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBjb3B5R2VuKCkub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbi8vIGNvcHkgcHVibGljIHRvIC5kZXBsb3lfZ2l0XG5ndWxwLnRhc2soJ2RlcGxveTpjb3B5JywgY29weUdlbik7XG5cbi8qKlxuICogZ2l0IHB1bGwgb24gZGVwbG95IGRpclxuICogQHBhcmFtIGRvbmVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVsbChkb25lOiBUYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgY3dkID0gY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGdoID0gY29uZmlnLmRlcGxveS5naXRodWI7XG4gIGNvbnN0IGRvUHVsbCA9IGFzeW5jIChjd2Q6IHN0cmluZykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ2NvbmZpZycsICdwdWxsLnJlYmFzZScsICdmYWxzZSddLCB7XG4gICAgICAgIGN3ZFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gTG9nZ2VyLmxvZyhlLm1lc3NhZ2UsIHN1Yi5yb290KTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgTG9nZ2VyLmxvZygncHVsbGluZycsIGN3ZCk7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ3B1bGwnLCAnLVgnLCAndGhlaXJzJ10sIHtcbiAgICAgICAgY3dkLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcHVsbCcsIGN3ZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNsb25lID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghZXhpc3RzU3luYyhjd2QpKSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbLi4uJ2Nsb25lIC1iIG1hc3RlciAtLXNpbmdsZS1icmFuY2gnLnNwbGl0KCcgJyksIGNvbmZpZy5kZXBsb3kucmVwbywgJy5kZXBsb3lfZ2l0J10sIHtcbiAgICAgICAgY3dkOiBfX2Rpcm5hbWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBhd2FpdCBjbG9uZSgpO1xuICBkb1B1bGwoY3dkKTtcbiAgaWYgKGdoKSB7XG4gICAgY29uc3Qgc3VibW9kdWxlcyA9IGdoLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1Ym1vZHVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN1YiA9IHN1Ym1vZHVsZXNbaV07XG5cbiAgICAgIGRvUHVsbChzdWIucm9vdCk7XG4gICAgfVxuICB9XG4gIGRvbmUoKTtcbn1cblxuZnVuY3Rpb24gc3RhdHVzKGRvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrKSB7XG4gIGNvbnN0IHsgZ2l0aHViIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgaWYgKCFnaXRodWIpIHJldHVybjtcbiAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKHN0YXR1c2VzKSA9PiB7XG4gICAgc3RhdHVzZXMubWFwKChpdGVtKSA9PiB7XG4gICAgICBsZXQgc3RyID0gJyc7XG5cbiAgICAgIHN3aXRjaCAoaXRlbS5jaGFuZ2VzKSB7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnJlZChpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhZGRlZCc6XG4gICAgICAgICAgc3RyICs9IGFuc2lDb2xvcnMuZ3JlZW4oaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbW9kaWZpZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnllbGxvdyhpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd1bnRyYWNrZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZXkoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBzdHIgKz0gaXRlbS5jaGFuZ2VzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBzdHIgKz0gJyAnO1xuICAgICAgc3RyICs9IGl0ZW0ucGF0aDtcbiAgICAgIExvZ2dlci5sb2coc3RyKTtcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2YgZG9uZSA9PT0gJ2Z1bmN0aW9uJykgZG9uZSgpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY29tbWl0KCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICBjb25zdCBub3cgPSBtb21lbnQoKS50eihnZXRDb25maWcoKS50aW1lem9uZSkuZm9ybWF0KCdMTEwnKTtcbiAgY29uc3QgY29tbWl0Um9vdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgIExvZ2dlci5sb2coJ2NoYW5nZXMnLCBjaGFuZ2VzLmxlbmd0aCwgdG9Vbml4KGdpdGh1Yi5jd2QpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJykpO1xuICAgICAgICBpZiAoY2hhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZ2l0aHViLmFkZCgnLUEnKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGdpdGh1Yi5jb21taXQoJ3VwZGF0ZSBzaXRlICcgKyBub3cpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGNvbW1pdFN1Ym1vZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGlmIChnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpKSB7XG4gICAgICAgIGNvbnN0IGluZm8gPSBnaXRodWIuc3VibW9kdWxlLmdldCgpO1xuICAgICAgICBjb25zdCBjb21taXRTdWJtb2R1bGVDaGlsZCA9IGFzeW5jIChzdWI6ICh0eXBlb2YgaW5mbylbbnVtYmVyXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IG5ldyBnaXRIZWxwZXIoc3ViLnJvb3QpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgc3VibW9kdWxlLnN0YXR1cygpO1xuICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCBzdWJtb2R1bGUuYWRkKCctQScpO1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmNvbW1pdChgdXBkYXRlICR7c3ViLnBhdGh9ICR7bm93fWAsICdhbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaXRlcmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVJdCkgPT4ge1xuICAgICAgICAgICAgLy8gcmVzb2x2ZSBkaXJlY3RseSB3aGVuIHN1Ym1vZHVsZSBpdGVtcyBubyBtYWRlIGNoYW5nZXNcbiAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgIGNvbW1pdFN1Ym1vZHVsZUNoaWxkKGluZm9bMF0pXG4gICAgICAgICAgICAgIC5jYXRjaChub29wKVxuICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIC8vIHJlLWl0ZXJhdGUgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm90IGNvbW1pdHRlZFxuICAgICAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA+IDApIHJldHVybiBpdGVyYXRlKCk7XG4gICAgICAgICAgICAgICAgLy8gcmVzb2x2ZXMgYWxsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZUl0KG51bGwpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaXRlcmF0ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbW1pdFN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihjb21taXRSb290KVxuICAgICAgLnRoZW4oKCkgPT4gcmVzb2x2ZShudWxsKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBub29wKCkge1xuICAvL1xufVxuXG5mdW5jdGlvbiBwdXNoKCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpID8gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKSA6IFtdO1xuICBjb25zdCBwdXNoU3VibW9kdWxlID0gZnVuY3Rpb24gKHN1Ym1vZHVsZTogKHR5cGVvZiBzdWJtb2R1bGVzKVtudW1iZXJdKSB7XG4gICAgY29uc3QgeyB1cmwsIGJyYW5jaCwgcm9vdCB9ID0gc3VibW9kdWxlO1xuICAgIGlmICghc3VibW9kdWxlLmdpdGh1Yikge1xuICAgICAgc3VibW9kdWxlLmdpdGh1YiA9IG5ldyBnaXRIZWxwZXIocm9vdCk7XG4gICAgfVxuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBzdWJtb2R1bGU7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlUHVzaCkgPT4ge1xuICAgICAgY29uc3Qgc2V0UiA9ICgpID0+IGdpdGh1Yi5zZXRyZW1vdGUodXJsKTtcbiAgICAgIGNvbnN0IHNldEIgPSAoKSA9PiBnaXRodWIuc2V0YnJhbmNoKGJyYW5jaCk7XG4gICAgICBQcm9taXNlLmFsbChbc2V0UigpLCBzZXRCKCldKS50aGVuKCgpID0+IHtcbiAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyh3b3Jrc3BhY2Uocm9vdCksICdjYW4gcHVzaCcsIGFsbG93ZWQpO1xuICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAvLyBwdXNoIHRoZW4gcmVzb2x2ZVxuICAgICAgICAgICAgZ2l0aHViLnB1c2goZmFsc2UsIHsgc3RkaW86ICdwaXBlJyB9KS50aGVuKHJlc29sdmVQdXNoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKGNoYW5nZXMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIExvZ2dlci5sb2coJ3N1Ym1vZHVsZScsIHdvcmtzcGFjZShyb290KSwgJ2NoYW5nZXMgbm90IHN0YWdlZCcpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgY2hhbmdlcyBub3Qgc3RhZ2VkXG4gICAgICAgICAgICAgICAgcmVzb2x2ZVB1c2gobnVsbCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2l0aHViLmlzVXBUb0RhdGUoKS50aGVuKCh1cGRhdGVkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICd1cGRhdGVkJywgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGlzIHVwIHRvIGRhdGVcbiAgICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGl0ZXJhdGVTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IHN1Ym1vZHVsZXMuc2hpZnQoKTtcbiAgICAgICAgaWYgKHN1Ym1vZHVsZSkge1xuICAgICAgICAgIHB1c2hTdWJtb2R1bGUoc3VibW9kdWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJtb2R1bGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgaXRlcmF0ZVN1Ym1vZHVsZSgpLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgaXRlcmF0ZVN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgICAgICBnaXRodWIuY2FuUHVzaCgpLnRoZW4oKGFsbG93ZWQpID0+IHtcbiAgICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKGdpdGh1Yi5jd2QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAgIGdpdGh1Yi5wdXNoKCkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUpO1xuICAgIC8vcHVzaFN1Ym1vZHVsZShzdWJtb2R1bGVzWzFdKS50aGVuKHJlc29sdmUpO1xuICB9KTtcbn1cblxuZ3VscC50YXNrKCdkZXBsb3k6cHVzaCcsIHB1c2gpO1xuZ3VscC50YXNrKCdkZXBsb3k6c3RhdHVzJywgc3RhdHVzKTtcbmd1bHAudGFzaygnZGVwbG95OmNvbW1pdCcsIGNvbW1pdCk7XG5ndWxwLnRhc2soJ2RlcGxveTpwdWxsJywgcHVsbCk7XG5cbi8qKlxuICogZ2V0IHJlbGF0aXZlIHBhdGggZnJvbSB3b3Jrc3BhY2VcbiAqIEBwYXJhbSBzdHJcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHdvcmtzcGFjZShzdHI6IHN0cmluZykge1xuICByZXR1cm4gdG9Vbml4KHN0cikucmVwbGFjZSh0b1VuaXgocHJvY2Vzcy5jd2QoKSksICcnKTtcbn1cblxuLy8gZGVwbG95XG5ndWxwLnRhc2soJ2RlcGxveScsIGd1bHAuc2VyaWVzKCdkZXBsb3k6cHVsbCcsICdkZXBsb3k6Y29weScsICdzYWZlbGluaycsICdkZXBsb3k6Y29tbWl0JywgJ2RlcGxveTpwdXNoJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/90/gulpdeploy_90b84dd58a01145dad19e958e2ead383.map","wrapperLength":82},"result":{"scriptId":"11943","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39615,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39612,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2FmZWxpbmsudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyx5QkFBZ0M7QUFDaEMsOENBQXdCO0FBQ3hCLDhDQUF3QjtBQUN4Qiw0REFBa0Q7QUFDbEQsc0RBQWdDO0FBRWhDLHVFQUFpRDtBQUNqRCxpQ0FBK0M7QUFDL0MsMERBQW9DO0FBQ3BDLHFDQUFzQztBQUV0Qzs7Ozs7R0FLRztBQUNILFNBQWdCLFlBQVksQ0FBQyxLQUFvRCxFQUFFLEdBQStCO0lBQWxILGlCQThHQzs7SUE3R0MsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxVQUFVLEdBQUcsT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO0lBQzNFLElBQU0sT0FBTyxHQUFHLHFCQUFVLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRW5ELHdCQUF3QjtJQUN4QixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFO1FBQ2xDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLHFCQUFVLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztLQUMxRTtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDM0MsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUscUJB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LElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDdEMsYUFBYTt3QkFDYixJQUFJLEVBQUUsQ0FBQzs7OzthQUNSLENBQUMsQ0FDSDthQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7S0FDaEM7U0FBTTtRQUNMLElBQU0sT0FBTyxHQUFHLElBQUEsc0JBQWlCLEVBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLENBQUMsQ0FBQztRQUNwRixPQUFPLE9BQU8sQ0FBQztLQUNoQjtBQUNILENBQUM7QUE5R0Qsb0NBOEdDO0FBRUQsZ0NBQWdDO0FBQ2hDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLnNhZmVsaW5rLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNmLCB7IFNhZmVsaW5rT3B0aW9ucyB9IGZyb20gJ3NhZmVsaW5raWZ5JztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBTcmNPcHRpb25zIH0gZnJvbSAndmlueWwtZnMnO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IHsgY3JlYXRlV3JpdGVTdHJlYW0gfSBmcm9tICcuL3V0aWxzL2ZtJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBQcm9jZXNzIFNhZmVsaW5rIG9uIERlcGxveSBEaXJcbiAqIEBwYXJhbSBfZG9uZSBjYWxsYmFjayBmdW5jdGlvblxuICogQHBhcmFtIGN3ZCB3b3JraW5nIGRpcmVjdG9yeSB0byBzY2FuIGh0bWwnc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTYWZlbGluayhfZG9uZT86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q/OiB1bmRlZmluZWQgfCBudWxsIHwgc3RyaW5nKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCB3b3JraW5nRGlyID0gdHlwZW9mIGN3ZCA9PT0gJ3N0cmluZycgPyBjd2QgOiBjb25maWcuZGVwbG95LmRlcGxveURpcjtcbiAgY29uc3QgbG9nbmFtZSA9IGFuc2lDb2xvcnMuZ3JlZW5CcmlnaHQoJ3NhZmVsaW5rJyk7XG5cbiAgLy8gc2tpcCBwcm9jZXNzIHNhZmVsaW5rXG4gIGxldCBoYXNFcnJvciA9IGZhbHNlO1xuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ2NvbmZpZyBzYWZlbGluaycsIGFuc2lDb2xvcnMucmVkKCdub3QgY29uZmlndXJlZCcpKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnJlZGlyZWN0KSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ3NhZmVsaW5rIHJlZGlyZWN0b3InLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5lbmFibGUpIHtcbiAgICBoYXNFcnJvciA9IHRydWU7XG4gICAgTG9nZ2VyLmxvZyhsb2duYW1lLCBhbnNpQ29sb3JzLnJlZCgnZGlzYWJsZWQnKSk7XG4gIH1cblxuICBpZiAoZXhpc3RzU3luYyh3b3JraW5nRGlyKSAmJiAhaGFzRXJyb3IpIHtcbiAgICBjb25zdCBkZWZhdWx0Q29uZmlnU2FmZWxpbms6IFNhZmVsaW5rT3B0aW9ucyAmIFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICBlbmFibGU6IGZhbHNlLFxuICAgICAgZXhjbHVkZTogW10gYXMgc3RyaW5nW10sXG4gICAgICByZWRpcmVjdDogJ2h0dHBzOi8vd3d3LndlYm1hbmFqZW1lbi5jb20vcGFnZS9zYWZlbGluay5odG1sP3VybD0nLFxuICAgICAgcGFzc3dvcmQ6ICdyb290JyxcbiAgICAgIHR5cGU6ICdiYXNlNjQnXG4gICAgfTtcbiAgICBjb25zdCBjb25maWdTYWZlbGluayA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENvbmZpZ1NhZmVsaW5rLCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluayB8fCB7fSk7XG4gICAgbGV0IGJhc2VVUkwgPSAnJztcbiAgICB0cnkge1xuICAgICAgYmFzZVVSTCA9IG5ldyBVUkwoY29uZmlnLnVybCkuaG9zdDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuXG4gICAgY29uc3Qgb3B0OiBQYXJ0aWFsPFNhZmVsaW5rT3B0aW9ucz4gPSB7XG4gICAgICAvLyBleGNsdWRlIHBhdHRlcm5zIChkb250IGFub255bWl6ZSB0aGVzZSBwYXR0ZXJucylcbiAgICAgIGV4Y2x1ZGU6IFtcbiAgICAgICAgLi4uKGNvbmZpZy5leHRlcm5hbF9saW5rPy5leGNsdWRlIHx8IFtdKSxcbiAgICAgICAgL2h0dHBzPzpcXC9cXC8/KD86KFteKl0rKVxcLik/d2VibWFuYWplbWVuXFwuY29tLyxcbiAgICAgICAgLyhbYS16MC05XSg/OlthLXowLTktXXsxLDYxfVthLXowLTldKT9bLl0pKndlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIGJhc2VVUkwsXG4gICAgICAgICd3d3cud2VibWFuYWplbWVuLmNvbScsXG4gICAgICAgICdodHRwczovL2dpdGh1Yi5jb20vZGltYXNsYW5qYWthJyxcbiAgICAgICAgJ2h0dHBzOi8vZmFjZWJvb2suY29tL2RpbWFzbGFuamFrYTEnLFxuICAgICAgICAnZGltYXNsYW5qYWthLmdpdGh1Yi5pbycsXG4gICAgICAgIC4uLmNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGVcbiAgICAgIF0uZmlsdGVyKGZ1bmN0aW9uICh4LCBpLCBhKSB7XG4gICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGUgYW5kIGVtcHRpZXNcbiAgICAgICAgcmV0dXJuIGEuaW5kZXhPZih4KSA9PT0gaSAmJiB4LnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMDtcbiAgICAgIH0pLFxuICAgICAgcmVkaXJlY3Q6IFtdLFxuICAgICAgLy9yZWRpcmVjdDogWywgY29uZmlnU2FmZWxpbmsucmVkaXJlY3RdLFxuICAgICAgcGFzc3dvcmQ6IGNvbmZpZ1NhZmVsaW5rLnBhc3N3b3JkIHx8IGNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnBhc3N3b3JkLFxuICAgICAgdHlwZTogY29uZmlnU2FmZWxpbmsudHlwZSB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay50eXBlXG4gICAgfTtcblxuICAgIGlmIChjb25maWdTYWZlbGluay5yZWRpcmVjdCkge1xuICAgICAgb3B0LnJlZGlyZWN0ID0gY29uZmlnU2FmZWxpbmsucmVkaXJlY3Q7XG4gICAgfVxuXG4gICAgY29uc3Qgc2FmZWxpbmsgPSBuZXcgc2Yuc2FmZWxpbmsob3B0KTtcblxuICAgIGNvbnN0IGd1bHBvcHQ6IFNyY09wdGlvbnMgPSB7XG4gICAgICBjd2Q6IHdvcmtpbmdEaXIsXG4gICAgICBpZ25vcmU6IFtdXG4gICAgfTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpKSB7XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWdTYWZlbGluay5leGNsdWRlKSkge1xuICAgICAgY29uc3QgaWdub3JlID0gY29uZmlnU2FmZWxpbmsuZXhjbHVkZS5maWx0ZXIoKHN0cikgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gIS9eKGh0dHBzPzpcXC98d3d3LikvLnRlc3Qoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KSBhcyBzdHJpbmdbXTtcbiAgICAgIGd1bHBvcHQuaWdub3JlPy5jb25jYXQoLi4uaWdub3JlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3VscFxuICAgICAgLnNyYyhbJyoqLyoue2h0bWwsaHRtfSddLCBndWxwb3B0KVxuICAgICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzYWZlbGluaycgfSkpXG4gICAgICAucGlwZShcbiAgICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIChmaWxlLCBfZW5jLCBuZXh0KSA9PiB7XG4gICAgICAgICAgLy8gZHJvcHNcbiAgICAgICAgICBpZiAoZmlsZS5pc051bGwoKSB8fCBmaWxlLmlzRGlyZWN0b3J5KCkgfHwgIWZpbGUgfHwgZmlsZS5pc1N0cmVhbSgpKSByZXR1cm4gbmV4dCgpO1xuICAgICAgICAgIC8vIHByb2Nlc3NcbiAgICAgICAgICBpZiAoZmlsZS5pc0J1ZmZlcigpICYmIEJ1ZmZlci5pc0J1ZmZlcihmaWxlLmNvbnRlbnRzKSkge1xuICAgICAgICAgICAgLy8gZG8gc2FmZWxpbmtpZnlcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCd1dGYtOCcpO1xuICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgc2FmZWxpbmsucGFyc2UoY29udGVudCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcnNlZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgLy8gTG9nZ2VyLmxvZyhwYXJzZWQpO1xuICAgICAgICAgICAgICBmaWxlLmNvbnRlbnRzID0gQnVmZmVyLmZyb20ocGFyc2VkKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQobnVsbCwgZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIExvZ2dlci5sb2coJ2Nhbm5vdCBwYXJzZScsIGZpbGUucGF0aCk7XG4gICAgICAgICAgLy8gZHJvcCBmYWlsc1xuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5waXBlKGd1bHAuZGVzdCh3b3JraW5nRGlyKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgd3N0cmVhbSA9IGNyZWF0ZVdyaXRlU3RyZWFtKHBhdGguam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9zYWZlbGluay5sb2cnKSk7XG4gICAgcmV0dXJuIHdzdHJlYW07XG4gIH1cbn1cblxuLy8gc2FmZWxpbmtpZnkgdGhlIGRlcGxveSBmb2xkZXJcbmd1bHAudGFzaygnc2FmZWxpbmsnLCB0YXNrU2FmZWxpbmspO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/16/gulpsafelink_164c92c7edb79d3cef122f73272620d8.map","wrapperLength":82},"result":{"scriptId":"11944","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21119,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21116,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsOENBQXdCO0FBQ3hCLHNEQUErQjtBQUMvQix1RUFBaUQ7QUFDakQsMERBQW9DO0FBQ3BDLHFDQUFrRTtBQUVsRTs7O0dBR0c7QUFDSCxTQUFnQixPQUFPLENBQUMsS0FBbUQsRUFBRSxHQUFXO0lBQ3RGLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sTUFBTSxHQUFhLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0UsTUFBTSxDQUFDLElBQUksT0FBWCxNQUFNLDJCQUFTLHNCQUFZLFdBQUU7SUFDN0IsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsY0FBYyxDQUFDLEVBQUUsRUFBRSxHQUFHLEtBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO1NBQ3pELElBQUksQ0FBQyxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNqQyxJQUFJLENBQ0gsSUFBQSxrQkFBTyxFQUFDLFVBQVUsSUFBSTtRQUFkLGlCQTJCUDtRQTFCQyxpQkFBaUI7UUFDakIsSUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNoQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDO2dCQUN0RSxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQzthQUMvQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsbUJBQW1CO1FBQ25CLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDakUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEVBQUU7WUFDakIsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUM1QixJQUFNLEtBQUssR0FBRyxLQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLFVBQVUsQ0FBQztnQkFDeEUsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDakM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILGdCQUFnQjtRQUNoQixXQUFXO1FBQ1gsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMscUJBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEVBQUUsY0FBTyxFQUFFLENBQUMsTUFBTSxlQUFLLElBQUksQ0FBRSxDQUFDLENBQUM7U0FDNUU7SUFDSCxDQUFDLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQXRDRCwwQkFzQ0M7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtJQUNQLElBQUEsU0FBUyxHQUFLLElBQUEsc0JBQVksR0FBRSxVQUFuQixDQUFvQjtJQUNyQyxPQUFPLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBjb21tb25JZ25vcmUsIGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBBdXRvIHNlbyBydW5uZXJcbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTZW8oX2RvbmU6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q6IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaWdub3JlOiBzdHJpbmdbXSA9IEFycmF5LmlzQXJyYXkoY29uZmlnLmV4Y2x1ZGUpID8gY29uZmlnLmV4Y2x1ZGUgOiBbXTtcbiAgaWdub3JlLnB1c2goLi4uY29tbW9uSWdub3JlKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKi57aHRtLGh0bWx9JywgJyoue2h0bWwsaHRtfSddLCB7IGN3ZCwgaWdub3JlIH0pXG4gICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzZW8nIH0pKVxuICAgIC5waXBlKFxuICAgICAgZ3VscERvbShmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAvLyBmaXggYWx0IGltYWdlc1xuICAgICAgICBjb25zdCBpbWFnZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW1nW3NyY10nKSk7XG4gICAgICAgIGltYWdlcy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFsdCA9IGVsLmdldEF0dHJpYnV0ZSgnYWx0Jyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBBbHQnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdhbHQnLCB0aXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBmaXggdGl0bGUgaWZyYW1lXG4gICAgICAgIGNvbnN0IGlmcmFtZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaWZyYW1lW3NyY10nKSk7XG4gICAgICAgIGlmcmFtZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBUaXRsZSc7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV0FSTklORyBNQUtFUlxuICAgICAgICAvLyBjb3VudCBIMVxuICAgICAgICBjb25zdCBoMSA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaDEnKTtcbiAgICAgICAgaWYgKGgxLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBMb2dnZXIubG9nKGFuc2lDb2xvcnMueWVsbG93QnJpZ2h0KCdbV0FSTl0nKSwgYEgxICgke2gxLmxlbmd0aH0pICR7cGF0aH1gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGN3ZCkpO1xufVxuXG5ndWxwLnRhc2soJ3NlbycsIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgeyBkZXBsb3lEaXIgfSA9IGRlcGxveUNvbmZpZygpO1xuICByZXR1cm4gdGFza1NlbyhudWxsLCBkZXBsb3lEaXIpO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/ee/gulpseo_ee59cff135689a98b46d52951c185d0d.map","wrapperLength":82},"result":{"scriptId":"11993","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8740,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8737,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc3RhbmRhbG9uZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QiwwREFBb0M7QUFDcEMseUNBQTZDO0FBQzdDLHFDQUFzQztBQUV0Qzs7O0dBR0c7QUFDSCxTQUFTLGdCQUFnQjtJQUN2QixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ2hELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUscUJBQXFCLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztTQUNsRyxJQUFJLENBQ0gsa0JBQVEsQ0FBQyxHQUFHLENBQUMsVUFBZ0IsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJOzs7Ozs7d0JBQzNDLGdCQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzt3QkFDeEQsS0FBQSxDQUFBLEtBQUEsZ0JBQU0sQ0FBQSxDQUFDLEdBQUcsQ0FBQTs7d0JBQVMscUJBQU0sSUFBQSxvQkFBVyxFQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBQSxtQkFBUyxHQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFBOzt3QkFBcEUsY0FBVyxtQkFBUSxTQUFpRCxFQUFFLEVBQUMsQ0FBQzt3QkFDeEUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNsRCxLQUFLLEdBQUcsSUFBQSxxQkFBSyxFQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO3dCQUMvRCxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRTs0QkFDaEIsWUFBWTs0QkFDWixJQUFJLEVBQUUsQ0FBQzt3QkFDVCxDQUFDLENBQUMsQ0FBQzs7Ozs7S0FDSixDQUFDLENBQ0g7U0FDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1NBQ3hELElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDWCxnQkFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUUvQyxrQkFBZSxnQkFBZ0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5zdGFuZGFsb25lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyByZXBsYWNlUGF0aCB9IGZyb20gJy4vdXRpbHMvc3RyaW5nJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogcnVuIGFsbCBfKi5zdGFuZGFsb25lLmpzIGluc2lkZSBzcmMtcG9zdHMgKF9jb25maWdfeW1sLnBvc3RfZGlyKVxuICogQHJldHVybnNcbiAqL1xuZnVuY3Rpb24gc3RhbmRhbG9uZVJ1bm5lcigpIHtcbiAgTG9nZ2VyLmxvZygnW3N0YW5kYWxvbmVdIFJ1bm5pbmcgc2NyaXB0cy4uLlxcbicpO1xuICByZXR1cm4gZ3VscFxuICAgIC5zcmMoam9pbihnZXRDb25maWcoKS5jd2QsICcqKi9fKi5zdGFuZGFsb25lLmpzJyksIHsgY3dkOiBnZXRDb25maWcoKS5jd2QsIGlnbm9yZTogWycqKi90bXAvKionXSB9KVxuICAgIC5waXBlKFxuICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIGZ1bmN0aW9uIChmaWxlLCBfZW5jLCBuZXh0KSB7XG4gICAgICAgIExvZ2dlci5sb2coJz0nLnJlcGVhdCgxMCkgKyAnIGlucHV0ICcgKyAnPScucmVwZWF0KDEwKSk7XG4gICAgICAgIExvZ2dlci5sb2coYG5vZGUgJHthd2FpdCByZXBsYWNlUGF0aChmaWxlLnBhdGgsIGdldENvbmZpZygpLmN3ZCwgJycpfWApO1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBvdXB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXduKCdub2RlJywgW2ZpbGUucGF0aF0sIHsgc3RkaW86ICdpbmhlcml0JyB9KTtcbiAgICAgICAgY2hpbGQub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3AgZmlsZVxuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIClcbiAgICAucGlwZShndWxwLmRlc3Qoam9pbihnZXRDb25maWcoKS5jd2QsICd0bXAvc3RhbmRhbG9uZScpKSlcbiAgICAub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgTG9nZ2VyLmxvZygnXFxuW3N0YW5kYWxvbmVdIHN0b3BwZWQnKTtcbiAgICB9KTtcbn1cblxuZ3VscC50YXNrKCdwb3N0OnN0YW5kYWxvbmUnLCBzdGFuZGFsb25lUnVubmVyKTtcblxuZXhwb3J0IGRlZmF1bHQgc3RhbmRhbG9uZVJ1bm5lcjtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/70/gulpstandalone_70a88f15ac851281d69271b2b48c84eb.map","wrapperLength":82},"result":{"scriptId":"11999","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8780,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8777,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLHFDQUF3QztBQUN4Qyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF1QztBQUN2Qyx1Q0FBeUM7QUFDekMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyx5QkFBeUI7QUFDekIsbURBQXNEO0FBQ3RELCtCQUE2QjtBQUM3QixxQ0FBcUM7QUFDckMsdUNBQWlFO0FBQ2pFLGlDQUF1QztBQUN2QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHNFQUErQztBQUMvQyxxQ0FBK0Q7QUFFL0Q7Ozs7RUFJRTtBQUNGLElBQUksUUFBUSxHQUFHLEVBQWMsQ0FBQztBQUM5QixJQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO0FBQ2xDLElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCOzs7OztHQUtHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLEdBQStCLEVBQUUsSUFBUTtJQUF6RSxpQkE2REM7SUE3RGdFLHFCQUFBLEVBQUEsUUFBUTtJQUN2RSxPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQW9DO1FBQ3ZELElBQU0sUUFBUSxHQUF5QyxFQUFFLENBQUM7UUFDMUQsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7WUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixRQUFRLENBQUMsSUFBSSxDQUNYLElBQUEscUNBQW1CLEVBQUMsR0FBRyxFQUFFO2dCQUN2QixJQUFJLE1BQUE7YUFDTCxDQUFDLENBQ0gsQ0FBQztTQUNIO2FBQU07WUFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsQ0FB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QUFBLGtCQUFPLEVBQUM7b0JBQ04seUJBQXlCO29CQUN6QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLG1CQUFlLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQzt3QkFDeEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDZCQUEyQixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDL0Q7d0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNkZBQStFLE9BQU8scUJBQWlCLENBQUM7cUJBQ2hJO29CQUNELHVFQUF1RTtnQkFDekUsQ0FBQyxDQUFDLENBQ0g7cUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7cUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLE9BQU8sRUFBRSxFQUFULENBQVMsQ0FBQyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFqR0Qsa0RBaUdDO0FBRUQsU0FBUyxPQUFPLENBQUMsSUFBWSxFQUFFLFFBQW9DO0lBQ2pFLE9BQU8sb0JBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtJQUNuQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQU87UUFDMUIsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGhleG8gfSBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciB9IGZyb20gJ2hleG8tdXRpbCc7XG5pbXBvcnQgbWljcm9tYXRjaCBmcm9tICdtaWNyb21hdGNoJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBzaXRlbWFwQ3Jhd2xlckFzeW5jIH0gZnJvbSAnc2l0ZW1hcC1jcmF3bGVyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyB5b2FzdFNlbyB9IGZyb20gJy4vc2l0ZW1hcCc7XG5pbXBvcnQgeyBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qXG4vLyByZWFkIGV4aXN0aW5nIHNpdGVtYXAudHh0XG5jb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xubGV0IHNpdGVtYXBzID0gZXhpc3RzU3luYyhzaXRlbWFwVFhUKSA/IGFycmF5X3JlbW92ZV9lbXB0eShyZWFkRmlsZVN5bmMoc2l0ZW1hcFRYVCwgJ3V0Zi04Jykuc3BsaXQoL1xccj9cXG4vZ20pKSA6IFtdO1xuKi9cbmxldCBzaXRlbWFwcyA9IFtdIGFzIHN0cmluZ1tdO1xuY29uc3QgY3Jhd2xlZCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuLyoqXG4gKiBTaXRlbWFwIEdlbmVyYXRvclxuICogQHBhcmFtIHVybCB1cmwgdG8gY3Jhd2xcbiAqIEBwYXJhbSBkZWVwIGNyYXdsIGRlZXBlciBuIHRpbWVzXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTaXRlbWFwKHVybD86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsIGRlZXAgPSAwKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmU6IChzaXRlbWFwczogc3RyaW5nW10pID0+IGFueSkgPT4ge1xuICAgIGNvbnN0IHByb21pc2VzOiBCbHVlYmlyZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4+W10gPSBbXTtcbiAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKHVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNyYXdsZWQuYWRkKGdldENvbmZpZygpLnVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKGdldENvbmZpZygpLnVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIEJsdWViaXJkLmFsbChwcm9taXNlcylcbiAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hcHBlZCA9IHt9IGFzIFJldHVyblR5cGU8dHlwZW9mIHNpdGVtYXBDcmF3bGVyQXN5bmM+O1xuICAgICAgICByZXN1bHRzLmZvckVhY2goKHNpdGVtYXApID0+IHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBzaXRlbWFwKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBzaXRlbWFwW2tleV07XG4gICAgICAgICAgICBpZiAoa2V5IGluIG1hcHBlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSB2YWx1ZXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBtYXBwZWRba2V5XSA9IGFycmF5X3VuaXF1ZSh2YWx1ZXMuY29uY2F0KG1hcHBlZFtrZXldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIGNvbnN0IHNhdmV0byA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL3NpdGVtYXAvc2l0ZW1hcC5qc29uJyk7XG4gICAgICAgIHdyaXRlZmlsZShzYXZldG8sIEpTT04uc3RyaW5naWZ5KG1hcHBlZCwgbnVsbCwgMikpO1xuXG4gICAgICAgIC8vIHJldHVyblxuICAgICAgICByZXR1cm4gbWFwcGVkO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGFzeW5jIChyZXN1bHRzKSA9PiB7XG4gICAgICAgIHNpdGVtYXBzID0gYXJyYXlfdW5pcXVlKGFycmF5X3JlbW92ZV9lbXB0eShPYmplY3QudmFsdWVzKHJlc3VsdHMpLmZsYXQoMSkuY29uY2F0KHNpdGVtYXBzKSkpLnNvcnQoZnVuY3Rpb24gKFxuICAgICAgICAgIGEsXG4gICAgICAgICAgYlxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IDAgOiBhIDwgYiA/IC0xIDogMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWVwOyBpKyspIHtcbiAgICAgICAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgc2l0ZW1hcHMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBzaXRlbWFwc1tpaV07XG4gICAgICAgICAgICBpZiAoY3Jhd2xlZC5oYXModXJsKSB8fCAvLihqc3x0c3xjc3N8c2Nzc3x0eHR8cGRmfHBuZ3xqcGU/Z3xnaWZ8d2VicCkkL2dpLnRlc3QodXJsKSkgY29udGludWU7XG5cbiAgICAgICAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICAgICAgICBMb2dnZXIubG9nKCdbZGVwdGhdJywgaWksIHVybCk7XG4gICAgICAgICAgICBhd2FpdCBnZW5lcmF0ZVNpdGVtYXAodXJsLCBkZWVwKS50aGVuKCgpID0+IHdyaXRlU2l0ZW1hcCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB3cml0ZVNpdGVtYXAocmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8qKlxuICogd3JpdGUgdGhlIHNpdGVtYXBcbiAqIEBwYXJhbSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiB3cml0ZVNpdGVtYXAoY2FsbGJhY2s/OiAoLi4uYXJnczogYW55W10pID0+IGFueSkge1xuICBsZXQgY2IgPSBub29wO1xuICBpZiAoY2FsbGJhY2spIGNiID0gKCkgPT4gY2FsbGJhY2soc2l0ZW1hcHMpO1xuICBjb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xuICB3cml0ZWZpbGUoc2l0ZW1hcFRYVCwgYXJyYXlfcmVtb3ZlX2VtcHR5KHNpdGVtYXBzKS5qb2luKEVPTCkpO1xuICBjYi5hcHBseSh0aGlzKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaXRlbWFwT3B0aW9ucyB7XG4gIHBhdGg6IHN0cmluZ1tdO1xuICB0YWdzOiBib29sZWFuO1xuICBjYXRlZ29yaWVzOiBib29sZWFuO1xuICByZWw6IGJvb2xlYW47XG4gIHlvYXN0OiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4b0dlbmVyYXRlU2l0ZW1hcCgpIHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oZ2V0Q29uZmlnKCkuY3dkKTtcbiAgICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICBpbnN0YW5jZS5sb2FkKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb25maWcgPSBzZXRDb25maWcoaW5zdGFuY2UuY29uZmlnKTtcbiAgICAgICAgLy8gYXNzaWduIGRlZmF1bHQgY29uZmlnXG4gICAgICAgIGNvbnN0IHNpdGVtYXA6IFNpdGVtYXBPcHRpb25zID0gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICB7IHJlbDogZmFsc2UsIHRhZ3M6IGZhbHNlLCBjYXRlZ29yaWVzOiBmYWxzZSwgcGF0aDogWydzaXRlbWFwLnR4dCcsICdzaXRlbWFwLnhtbCddIH0sXG4gICAgICAgICAgY29uZmlnLnNpdGVtYXBcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCdWlsZCBZb2FzdCBTRU8gc2l0ZW1hcFxuICAgICAgICAvLyB3aGVuIGNvbmZpZy55b2FzdCBkZWZpbmVkXG4gICAgICAgIGlmIChzaXRlbWFwLnlvYXN0KSB7XG4gICAgICAgICAgcmV0dXJuIHlvYXN0U2VvKGluc3RhbmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLnNpdGVtYXApIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAgbm90IGNvbmZpZ3VyZWQgaW4gX2NvbmZpZy55bWwnKTtcbiAgICAgICAgY29uc3QgbG9jYWxzID0gaW5zdGFuY2UubG9jYWxzO1xuICAgICAgICBjb25zdCB7IHNraXBfcmVuZGVyIH0gPSBjb25maWc7XG5cbiAgICAgICAgaWYgKCFzaXRlbWFwLnRhZ3MgfHwgIXNpdGVtYXAuY2F0ZWdvcmllcykge1xuICAgICAgICAgIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAudGFncyBvciBjb25maWcuc2l0ZW1hcC5jYXRlZ29yaWVzIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2tpcFJlbmRlckxpc3QgPSBbJyoqLyouanMnLCAnKiovKi5jc3MnLCAnKiovLmdpdConXTtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShza2lwX3JlbmRlcikpIHtcbiAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKC4uLnNraXBfcmVuZGVyKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2tpcF9yZW5kZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaWYgKHNraXBfcmVuZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNraXBSZW5kZXJMaXN0LnB1c2goc2tpcF9yZW5kZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvc3RzID0gWy4uLmxvY2Fscy5nZXQoJ3BhZ2VzJykudG9BcnJheSgpLCAuLi5sb2NhbHMuZ2V0KCdwb3N0cycpLnRvQXJyYXkoKV1cbiAgICAgICAgICAuZmlsdGVyKChwb3N0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcG9zdC5zaXRlbWFwICE9PSBmYWxzZSAmJiAhaXNNYXRjaChwb3N0LnNvdXJjZSwgc2tpcFJlbmRlckxpc3QpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnVwZGF0ZWQgJiYgYS51cGRhdGVkKSByZXR1cm4gYi51cGRhdGVkLnRvRGF0ZSgpLmdldFRpbWUoKSAtIGEudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAocG9zdHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdG1wbFNyYyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9zaXRlbWFwLnhtbCcpO1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuICAgICAgICBjb25zdCB7IHRhZ3M6IHRhZ3NDZmcsIGNhdGVnb3JpZXM6IGNhdHNDZmcsIHJlbDogcmVsQ2ZnIH0gPSBzaXRlbWFwO1xuICAgICAgICBsZXQgZGF0YSA9IHRlbXBsYXRlLnJlbmRlcih7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIHBvc3RzLFxuICAgICAgICAgIHNOb3c6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdGFnczogdGFnc0NmZyA/IGxvY2Fscy5nZXQoJ3RhZ3MnKS50b0FycmF5KCkgOiBbXSxcbiAgICAgICAgICBjYXRlZ29yaWVzOiBjYXRzQ2ZnID8gbG9jYWxzLmdldCgnY2F0ZWdvcmllcycpLnRvQXJyYXkoKSA6IFtdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlbW92ZSBibGFuayBuZXdsaW5lc1xuICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9eXFxzKltcXHJcXG5dL2dtLCAnXFxuJyk7XG5cbiAgICAgICAgLy9kYXRhID0gcHJldHRpZXIuZm9ybWF0KGRhdGEsIHsgcGFyc2VyOiAneG1sJywgcGx1Z2luczogW3htbHBsdWdpbl0sIGVuZE9mTGluZTogJ2xmJyB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIHdyaXRlZmlsZShqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAueG1sJyksIGRhdGEpO1xuXG4gICAgICAgIC8vIHdyaXRlXG4gICAgICAgIGNvbnN0IHNpdGVtYXBYbWwgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdzaXRlbWFwLnhtbCcpO1xuICAgICAgICB3cml0ZWZpbGUoc2l0ZW1hcFhtbCwgZGF0YSk7XG4gICAgICAgIGluc3RhbmNlLmxvZy5pbmZvKCdzaXRlbWFwIHdyaXR0ZW4nLCBzaXRlbWFwWG1sKTtcblxuICAgICAgICBpZiAoIXJlbENmZykgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgY29uc3QgYmFzZVVSTCA9IGNvbmZpZy51cmwuZW5kc1dpdGgoJy8nKSA/IGNvbmZpZy51cmwgOiBjb25maWcudXJsICsgJy8nO1xuICAgICAgICBjb25zdCBwdWJsaWNEaXIgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgICBndWxwXG4gICAgICAgICAgLnNyYygnKiovKi5odG1sJywgeyBjd2Q6IHB1YmxpY0RpciwgaWdub3JlOiBjb21tb25JZ25vcmUgfSlcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBzaXRlbWFwXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3NpdGVtYXAueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwic2l0ZW1hcC1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi90ZXh0K3htbFwiIHJlbD1cInNpdGVtYXBcIiBocmVmPVwiJHtiYXNlVVJMfXNpdGVtYXAueG1sXCIgLz5gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgICAub25jZSgnZW5kJywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaXNNYXRjaChwYXRoOiBzdHJpbmcsIHBhdHRlcm5zOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSkge1xuICByZXR1cm4gbWljcm9tYXRjaC5pc01hdGNoKHBhdGgsIHBhdHRlcm5zKTtcbn1cblxuZ3VscC50YXNrKCdzaXRlbWFwJywgKCkgPT4ge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgaGV4b0dlbmVyYXRlU2l0ZW1hcCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/e1/gulpsitemap_e101e74aed6d774c00756f77ebed36bd.map","wrapperLength":82},"result":{"scriptId":"12003","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33900,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33897,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDhDQUF3QjtBQUN4Qix1Q0FBa0M7QUFDbEMsK0JBQTZCO0FBQzdCLHdCQUFzQjtBQUN0Qix5QkFBdUI7QUFDdkIsdUJBQXFCO0FBQ3JCLDJCQUF5QjtBQUN6QixzQkFBb0I7QUFDcEIsdUJBQXFCO0FBQ3JCLDZCQUEyQjtBQUMzQiwwREFBb0M7QUFFcEMseUJBQXlCO0FBQ3pCLFNBQWdCLGFBQWEsQ0FBQyxNQUFpQztJQUM3RCxJQUFNLE9BQU8sR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxXQUFXLENBQUMsRUFBRSxJQUFBLFlBQUksRUFBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDakcsSUFBTSxNQUFNLEdBQUc7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU07WUFBRSxPQUFPLE1BQU0sRUFBRSxDQUFDO1FBQ3JDLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFNLEdBQUcsR0FBRztZQUNWLEdBQUcsRUFBRSxNQUFNO1lBQ1gsS0FBSyxFQUFFLFNBQVM7U0FDakIsQ0FBQztRQUNGLE9BQU8sSUFBQSxpQkFBSyxFQUFDLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBTyxHQUFHLENBQUM7YUFDekMsSUFBSSxDQUFDLGNBQU0sT0FBQSxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxFQUFPLEdBQUcsQ0FBQyxFQUFoRSxDQUFnRSxDQUFDO2FBQzVFLEtBQUssQ0FBQyxVQUFDLENBQUM7WUFDUCxJQUFJLENBQUMsWUFBWSxLQUFLO2dCQUFFLGdCQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDO2FBQ0QsT0FBTyxDQUFDO1lBQ1AsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2hCLE1BQU0sRUFBRSxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUM7SUFDRixPQUFPLE1BQU0sRUFBRSxDQUFDO0FBQ2xCLENBQUM7QUFwQkQsc0NBb0JDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUUzQyxrQkFBZSxjQUFJLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgc3Bhd24gfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLmRlcGxveSc7XG5pbXBvcnQgJy4vZ3VscC5mZWVkJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgJy4vcG9zdC9jb3B5JztcbmltcG9ydCAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5cbi8vIGNvbW1pdCBjdXJyZW50IHByb2plY3RcbmV4cG9ydCBmdW5jdGlvbiBjb21taXRQcm9qZWN0KGZpbmlzaDogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBnaXREaXJzID0gW2pvaW4ocHJvY2Vzcy5jd2QoKSwgJ3NyYy1wb3N0cycpLCBqb2luKHByb2Nlc3MuY3dkKCksICdzb3VyY2UnKSwgcHJvY2Vzcy5jd2QoKV07XG4gIGNvbnN0IGNvbW1pdCA9ICgpID0+IHtcbiAgICBpZiAoIWdpdERpcnMubGVuZ3RoKSByZXR1cm4gZmluaXNoKCk7XG4gICAgY29uc3QgZ2l0RGlyID0gZ2l0RGlyc1swXTtcbiAgICBjb25zdCBvcHQgPSB7XG4gICAgICBjd2Q6IGdpdERpcixcbiAgICAgIHN0ZGlvOiAnaW5oZXJpdCdcbiAgICB9O1xuICAgIHJldHVybiBzcGF3bignZ2l0JywgWydhZGQnLCAnLUEnXSwgPGFueT5vcHQpXG4gICAgICAudGhlbigoKSA9PiBzcGF3bignZ2l0JywgWydjb21taXQnLCAnLW0nLCAndXBkYXRlICcgKyBuZXcgRGF0ZSgpXSwgPGFueT5vcHQpKVxuICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIExvZ2dlci5sb2coZS5tZXNzYWdlLCBnaXREaXIpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgZ2l0RGlycy5zaGlmdCgpO1xuICAgICAgICBjb21taXQoKTtcbiAgICAgIH0pO1xuICB9O1xuICByZXR1cm4gY29tbWl0KCk7XG59XG5cbmd1bHAudGFzaygncHJvamVjdC1jb21taXQnLCBjb21taXRQcm9qZWN0KTtcblxuZXhwb3J0IGRlZmF1bHQgZ3VscDtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/c0/gulpfile_c0c9f96e795586c702c83946161b1950.map","wrapperLength":82},"result":{"scriptId":"12352","url":"D:\\Repositories\\static-blog-generator\\src\\gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4931,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4928,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlCQUF1RTtBQUN2RSw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBbUQ7QUFDbkQsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QixzRUFBK0M7QUFDL0MscUNBQW9EO0FBRXBELElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCLGNBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsSUFBSTtJQUM5QixJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFFBQVEsR0FBRyxJQUFJLGNBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQztRQUNuQixRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFVBQUMsR0FBRztnQkFDN0IsT0FBTyx3QkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUM7WUFFSCxTQUFTLEtBQUssQ0FBQyxPQUE2QixFQUFFLElBQTBCO2dCQUN0RSxJQUFNLFFBQVEsR0FBRyxrQkFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUV2RSxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDekMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzVCLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFBSTtvQkFDeEIsT0FBTyxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQztnQkFDN0IsQ0FBQyxDQUFDLENBQUM7Z0JBRUssSUFBQSxLQUFLLEdBQXdCLE1BQU0sTUFBOUIsRUFBRSxJQUFJLEdBQWtCLE1BQU0sS0FBeEIsRUFBTyxNQUFNLEdBQUssTUFBTSxJQUFYLENBQVk7Z0JBQ3BDLElBQU0sT0FBTyxHQUFLLElBQUksS0FBVCxDQUFVO2dCQUUvQixJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUM7Z0JBQ2pCLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssR0FBRztvQkFBRSxHQUFHLElBQUksR0FBRyxDQUFDO2dCQUM1QyxvQ0FBb0M7Z0JBQ3BDLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUM7b0JBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUU5RCxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7Z0JBQ2QsSUFBSSxPQUFPO29CQUFFLElBQUksR0FBRyx3QkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7cUJBQ3BELElBQUksS0FBSztvQkFBRSxJQUFJLEdBQUcsSUFBQSxvQkFBUSxFQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFFM0MsSUFBTSxRQUFRLEdBQUcsd0JBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2dCQUV4RCxJQUFNLElBQUksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO29CQUMzQixNQUFNLFFBQUE7b0JBQ04sR0FBRyxLQUFBO29CQUNILElBQUksTUFBQTtvQkFDSixLQUFLLE9BQUE7b0JBQ0wsUUFBUSxVQUFBO2lCQUNULENBQUMsQ0FBQztnQkFFSCxJQUFBLGtCQUFhLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzVCLENBQUM7WUFFRCxJQUFNLFdBQVcsR0FBRyxJQUFBLFlBQUksRUFBQyxTQUFTLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztZQUNoRSxJQUFNLE9BQU8sR0FBRyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDL0QsS0FBSyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUU1QixJQUFNLFlBQVksR0FBRyxJQUFBLFlBQUksRUFBQyxTQUFTLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztZQUNsRSxJQUFNLFFBQVEsR0FBRyxJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDakUsS0FBSyxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUU5QixJQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7WUFFekUsSUFBTSxTQUFTLEdBQUcsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdEQsY0FBSTtpQkFDRCxHQUFHLENBQUMsV0FBVyxFQUFFLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsc0JBQVksRUFBRSxDQUFDO2lCQUMxRCxJQUFJLENBQ0gsSUFBQSxrQkFBTyxFQUFDO2dCQUNOLHFCQUFxQjtnQkFDckIsSUFDRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsc0JBQWMsT0FBTyxlQUFXLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQztvQkFDcEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHlCQUF1QixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDM0Q7b0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksMEZBQTRFLE9BQU8saUJBQWEsQ0FBQztpQkFDekg7Z0JBQ0Qsc0JBQXNCO2dCQUN0QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLGdCQUFZLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQztvQkFDckUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDBCQUF3QixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDNUQ7b0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNEZBQThFLE9BQU8sa0JBQWMsQ0FBQztpQkFDNUg7Z0JBQ0QsdUVBQXVFO1lBQ3pFLENBQUMsQ0FBQyxDQUNIO2lCQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUMxQixJQUFJLENBQUMsS0FBSyxFQUFFLGNBQU0sT0FBQSxJQUFJLEVBQUUsRUFBTixDQUFNLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXRoT3JGaWxlRGVzY3JpcHRvciwgcmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgaGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciwgZ3JhdmF0YXIgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG51bmp1Y2tzIGZyb20gJ251bmp1Y2tzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG5jb25zdCBlbnYgPSBlbnZOdW5qdWNrcygpO1xuXG5ndWxwLnRhc2soJ2ZlZWQnLCBmdW5jdGlvbiAoZG9uZSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaW5zdGFuY2UgPSBuZXcgaGV4byhjb25maWcuY3dkKTtcblxuICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oKCkgPT4ge1xuICAgICAgZW52LmFkZEZpbHRlcignZm9ybWF0VXJsJywgKHN0cikgPT4ge1xuICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICB9KTtcblxuICAgICAgZnVuY3Rpb24gYnVpbGQodG1wbFNyYzogUGF0aE9yRmlsZURlc2NyaXB0b3IsIGRlc3Q6IFBhdGhPckZpbGVEZXNjcmlwdG9yKSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gbnVuanVja3MuY29tcGlsZShyZWFkRmlsZVN5bmModG1wbFNyYywgJ3V0Zi04JyksIGVudik7XG5cbiAgICAgICAgbGV0IHBvc3RzID0gaW5zdGFuY2UubG9jYWxzLmdldCgncG9zdHMnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5zb3J0KCctZGF0ZScpO1xuICAgICAgICBwb3N0cyA9IHBvc3RzLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwb3N0LmRyYWZ0ICE9PSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB7IGVtYWlsLCBmZWVkLCB1cmw6IHVybENmZyB9ID0gY29uZmlnO1xuICAgICAgICBjb25zdCB7IGljb246IGljb25DZmcgfSA9IGZlZWQ7XG5cbiAgICAgICAgbGV0IHVybCA9IHVybENmZztcbiAgICAgICAgaWYgKHVybFt1cmwubGVuZ3RoIC0gMV0gIT09ICcvJykgdXJsICs9ICcvJztcbiAgICAgICAgLy8gcmVtb3ZlIGJyb2tlbiBoZXhvIGxhbmcgc2hvcnRjb2RlXG4gICAgICAgIGlmICh1cmwuaW5jbHVkZXMoJzpsYW5nLycpKSB1cmwgPSB1cmwucmVwbGFjZSgnLzpsYW5nLycsICcvJyk7XG5cbiAgICAgICAgbGV0IGljb24gPSAnJztcbiAgICAgICAgaWYgKGljb25DZmcpIGljb24gPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgaWNvbkNmZyk7XG4gICAgICAgIGVsc2UgaWYgKGVtYWlsKSBpY29uID0gZ3JhdmF0YXIoZW1haWwsIHt9KTtcblxuICAgICAgICBjb25zdCBmZWVkX3VybCA9IGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCAncnNzLnhtbCcpO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgaWNvbixcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBmZWVkX3VybFxuICAgICAgICB9KTtcblxuICAgICAgICB3cml0ZUZpbGVTeW5jKGRlc3QsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVJTUyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9yc3MueG1sJyk7XG4gICAgICBjb25zdCBkZXN0UlNTID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2RpciwgJ3Jzcy54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlUlNTLCBkZXN0UlNTKTtcblxuICAgICAgY29uc3QgdGVtcGxhdGVBVE9NID0gam9pbihfX2Rpcm5hbWUsICdfY29uZmlnX3RlbXBsYXRlX2F0b20ueG1sJyk7XG4gICAgICBjb25zdCBkZXN0QVRPTSA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdhdG9tLnhtbCcpO1xuICAgICAgYnVpbGQodGVtcGxhdGVBVE9NLCBkZXN0QVRPTSk7XG5cbiAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcblxuICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG4gICAgICBndWxwXG4gICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgcnNzXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIvcnNzLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwicnNzLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL3Jzcyt4bWxcIiByZWw9XCJhbHRlcm5hdGVcIiBocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBhdG9tXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfWF0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL2F0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5oZWFkLmlubmVySFRNTCArPSBgPGxpbmsgaWQ9XCJhdG9tLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL2F0b20reG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiIC8+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IGRvbmUoKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/21/gulpfeed_218d054d70d3561ba89867e4695c6976.map","wrapperLength":82},"result":{"scriptId":"12353","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13306,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13303,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":4,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1673237885387,"runtime":26436,"slow":true,"start":1673237858951},"skipped":false,"testFilePath":"D:\\Repositories\\static-blog-generator\\test\\copy.test.ts","testResults":[{"ancestorTitles":["test copy post without label mapper","clean"],"duration":734,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper clean run clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run clean"},{"ancestorTitles":["test copy post without label mapper","clean"],"duration":40,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper clean validate clean","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate clean"},{"ancestorTitles":["test copy post without label mapper","copy"],"duration":12817,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper copy run copy","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"run copy"},{"ancestorTitles":["test copy post without label mapper","copy"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"test copy post without label mapper copy validate total markdown","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"validate total markdown"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setConfig = exports.getConfig = exports.deployConfig = exports.scheduler = exports.noop = exports.array_unique = exports.array_remove_empty = exports.array_random = exports.updatePost = exports.copySinglePost = exports.copyAllPosts = exports.gulp = exports.commitProject = exports.standaloneRunner = exports.hexoGenerateSitemap = exports.generateSitemap = exports.autoSeo = exports.deleteDir = exports.del = exports.cleanDb = exports.gulpDebug = exports.gulpCached = exports.Application = void 0;\nvar api_1 = require(\"./api\");\nObject.defineProperty(exports, \"Application\", { enumerable: true, get: function () { return __importDefault(api_1).default; } });\nvar gulp_cache_1 = require(\"./gulp-utils/gulp.cache\");\nObject.defineProperty(exports, \"gulpCached\", { enumerable: true, get: function () { return __importDefault(gulp_cache_1).default; } });\nvar gulp_debug_1 = require(\"./gulp-utils/gulp.debug\");\nObject.defineProperty(exports, \"gulpDebug\", { enumerable: true, get: function () { return __importDefault(gulp_debug_1).default; } });\nvar gulp_clean_1 = require(\"./gulp.clean\");\nObject.defineProperty(exports, \"cleanDb\", { enumerable: true, get: function () { return gulp_clean_1.cleanDb; } });\nObject.defineProperty(exports, \"del\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nObject.defineProperty(exports, \"deleteDir\", { enumerable: true, get: function () { return gulp_clean_1.del; } });\nvar gulp_seo_1 = require(\"./gulp.seo\");\nObject.defineProperty(exports, \"autoSeo\", { enumerable: true, get: function () { return gulp_seo_1.taskSeo; } });\nvar gulp_sitemap_1 = require(\"./gulp.sitemap\");\nObject.defineProperty(exports, \"generateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.generateSitemap; } });\nObject.defineProperty(exports, \"hexoGenerateSitemap\", { enumerable: true, get: function () { return gulp_sitemap_1.hexoGenerateSitemap; } });\nvar gulp_standalone_1 = require(\"./gulp.standalone\");\nObject.defineProperty(exports, \"standaloneRunner\", { enumerable: true, get: function () { return __importDefault(gulp_standalone_1).default; } });\nvar gulpfile_1 = require(\"./gulpfile\");\nObject.defineProperty(exports, \"commitProject\", { enumerable: true, get: function () { return gulpfile_1.commitProject; } });\nObject.defineProperty(exports, \"gulp\", { enumerable: true, get: function () { return __importDefault(gulpfile_1).default; } });\nvar copy_1 = require(\"./post/copy\");\nObject.defineProperty(exports, \"copyAllPosts\", { enumerable: true, get: function () { return copy_1.copyAllPosts; } });\nObject.defineProperty(exports, \"copySinglePost\", { enumerable: true, get: function () { return copy_1.copySinglePost; } });\nvar update_1 = require(\"./post/update\");\nObject.defineProperty(exports, \"updatePost\", { enumerable: true, get: function () { return update_1.updatePost; } });\nvar array_1 = require(\"./utils/array\");\nObject.defineProperty(exports, \"array_random\", { enumerable: true, get: function () { return array_1.array_random; } });\nObject.defineProperty(exports, \"array_remove_empty\", { enumerable: true, get: function () { return array_1.array_remove_empty; } });\nObject.defineProperty(exports, \"array_unique\", { enumerable: true, get: function () { return array_1.array_unique; } });\nvar noop_1 = require(\"./utils/noop\");\nObject.defineProperty(exports, \"noop\", { enumerable: true, get: function () { return noop_1.noop; } });\nvar scheduler_1 = require(\"./utils/scheduler\");\nObject.defineProperty(exports, \"scheduler\", { enumerable: true, get: function () { return __importDefault(scheduler_1).default; } });\nvar _config_1 = require(\"./_config\");\nObject.defineProperty(exports, \"deployConfig\", { enumerable: true, get: function () { return _config_1.deployConfig; } });\nObject.defineProperty(exports, \"getConfig\", { enumerable: true, get: function () { return _config_1.getConfig; } });\nObject.defineProperty(exports, \"setConfig\", { enumerable: true, get: function () { return _config_1.setConfig; } });\n//\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGluZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUErQztBQUF0QyxtSEFBQSxPQUFPLE9BQWU7QUFDL0Isc0RBQWdFO0FBQXZELHlIQUFBLE9BQU8sT0FBYztBQUM5QixzREFBK0Q7QUFBdEQsd0hBQUEsT0FBTyxPQUFhO0FBQzdCLDJDQUE4RDtBQUFyRCxxR0FBQSxPQUFPLE9BQUE7QUFBRSxpR0FBQSxHQUFHLE9BQUE7QUFBRSx1R0FBQSxHQUFHLE9BQWE7QUFDdkMsdUNBQWdEO0FBQXZDLG1HQUFBLE9BQU8sT0FBVztBQUMzQiwrQ0FBc0U7QUFBN0QsK0dBQUEsZUFBZSxPQUFBO0FBQUUsbUhBQUEsbUJBQW1CLE9BQUE7QUFDN0MscURBQWdFO0FBQXZELG9JQUFBLE9BQU8sT0FBb0I7QUFDcEMsdUNBQTREO0FBQW5ELHlHQUFBLGFBQWEsT0FBQTtBQUFFLGlIQUFBLE9BQU8sT0FBUTtBQUN2QyxvQ0FBMkQ7QUFBbEQsb0dBQUEsWUFBWSxPQUFBO0FBQUUsc0dBQUEsY0FBYyxPQUFBO0FBQ3JDLHdDQUEyQztBQUFsQyxvR0FBQSxVQUFVLE9BQUE7QUFDbkIsdUNBQStFO0FBQXRFLHFHQUFBLFlBQVksT0FBQTtBQUFFLDJHQUFBLGtCQUFrQixPQUFBO0FBQUUscUdBQUEsWUFBWSxPQUFBO0FBQ3ZELHFDQUFvQztBQUEzQiw0RkFBQSxJQUFJLE9BQUE7QUFDYiwrQ0FBeUQ7QUFBaEQsdUhBQUEsT0FBTyxPQUFhO0FBQzdCLHFDQUErRDtBQUF0RCx1R0FBQSxZQUFZLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFBRSxvR0FBQSxTQUFTLE9BQUE7QUFFM0MsRUFBRSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHsgZGVmYXVsdCBhcyBBcHBsaWNhdGlvbiB9IGZyb20gJy4vYXBpJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscENhY2hlZCB9IGZyb20gJy4vZ3VscC11dGlscy9ndWxwLmNhY2hlJztcbmV4cG9ydCB7IGRlZmF1bHQgYXMgZ3VscERlYnVnIH0gZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuZGVidWcnO1xuZXhwb3J0IHsgY2xlYW5EYiwgZGVsLCBkZWwgYXMgZGVsZXRlRGlyIH0gZnJvbSAnLi9ndWxwLmNsZWFuJztcbmV4cG9ydCB7IHRhc2tTZW8gYXMgYXV0b1NlbyB9IGZyb20gJy4vZ3VscC5zZW8nO1xuZXhwb3J0IHsgZ2VuZXJhdGVTaXRlbWFwLCBoZXhvR2VuZXJhdGVTaXRlbWFwIH0gZnJvbSAnLi9ndWxwLnNpdGVtYXAnO1xuZXhwb3J0IHsgZGVmYXVsdCBhcyBzdGFuZGFsb25lUnVubmVyIH0gZnJvbSAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuZXhwb3J0IHsgY29tbWl0UHJvamVjdCwgZGVmYXVsdCBhcyBndWxwIH0gZnJvbSAnLi9ndWxwZmlsZSc7XG5leHBvcnQgeyBjb3B5QWxsUG9zdHMsIGNvcHlTaW5nbGVQb3N0IH0gZnJvbSAnLi9wb3N0L2NvcHknO1xuZXhwb3J0IHsgdXBkYXRlUG9zdCB9IGZyb20gJy4vcG9zdC91cGRhdGUnO1xuZXhwb3J0IHsgYXJyYXlfcmFuZG9tLCBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuZXhwb3J0IHsgbm9vcCB9IGZyb20gJy4vdXRpbHMvbm9vcCc7XG5leHBvcnQgeyBkZWZhdWx0IGFzIHNjaGVkdWxlciB9IGZyb20gJy4vdXRpbHMvc2NoZWR1bGVyJztcbmV4cG9ydCB7IGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnLCBzZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vL1xuIl0sInZlcnNpb24iOjN9","originalCode":"export { default as Application } from './api';\nexport { default as gulpCached } from './gulp-utils/gulp.cache';\nexport { default as gulpDebug } from './gulp-utils/gulp.debug';\nexport { cleanDb, del, del as deleteDir } from './gulp.clean';\nexport { taskSeo as autoSeo } from './gulp.seo';\nexport { generateSitemap, hexoGenerateSitemap } from './gulp.sitemap';\nexport { default as standaloneRunner } from './gulp.standalone';\nexport { commitProject, default as gulp } from './gulpfile';\nexport { copyAllPosts, copySinglePost } from './post/copy';\nexport { updatePost } from './post/update';\nexport { array_random, array_remove_empty, array_unique } from './utils/array';\nexport { noop } from './utils/noop';\nexport { default as scheduler } from './utils/scheduler';\nexport { deployConfig, getConfig, setConfig } from './_config';\n\n//\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/11/index_11ca8584e92c62acbf7dbcbf146ed11f.map","wrapperLength":82},"result":{"scriptId":"12692","url":"D:\\Repositories\\static-blog-generator\\src\\index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":6665,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":6662,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":210,"endOffset":230,"count":0}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":904,"endOffset":958,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1088,"endOffset":1149,"count":1}],"isBlockCoverage":true},{"functionName":"get","ranges":[{"startOffset":1278,"endOffset":1339,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1455,"endOffset":1499,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1567,"endOffset":1607,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1681,"endOffset":1721,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":1833,"endOffset":1875,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2003,"endOffset":2057,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2141,"endOffset":2199,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2334,"endOffset":2400,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2518,"endOffset":2566,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2635,"endOffset":2694,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2808,"endOffset":2851,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":2930,"endOffset":2975,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3091,"endOffset":3134,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3251,"endOffset":3295,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3378,"endOffset":3428,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3505,"endOffset":3549,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3656,"endOffset":3691,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3813,"endOffset":3873,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":3988,"endOffset":4034,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4108,"endOffset":4151,"count":0}],"isBlockCoverage":false},{"functionName":"get","ranges":[{"startOffset":4225,"endOffset":4268,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar upath_1 = require(\"upath\");\nvar cleaner = __importStar(require(\"./gulp.clean\"));\nvar gulp_deploy_1 = require(\"./gulp.deploy\");\nvar gulp_safelink_1 = require(\"./gulp.safelink\");\nvar gulp_seo_1 = require(\"./gulp.seo\");\nvar gulp_standalone_1 = __importDefault(require(\"./gulp.standalone\"));\nvar pcopy = __importStar(require(\"./post/copy\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar scheduler_1 = __importDefault(require(\"./utils/scheduler\"));\nvar _config_1 = require(\"./_config\");\nvar SBG = /** @class */ (function () {\n    /**\n     * Static blog generator\n     * @param cwd base folder\n     */\n    function SBG(cwd, options) {\n        var _this = this;\n        this.config = {};\n        this.setConfig = _config_1.setConfig;\n        this.getConfig = _config_1.getConfig;\n        /**\n         * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n         * @returns\n         */\n        this.standalone = function () { return (0, gulp_standalone_1.default)(); };\n        /**\n         * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.seo = function () { return (0, gulp_seo_1.taskSeo)(null, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        /**\n         * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n         * @returns\n         */\n        this.safelink = function () { return (0, gulp_safelink_1.taskSafelink)(noop_1.default, (0, upath_1.join)(_this.cwd, (0, _config_1.getConfig)().public_dir)); };\n        if (!cwd)\n            cwd = process.cwd();\n        if (!options)\n            options = (0, _config_1.getConfig)();\n        this.cwd = cwd;\n        options.cwd = cwd;\n        this.config = this.setConfig(options);\n        SBG.setApi(this);\n        new scheduler_1.default();\n    }\n    SBG.setApi = function (api) {\n        this.currentApI = api;\n    };\n    SBG.getApi = function () {\n        return this.currentApI;\n    };\n    /**\n     * Copy all **src-post** to **source/_posts** (run before generate)\n     * * see the method {@link pcopy.copyAllPosts}\n     * @returns\n     */\n    SBG.prototype.copy = function () {\n        return new bluebird_1.default(function (resolve, reject) {\n            pcopy\n                .copyAllPosts()\n                .once('end', function () { return resolve(); })\n                .once('error', reject);\n        });\n    };\n    /**\n     * generate site with hexo\n     */\n    SBG.prototype.generate = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var hexo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        hexo = new hexo_1.default(this.cwd);\n                        // hexo init\n                        return [4 /*yield*/, hexo.init().catch(noop_1.default)];\n                    case 1:\n                        // hexo init\n                        _a.sent();\n                        return [4 /*yield*/, hexo.load().catch(noop_1.default)];\n                    case 2:\n                        _a.sent();\n                        // hexo generate\n                        return [4 /*yield*/, hexo.call('generate').catch(noop_1.default)];\n                    case 3:\n                        // hexo generate\n                        _a.sent();\n                        return [4 /*yield*/, hexo.exit()];\n                    case 4:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    SBG.prototype.deploy = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var config, github;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: \n                    // run generate task\n                    return [4 /*yield*/, this.generate()];\n                    case 1:\n                        // run generate task\n                        _a.sent();\n                        // copy generated files to deployment directory\n                        return [4 /*yield*/, (0, gulp_deploy_1.asyncCopyGen)()];\n                    case 2:\n                        // copy generated files to deployment directory\n                        _a.sent();\n                        config = (0, _config_1.getConfig)();\n                        github = config.deploy.github;\n                        if (!github)\n                            return [2 /*return*/];\n                        return [4 /*yield*/, github.init().catch(noop_1.default)];\n                    case 3:\n                        _a.sent();\n                        return [4 /*yield*/, github.setremote(config.repo).catch(noop_1.default)];\n                    case 4:\n                        _a.sent();\n                        return [4 /*yield*/, github.setuser(config.username).catch(noop_1.default)];\n                    case 5:\n                        _a.sent();\n                        return [4 /*yield*/, github.setemail(config.email).catch(noop_1.default)];\n                    case 6:\n                        _a.sent();\n                        return [4 /*yield*/, github.setbranch(config.branch).catch(noop_1.default)];\n                    case 7:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * clean cache, auto generated posts, etc\n     * @see {@link cleaner.cleanDb}\n     * @see {@link cleaner.cleanOldArchives}\n     */\n    SBG.prototype.clean = function (opt) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(opt === 'all')) return [3 /*break*/, 3];\n                        return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 2:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 3:\n                        if (!(opt === 'archives')) return [3 /*break*/, 5];\n                        return [4 /*yield*/, cleaner.cleanOldArchives().catch(console.log)];\n                    case 4:\n                        _a.sent();\n                        return [3 /*break*/, 7];\n                    case 5: return [4 /*yield*/, cleaner.cleanDb().catch(console.log)];\n                    case 6:\n                        _a.sent();\n                        _a.label = 7;\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return SBG;\n}());\nexports.default = SBG;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGFwaS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLDhDQUF3QjtBQUN4QiwrQkFBNkI7QUFFN0Isb0RBQXdDO0FBQ3hDLDZDQUE2QztBQUM3QyxpREFBK0M7QUFDL0MsdUNBQXFDO0FBQ3JDLHNFQUFpRDtBQUNqRCxpREFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLGdFQUEwQztBQUMxQyxxQ0FBaUQ7QUFFakQ7SUFNRTs7O09BR0c7SUFDSCxhQUFZLEdBQXFCLEVBQUUsT0FBeUM7UUFBNUUsaUJBUUM7UUFoQkQsV0FBTSxHQUFHLEVBQWtDLENBQUM7UUFDNUMsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUFDdEIsY0FBUyxHQUFHLG1CQUFTLENBQUM7UUF3QnRCOzs7V0FHRztRQUNILGVBQVUsR0FBRyxjQUFNLE9BQUEsSUFBQSx5QkFBZ0IsR0FBRSxFQUFsQixDQUFrQixDQUFDO1FBRXRDOzs7V0FHRztRQUNILFFBQUcsR0FBRyxjQUFNLE9BQUEsSUFBQSxrQkFBTyxFQUFDLElBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQXJELENBQXFELENBQUM7UUFnQmxFOzs7V0FHRztRQUNILGFBQVEsR0FBRyxjQUFNLE9BQUEsSUFBQSw0QkFBWSxFQUFDLGNBQUksRUFBRSxJQUFBLFlBQUksRUFBQyxLQUFJLENBQUMsR0FBRyxFQUFFLElBQUEsbUJBQVMsR0FBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQTFELENBQTBELENBQUM7UUEvQzFFLElBQUksQ0FBQyxHQUFHO1lBQUUsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsT0FBTztZQUFFLE9B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QUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBSSxDQUFDLEVBQUE7O3dCQUFqRCxTQUFpRCxDQUFDOzs7OztLQUNuRDtJQUVEOzs7O09BSUc7SUFDRyxtQkFBSyxHQUFYLFVBQVksR0FBcUM7Ozs7OzZCQUMzQyxDQUFBLEdBQUcsS0FBSyxLQUFLLENBQUEsRUFBYix3QkFBYTt3QkFDZixxQkFBTSxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBQTs7d0JBQTFDLFNBQTBDLENBQUM7d0JBQzNDLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs7NkJBQzNDLENBQUEsR0FBRyxLQUFLLFVBQVUsQ0FBQSxFQUFsQix3QkFBa0I7d0JBQzNCLHFCQUFNLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUFuRCxTQUFtRCxDQUFDOzs0QkFFcEQscUJBQU0sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUE7O3dCQUExQyxTQUEwQyxDQUFDOzs7Ozs7S0FFOUM7SUFDSCxVQUFDO0FBQUQsQ0FBQyxBQXhHRCxJQXdHQztBQUVELGtCQUFlLEdBQUcsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcYXBpLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgSGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyBOdWxsYWJsZSB9IGZyb20gJy4vZ2xvYmFscyc7XG5pbXBvcnQgKiBhcyBjbGVhbmVyIGZyb20gJy4vZ3VscC5jbGVhbic7XG5pbXBvcnQgeyBhc3luY0NvcHlHZW4gfSBmcm9tICcuL2d1bHAuZGVwbG95JztcbmltcG9ydCB7IHRhc2tTYWZlbGluayB9IGZyb20gJy4vZ3VscC5zYWZlbGluayc7XG5pbXBvcnQgeyB0YXNrU2VvIH0gZnJvbSAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgc3RhbmRhbG9uZVJ1bm5lciBmcm9tICcuL2d1bHAuc3RhbmRhbG9uZSc7XG5pbXBvcnQgKiBhcyBwY29weSBmcm9tICcuL3Bvc3QvY29weSc7XG5pbXBvcnQgbm9vcCBmcm9tICcuL3V0aWxzL25vb3AnO1xuaW1wb3J0IHNjaGVkdWxlciBmcm9tICcuL3V0aWxzL3NjaGVkdWxlcic7XG5pbXBvcnQgeyBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbmNsYXNzIFNCRyB7XG4gIGN3ZDogc3RyaW5nO1xuICBjb25maWcgPSB7fSBhcyBSZXR1cm5UeXBlPHR5cGVvZiBnZXRDb25maWc+O1xuICBzZXRDb25maWcgPSBzZXRDb25maWc7XG4gIGdldENvbmZpZyA9IGdldENvbmZpZztcblxuICAvKipcbiAgICogU3RhdGljIGJsb2cgZ2VuZXJhdG9yXG4gICAqIEBwYXJhbSBjd2QgYmFzZSBmb2xkZXJcbiAgICovXG4gIGNvbnN0cnVjdG9yKGN3ZDogTnVsbGFibGU8c3RyaW5nPiwgb3B0aW9ucz86IFBhcmFtZXRlcnM8dHlwZW9mIHNldENvbmZpZz5bMF0pIHtcbiAgICBpZiAoIWN3ZCkgY3dkID0gcHJvY2Vzcy5jd2QoKTtcbiAgICBpZiAoIW9wdGlvbnMpIG9wdGlvbnMgPSBnZXRDb25maWcoKTtcbiAgICB0aGlzLmN3ZCA9IGN3ZDtcbiAgICBvcHRpb25zLmN3ZCA9IGN3ZDtcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMuc2V0Q29uZmlnKG9wdGlvbnMpO1xuICAgIFNCRy5zZXRBcGkodGhpcyk7XG4gICAgbmV3IHNjaGVkdWxlcigpO1xuICB9XG5cbiAgc3RhdGljIGN1cnJlbnRBcEk6IFNCRztcbiAgc3RhdGljIHNldEFwaShhcGk6IFNCRykge1xuICAgIHRoaXMuY3VycmVudEFwSSA9IGFwaTtcbiAgfVxuICBzdGF0aWMgZ2V0QXBpKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRBcEk7XG4gIH1cblxuICAvKipcbiAgICogcnVuIGZpbGVzIGVuZHMgd2l0aCBgc3RhbmRhbG9uZS5qc2AgaW5zaWRlIHNvdXJjZSBwb3N0cyB7QGxpbmsgc3RhbmRhbG9uZVJ1bm5lcn1cbiAgICogQHJldHVybnNcbiAgICovXG4gIHN0YW5kYWxvbmUgPSAoKSA9PiBzdGFuZGFsb25lUnVubmVyKCk7XG5cbiAgLyoqXG4gICAqIEF1dG8gc2VvIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2VvID0gKCkgPT4gdGFza1NlbyhudWxsLCBqb2luKHRoaXMuY3dkLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKSk7XG5cbiAgLyoqXG4gICAqIENvcHkgYWxsICoqc3JjLXBvc3QqKiB0byAqKnNvdXJjZS9fcG9zdHMqKiAocnVuIGJlZm9yZSBnZW5lcmF0ZSlcbiAgICogKiBzZWUgdGhlIG1ldGhvZCB7QGxpbmsgcGNvcHkuY29weUFsbFBvc3RzfVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29weSgpIHtcbiAgICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlOiAoKSA9PiBhbnksIHJlamVjdDogKGVycjogRXJyb3IpID0+IGFueSkgPT4ge1xuICAgICAgcGNvcHlcbiAgICAgICAgLmNvcHlBbGxQb3N0cygpXG4gICAgICAgIC5vbmNlKCdlbmQnLCAoKSA9PiByZXNvbHZlKCkpXG4gICAgICAgIC5vbmNlKCdlcnJvcicsIHJlamVjdCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQW5vbnltaXplIGV4dGVybmFsIGxpbmtzIG9uIHB1YmxpYyBkaXIgKF9jb25maWdfeW1sLnB1YmxpY19kaXIpIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgc2FmZWxpbmsgPSAoKSA9PiB0YXNrU2FmZWxpbmsobm9vcCwgam9pbih0aGlzLmN3ZCwgZ2V0Q29uZmlnKCkucHVibGljX2RpcikpO1xuXG4gIC8qKlxuICAgKiBnZW5lcmF0ZSBzaXRlIHdpdGggaGV4b1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGUoKSB7XG4gICAgY29uc3QgaGV4byA9IG5ldyBIZXhvKHRoaXMuY3dkKTtcbiAgICAvLyBoZXhvIGluaXRcbiAgICBhd2FpdCBoZXhvLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBoZXhvLmxvYWQoKS5jYXRjaChub29wKTtcbiAgICAvLyBoZXhvIGdlbmVyYXRlXG4gICAgYXdhaXQgaGV4by5jYWxsKCdnZW5lcmF0ZScpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGhleG8uZXhpdCgpO1xuICB9XG5cbiAgYXN5bmMgZGVwbG95KCkge1xuICAgIC8vIHJ1biBnZW5lcmF0ZSB0YXNrXG4gICAgYXdhaXQgdGhpcy5nZW5lcmF0ZSgpO1xuICAgIC8vIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIHRvIGRlcGxveW1lbnQgZGlyZWN0b3J5XG4gICAgYXdhaXQgYXN5bmNDb3B5R2VuKCk7XG4gICAgLy8gZGVwbG95bWVudCBzdGFydFxuICAgIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBjb25maWcuZGVwbG95O1xuICAgIGlmICghZ2l0aHViKSByZXR1cm47XG4gICAgYXdhaXQgZ2l0aHViLmluaXQoKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0cmVtb3RlKGNvbmZpZy5yZXBvKS5jYXRjaChub29wKTtcbiAgICBhd2FpdCBnaXRodWIuc2V0dXNlcihjb25maWcudXNlcm5hbWUpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRlbWFpbChjb25maWcuZW1haWwpLmNhdGNoKG5vb3ApO1xuICAgIGF3YWl0IGdpdGh1Yi5zZXRicmFuY2goY29uZmlnLmJyYW5jaCkuY2F0Y2gobm9vcCk7XG4gIH1cblxuICAvKipcbiAgICogY2xlYW4gY2FjaGUsIGF1dG8gZ2VuZXJhdGVkIHBvc3RzLCBldGNcbiAgICogQHNlZSB7QGxpbmsgY2xlYW5lci5jbGVhbkRifVxuICAgKiBAc2VlIHtAbGluayBjbGVhbmVyLmNsZWFuT2xkQXJjaGl2ZXN9XG4gICAqL1xuICBhc3luYyBjbGVhbihvcHQ/OiAnYWxsJyB8ICdhcmNoaXZlcycgfCAnZGF0YWJhc2UnKSB7XG4gICAgaWYgKG9wdCA9PT0gJ2FsbCcpIHtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5EYigpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICAgIGF3YWl0IGNsZWFuZXIuY2xlYW5PbGRBcmNoaXZlcygpLmNhdGNoKGNvbnNvbGUubG9nKTtcbiAgICB9IGVsc2UgaWYgKG9wdCA9PT0gJ2FyY2hpdmVzJykge1xuICAgICAgYXdhaXQgY2xlYW5lci5jbGVhbk9sZEFyY2hpdmVzKCkuY2F0Y2goY29uc29sZS5sb2cpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBjbGVhbmVyLmNsZWFuRGIoKS5jYXRjaChjb25zb2xlLmxvZyk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNCRztcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import Bluebird from 'bluebird';\nimport Hexo from 'hexo';\nimport { join } from 'upath';\nimport { Nullable } from './globals';\nimport * as cleaner from './gulp.clean';\nimport { asyncCopyGen } from './gulp.deploy';\nimport { taskSafelink } from './gulp.safelink';\nimport { taskSeo } from './gulp.seo';\nimport standaloneRunner from './gulp.standalone';\nimport * as pcopy from './post/copy';\nimport noop from './utils/noop';\nimport scheduler from './utils/scheduler';\nimport { getConfig, setConfig } from './_config';\n\nclass SBG {\n  cwd: string;\n  config = {} as ReturnType<typeof getConfig>;\n  setConfig = setConfig;\n  getConfig = getConfig;\n\n  /**\n   * Static blog generator\n   * @param cwd base folder\n   */\n  constructor(cwd: Nullable<string>, options?: Parameters<typeof setConfig>[0]) {\n    if (!cwd) cwd = process.cwd();\n    if (!options) options = getConfig();\n    this.cwd = cwd;\n    options.cwd = cwd;\n    this.config = this.setConfig(options);\n    SBG.setApi(this);\n    new scheduler();\n  }\n\n  static currentApI: SBG;\n  static setApi(api: SBG) {\n    this.currentApI = api;\n  }\n  static getApi() {\n    return this.currentApI;\n  }\n\n  /**\n   * run files ends with `standalone.js` inside source posts {@link standaloneRunner}\n   * @returns\n   */\n  standalone = () => standaloneRunner();\n\n  /**\n   * Auto seo on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  seo = () => taskSeo(null, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * Copy all **src-post** to **source/_posts** (run before generate)\n   * * see the method {@link pcopy.copyAllPosts}\n   * @returns\n   */\n  copy() {\n    return new Bluebird((resolve: () => any, reject: (err: Error) => any) => {\n      pcopy\n        .copyAllPosts()\n        .once('end', () => resolve())\n        .once('error', reject);\n    });\n  }\n\n  /**\n   * Anonymize external links on public dir (_config_yml.public_dir) (run after generated)\n   * @returns\n   */\n  safelink = () => taskSafelink(noop, join(this.cwd, getConfig().public_dir));\n\n  /**\n   * generate site with hexo\n   */\n  async generate() {\n    const hexo = new Hexo(this.cwd);\n    // hexo init\n    await hexo.init().catch(noop);\n    await hexo.load().catch(noop);\n    // hexo generate\n    await hexo.call('generate').catch(noop);\n    await hexo.exit();\n  }\n\n  async deploy() {\n    // run generate task\n    await this.generate();\n    // copy generated files to deployment directory\n    await asyncCopyGen();\n    // deployment start\n    const config = getConfig();\n    const { github } = config.deploy;\n    if (!github) return;\n    await github.init().catch(noop);\n    await github.setremote(config.repo).catch(noop);\n    await github.setuser(config.username).catch(noop);\n    await github.setemail(config.email).catch(noop);\n    await github.setbranch(config.branch).catch(noop);\n  }\n\n  /**\n   * clean cache, auto generated posts, etc\n   * @see {@link cleaner.cleanDb}\n   * @see {@link cleaner.cleanOldArchives}\n   */\n  async clean(opt?: 'all' | 'archives' | 'database') {\n    if (opt === 'all') {\n      await cleaner.cleanDb().catch(console.log);\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else if (opt === 'archives') {\n      await cleaner.cleanOldArchives().catch(console.log);\n    } else {\n      await cleaner.cleanDb().catch(console.log);\n    }\n  }\n}\n\nexport default SBG;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/27/api_27977693f3bb9acc653b3d92027b188c.map","wrapperLength":82},"result":{"scriptId":"12693","url":"D:\\Repositories\\static-blog-generator\\src\\api.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":20115,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":20112,"count":1},{"startOffset":489,"endOffset":570,"count":0},{"startOffset":746,"endOffset":788,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":170,"endOffset":487,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":492,"endOffset":569,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":653,"endOffset":744,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__setModuleDefault","ranges":[{"startOffset":748,"endOffset":788,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importStar","ranges":[{"startOffset":841,"endOffset":1121,"count":2},{"startOffset":900,"endOffset":1120,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":1167,"endOffset":1802,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":1218,"endOffset":1326,"count":1},{"startOffset":1276,"endOffset":1323,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1284,"endOffset":1322,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":1363,"endOffset":1798,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":1400,"endOffset":1491,"count":1},{"startOffset":1465,"endOffset":1489,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":1500,"endOffset":1594,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":1603,"endOffset":1713,"count":2},{"startOffset":1639,"endOffset":1662,"count":1},{"startOffset":1663,"endOffset":1710,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":1852,"endOffset":3625,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":1909,"endOffset":1962,"count":1},{"startOffset":1936,"endOffset":1947,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":2122,"endOffset":2149,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":2159,"endOffset":2225,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":2185,"endOffset":2222,"count":2}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":2230,"endOffset":3623,"count":2},{"startOffset":2265,"endOffset":2320,"count":0},{"startOffset":2338,"endOffset":2366,"count":1},{"startOffset":2355,"endOffset":2365,"count":0},{"startOffset":2371,"endOffset":3527,"count":6},{"startOffset":2402,"endOffset":2503,"count":0},{"startOffset":2504,"endOffset":2535,"count":0},{"startOffset":2537,"endOffset":2546,"count":0},{"startOffset":2573,"endOffset":2599,"count":0},{"startOffset":2645,"endOffset":2652,"count":2},{"startOffset":2653,"endOffset":2675,"count":2},{"startOffset":2692,"endOffset":2748,"count":1},{"startOffset":2765,"endOffset":2814,"count":0},{"startOffset":2831,"endOffset":2880,"count":0},{"startOffset":2897,"endOffset":3406,"count":3},{"startOffset":2961,"endOffset":2979,"count":0},{"startOffset":3014,"endOffset":3034,"count":1},{"startOffset":3034,"endOffset":3112,"count":2},{"startOffset":3078,"endOffset":3111,"count":0},{"startOffset":3114,"endOffset":3141,"count":2},{"startOffset":3141,"endOffset":3195,"count":0},{"startOffset":3197,"endOffset":3275,"count":0},{"startOffset":3277,"endOffset":3406,"count":0},{"startOffset":3420,"endOffset":3471,"count":4},{"startOffset":3471,"endOffset":3504,"count":0},{"startOffset":3504,"endOffset":3505,"count":4},{"startOffset":3527,"endOffset":3551,"count":1},{"startOffset":3551,"endOffset":3563,"count":0},{"startOffset":3563,"endOffset":3593,"count":1},{"startOffset":3594,"endOffset":3602,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3683,"endOffset":3764,"count":5},{"startOffset":3735,"endOffset":3740,"count":3},{"startOffset":3741,"endOffset":3761,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4456,"endOffset":10810,"count":1}],"isBlockCoverage":true},{"functionName":"SBG","ranges":[{"startOffset":4549,"endOffset":5806,"count":1},{"startOffset":5549,"endOffset":5569,"count":0},{"startOffset":5604,"endOffset":5641,"count":0}],"isBlockCoverage":true},{"functionName":"SBG.standalone","ranges":[{"startOffset":4884,"endOffset":4940,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.seo","ranges":[{"startOffset":5086,"endOffset":5208,"count":0}],"isBlockCoverage":false},{"functionName":"SBG.safelink","ranges":[{"startOffset":5375,"endOffset":5517,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.setApi","ranges":[{"startOffset":5824,"endOffset":5877,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.getApi","ranges":[{"startOffset":5896,"endOffset":5947,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.copy","ranges":[{"startOffset":6129,"endOffset":6381,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6181,"endOffset":6373,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6289,"endOffset":6322,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.SBG.generate","ranges":[{"startOffset":6459,"endOffset":7552,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.deploy","ranges":[{"startOffset":7581,"endOffset":9402,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.SBG.clean","ranges":[{"startOffset":9573,"endOffset":10791,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9637,"endOffset":10783,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":9688,"endOffset":10771,"count":4},{"startOffset":9760,"endOffset":9922,"count":1},{"startOffset":9838,"endOffset":9922,"count":0},{"startOffset":9943,"endOffset":10078,"count":0},{"startOffset":10099,"endOffset":10190,"count":0},{"startOffset":10211,"endOffset":10387,"count":1},{"startOffset":10294,"endOffset":10387,"count":0},{"startOffset":10408,"endOffset":10499,"count":0},{"startOffset":10520,"endOffset":10587,"count":1},{"startOffset":10608,"endOffset":10688,"count":1},{"startOffset":10709,"endOffset":10739,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cleanGeneratedPosts = exports.cleanOldArchives = exports.del = exports.cleanDb = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar os_1 = require(\"os\");\nvar upath_1 = require(\"upath\");\nvar util_1 = require(\"util\");\nvar debug_1 = __importDefault(require(\"./utils/debug\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Clean Project Databases\n */\nfunction cleanDb(callback, files) {\n    return __awaiter(this, void 0, void 0, function () {\n        var log, config, dirs, i, dir, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    log = (0, debug_1.default)('clean');\n                    config = (0, _config_1.getConfig)();\n                    if (typeof config.source_dir !== 'string') {\n                        (0, fm_1.writefile)((0, upath_1.join)(config.cwd, 'tmp/errors/clean.log'), (0, util_1.inspect)(config));\n                        throw new Error('config.source_dir must be configured');\n                    }\n                    dirs = [\n                        (0, upath_1.join)(config.cwd, config.source_dir, '_posts'),\n                        (0, upath_1.join)(config.cwd, 'tmp/cache'),\n                        (0, upath_1.join)(config.cwd, 'tmp/dump'),\n                        (0, upath_1.join)(config.cwd, 'tmp/logs'),\n                        (0, upath_1.join)(config.cwd, 'db.json')\n                    ];\n                    if (Array.isArray(files))\n                        dirs = dirs.concat(files);\n                    i = 0;\n                    _b.label = 1;\n                case 1:\n                    if (!(i < dirs.length)) return [3 /*break*/, 7];\n                    dir = dirs[i];\n                    _b.label = 2;\n                case 2:\n                    _b.trys.push([2, 5, , 6]);\n                    if (!(0, fs_extra_1.existsSync)(dir)) return [3 /*break*/, 4];\n                    log('claning', dir);\n                    return [4 /*yield*/, del(dir)];\n                case 3:\n                    _b.sent();\n                    _b.label = 4;\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    _a = _b.sent();\n                    log('cannot delete', dir);\n                    return [3 /*break*/, 6];\n                case 6:\n                    i++;\n                    return [3 /*break*/, 1];\n                case 7:\n                    /*const hexo = new hexoLib(config.cwd);\n                    await hexo.init().catch(noop);\n                    await hexo.call('clean').catch(noop);*/\n                    if (typeof callback === 'function')\n                        return [2 /*return*/, callback()];\n                    return [2 /*return*/, undefined];\n            }\n        });\n    });\n}\nexports.cleanDb = cleanDb;\n/**\n * delete folder async\n * @param path\n * @returns\n */\nfunction del(path) {\n    return new bluebird_1.default(function (resolve) {\n        var rmOpt = { recursive: true, force: true };\n        if ((0, fs_extra_1.existsSync)(path)) {\n            (0, fs_extra_1.rm)(path, rmOpt).then(resolve).catch(resolve);\n            /*if (statSync(path).isDirectory()) {\n              rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n            } else {\n              rm(path, rmOpt).then(resolve).catch(resolve);\n            }*/\n        }\n        else {\n            resolve(new Error(path + ' not found'));\n        }\n    });\n}\nexports.del = del;\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nfunction cleanOldArchives(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, logname, archives, categories, tags, folders, langDir, pagesDir, pages, promises, dumpfile, i, pathStr, finishNow;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    logname = 'clean:' + ansi_colors_1.default.grey('archives');\n                    archives = (0, upath_1.join)(config.deploy.deployDir, config.archive_dir);\n                    categories = (0, upath_1.join)(config.deploy.deployDir, config.category_dir);\n                    tags = (0, upath_1.join)(config.deploy.deployDir, config.tag_dir);\n                    folders = [archives, tags, categories].filter(function (str) { return (0, fs_extra_1.existsSync)(str); });\n                    // push language folder to be deleted from deploy dir\n                    if (Array.isArray(config.language)) {\n                        langDir = config.language.map(function (path) { return (0, upath_1.join)(config.deploy.deployDir, path); });\n                        folders.push.apply(folders, __spreadArray([], __read(langDir), false));\n                    }\n                    else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n                        folders.push((0, upath_1.join)(config.deploy.deployDir, String(config.language)));\n                    }\n                    pagesDir = (0, upath_1.join)(config.deploy.deployDir, 'page');\n                    if (!(0, fs_extra_1.existsSync)(pagesDir)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, fs_extra_1.readdir)(pagesDir)];\n                case 1:\n                    pages = (_a.sent()).filter(function (str) { return /^\\d+$/.test(str); }).map(function (str) { return (0, upath_1.join)(pagesDir, str); });\n                    folders.push.apply(folders, __spreadArray([], __read(pages), false));\n                    _a.label = 2;\n                case 2:\n                    promises = [];\n                    dumpfile = (0, upath_1.join)(process.cwd(), 'tmp/dump/clean.txt');\n                    (0, fm_1.writefile)(dumpfile, folders.join(os_1.EOL));\n                    logger_1.default.log(logname, 'list deleted files', dumpfile);\n                    for (i = 0; i < folders.length; i++) {\n                        pathStr = folders[i];\n                        try {\n                            if ((0, fs_extra_1.existsSync)(pathStr))\n                                promises.push(del(pathStr).catch(noop_1.default));\n                        }\n                        catch (_b) {\n                            //\n                        }\n                    }\n                    finishNow = function (e) {\n                        if (e instanceof Error) {\n                            console.log('clean archives has some erros');\n                        }\n                        if (typeof callback === 'function')\n                            callback();\n                        return undefined;\n                    };\n                    return [4 /*yield*/, bluebird_1.default.all(promises).then(finishNow).catch(finishNow)];\n                case 3:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.cleanOldArchives = cleanOldArchives;\nfunction cleanGeneratedPosts(callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config;\n        return __generator(this, function (_a) {\n            config = (0, _config_1.getConfig)();\n            return [2 /*return*/, cleanDb(callback, [(0, upath_1.join)(config.cwd, config.source_dir, '_posts')])];\n        });\n    });\n}\nexports.cleanGeneratedPosts = cleanGeneratedPosts;\ngulp_1.default.task('clean:archive', cleanOldArchives);\ngulp_1.default.task('clean:db', cleanDb);\ngulp_1.default.task('clean:post', cleanGeneratedPosts);\ngulp_1.default.task('clean:all', gulp_1.default.series('clean:db', 'clean:archive'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuY2xlYW4udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyxzREFBZ0M7QUFDaEMscUNBQThEO0FBQzlELDhDQUF3QjtBQUN4Qix5QkFBeUI7QUFDekIsK0JBQTZCO0FBQzdCLDZCQUErQjtBQUMvQix3REFBa0M7QUFDbEMsaUNBQXVDO0FBQ3ZDLDBEQUFvQztBQUNwQyxzREFBZ0M7QUFDaEMscUNBQXNDO0FBRXRDOztHQUVHO0FBQ0gsU0FBc0IsT0FBTyxDQUFDLFFBQWtELEVBQUUsS0FBZ0I7Ozs7OztvQkFDMUYsR0FBRyxHQUFHLElBQUEsZUFBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUNyQixNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7b0JBQzNCLElBQUksT0FBTyxNQUFNLENBQUMsVUFBVSxLQUFLLFFBQVEsRUFBRTt3QkFDekMsSUFBQSxjQUFTLEVBQUMsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxzQkFBc0IsQ0FBQyxFQUFFLElBQUEsY0FBTyxFQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7d0JBQ3JFLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztxQkFDekQ7b0JBSUcsSUFBSSxHQUFHO3dCQUNULElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUM7d0JBQzdDLElBQUEsWUFBSSxFQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsV0FBVyxDQUFDO3dCQUM3QixJQUFBLFlBQUksRUFBQyxNQUFNLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQzt3QkFDNUIsSUFBQSxZQUFJLEVBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUM7d0JBQzVC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QUFDN0MsY0FBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDL0IsY0FBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUM3QyxjQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLmNsZWFuLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCByZWFkZGlyLCBybSwgUm1PcHRpb25zIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IGRlYnVnIGZyb20gJy4vdXRpbHMvZGVidWcnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgeyBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIENsZWFuIFByb2plY3QgRGF0YWJhc2VzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhbkRiKGNhbGxiYWNrPzogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjayB8ICgoKSA9PiBhbnkpLCBmaWxlcz86IHN0cmluZ1tdKSB7XG4gIGNvbnN0IGxvZyA9IGRlYnVnKCdjbGVhbicpO1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgaWYgKHR5cGVvZiBjb25maWcuc291cmNlX2RpciAhPT0gJ3N0cmluZycpIHtcbiAgICB3cml0ZWZpbGUoam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9jbGVhbi5sb2cnKSwgaW5zcGVjdChjb25maWcpKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbmZpZy5zb3VyY2VfZGlyIG11c3QgYmUgY29uZmlndXJlZCcpO1xuICB9XG5cbiAgLy8gY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG5cbiAgbGV0IGRpcnMgPSBbXG4gICAgam9pbihjb25maWcuY3dkLCBjb25maWcuc291cmNlX2RpciwgJ19wb3N0cycpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9jYWNoZScpLFxuICAgIGpvaW4oY29uZmlnLmN3ZCwgJ3RtcC9kdW1wJyksXG4gICAgam9pbihjb25maWcuY3dkLCAndG1wL2xvZ3MnKSxcbiAgICBqb2luKGNvbmZpZy5jd2QsICdkYi5qc29uJylcbiAgXTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZmlsZXMpKSBkaXJzID0gZGlycy5jb25jYXQoZmlsZXMpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBkaXIgPSBkaXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICAgIGxvZygnY2xhbmluZycsIGRpcik7XG4gICAgICAgIGF3YWl0IGRlbChkaXIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2gge1xuICAgICAgbG9nKCdjYW5ub3QgZGVsZXRlJywgZGlyKTtcbiAgICB9XG4gIH1cblxuICAvKmNvbnN0IGhleG8gPSBuZXcgaGV4b0xpYihjb25maWcuY3dkKTtcbiAgYXdhaXQgaGV4by5pbml0KCkuY2F0Y2gobm9vcCk7XG4gIGF3YWl0IGhleG8uY2FsbCgnY2xlYW4nKS5jYXRjaChub29wKTsqL1xuXG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHJldHVybiBjYWxsYmFjaygpO1xuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogZGVsZXRlIGZvbGRlciBhc3luY1xuICogQHBhcmFtIHBhdGhcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWwocGF0aDogc3RyaW5nKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBybU9wdDogUm1PcHRpb25zID0geyByZWN1cnNpdmU6IHRydWUsIGZvcmNlOiB0cnVlIH07XG4gICAgaWYgKGV4aXN0c1N5bmMocGF0aCkpIHtcbiAgICAgIHJtKHBhdGgsIHJtT3B0KS50aGVuKHJlc29sdmUpLmNhdGNoKHJlc29sdmUpO1xuICAgICAgLyppZiAoc3RhdFN5bmMocGF0aCkuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICBybWRpcihwYXRoLCB7IG1heFJldHJpZXM6IDEwIH0pLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVzb2x2ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBybShwYXRoLCBybU9wdCkudGhlbihyZXNvbHZlKS5jYXRjaChyZXNvbHZlKTtcbiAgICAgIH0qL1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlKG5ldyBFcnJvcihwYXRoICsgJyBub3QgZm91bmQnKSk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBjbGVhbiBvbGQgYXJjaGl2ZXMgKGNhdGVnb3JpZXMsIHRhZ3MsIHBhZ2luYXRpb24pIGZyb20gZGVwbG95bWVudCBkaXJlY3RvcnlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFuT2xkQXJjaGl2ZXMoY2FsbGJhY2s/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrIHwgKCgpID0+IGFueSkpIHtcbiAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGxvZ25hbWUgPSAnY2xlYW46JyArIGFuc2lDb2xvcnMuZ3JleSgnYXJjaGl2ZXMnKTtcblxuICAvLyBjbGVhbiBhcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc1xuICBjb25zdCBhcmNoaXZlcyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy5hcmNoaXZlX2Rpcik7XG4gIGNvbnN0IGNhdGVnb3JpZXMgPSBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBjb25maWcuY2F0ZWdvcnlfZGlyKTtcbiAgY29uc3QgdGFncyA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIGNvbmZpZy50YWdfZGlyKTtcbiAgY29uc3QgZm9sZGVycyA9IFthcmNoaXZlcywgdGFncywgY2F0ZWdvcmllc10uZmlsdGVyKChzdHIpID0+IGV4aXN0c1N5bmMoc3RyKSk7XG5cbiAgLy8gcHVzaCBsYW5ndWFnZSBmb2xkZXIgdG8gYmUgZGVsZXRlZCBmcm9tIGRlcGxveSBkaXJcbiAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLmxhbmd1YWdlKSkge1xuICAgIGNvbnN0IGxhbmdEaXIgPSBjb25maWcubGFuZ3VhZ2UubWFwKChwYXRoKSA9PiBqb2luKGNvbmZpZy5kZXBsb3kuZGVwbG95RGlyLCBwYXRoKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLmxhbmdEaXIpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBjb25maWcubGFuZ3VhZ2UgPT09ICdzdHJpbmcnICYmIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpLnRyaW0oKS5sZW5ndGggPiAwKSB7XG4gICAgZm9sZGVycy5wdXNoKGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsIFN0cmluZyhjb25maWcubGFuZ3VhZ2UpKSk7XG4gIH1cblxuICAvLyBkZWxldGUgcGFnaW5hdGlvblxuICBjb25zdCBwYWdlc0RpciA9IGpvaW4oY29uZmlnLmRlcGxveS5kZXBsb3lEaXIsICdwYWdlJyk7XG4gIGlmIChleGlzdHNTeW5jKHBhZ2VzRGlyKSkge1xuICAgIGNvbnN0IHBhZ2VzID0gKGF3YWl0IHJlYWRkaXIocGFnZXNEaXIpKS5maWx0ZXIoKHN0cikgPT4gL15cXGQrJC8udGVzdChzdHIpKS5tYXAoKHN0cikgPT4gam9pbihwYWdlc0Rpciwgc3RyKSk7XG4gICAgZm9sZGVycy5wdXNoKC4uLnBhZ2VzKTtcbiAgfVxuXG4gIGNvbnN0IHByb21pc2VzOiBQcm9taXNlPGFueT5bXSA9IFtdO1xuXG4gIC8vIGR1bXAgdG8gZmlsZVxuICBjb25zdCBkdW1wZmlsZSA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL2NsZWFuLnR4dCcpO1xuICB3cml0ZWZpbGUoZHVtcGZpbGUsIGZvbGRlcnMuam9pbihFT0wpKTtcbiAgTG9nZ2VyLmxvZyhsb2duYW1lLCAnbGlzdCBkZWxldGVkIGZpbGVzJywgZHVtcGZpbGUpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZm9sZGVycy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHBhdGhTdHIgPSBmb2xkZXJzW2ldO1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyhwYXRoU3RyKSkgcHJvbWlzZXMucHVzaChkZWwocGF0aFN0cikuY2F0Y2gobm9vcCkpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy9cbiAgICB9XG4gIH1cblxuICBjb25zdCBmaW5pc2hOb3cgPSBmdW5jdGlvbiAoZTogYW55KSB7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgY29uc29sZS5sb2coJ2NsZWFuIGFyY2hpdmVzIGhhcyBzb21lIGVycm9zJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIGNhbGxiYWNrKCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBhd2FpdCBCbHVlYmlyZC5hbGwocHJvbWlzZXMpLnRoZW4oZmluaXNoTm93KS5jYXRjaChmaW5pc2hOb3cpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2xlYW5HZW5lcmF0ZWRQb3N0cyhjYWxsYmFjaz86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCAoKCkgPT4gYW55KSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgcmV0dXJuIGNsZWFuRGIoY2FsbGJhY2ssIFtqb2luKGNvbmZpZy5jd2QsIGNvbmZpZy5zb3VyY2VfZGlyLCAnX3Bvc3RzJyldKTtcbn1cblxuZ3VscC50YXNrKCdjbGVhbjphcmNoaXZlJywgY2xlYW5PbGRBcmNoaXZlcyk7XG5ndWxwLnRhc2soJ2NsZWFuOmRiJywgY2xlYW5EYik7XG5ndWxwLnRhc2soJ2NsZWFuOnBvc3QnLCBjbGVhbkdlbmVyYXRlZFBvc3RzKTtcbmd1bHAudGFzaygnY2xlYW46YWxsJywgZ3VscC5zZXJpZXMoJ2NsZWFuOmRiJywgJ2NsZWFuOmFyY2hpdmUnKSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync, readdir, rm, RmOptions } from 'fs-extra';\nimport gulp from 'gulp';\nimport { EOL } from 'os';\nimport { join } from 'upath';\nimport { inspect } from 'util';\nimport debug from './utils/debug';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport { getConfig } from './_config';\n\n/**\n * Clean Project Databases\n */\nexport async function cleanDb(callback?: gulp.TaskFunctionCallback | (() => any), files?: string[]) {\n  const log = debug('clean');\n  const config = getConfig();\n  if (typeof config.source_dir !== 'string') {\n    writefile(join(config.cwd, 'tmp/errors/clean.log'), inspect(config));\n    throw new Error('config.source_dir must be configured');\n  }\n\n  // const publicDir = join(config.cwd, config.public_dir);\n\n  let dirs = [\n    join(config.cwd, config.source_dir, '_posts'),\n    join(config.cwd, 'tmp/cache'),\n    join(config.cwd, 'tmp/dump'),\n    join(config.cwd, 'tmp/logs'),\n    join(config.cwd, 'db.json')\n  ];\n  if (Array.isArray(files)) dirs = dirs.concat(files);\n  for (let i = 0; i < dirs.length; i++) {\n    const dir = dirs[i];\n    try {\n      if (existsSync(dir)) {\n        log('claning', dir);\n        await del(dir);\n      }\n    } catch {\n      log('cannot delete', dir);\n    }\n  }\n\n  /*const hexo = new hexoLib(config.cwd);\n  await hexo.init().catch(noop);\n  await hexo.call('clean').catch(noop);*/\n\n  if (typeof callback === 'function') return callback();\n\n  return undefined;\n}\n\n/**\n * delete folder async\n * @param path\n * @returns\n */\nexport function del(path: string) {\n  return new Bluebird((resolve) => {\n    const rmOpt: RmOptions = { recursive: true, force: true };\n    if (existsSync(path)) {\n      rm(path, rmOpt).then(resolve).catch(resolve);\n      /*if (statSync(path).isDirectory()) {\n        rmdir(path, { maxRetries: 10 }).then(resolve).catch(resolve);\n      } else {\n        rm(path, rmOpt).then(resolve).catch(resolve);\n      }*/\n    } else {\n      resolve(new Error(path + ' not found'));\n    }\n  });\n}\n\n/**\n * clean old archives (categories, tags, pagination) from deployment directory\n */\nexport async function cleanOldArchives(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  const logname = 'clean:' + ansiColors.grey('archives');\n\n  // clean archives, tags, categories\n  const archives = join(config.deploy.deployDir, config.archive_dir);\n  const categories = join(config.deploy.deployDir, config.category_dir);\n  const tags = join(config.deploy.deployDir, config.tag_dir);\n  const folders = [archives, tags, categories].filter((str) => existsSync(str));\n\n  // push language folder to be deleted from deploy dir\n  if (Array.isArray(config.language)) {\n    const langDir = config.language.map((path) => join(config.deploy.deployDir, path));\n    folders.push(...langDir);\n  } else if (typeof config.language === 'string' && String(config.language).trim().length > 0) {\n    folders.push(join(config.deploy.deployDir, String(config.language)));\n  }\n\n  // delete pagination\n  const pagesDir = join(config.deploy.deployDir, 'page');\n  if (existsSync(pagesDir)) {\n    const pages = (await readdir(pagesDir)).filter((str) => /^\\d+$/.test(str)).map((str) => join(pagesDir, str));\n    folders.push(...pages);\n  }\n\n  const promises: Promise<any>[] = [];\n\n  // dump to file\n  const dumpfile = join(process.cwd(), 'tmp/dump/clean.txt');\n  writefile(dumpfile, folders.join(EOL));\n  Logger.log(logname, 'list deleted files', dumpfile);\n\n  for (let i = 0; i < folders.length; i++) {\n    const pathStr = folders[i];\n    try {\n      if (existsSync(pathStr)) promises.push(del(pathStr).catch(noop));\n    } catch {\n      //\n    }\n  }\n\n  const finishNow = function (e: any) {\n    if (e instanceof Error) {\n      console.log('clean archives has some erros');\n    }\n    if (typeof callback === 'function') callback();\n    return undefined;\n  };\n\n  await Bluebird.all(promises).then(finishNow).catch(finishNow);\n}\n\nexport async function cleanGeneratedPosts(callback?: gulp.TaskFunctionCallback | (() => any)) {\n  const config = getConfig();\n  return cleanDb(callback, [join(config.cwd, config.source_dir, '_posts')]);\n}\n\ngulp.task('clean:archive', cleanOldArchives);\ngulp.task('clean:db', cleanDb);\ngulp.task('clean:post', cleanGeneratedPosts);\ngulp.task('clean:all', gulp.series('clean:db', 'clean:archive'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0e/gulpclean_0e73cdf97e0865d562e48a7ea63cce15.map","wrapperLength":82},"result":{"scriptId":"13267","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.clean.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":24172,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":24169,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":1}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":3},{"startOffset":241,"endOffset":248,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":1}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":3},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":3}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":1}],"isBlockCoverage":true},{"functionName":"sent","ranges":[{"startOffset":882,"endOffset":935,"count":3},{"startOffset":909,"endOffset":920,"count":0}],"isBlockCoverage":true},{"functionName":"g.<computed>","ranges":[{"startOffset":1095,"endOffset":1122,"count":0}],"isBlockCoverage":false},{"functionName":"verb","ranges":[{"startOffset":1132,"endOffset":1198,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1158,"endOffset":1195,"count":4}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":1203,"endOffset":2596,"count":4},{"startOffset":1238,"endOffset":1293,"count":0},{"startOffset":1311,"endOffset":1339,"count":1},{"startOffset":1328,"endOffset":1338,"count":0},{"startOffset":1344,"endOffset":2500,"count":26},{"startOffset":1375,"endOffset":1476,"count":0},{"startOffset":1477,"endOffset":1508,"count":0},{"startOffset":1510,"endOffset":1519,"count":0},{"startOffset":1546,"endOffset":1572,"count":0},{"startOffset":1618,"endOffset":1625,"count":4},{"startOffset":1626,"endOffset":1648,"count":4},{"startOffset":1665,"endOffset":1721,"count":3},{"startOffset":1738,"endOffset":1787,"count":0},{"startOffset":1804,"endOffset":1853,"count":0},{"startOffset":1870,"endOffset":2379,"count":19},{"startOffset":1934,"endOffset":1952,"count":7},{"startOffset":1954,"endOffset":1985,"count":12},{"startOffset":1987,"endOffset":2007,"count":1},{"startOffset":2007,"endOffset":2085,"count":18},{"startOffset":2051,"endOffset":2084,"count":7},{"startOffset":2087,"endOffset":2114,"count":13},{"startOffset":2114,"endOffset":2151,"count":5},{"startOffset":2151,"endOffset":2168,"count":0},{"startOffset":2170,"endOffset":2204,"count":0},{"startOffset":2204,"endOffset":2248,"count":5},{"startOffset":2250,"endOffset":2292,"count":0},{"startOffset":2292,"endOffset":2323,"count":5},{"startOffset":2323,"endOffset":2335,"count":0},{"startOffset":2335,"endOffset":2379,"count":5},{"startOffset":2393,"endOffset":2444,"count":17},{"startOffset":2444,"endOffset":2477,"count":0},{"startOffset":2477,"endOffset":2478,"count":17},{"startOffset":2500,"endOffset":2524,"count":1},{"startOffset":2524,"endOffset":2536,"count":0},{"startOffset":2536,"endOffset":2566,"count":1},{"startOffset":2567,"endOffset":2575,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":3},{"startOffset":3585,"endOffset":3605,"count":3}],"isBlockCoverage":true},{"functionName":"cleanDb","ranges":[{"startOffset":4337,"endOffset":6742,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4416,"endOffset":6738,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":4506,"endOffset":6730,"count":17},{"startOffset":4570,"endOffset":5549,"count":1},{"startOffset":4755,"endOffset":4988,"count":0},{"startOffset":5462,"endOffset":5488,"count":0},{"startOffset":5566,"endOffset":5711,"count":6},{"startOffset":5618,"endOffset":5642,"count":1},{"startOffset":5642,"endOffset":5711,"count":5},{"startOffset":5728,"endOffset":5958,"count":5},{"startOffset":5841,"endOffset":5865,"count":2},{"startOffset":5865,"endOffset":5958,"count":3},{"startOffset":5975,"endOffset":6047,"count":3},{"startOffset":6064,"endOffset":6096,"count":5},{"startOffset":6113,"endOffset":6248,"count":0},{"startOffset":6265,"endOffset":6342,"count":5},{"startOffset":6359,"endOffset":6706,"count":1},{"startOffset":6618,"endOffset":6652,"count":0}],"isBlockCoverage":true},{"functionName":"del","ranges":[{"startOffset":6828,"endOffset":7400,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":6883,"endOffset":7396,"count":3},{"startOffset":7312,"endOffset":7390,"count":0}],"isBlockCoverage":true},{"functionName":"cleanOldArchives","ranges":[{"startOffset":7507,"endOffset":10904,"count":0}],"isBlockCoverage":false},{"functionName":"cleanGeneratedPosts","ranges":[{"startOffset":10950,"endOffset":11303,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.projectIgnores = exports.commonIgnore = exports.deployConfig = exports.getConfig = exports.setConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar hexo_post_parser_1 = __importDefault(require(\"hexo-post-parser\"));\nvar path_1 = require(\"path\");\nvar true_case_path_1 = __importDefault(require(\"true-case-path\"));\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\nvar defaults_1 = require(\"./defaults\");\nvar fm_1 = require(\"./utils/fm\");\nvar object_1 = require(\"./utils/object\");\nvar settledConfig = (0, defaults_1.getDefaultConfig)();\nvar fetched = {};\nvar fileYML = (0, path_1.join)(process.cwd(), '_config.yml');\nvar loadYml = function () {\n    if ((0, fs_1.existsSync)(fileYML)) {\n        fetched[fileYML] = true;\n        var configYML = yaml_1.default.parse((0, fs_1.readFileSync)(fileYML, 'utf-8'));\n        settledConfig = Object.assign({}, configYML, settledConfig);\n        // update hexo-post-parser config\n        hexo_post_parser_1.default.setConfig(settledConfig);\n        (0, fm_1.writefile)((0, path_1.join)(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n    }\n};\nloadYml();\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nfunction setConfig(obj) {\n    settledConfig = Object.assign({}, settledConfig, obj);\n    fileYML = (0, path_1.join)(settledConfig.cwd, '_config.yml');\n    if (!fetched[fileYML]) {\n        if (settledConfig.cwd) {\n            // fix cwd\n            settledConfig.cwd = (0, upath_1.toUnix)(true_case_path_1.default.trueCasePathSync(settledConfig.cwd));\n        }\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    return getConfig();\n}\nexports.setConfig = setConfig;\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nfunction getConfig(customFolder) {\n    if (typeof customFolder === 'string') {\n        fileYML = (0, path_1.join)(customFolder, '_config.yml');\n        loadYml();\n        fetched[fileYML] = true;\n    }\n    settledConfig = (0, object_1.orderKeys)(settledConfig);\n    settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n    //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n    return settledConfig;\n}\nexports.getConfig = getConfig;\n// first fetch\nif (!fetched)\n    getConfig();\nfunction deployConfig() {\n    var _a;\n    var deployDir = (0, path_1.join)(settledConfig.cwd, '.deploy_' + ((_a = settledConfig.deploy) === null || _a === void 0 ? void 0 : _a.type) || 'git');\n    var github = (0, fs_1.existsSync)(deployDir) ? new git_command_helper_1.default(deployDir) : null;\n    return { deployDir: deployDir, github: github };\n}\nexports.deployConfig = deployConfig;\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexports.commonIgnore = [\n    '**/yandex_*.html',\n    // '**/comments.html',\n    // '**/disqus-comments.html',\n    // '**/comment.html', // skip comment.html\n    '**/favicon.html',\n    '**/404.html',\n    '**/node_modules/**',\n    '**/tmp/**',\n    '**/build/**',\n    '**/.cache/**',\n    '**/.vscode/**',\n    '**/.frontmatter/**',\n    '**/pinterest-*.html',\n    '**/_*.standalone.{js,ts}',\n    '**/desktop.ini',\n    '**/node_modules/**',\n    '**/.frontmatter/**',\n    '**/.git*/**',\n    '**/.*' // skip dots\n];\n/**\n * array of config.exclude, config.ignore\n */\nexports.projectIgnores = __spreadArray(__spreadArray([], __read((getConfig().skip_render || [])), false), __read((getConfig().ignore || [])), false);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHlCQUE4QztBQUM5QywwRUFBcUM7QUFFckMsc0VBQThDO0FBQzlDLDZCQUE0QjtBQUM1QixrRUFBMEM7QUFDMUMsK0JBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBOEM7QUFDOUMsaUNBQXVDO0FBQ3ZDLHlDQUEyQztBQTREM0MsSUFBSSxhQUFhLEdBQUcsSUFBQSwyQkFBZ0IsR0FBeUIsQ0FBQztBQUU5RCxJQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDbkIsSUFBSSxPQUFPLEdBQUcsSUFBQSxXQUFJLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ2pELElBQU0sT0FBTyxHQUFHO0lBQ2QsSUFBSSxJQUFBLGVBQVUsRUFBQyxPQUFPLENBQUMsRUFBRTtRQUN2QixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsSUFBQSxpQkFBWSxFQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzdELGFBQWEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUQsaUNBQWlDO1FBQ2pDLDBCQUFjLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hDLElBQUEsY0FBUyxFQUFDLElBQUEsV0FBSSxFQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNoRjtBQUNILENBQUMsQ0FBQztBQUVGLE9BQU8sRUFBRSxDQUFDO0FBRVY7Ozs7R0FJRztBQUNILFNBQWdCLFNBQVMsQ0FBQyxHQUFtQztJQUMzRCxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3RELE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxhQUFhLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2pELElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDckIsSUFBSSxhQUFhLENBQUMsR0FBRyxFQUFFO1lBQ3JCLFVBQVU7WUFDVixhQUFhLENBQUMsR0FBRyxHQUFHLElBQUEsY0FBTSxFQUFDLHdCQUFZLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDOUU7UUFDRCxPQUFPLEVBQUUsQ0FBQztRQUNWLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7S0FDekI7SUFFRCxPQUFPLFNBQVMsRUFBRSxDQUFDO0FBQ3JCLENBQUM7QUFiRCw4QkFhQztBQUVEOzs7OztHQUtHO0FBQ0gsU0FBZ0IsU0FBUyxDQUFDLFlBQXFCO0lBQzdDLElBQUksT0FBTyxZQUFZLEtBQUssUUFBUSxFQUFFO1FBQ3BDLE9BQU8sR0FBRyxJQUFBLFdBQUksRUFBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDNUMsT0FBTyxFQUFFLENBQUM7UUFDVixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO0tBQ3pCO0lBQ0QsYUFBYSxHQUFHLElBQUEsa0JBQVMsRUFBQyxhQUFhLENBQUMsQ0FBQztJQUN6QyxhQUFhLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sSUFBSSxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUMsQ0FBQztJQUNqRiw4RkFBOEY7SUFDOUYsT0FBTyxhQUF5QixDQUFDO0FBQ25DLENBQUM7QUFWRCw4QkFVQztBQUVELGNBQWM7QUFDZCxJQUFJLENBQUMsT0FBTztJQUFFLFNBQVMsRUFBRSxDQUFDO0FBRTFCLFNBQWdCLFlBQVk7O0lBQzFCLElBQU0sU0FBUyxHQUFHLElBQUEsV0FBSSxFQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsVUFBVSxJQUFHLE1BQUEsYUFBYSxDQUFDLE1BQU0sMENBQUUsSUFBSSxDQUFBLElBQUksS0FBSyxDQUFDLENBQUM7SUFDNUYsSUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFVLEVBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksNEJBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pFLE9BQU8sRUFBRSxTQUFTLFdBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO0FBQy9CLENBQUM7QUFKRCxvQ0FJQztBQUVEOzs7Ozs7R0FNRztBQUNVLFFBQUEsWUFBWSxHQUFHO0lBQzFCLGtCQUFrQjtJQUNsQixzQkFBc0I7SUFDdEIsNkJBQTZCO0lBQzdCLDBDQUEwQztJQUMxQyxpQkFBaUI7SUFDakIsYUFBYTtJQUNiLG9CQUFvQjtJQUNwQixXQUFXO0lBQ1gsYUFBYTtJQUNiLGNBQWM7SUFDZCxlQUFlO0lBQ2Ysb0JBQW9CO0lBQ3BCLHFCQUFxQjtJQUNyQiwwQkFBMEI7SUFDMUIsZ0JBQWdCO0lBQ2hCLG9CQUFvQjtJQUNwQixvQkFBb0I7SUFDcEIsYUFBYTtJQUNiLE9BQU8sQ0FBQyxZQUFZO0NBQ3JCLENBQUM7QUFFRjs7R0FFRztBQUNVLFFBQUEsY0FBYywwQ0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsa0JBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLFVBQUUiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXF9jb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGdpdCBmcm9tICdnaXQtY29tbWFuZC1oZWxwZXInO1xuaW1wb3J0IEhleG8gZnJvbSAnaGV4byc7XG5pbXBvcnQgaGV4b1Bvc3RQYXJzZXIgZnJvbSAnaGV4by1wb3N0LXBhcnNlcic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5pbXBvcnQgdHJ1ZWNhc2VwYXRoIGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdENvbmZpZyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgeyBvcmRlcktleXMgfSBmcm9tICcuL3V0aWxzL29iamVjdCc7XG5cbi8vdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKSAmIFJlY29yZDxzdHJpbmcsIGFueT4gJlxuZXhwb3J0IHR5cGUgaW1wb3J0Q29uZmlnID0gdHlwZW9mIGltcG9ydCgnLi9fY29uZmlnLmpzb24nKTtcblxuZXhwb3J0IGludGVyZmFjZSBQcm9qQ29uZiBleHRlbmRzIEhleG8uQ29uZmlnIHtcbiAgW2tleTogc3RyaW5nXTogYW55O1xuICAvKipcbiAgICogU291cmNlIHBvc3RzXG4gICAqL1xuICBwb3N0X2Rpcjogc3RyaW5nO1xuICAvKipcbiAgICogUHJvamVjdCBDV0RcbiAgICovXG4gIGN3ZDogc3RyaW5nO1xuICAvKipcbiAgICogRGVwbG95bWVudCBvcHRpb25zXG4gICAqL1xuICBkZXBsb3k6IGltcG9ydENvbmZpZ1snZGVwbG95J10gJiBSZXR1cm5UeXBlPHR5cGVvZiBkZXBsb3lDb25maWc+O1xuICBleHRlcm5hbF9saW5rOiBpbXBvcnRDb25maWdbJ2V4dGVybmFsX2xpbmsnXSAmXG4gICAgYm9vbGVhbiAmIHtcbiAgICAgIHNhZmVsaW5rPzogaW1wb3J0KCdzYWZlbGlua2lmeScpLlNhZmVsaW5rT3B0aW9ucztcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBnbG9iYWwgaWdub3JlXG4gICAqL1xuICBleGNsdWRlOiBzdHJpbmdbXTtcblxuICBnZW5lcmF0b3I6IHtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gICAgY2FjaGU6IGJvb2xlYW47XG4gICAgdmVyYm9zZTogYm9vbGVhbjtcbiAgfTtcblxuICAvKipcbiAgICogVGFncyBtYXBwZXJcbiAgICovXG4gIHRhZ3M/OiBMYWJlbE1hcHBlcjtcbiAgLyoqXG4gICAqIENhdGVnb3JpZXMgbWFwcGVyXG4gICAqL1xuICBjYXRlZ29yaWVzPzogTGFiZWxNYXBwZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGFiZWxNYXBwZXIge1xuICAvKipcbiAgICogdHVybiBsYWJlbCB0byBsb3dlciBjYXNlXG4gICAqL1xuICBsb3dlcmNhc2U6IGJvb2xlYW47XG4gIC8qKlxuICAgKiBhZGQgb2xkIGxhYmVsIHdpdGggbmV3IGxhYmVsXG4gICAqL1xuICBhc3NpZ246IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gfCB1bmRlZmluZWQgfCBudWxsO1xuICAvKipcbiAgICogcmVwbGFjZSBvbGQgbGFiZWwgd2l0aCBuZXcgbGFiZWxcbiAgICovXG4gIG1hcHBlcjogUmVjb3JkPHN0cmluZywgc3RyaW5nPiB8IHVuZGVmaW5lZCB8IG51bGw7XG59XG5cbmxldCBzZXR0bGVkQ29uZmlnID0gZ2V0RGVmYXVsdENvbmZpZygpIGFzIFJlY29yZDxzdHJpbmcsIGFueT47XG5cbmNvbnN0IGZldGNoZWQgPSB7fTtcbmxldCBmaWxlWU1MID0gam9pbihwcm9jZXNzLmN3ZCgpLCAnX2NvbmZpZy55bWwnKTtcbmNvbnN0IGxvYWRZbWwgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChleGlzdHNTeW5jKGZpbGVZTUwpKSB7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gICAgY29uc3QgY29uZmlnWU1MID0geWFtbC5wYXJzZShyZWFkRmlsZVN5bmMoZmlsZVlNTCwgJ3V0Zi04JykpO1xuICAgIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWdZTUwsIHNldHRsZWRDb25maWcpO1xuICAgIC8vIHVwZGF0ZSBoZXhvLXBvc3QtcGFyc2VyIGNvbmZpZ1xuICAgIGhleG9Qb3N0UGFyc2VyLnNldENvbmZpZyhzZXR0bGVkQ29uZmlnKTtcbiAgICB3cml0ZWZpbGUoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkoY29uZmlnWU1MLCBudWxsLCAyKSk7XG4gIH1cbn07XG5cbmxvYWRZbWwoKTtcblxuLyoqXG4gKiBDb25maWcgc2V0dGVyXG4gKiAqIHVzZWZ1bCBmb3IgamVzdFxuICogQHBhcmFtIG9ialxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29uZmlnKG9iajogUmVjb3JkPHN0cmluZywgYW55PiB8IFByb2pDb25mKSB7XG4gIHNldHRsZWRDb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBzZXR0bGVkQ29uZmlnLCBvYmopO1xuICBmaWxlWU1MID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJ19jb25maWcueW1sJyk7XG4gIGlmICghZmV0Y2hlZFtmaWxlWU1MXSkge1xuICAgIGlmIChzZXR0bGVkQ29uZmlnLmN3ZCkge1xuICAgICAgLy8gZml4IGN3ZFxuICAgICAgc2V0dGxlZENvbmZpZy5jd2QgPSB0b1VuaXgodHJ1ZWNhc2VwYXRoLnRydWVDYXNlUGF0aFN5bmMoc2V0dGxlZENvbmZpZy5jd2QpKTtcbiAgICB9XG4gICAgbG9hZFltbCgpO1xuICAgIGZldGNoZWRbZmlsZVlNTF0gPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGdldENvbmZpZygpO1xufVxuXG4vKipcbiAqIENvbmZpZyBnZXR0ZXJcbiAqICogdXNlZnVsIGZvciBqZXN0XG4gKiBAcGFyYW0gY3VzdG9tRm9sZGVyIGxvYWQgZnJvbSBjdXN0b20gZm9sZGVyIGFuZCBhcHBseSB0byBjdXJyZW50IGNvbmZpZ1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbmZpZyhjdXN0b21Gb2xkZXI/OiBzdHJpbmcpIHtcbiAgaWYgKHR5cGVvZiBjdXN0b21Gb2xkZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgZmlsZVlNTCA9IGpvaW4oY3VzdG9tRm9sZGVyLCAnX2NvbmZpZy55bWwnKTtcbiAgICBsb2FkWW1sKCk7XG4gICAgZmV0Y2hlZFtmaWxlWU1MXSA9IHRydWU7XG4gIH1cbiAgc2V0dGxlZENvbmZpZyA9IG9yZGVyS2V5cyhzZXR0bGVkQ29uZmlnKTtcbiAgc2V0dGxlZENvbmZpZy5kZXBsb3kgPSBPYmplY3QuYXNzaWduKHNldHRsZWRDb25maWcuZGVwbG95IHx8IHt9LCBkZXBsb3lDb25maWcoKSk7XG4gIC8vY29uc3QgZGVwbG95RGlyID0gam9pbihzZXR0bGVkQ29uZmlnLmN3ZCwgJy5kZXBsb3lfJyArIHNldHRsZWRDb25maWcuZGVwbG95Py50eXBlIHx8ICdnaXQnKTtcbiAgcmV0dXJuIHNldHRsZWRDb25maWcgYXMgUHJvakNvbmY7XG59XG5cbi8vIGZpcnN0IGZldGNoXG5pZiAoIWZldGNoZWQpIGdldENvbmZpZygpO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVwbG95Q29uZmlnKCkge1xuICBjb25zdCBkZXBsb3lEaXIgPSBqb2luKHNldHRsZWRDb25maWcuY3dkLCAnLmRlcGxveV8nICsgc2V0dGxlZENvbmZpZy5kZXBsb3k/LnR5cGUgfHwgJ2dpdCcpO1xuICBjb25zdCBnaXRodWIgPSBleGlzdHNTeW5jKGRlcGxveURpcikgPyBuZXcgZ2l0KGRlcGxveURpcikgOiBudWxsO1xuICByZXR1cm4geyBkZXBsb3lEaXIsIGdpdGh1YiB9O1xufVxuXG4vKipcbiAqIGNvbW1vbiBpZ25vcmUgZmlsZXNcbiAqIEBleGFtcGxlXG4gKiBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAqIGNvbnN0IGV4Y2x1ZGVzID0gQXJyYXkuaXNBcnJheShjb25maWcuZXhjbHVkZSkgPyBjb25maWcuZXhjbHVkZSA6IFtdO1xuICogZXhjbHVkZXMucHVzaCguLi5jb21tb25JZ25vcmUpO1xuICovXG5leHBvcnQgY29uc3QgY29tbW9uSWdub3JlID0gW1xuICAnKioveWFuZGV4XyouaHRtbCcsIC8vIHNraXAgeWFuZGV4IHZlcmlmaWNhdGlvbiBmaWxlXG4gIC8vICcqKi9jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2Rpc3F1cy1jb21tZW50cy5odG1sJyxcbiAgLy8gJyoqL2NvbW1lbnQuaHRtbCcsIC8vIHNraXAgY29tbWVudC5odG1sXG4gICcqKi9mYXZpY29uLmh0bWwnLCAvLyBza2lwIGZhdmljb25cbiAgJyoqLzQwNC5odG1sJywgLy8gc2tpcCA0MDRcbiAgJyoqL25vZGVfbW9kdWxlcy8qKicsIC8vIHNraXAgbm9kZV9tb2R1bGVzXG4gICcqKi90bXAvKionLCAvLyBza2lwIHRtcFxuICAnKiovYnVpbGQvKionLCAvLyBza2lwIGJ1aWxkXG4gICcqKi8uY2FjaGUvKionLCAvLyBza2lwIGNvbW1vbiBjYWNoZSBmb2xkZXJcbiAgJyoqLy52c2NvZGUvKionLCAvLyBza2lwIHZzY29kZSBjb25maWd1cmF0aW9uIGZvbGRlclxuICAnKiovLmZyb250bWF0dGVyLyoqJywgLy8gc2tpcCBmcm9udG1hdHRlciB2c2NvZGUgZXh0ZW5zaW9uXG4gICcqKi9waW50ZXJlc3QtKi5odG1sJywgLy8gc2tpcCBwaW50ZXJlc3QgdmVyaWZpY2F0aW9uIGZpbGVcbiAgJyoqL18qLnN0YW5kYWxvbmUue2pzLHRzfScsIC8vIHNraXAgX2ZpbGVuYW1lLnN0YW5kYWxvbmUuanNcbiAgJyoqL2Rlc2t0b3AuaW5pJywgLy8gd2luZG93cyBkZXNrdG9wLmluaVxuICAnKiovbm9kZV9tb2R1bGVzLyoqJywgLy8gbm9kZV9tb2R1bGVzXG4gICcqKi8uZnJvbnRtYXR0ZXIvKionLCAvLyB2c2NvZGUgZnJvbnRtYXR0ZXIgcGx1Z2luXG4gICcqKi8uZ2l0Ki8qKicsIC8vIGFueSBnaXQgY29uZmlnc1xuICAnKiovLionIC8vIHNraXAgZG90c1xuXTtcblxuLyoqXG4gKiBhcnJheSBvZiBjb25maWcuZXhjbHVkZSwgY29uZmlnLmlnbm9yZVxuICovXG5leHBvcnQgY29uc3QgcHJvamVjdElnbm9yZXMgPSBbLi4uKGdldENvbmZpZygpLnNraXBfcmVuZGVyIHx8IFtdKSwgLi4uKGdldENvbmZpZygpLmlnbm9yZSB8fCBbXSldO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import { existsSync, readFileSync } from 'fs';\nimport git from 'git-command-helper';\nimport Hexo from 'hexo';\nimport hexoPostParser from 'hexo-post-parser';\nimport { join } from 'path';\nimport truecasepath from 'true-case-path';\nimport { toUnix } from 'upath';\nimport yaml from 'yaml';\nimport { getDefaultConfig } from './defaults';\nimport { writefile } from './utils/fm';\nimport { orderKeys } from './utils/object';\n\n//typeof import('./_config.json') & Record<string, any> &\nexport type importConfig = typeof import('./_config.json');\n\nexport interface ProjConf extends Hexo.Config {\n  [key: string]: any;\n  /**\n   * Source posts\n   */\n  post_dir: string;\n  /**\n   * Project CWD\n   */\n  cwd: string;\n  /**\n   * Deployment options\n   */\n  deploy: importConfig['deploy'] & ReturnType<typeof deployConfig>;\n  external_link: importConfig['external_link'] &\n    boolean & {\n      safelink?: import('safelinkify').SafelinkOptions;\n    };\n\n  /**\n   * global ignore\n   */\n  exclude: string[];\n\n  generator: {\n    [key: string]: any;\n    cache: boolean;\n    verbose: boolean;\n  };\n\n  /**\n   * Tags mapper\n   */\n  tags?: LabelMapper;\n  /**\n   * Categories mapper\n   */\n  categories?: LabelMapper;\n}\n\nexport interface LabelMapper {\n  /**\n   * turn label to lower case\n   */\n  lowercase: boolean;\n  /**\n   * add old label with new label\n   */\n  assign: Record<string, string> | undefined | null;\n  /**\n   * replace old label with new label\n   */\n  mapper: Record<string, string> | undefined | null;\n}\n\nlet settledConfig = getDefaultConfig() as Record<string, any>;\n\nconst fetched = {};\nlet fileYML = join(process.cwd(), '_config.yml');\nconst loadYml = function () {\n  if (existsSync(fileYML)) {\n    fetched[fileYML] = true;\n    const configYML = yaml.parse(readFileSync(fileYML, 'utf-8'));\n    settledConfig = Object.assign({}, configYML, settledConfig);\n    // update hexo-post-parser config\n    hexoPostParser.setConfig(settledConfig);\n    writefile(join(__dirname, '_config.json'), JSON.stringify(configYML, null, 2));\n  }\n};\n\nloadYml();\n\n/**\n * Config setter\n * * useful for jest\n * @param obj\n */\nexport function setConfig(obj: Record<string, any> | ProjConf) {\n  settledConfig = Object.assign({}, settledConfig, obj);\n  fileYML = join(settledConfig.cwd, '_config.yml');\n  if (!fetched[fileYML]) {\n    if (settledConfig.cwd) {\n      // fix cwd\n      settledConfig.cwd = toUnix(truecasepath.trueCasePathSync(settledConfig.cwd));\n    }\n    loadYml();\n    fetched[fileYML] = true;\n  }\n\n  return getConfig();\n}\n\n/**\n * Config getter\n * * useful for jest\n * @param customFolder load from custom folder and apply to current config\n * @returns\n */\nexport function getConfig(customFolder?: string) {\n  if (typeof customFolder === 'string') {\n    fileYML = join(customFolder, '_config.yml');\n    loadYml();\n    fetched[fileYML] = true;\n  }\n  settledConfig = orderKeys(settledConfig);\n  settledConfig.deploy = Object.assign(settledConfig.deploy || {}, deployConfig());\n  //const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  return settledConfig as ProjConf;\n}\n\n// first fetch\nif (!fetched) getConfig();\n\nexport function deployConfig() {\n  const deployDir = join(settledConfig.cwd, '.deploy_' + settledConfig.deploy?.type || 'git');\n  const github = existsSync(deployDir) ? new git(deployDir) : null;\n  return { deployDir, github };\n}\n\n/**\n * common ignore files\n * @example\n * const config = getConfig();\n * const excludes = Array.isArray(config.exclude) ? config.exclude : [];\n * excludes.push(...commonIgnore);\n */\nexport const commonIgnore = [\n  '**/yandex_*.html', // skip yandex verification file\n  // '**/comments.html',\n  // '**/disqus-comments.html',\n  // '**/comment.html', // skip comment.html\n  '**/favicon.html', // skip favicon\n  '**/404.html', // skip 404\n  '**/node_modules/**', // skip node_modules\n  '**/tmp/**', // skip tmp\n  '**/build/**', // skip build\n  '**/.cache/**', // skip common cache folder\n  '**/.vscode/**', // skip vscode configuration folder\n  '**/.frontmatter/**', // skip frontmatter vscode extension\n  '**/pinterest-*.html', // skip pinterest verification file\n  '**/_*.standalone.{js,ts}', // skip _filename.standalone.js\n  '**/desktop.ini', // windows desktop.ini\n  '**/node_modules/**', // node_modules\n  '**/.frontmatter/**', // vscode frontmatter plugin\n  '**/.git*/**', // any git configs\n  '**/.*' // skip dots\n];\n\n/**\n * array of config.exclude, config.ignore\n */\nexport const projectIgnores = [...(getConfig().skip_render || []), ...(getConfig().ignore || [])];\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/0f/_config_0f3f45dd644bddb8c0e53e47eddfc08f.map","wrapperLength":82},"result":{"scriptId":"13700","url":"D:\\Repositories\\static-blog-generator\\src\\_config.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":14732,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":14729,"count":1},{"startOffset":3588,"endOffset":3600,"count":0},{"startOffset":4818,"endOffset":4823,"count":0},{"startOffset":4862,"endOffset":4867,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":2},{"startOffset":228,"endOffset":237,"count":0},{"startOffset":315,"endOffset":325,"count":0},{"startOffset":352,"endOffset":369,"count":0},{"startOffset":380,"endOffset":419,"count":0},{"startOffset":477,"endOffset":497,"count":0},{"startOffset":499,"endOffset":509,"count":0},{"startOffset":545,"endOffset":559,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":2},{"startOffset":706,"endOffset":901,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":4},{"startOffset":1075,"endOffset":1080,"count":2},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"loadYml","ranges":[{"startOffset":1902,"endOffset":2367,"count":1}],"isBlockCoverage":true},{"functionName":"setConfig","ranges":[{"startOffset":2440,"endOffset":2884,"count":1},{"startOffset":2618,"endOffset":2858,"count":0}],"isBlockCoverage":true},{"functionName":"getConfig","ranges":[{"startOffset":3049,"endOffset":3523,"count":82},{"startOffset":3126,"endOffset":3250,"count":0},{"startOffset":3373,"endOffset":3378,"count":0}],"isBlockCoverage":true},{"functionName":"deployConfig","ranges":[{"startOffset":3601,"endOffset":3951,"count":82},{"startOffset":3763,"endOffset":3771,"count":0},{"startOffset":3783,"endOffset":3791,"count":0},{"startOffset":3843,"endOffset":3888,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDefaultConfigYaml = exports.getDefaultConfig = void 0;\nvar fs_1 = require(\"fs\");\nvar true_case_path_1 = require(\"true-case-path\");\nvar upath_1 = require(\"upath\");\nvar yaml_1 = __importDefault(require(\"yaml\"));\n/**\n * get default configuration\n * @returns\n */\nfunction getDefaultConfig() {\n    var hexoDefaultConfig = {\n        // Site\n        title: 'Hexo',\n        subtitle: '',\n        description: '',\n        author: 'John Doe',\n        language: 'en',\n        timezone: '',\n        // URL\n        url: 'http://example.com',\n        root: '/',\n        permalink: ':year/:month/:day/:title/',\n        permalink_defaults: {},\n        pretty_urls: {\n            trailing_index: true,\n            trailing_html: true\n        },\n        // Directory\n        source_dir: 'source',\n        public_dir: 'public',\n        tag_dir: 'tags',\n        archive_dir: 'archives',\n        category_dir: 'categories',\n        code_dir: 'downloads/code',\n        i18n_dir: ':lang',\n        skip_render: [],\n        // Writing\n        new_post_name: ':title.md',\n        default_layout: 'post',\n        titlecase: false,\n        external_link: {\n            enable: true,\n            field: 'site',\n            exclude: ''\n        },\n        filename_case: 0,\n        render_drafts: false,\n        post_asset_folder: false,\n        relative_link: false,\n        future: true,\n        syntax_highlighter: 'highlight.js',\n        highlight: {\n            auto_detect: false,\n            line_number: true,\n            tab_replace: '',\n            wrap: true,\n            exclude_languages: [],\n            language_attr: false,\n            hljs: false\n        },\n        prismjs: {\n            preprocess: true,\n            line_number: true,\n            tab_replace: ''\n        },\n        // Category & Tag\n        default_category: 'uncategorized',\n        category_map: {},\n        tag_map: {},\n        // Date / Time format\n        date_format: 'YYYY-MM-DD',\n        time_format: 'HH:mm:ss',\n        updated_option: 'mtime',\n        // * mtime: file modification date (default)\n        // * empty: no more update\n        // Pagination\n        per_page: 10,\n        pagination_dir: 'page',\n        // Extensions\n        theme: 'landscape',\n        server: {\n            cache: false\n        },\n        // Deployment\n        deploy: {},\n        // ignore files from processing\n        ignore: [],\n        // Category & Tag\n        meta_generator: true\n    };\n    var sbgDefaultConfig = {\n        cwd: (0, upath_1.toUnix)((0, true_case_path_1.trueCasePathSync)(process.cwd()))\n    };\n    var configYML = yaml_1.default.parse(getDefaultConfigYaml());\n    return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML);\n}\nexports.getDefaultConfig = getDefaultConfig;\n/**\n * get default _config.yml\n * @returns\n */\nfunction getDefaultConfigYaml() {\n    return (0, fs_1.readFileSync)((0, upath_1.join)(__dirname, '_config.yml'), 'utf-8');\n}\nexports.getDefaultConfigYaml = getDefaultConfigYaml;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGRlZmF1bHRzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHlCQUFrQztBQUNsQyxpREFBa0Q7QUFDbEQsK0JBQXFDO0FBQ3JDLDhDQUF3QjtBQUV4Qjs7O0dBR0c7QUFDSCxTQUFnQixnQkFBZ0I7SUFDOUIsSUFBTSxpQkFBaUIsR0FBRztRQUN4QixPQUFPO1FBQ1AsS0FBSyxFQUFFLE1BQU07UUFDYixRQUFRLEVBQUUsRUFBRTtRQUNaLFdBQVcsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLFVBQVU7UUFDbEIsUUFBUSxFQUFFLElBQUk7UUFDZCxRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU07UUFDTixHQUFHLEVBQUUsb0JBQW9CO1FBQ3pCLElBQUksRUFBRSxHQUFHO1FBQ1QsU0FBUyxFQUFFLDJCQUEyQjtRQUN0QyxrQkFBa0IsRUFBRSxFQUFFO1FBQ3RCLFdBQVcsRUFBRTtZQUNYLGNBQWMsRUFBRSxJQUFJO1lBQ3BCLGFBQWEsRUFBRSxJQUFJO1NBQ3BCO1FBQ0QsWUFBWTtRQUNaLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLFVBQVUsRUFBRSxRQUFRO1FBQ3BCLE9BQU8sRUFBRSxNQUFNO1FBQ2YsV0FBVyxFQUFFLFVBQVU7UUFDdkIsWUFBWSxFQUFFLFlBQVk7UUFDMUIsUUFBUSxFQUFFLGdCQUFnQjtRQUMxQixRQUFRLEVBQUUsT0FBTztRQUNqQixXQUFXLEVBQUUsRUFBRTtRQUNmLFVBQVU7UUFDVixhQUFhLEVBQUUsV0FBVztRQUMxQixjQUFjLEVBQUUsTUFBTTtRQUN0QixTQUFTLEVBQUUsS0FBSztRQUNoQixhQUFhLEVBQUU7WUFDYixNQUFNLEVBQUUsSUFBSTtZQUNaLEtBQUssRUFBRSxNQUFNO1lBQ2IsT0FBTyxFQUFFLEVBQUU7U0FDWjtRQUNELGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGFBQWEsRUFBRSxLQUFLO1FBQ3BCLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsYUFBYSxFQUFFLEtBQUs7UUFDcEIsTUFBTSxFQUFFLElBQUk7UUFDWixrQkFBa0IsRUFBRSxjQUFjO1FBQ2xDLFNBQVMsRUFBRTtZQUNULFdBQVcsRUFBRSxLQUFLO1lBQ2xCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFdBQVcsRUFBRSxFQUFFO1lBQ2YsSUFBSSxFQUFFLElBQUk7WUFDVixpQkFBaUIsRUFBRSxFQUFFO1lBQ3JCLGFBQWEsRUFBRSxLQUFLO1lBQ3BCLElBQUksRUFBRSxLQUFLO1NBQ1o7UUFDRCxPQUFPLEVBQUU7WUFDUCxVQUFVLEVBQUUsSUFBSTtZQUNoQixXQUFXLEVBQUUsSUFBSTtZQUNqQixXQUFXLEVBQUUsRUFBRTtTQUNoQjtRQUNELGlCQUFpQjtRQUNqQixnQkFBZ0IsRUFBRSxlQUFlO1FBQ2pDLFlBQVksRUFBRSxFQUFFO1FBQ2hCLE9BQU8sRUFBRSxFQUFFO1FBQ1gscUJBQXFCO1FBQ3JCLFdBQVcsRUFBRSxZQUFZO1FBQ3pCLFdBQVcsRUFBRSxVQUFVO1FBQ3ZCLGNBQWMsRUFBRSxPQUFPO1FBQ3ZCLDRDQUE0QztRQUM1QywwQkFBMEI7UUFDMUIsYUFBYTtRQUNiLFFBQVEsRUFBRSxFQUFFO1FBQ1osY0FBYyxFQUFFLE1BQU07UUFDdEIsYUFBYTtRQUNiLEtBQUssRUFBRSxXQUFXO1FBQ2xCLE1BQU0sRUFBRTtZQUNOLEtBQUssRUFBRSxLQUFLO1NBQ2I7UUFDRCxhQUFhO1FBQ2IsTUFBTSxFQUFFLEVBQUU7UUFFViwrQkFBK0I7UUFDL0IsTUFBTSxFQUFFLEVBQUU7UUFFVixpQkFBaUI7UUFDakIsY0FBYyxFQUFFLElBQUk7S0FDckIsQ0FBQztJQUNGLElBQU0sZ0JBQWdCLEdBQUc7UUFDdkIsR0FBRyxFQUFFLElBQUEsY0FBTSxFQUFDLElBQUEsaUNBQWdCLEVBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7S0FDN0MsQ0FBQztJQUNGLElBQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxLQUFLLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQW9DLENBQUM7QUFDMUcsQ0FBQztBQXhGRCw0Q0F3RkM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixvQkFBb0I7SUFDbEMsT0FBTyxJQUFBLGlCQUFZLEVBQUMsSUFBQSxZQUFJLEVBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQy9ELENBQUM7QUFGRCxvREFFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZGVmYXVsdHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgdHJ1ZUNhc2VQYXRoU3luYyB9IGZyb20gJ3RydWUtY2FzZS1wYXRoJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCB5YW1sIGZyb20gJ3lhbWwnO1xuXG4vKipcbiAqIGdldCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0Q29uZmlnKCkge1xuICBjb25zdCBoZXhvRGVmYXVsdENvbmZpZyA9IHtcbiAgICAvLyBTaXRlXG4gICAgdGl0bGU6ICdIZXhvJyxcbiAgICBzdWJ0aXRsZTogJycsXG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIGF1dGhvcjogJ0pvaG4gRG9lJyxcbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICB0aW1lem9uZTogJycsXG4gICAgLy8gVVJMXG4gICAgdXJsOiAnaHR0cDovL2V4YW1wbGUuY29tJyxcbiAgICByb290OiAnLycsXG4gICAgcGVybWFsaW5rOiAnOnllYXIvOm1vbnRoLzpkYXkvOnRpdGxlLycsXG4gICAgcGVybWFsaW5rX2RlZmF1bHRzOiB7fSxcbiAgICBwcmV0dHlfdXJsczoge1xuICAgICAgdHJhaWxpbmdfaW5kZXg6IHRydWUsXG4gICAgICB0cmFpbGluZ19odG1sOiB0cnVlXG4gICAgfSxcbiAgICAvLyBEaXJlY3RvcnlcbiAgICBzb3VyY2VfZGlyOiAnc291cmNlJyxcbiAgICBwdWJsaWNfZGlyOiAncHVibGljJyxcbiAgICB0YWdfZGlyOiAndGFncycsXG4gICAgYXJjaGl2ZV9kaXI6ICdhcmNoaXZlcycsXG4gICAgY2F0ZWdvcnlfZGlyOiAnY2F0ZWdvcmllcycsXG4gICAgY29kZV9kaXI6ICdkb3dubG9hZHMvY29kZScsXG4gICAgaTE4bl9kaXI6ICc6bGFuZycsXG4gICAgc2tpcF9yZW5kZXI6IFtdLFxuICAgIC8vIFdyaXRpbmdcbiAgICBuZXdfcG9zdF9uYW1lOiAnOnRpdGxlLm1kJyxcbiAgICBkZWZhdWx0X2xheW91dDogJ3Bvc3QnLFxuICAgIHRpdGxlY2FzZTogZmFsc2UsXG4gICAgZXh0ZXJuYWxfbGluazoge1xuICAgICAgZW5hYmxlOiB0cnVlLFxuICAgICAgZmllbGQ6ICdzaXRlJyxcbiAgICAgIGV4Y2x1ZGU6ICcnXG4gICAgfSxcbiAgICBmaWxlbmFtZV9jYXNlOiAwLFxuICAgIHJlbmRlcl9kcmFmdHM6IGZhbHNlLFxuICAgIHBvc3RfYXNzZXRfZm9sZGVyOiBmYWxzZSxcbiAgICByZWxhdGl2ZV9saW5rOiBmYWxzZSxcbiAgICBmdXR1cmU6IHRydWUsXG4gICAgc3ludGF4X2hpZ2hsaWdodGVyOiAnaGlnaGxpZ2h0LmpzJyxcbiAgICBoaWdobGlnaHQ6IHtcbiAgICAgIGF1dG9fZGV0ZWN0OiBmYWxzZSxcbiAgICAgIGxpbmVfbnVtYmVyOiB0cnVlLFxuICAgICAgdGFiX3JlcGxhY2U6ICcnLFxuICAgICAgd3JhcDogdHJ1ZSxcbiAgICAgIGV4Y2x1ZGVfbGFuZ3VhZ2VzOiBbXSxcbiAgICAgIGxhbmd1YWdlX2F0dHI6IGZhbHNlLFxuICAgICAgaGxqczogZmFsc2VcbiAgICB9LFxuICAgIHByaXNtanM6IHtcbiAgICAgIHByZXByb2Nlc3M6IHRydWUsXG4gICAgICBsaW5lX251bWJlcjogdHJ1ZSxcbiAgICAgIHRhYl9yZXBsYWNlOiAnJ1xuICAgIH0sXG4gICAgLy8gQ2F0ZWdvcnkgJiBUYWdcbiAgICBkZWZhdWx0X2NhdGVnb3J5OiAndW5jYXRlZ29yaXplZCcsXG4gICAgY2F0ZWdvcnlfbWFwOiB7fSxcbiAgICB0YWdfbWFwOiB7fSxcbiAgICAvLyBEYXRlIC8gVGltZSBmb3JtYXRcbiAgICBkYXRlX2Zvcm1hdDogJ1lZWVktTU0tREQnLFxuICAgIHRpbWVfZm9ybWF0OiAnSEg6bW06c3MnLFxuICAgIHVwZGF0ZWRfb3B0aW9uOiAnbXRpbWUnLFxuICAgIC8vICogbXRpbWU6IGZpbGUgbW9kaWZpY2F0aW9uIGRhdGUgKGRlZmF1bHQpXG4gICAgLy8gKiBlbXB0eTogbm8gbW9yZSB1cGRhdGVcbiAgICAvLyBQYWdpbmF0aW9uXG4gICAgcGVyX3BhZ2U6IDEwLFxuICAgIHBhZ2luYXRpb25fZGlyOiAncGFnZScsXG4gICAgLy8gRXh0ZW5zaW9uc1xuICAgIHRoZW1lOiAnbGFuZHNjYXBlJyxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgIGNhY2hlOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gRGVwbG95bWVudFxuICAgIGRlcGxveToge30sXG5cbiAgICAvLyBpZ25vcmUgZmlsZXMgZnJvbSBwcm9jZXNzaW5nXG4gICAgaWdub3JlOiBbXSxcblxuICAgIC8vIENhdGVnb3J5ICYgVGFnXG4gICAgbWV0YV9nZW5lcmF0b3I6IHRydWVcbiAgfTtcbiAgY29uc3Qgc2JnRGVmYXVsdENvbmZpZyA9IHtcbiAgICBjd2Q6IHRvVW5peCh0cnVlQ2FzZVBhdGhTeW5jKHByb2Nlc3MuY3dkKCkpKVxuICB9O1xuICBjb25zdCBjb25maWdZTUwgPSB5YW1sLnBhcnNlKGdldERlZmF1bHRDb25maWdZYW1sKCkpO1xuICByZXR1cm4gT2JqZWN0LmFzc2lnbihoZXhvRGVmYXVsdENvbmZpZywgc2JnRGVmYXVsdENvbmZpZywgY29uZmlnWU1MKSBhcyB0eXBlb2YgaW1wb3J0KCcuL19jb25maWcuanNvbicpO1xufVxuXG4vKipcbiAqIGdldCBkZWZhdWx0IF9jb25maWcueW1sXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdENvbmZpZ1lhbWwoKSB7XG4gIHJldHVybiByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICdfY29uZmlnLnltbCcpLCAndXRmLTgnKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { readFileSync } from 'fs';\nimport { trueCasePathSync } from 'true-case-path';\nimport { join, toUnix } from 'upath';\nimport yaml from 'yaml';\n\n/**\n * get default configuration\n * @returns\n */\nexport function getDefaultConfig() {\n  const hexoDefaultConfig = {\n    // Site\n    title: 'Hexo',\n    subtitle: '',\n    description: '',\n    author: 'John Doe',\n    language: 'en',\n    timezone: '',\n    // URL\n    url: 'http://example.com',\n    root: '/',\n    permalink: ':year/:month/:day/:title/',\n    permalink_defaults: {},\n    pretty_urls: {\n      trailing_index: true,\n      trailing_html: true\n    },\n    // Directory\n    source_dir: 'source',\n    public_dir: 'public',\n    tag_dir: 'tags',\n    archive_dir: 'archives',\n    category_dir: 'categories',\n    code_dir: 'downloads/code',\n    i18n_dir: ':lang',\n    skip_render: [],\n    // Writing\n    new_post_name: ':title.md',\n    default_layout: 'post',\n    titlecase: false,\n    external_link: {\n      enable: true,\n      field: 'site',\n      exclude: ''\n    },\n    filename_case: 0,\n    render_drafts: false,\n    post_asset_folder: false,\n    relative_link: false,\n    future: true,\n    syntax_highlighter: 'highlight.js',\n    highlight: {\n      auto_detect: false,\n      line_number: true,\n      tab_replace: '',\n      wrap: true,\n      exclude_languages: [],\n      language_attr: false,\n      hljs: false\n    },\n    prismjs: {\n      preprocess: true,\n      line_number: true,\n      tab_replace: ''\n    },\n    // Category & Tag\n    default_category: 'uncategorized',\n    category_map: {},\n    tag_map: {},\n    // Date / Time format\n    date_format: 'YYYY-MM-DD',\n    time_format: 'HH:mm:ss',\n    updated_option: 'mtime',\n    // * mtime: file modification date (default)\n    // * empty: no more update\n    // Pagination\n    per_page: 10,\n    pagination_dir: 'page',\n    // Extensions\n    theme: 'landscape',\n    server: {\n      cache: false\n    },\n    // Deployment\n    deploy: {},\n\n    // ignore files from processing\n    ignore: [],\n\n    // Category & Tag\n    meta_generator: true\n  };\n  const sbgDefaultConfig = {\n    cwd: toUnix(trueCasePathSync(process.cwd()))\n  };\n  const configYML = yaml.parse(getDefaultConfigYaml());\n  return Object.assign(hexoDefaultConfig, sbgDefaultConfig, configYML) as typeof import('./_config.json');\n}\n\n/**\n * get default _config.yml\n * @returns\n */\nexport function getDefaultConfigYaml() {\n  return readFileSync(join(__dirname, '_config.yml'), 'utf-8');\n}\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/9d/defaults_9d90978728a2f8c36350e6b522c45e0e.map","wrapperLength":82},"result":{"scriptId":"14621","url":"D:\\Repositories\\static-blog-generator\\src\\defaults.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":9592,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":9589,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":1},{"startOffset":204,"endOffset":209,"count":0}],"isBlockCoverage":true},{"functionName":"getDefaultConfig","ranges":[{"startOffset":568,"endOffset":3016,"count":1}],"isBlockCoverage":true},{"functionName":"getDefaultConfigYaml","ranges":[{"startOffset":3109,"endOffset":3233,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asyncCopyGen = exports.copyGen = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_1 = require(\"fs\");\nvar git_command_helper_1 = __importDefault(require(\"git-command-helper\"));\nvar spawn_1 = require(\"git-command-helper/dist/spawn\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar moment_timezone_1 = __importDefault(require(\"moment-timezone\"));\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.safelink\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction copyGen() {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    var publicDir = (0, upath_1.join)(process.cwd(), (0, _config_1.getConfig)().public_dir);\n    return gulp_1.default\n        .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n        cwd: publicDir,\n        dot: true\n    })\n        .pipe(gulp_1.default.dest(deployDir))\n        .on('error', console.trace);\n}\nexports.copyGen = copyGen;\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nfunction asyncCopyGen() {\n    return new bluebird_1.default(function (resolve) {\n        copyGen().once('end', function () {\n            resolve(null);\n        });\n    });\n}\nexports.asyncCopyGen = asyncCopyGen;\n// copy public to .deploy_git\ngulp_1.default.task('deploy:copy', copyGen);\n/**\n * git pull on deploy dir\n * @param done\n */\nfunction pull(done) {\n    return __awaiter(this, void 0, void 0, function () {\n        var config, cwd, gh, doPull, clone, submodules, i, sub;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    config = (0, _config_1.getConfig)();\n                    cwd = config.deploy.deployDir;\n                    gh = config.deploy.github;\n                    doPull = function (cwd) { return __awaiter(_this, void 0, void 0, function () {\n                        var e_1, e_2;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    _a.trys.push([0, 2, , 3]);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['config', 'pull.rebase', 'false'], {\n                                            cwd: cwd\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 2:\n                                    e_1 = _a.sent();\n                                    return [3 /*break*/, 3];\n                                case 3:\n                                    _a.trys.push([3, 5, , 6]);\n                                    logger_1.default.log('pulling', cwd);\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', ['pull', '-X', 'theirs'], {\n                                            cwd: cwd,\n                                            stdio: 'pipe'\n                                        })];\n                                case 4:\n                                    _a.sent();\n                                    return [3 /*break*/, 6];\n                                case 5:\n                                    e_2 = _a.sent();\n                                    logger_1.default.log('cannot pull', cwd);\n                                    return [3 /*break*/, 6];\n                                case 6: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    clone = function () { return __awaiter(_this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    if (!!(0, fs_1.existsSync)(cwd)) return [3 /*break*/, 2];\n                                    return [4 /*yield*/, (0, spawn_1.spawnAsync)('git', __spreadArray(__spreadArray([], __read('clone -b master --single-branch'.split(' ')), false), [config.deploy.repo, '.deploy_git'], false), {\n                                            cwd: __dirname\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    _a.label = 2;\n                                case 2: return [2 /*return*/];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, clone()];\n                case 1:\n                    _a.sent();\n                    doPull(cwd);\n                    if (gh) {\n                        submodules = gh.submodule.get();\n                        for (i = 0; i < submodules.length; i++) {\n                            sub = submodules[i];\n                            doPull(sub.root);\n                        }\n                    }\n                    done();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction status(done) {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return;\n    github.status().then(function (statuses) {\n        statuses.map(function (item) {\n            var str = '';\n            switch (item.changes) {\n                case 'deleted':\n                    str += ansi_colors_1.default.red(item.changes);\n                    break;\n                case 'added':\n                    str += ansi_colors_1.default.green(item.changes);\n                    break;\n                case 'modified':\n                    str += ansi_colors_1.default.yellow(item.changes);\n                    break;\n                case 'untracked':\n                    str += ansi_colors_1.default.grey(item.changes);\n                    break;\n                default:\n                    str += item.changes;\n                    break;\n            }\n            str += ' ';\n            str += item.path;\n            logger_1.default.log(str);\n        });\n        if (typeof done === 'function')\n            done();\n    });\n}\nfunction commit() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github)\n        return Promise.resolve(null);\n    var now = (0, moment_timezone_1.default)().tz((0, _config_1.getConfig)().timezone).format('LLL');\n    var commitRoot = function () {\n        return new Promise(function (resolve) {\n            github.status().then(function (changes) {\n                logger_1.default.log('changes', changes.length, (0, upath_1.toUnix)(github.cwd).replace((0, upath_1.toUnix)(process.cwd()), ''));\n                if (changes.length > 0) {\n                    github.add('-A').then(function () {\n                        github.commit('update site ' + now).then(function () {\n                            resolve(null);\n                        });\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            });\n        });\n    };\n    var commitSubmodule = function () {\n        var _this = this;\n        return new Promise(function (resolve) {\n            if (github.submodule.hasSubmodule()) {\n                var info_1 = github.submodule.get();\n                var commitSubmoduleChild_1 = function (sub) { return __awaiter(_this, void 0, void 0, function () {\n                    var submodule, items;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                submodule = new git_command_helper_1.default(sub.root);\n                                return [4 /*yield*/, submodule.status()];\n                            case 1:\n                                items = _a.sent();\n                                if (!(items.length > 0)) return [3 /*break*/, 4];\n                                return [4 /*yield*/, submodule.add('-A')];\n                            case 2:\n                                _a.sent();\n                                return [4 /*yield*/, submodule.commit(\"update \".concat(sub.path, \" \").concat(now), 'am')];\n                            case 3:\n                                _a.sent();\n                                _a.label = 4;\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n                var iterate_1 = function () {\n                    return new Promise(function (resolveIt) {\n                        // resolve directly when submodule items no made changes\n                        if (info_1.length === 0)\n                            return resolveIt(null);\n                        commitSubmoduleChild_1(info_1[0])\n                            .catch(noop)\n                            .finally(function () {\n                            info_1.shift();\n                            // re-iterate when submodule items not committed\n                            if (info_1.length > 0)\n                                return iterate_1();\n                            // resolves all\n                            resolveIt(null);\n                        });\n                    });\n                };\n                iterate_1().then(function () {\n                    resolve(null);\n                });\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        commitSubmodule()\n            .then(commitRoot)\n            .then(function () { return resolve(null); });\n    });\n}\nfunction noop() {\n    //\n}\nfunction push() {\n    var github = (0, _config_1.deployConfig)().github;\n    if (!github) {\n        return;\n    }\n    var submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n    var pushSubmodule = function (submodule) {\n        var url = submodule.url, branch = submodule.branch, root = submodule.root;\n        if (!submodule.github) {\n            submodule.github = new git_command_helper_1.default(root);\n        }\n        var github = submodule.github;\n        return new Promise(function (resolvePush) {\n            var setR = function () { return github.setremote(url); };\n            var setB = function () { return github.setbranch(branch); };\n            Promise.all([setR(), setB()]).then(function () {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(root), 'can push', allowed);\n                    if (allowed) {\n                        // push then resolve\n                        github.push(false, { stdio: 'pipe' }).then(resolvePush);\n                    }\n                    else {\n                        github.status().then(function (changes) {\n                            if (changes.length > 0) {\n                                logger_1.default.log('submodule', workspace(root), 'changes not staged');\n                                // resolve changes not staged\n                                resolvePush(null);\n                            }\n                            else {\n                                github.isUpToDate().then(function (updated) {\n                                    logger_1.default.log('submodule', workspace(root), 'updated', updated);\n                                    // resolve is up to date\n                                    resolvePush(null);\n                                });\n                            }\n                        });\n                    }\n                });\n            });\n        });\n    };\n    var iterateSubmodule = function () {\n        return new Promise(function (resolve) {\n            if (submodules.length === 0) {\n                resolve(null);\n            }\n            else {\n                var submodule = submodules.shift();\n                if (submodule) {\n                    pushSubmodule(submodule).then(function () {\n                        if (submodules.length > 0) {\n                            iterateSubmodule().then(resolve);\n                        }\n                        else {\n                            resolve(null);\n                        }\n                    });\n                }\n                else {\n                    resolve(null);\n                }\n            }\n        });\n    };\n    return new Promise(function (resolve) {\n        iterateSubmodule()\n            .then(function () {\n            return new Promise(function (resolvePush) {\n                github.canPush().then(function (allowed) {\n                    logger_1.default.log(workspace(github.cwd), 'can push', allowed);\n                    if (allowed) {\n                        github.push().then(resolvePush);\n                    }\n                });\n            });\n        })\n            .then(resolve);\n        //pushSubmodule(submodules[1]).then(resolve);\n    });\n}\ngulp_1.default.task('deploy:push', push);\ngulp_1.default.task('deploy:status', status);\ngulp_1.default.task('deploy:commit', commit);\ngulp_1.default.task('deploy:pull', pull);\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str) {\n    return (0, upath_1.toUnix)(str).replace((0, upath_1.toUnix)(process.cwd()), '');\n}\n// deploy\ngulp_1.default.task('deploy', gulp_1.default.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZGVwbG95LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsc0RBQWdDO0FBQ2hDLHlCQUFnQztBQUNoQywwRUFBMEQ7QUFDMUQsdURBQTJEO0FBQzNELDhDQUFrRDtBQUNsRCxvRUFBcUM7QUFDckMsK0JBQXFDO0FBQ3JDLHdCQUFzQjtBQUN0QiwyQkFBeUI7QUFDekIsMERBQW9DO0FBQ3BDLHFDQUFvRDtBQUVwRDs7O0dBR0c7QUFDSCxTQUFnQixPQUFPO0lBQ2IsSUFBQSxTQUFTLEdBQUssSUFBQSxzQkFBWSxHQUFFLFVBQW5CLENBQW9CO0lBQ3JDLElBQU0sU0FBUyxHQUFHLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM5RCxPQUFPLGNBQUk7U0FDUixHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxxQkFBcUIsQ0FBQyxFQUFFO1FBQ2hFLEdBQUcsRUFBRSxTQUFTO1FBQ2QsR0FBRyxFQUFFLElBQUk7S0FDVixDQUFDO1NBQ0QsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDMUIsRUFBRSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQVZELDBCQVVDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBZ0IsWUFBWTtJQUMxQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFVLE9BQU87UUFDbkMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNwQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxD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QUFNLEVBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUEsY0FBTSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsY0FBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxlQUFlLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5kZXBsb3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuc2lDb2xvcnMgZnJvbSAnYW5zaS1jb2xvcnMnO1xuaW1wb3J0IEJsdWViaXJkIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGdpdEhlbHBlciB9IGZyb20gJ2dpdC1jb21tYW5kLWhlbHBlcic7XG5pbXBvcnQgeyBzcGF3bkFzeW5jIH0gZnJvbSAnZ2l0LWNvbW1hbmQtaGVscGVyL2Rpc3Qvc3Bhd24nO1xuaW1wb3J0IGd1bHAsIHsgVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfSBmcm9tICdndWxwJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50LXRpbWV6b25lJztcbmltcG9ydCB7IGpvaW4sIHRvVW5peCB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZGVwbG95Q29uZmlnLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG4vKipcbiAqIGNvcHkgZ2VuZXJhdGVkIGZpbGVzIChfY29uZmlnX3ltbC5wdWJsaWNfZGlyKSB0byBkZXBsb3kgZGlyIChydW4gYWZ0ZXIgZ2VuZXJhdGVkKVxuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNvcHlHZW4oKSB7XG4gIGNvbnN0IHsgZGVwbG95RGlyIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgY29uc3QgcHVibGljRGlyID0gam9pbihwcm9jZXNzLmN3ZCgpLCBnZXRDb25maWcoKS5wdWJsaWNfZGlyKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKionLCAnISoqLy5naXQqJywgJyEqKi90bXAvKionLCAnISoqL25vZGVfbW9kdWxlcy8qKiddLCB7XG4gICAgICBjd2Q6IHB1YmxpY0RpcixcbiAgICAgIGRvdDogdHJ1ZVxuICAgIH0pXG4gICAgLnBpcGUoZ3VscC5kZXN0KGRlcGxveURpcikpXG4gICAgLm9uKCdlcnJvcicsIGNvbnNvbGUudHJhY2UpO1xufVxuXG4vKipcbiAqIGFzeW5jaHJvbm91cyBjb3B5IGdlbmVyYXRlZCBmaWxlcyAoX2NvbmZpZ195bWwucHVibGljX2RpcikgdG8gZGVwbG95IGRpciAocnVuIGFmdGVyIGdlbmVyYXRlZClcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3luY0NvcHlHZW4oKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICBjb3B5R2VuKCkub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbi8vIGNvcHkgcHVibGljIHRvIC5kZXBsb3lfZ2l0XG5ndWxwLnRhc2soJ2RlcGxveTpjb3B5JywgY29weUdlbik7XG5cbi8qKlxuICogZ2l0IHB1bGwgb24gZGVwbG95IGRpclxuICogQHBhcmFtIGRvbmVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVsbChkb25lOiBUYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgY3dkID0gY29uZmlnLmRlcGxveS5kZXBsb3lEaXI7XG4gIGNvbnN0IGdoID0gY29uZmlnLmRlcGxveS5naXRodWI7XG4gIGNvbnN0IGRvUHVsbCA9IGFzeW5jIChjd2Q6IHN0cmluZykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ2NvbmZpZycsICdwdWxsLnJlYmFzZScsICdmYWxzZSddLCB7XG4gICAgICAgIGN3ZFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gTG9nZ2VyLmxvZyhlLm1lc3NhZ2UsIHN1Yi5yb290KTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgTG9nZ2VyLmxvZygncHVsbGluZycsIGN3ZCk7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbJ3B1bGwnLCAnLVgnLCAndGhlaXJzJ10sIHtcbiAgICAgICAgY3dkLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBMb2dnZXIubG9nKCdjYW5ub3QgcHVsbCcsIGN3ZCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNsb25lID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghZXhpc3RzU3luYyhjd2QpKSB7XG4gICAgICBhd2FpdCBzcGF3bkFzeW5jKCdnaXQnLCBbLi4uJ2Nsb25lIC1iIG1hc3RlciAtLXNpbmdsZS1icmFuY2gnLnNwbGl0KCcgJyksIGNvbmZpZy5kZXBsb3kucmVwbywgJy5kZXBsb3lfZ2l0J10sIHtcbiAgICAgICAgY3dkOiBfX2Rpcm5hbWVcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBhd2FpdCBjbG9uZSgpO1xuICBkb1B1bGwoY3dkKTtcbiAgaWYgKGdoKSB7XG4gICAgY29uc3Qgc3VibW9kdWxlcyA9IGdoLnN1Ym1vZHVsZS5nZXQoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1Ym1vZHVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN1YiA9IHN1Ym1vZHVsZXNbaV07XG5cbiAgICAgIGRvUHVsbChzdWIucm9vdCk7XG4gICAgfVxuICB9XG4gIGRvbmUoKTtcbn1cblxuZnVuY3Rpb24gc3RhdHVzKGRvbmU/OiBndWxwLlRhc2tGdW5jdGlvbkNhbGxiYWNrKSB7XG4gIGNvbnN0IHsgZ2l0aHViIH0gPSBkZXBsb3lDb25maWcoKTtcbiAgaWYgKCFnaXRodWIpIHJldHVybjtcbiAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKHN0YXR1c2VzKSA9PiB7XG4gICAgc3RhdHVzZXMubWFwKChpdGVtKSA9PiB7XG4gICAgICBsZXQgc3RyID0gJyc7XG5cbiAgICAgIHN3aXRjaCAoaXRlbS5jaGFuZ2VzKSB7XG4gICAgICAgIGNhc2UgJ2RlbGV0ZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnJlZChpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhZGRlZCc6XG4gICAgICAgICAgc3RyICs9IGFuc2lDb2xvcnMuZ3JlZW4oaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbW9kaWZpZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLnllbGxvdyhpdGVtLmNoYW5nZXMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd1bnRyYWNrZWQnOlxuICAgICAgICAgIHN0ciArPSBhbnNpQ29sb3JzLmdyZXkoaXRlbS5jaGFuZ2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBzdHIgKz0gaXRlbS5jaGFuZ2VzO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBzdHIgKz0gJyAnO1xuICAgICAgc3RyICs9IGl0ZW0ucGF0aDtcbiAgICAgIExvZ2dlci5sb2coc3RyKTtcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2YgZG9uZSA9PT0gJ2Z1bmN0aW9uJykgZG9uZSgpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY29tbWl0KCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICBjb25zdCBub3cgPSBtb21lbnQoKS50eihnZXRDb25maWcoKS50aW1lem9uZSkuZm9ybWF0KCdMTEwnKTtcbiAgY29uc3QgY29tbWl0Um9vdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGdpdGh1Yi5zdGF0dXMoKS50aGVuKChjaGFuZ2VzKSA9PiB7XG4gICAgICAgIExvZ2dlci5sb2coJ2NoYW5nZXMnLCBjaGFuZ2VzLmxlbmd0aCwgdG9Vbml4KGdpdGh1Yi5jd2QpLnJlcGxhY2UodG9Vbml4KHByb2Nlc3MuY3dkKCkpLCAnJykpO1xuICAgICAgICBpZiAoY2hhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZ2l0aHViLmFkZCgnLUEnKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGdpdGh1Yi5jb21taXQoJ3VwZGF0ZSBzaXRlICcgKyBub3cpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGNvbW1pdFN1Ym1vZHVsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIGlmIChnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpKSB7XG4gICAgICAgIGNvbnN0IGluZm8gPSBnaXRodWIuc3VibW9kdWxlLmdldCgpO1xuICAgICAgICBjb25zdCBjb21taXRTdWJtb2R1bGVDaGlsZCA9IGFzeW5jIChzdWI6ICh0eXBlb2YgaW5mbylbbnVtYmVyXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IG5ldyBnaXRIZWxwZXIoc3ViLnJvb3QpO1xuICAgICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgc3VibW9kdWxlLnN0YXR1cygpO1xuICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCBzdWJtb2R1bGUuYWRkKCctQScpO1xuICAgICAgICAgICAgYXdhaXQgc3VibW9kdWxlLmNvbW1pdChgdXBkYXRlICR7c3ViLnBhdGh9ICR7bm93fWAsICdhbScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaXRlcmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVJdCkgPT4ge1xuICAgICAgICAgICAgLy8gcmVzb2x2ZSBkaXJlY3RseSB3aGVuIHN1Ym1vZHVsZSBpdGVtcyBubyBtYWRlIGNoYW5nZXNcbiAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHJlc29sdmVJdChudWxsKTtcbiAgICAgICAgICAgIGNvbW1pdFN1Ym1vZHVsZUNoaWxkKGluZm9bMF0pXG4gICAgICAgICAgICAgIC5jYXRjaChub29wKVxuICAgICAgICAgICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaW5mby5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIC8vIHJlLWl0ZXJhdGUgd2hlbiBzdWJtb2R1bGUgaXRlbXMgbm90IGNvbW1pdHRlZFxuICAgICAgICAgICAgICAgIGlmIChpbmZvLmxlbmd0aCA+IDApIHJldHVybiBpdGVyYXRlKCk7XG4gICAgICAgICAgICAgICAgLy8gcmVzb2x2ZXMgYWxsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZUl0KG51bGwpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgaXRlcmF0ZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbW1pdFN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihjb21taXRSb290KVxuICAgICAgLnRoZW4oKCkgPT4gcmVzb2x2ZShudWxsKSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBub29wKCkge1xuICAvL1xufVxuXG5mdW5jdGlvbiBwdXNoKCkge1xuICBjb25zdCB7IGdpdGh1YiB9ID0gZGVwbG95Q29uZmlnKCk7XG4gIGlmICghZ2l0aHViKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHN1Ym1vZHVsZXMgPSBnaXRodWIuc3VibW9kdWxlLmhhc1N1Ym1vZHVsZSgpID8gZ2l0aHViLnN1Ym1vZHVsZS5nZXQoKSA6IFtdO1xuICBjb25zdCBwdXNoU3VibW9kdWxlID0gZnVuY3Rpb24gKHN1Ym1vZHVsZTogKHR5cGVvZiBzdWJtb2R1bGVzKVtudW1iZXJdKSB7XG4gICAgY29uc3QgeyB1cmwsIGJyYW5jaCwgcm9vdCB9ID0gc3VibW9kdWxlO1xuICAgIGlmICghc3VibW9kdWxlLmdpdGh1Yikge1xuICAgICAgc3VibW9kdWxlLmdpdGh1YiA9IG5ldyBnaXRIZWxwZXIocm9vdCk7XG4gICAgfVxuICAgIGNvbnN0IHsgZ2l0aHViIH0gPSBzdWJtb2R1bGU7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlUHVzaCkgPT4ge1xuICAgICAgY29uc3Qgc2V0UiA9ICgpID0+IGdpdGh1Yi5zZXRyZW1vdGUodXJsKTtcbiAgICAgIGNvbnN0IHNldEIgPSAoKSA9PiBnaXRodWIuc2V0YnJhbmNoKGJyYW5jaCk7XG4gICAgICBQcm9taXNlLmFsbChbc2V0UigpLCBzZXRCKCldKS50aGVuKCgpID0+IHtcbiAgICAgICAgZ2l0aHViLmNhblB1c2goKS50aGVuKChhbGxvd2VkKSA9PiB7XG4gICAgICAgICAgTG9nZ2VyLmxvZyh3b3Jrc3BhY2Uocm9vdCksICdjYW4gcHVzaCcsIGFsbG93ZWQpO1xuICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAvLyBwdXNoIHRoZW4gcmVzb2x2ZVxuICAgICAgICAgICAgZ2l0aHViLnB1c2goZmFsc2UsIHsgc3RkaW86ICdwaXBlJyB9KS50aGVuKHJlc29sdmVQdXNoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2l0aHViLnN0YXR1cygpLnRoZW4oKGNoYW5nZXMpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIExvZ2dlci5sb2coJ3N1Ym1vZHVsZScsIHdvcmtzcGFjZShyb290KSwgJ2NoYW5nZXMgbm90IHN0YWdlZCcpO1xuICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgY2hhbmdlcyBub3Qgc3RhZ2VkXG4gICAgICAgICAgICAgICAgcmVzb2x2ZVB1c2gobnVsbCk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZ2l0aHViLmlzVXBUb0RhdGUoKS50aGVuKCh1cGRhdGVkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBMb2dnZXIubG9nKCdzdWJtb2R1bGUnLCB3b3Jrc3BhY2Uocm9vdCksICd1cGRhdGVkJywgdXBkYXRlZCk7XG4gICAgICAgICAgICAgICAgICAvLyByZXNvbHZlIGlzIHVwIHRvIGRhdGVcbiAgICAgICAgICAgICAgICAgIHJlc29sdmVQdXNoKG51bGwpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGl0ZXJhdGVTdWJtb2R1bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoc3VibW9kdWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHN1Ym1vZHVsZSA9IHN1Ym1vZHVsZXMuc2hpZnQoKTtcbiAgICAgICAgaWYgKHN1Ym1vZHVsZSkge1xuICAgICAgICAgIHB1c2hTdWJtb2R1bGUoc3VibW9kdWxlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJtb2R1bGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgaXRlcmF0ZVN1Ym1vZHVsZSgpLnRoZW4ocmVzb2x2ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgaXRlcmF0ZVN1Ym1vZHVsZSgpXG4gICAgICAudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZVB1c2gpID0+IHtcbiAgICAgICAgICBnaXRodWIuY2FuUHVzaCgpLnRoZW4oKGFsbG93ZWQpID0+IHtcbiAgICAgICAgICAgIExvZ2dlci5sb2cod29ya3NwYWNlKGdpdGh1Yi5jd2QpLCAnY2FuIHB1c2gnLCBhbGxvd2VkKTtcbiAgICAgICAgICAgIGlmIChhbGxvd2VkKSB7XG4gICAgICAgICAgICAgIGdpdGh1Yi5wdXNoKCkudGhlbihyZXNvbHZlUHVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUpO1xuICAgIC8vcHVzaFN1Ym1vZHVsZShzdWJtb2R1bGVzWzFdKS50aGVuKHJlc29sdmUpO1xuICB9KTtcbn1cblxuZ3VscC50YXNrKCdkZXBsb3k6cHVzaCcsIHB1c2gpO1xuZ3VscC50YXNrKCdkZXBsb3k6c3RhdHVzJywgc3RhdHVzKTtcbmd1bHAudGFzaygnZGVwbG95OmNvbW1pdCcsIGNvbW1pdCk7XG5ndWxwLnRhc2soJ2RlcGxveTpwdWxsJywgcHVsbCk7XG5cbi8qKlxuICogZ2V0IHJlbGF0aXZlIHBhdGggZnJvbSB3b3Jrc3BhY2VcbiAqIEBwYXJhbSBzdHJcbiAqIEByZXR1cm5zXG4gKi9cbmZ1bmN0aW9uIHdvcmtzcGFjZShzdHI6IHN0cmluZykge1xuICByZXR1cm4gdG9Vbml4KHN0cikucmVwbGFjZSh0b1VuaXgocHJvY2Vzcy5jd2QoKSksICcnKTtcbn1cblxuLy8gZGVwbG95XG5ndWxwLnRhc2soJ2RlcGxveScsIGd1bHAuc2VyaWVzKCdkZXBsb3k6cHVsbCcsICdkZXBsb3k6Y29weScsICdzYWZlbGluaycsICdkZXBsb3k6Y29tbWl0JywgJ2RlcGxveTpwdXNoJykpO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport Bluebird from 'bluebird';\nimport { existsSync } from 'fs';\nimport { default as gitHelper } from 'git-command-helper';\nimport { spawnAsync } from 'git-command-helper/dist/spawn';\nimport gulp, { TaskFunctionCallback } from 'gulp';\nimport moment from 'moment-timezone';\nimport { join, toUnix } from 'upath';\nimport './gulp.clean';\nimport './gulp.safelink';\nimport Logger from './utils/logger';\nimport { deployConfig, getConfig } from './_config';\n\n/**\n * copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function copyGen() {\n  const { deployDir } = deployConfig();\n  const publicDir = join(process.cwd(), getConfig().public_dir);\n  return gulp\n    .src(['**/**', '!**/.git*', '!**/tmp/**', '!**/node_modules/**'], {\n      cwd: publicDir,\n      dot: true\n    })\n    .pipe(gulp.dest(deployDir))\n    .on('error', console.trace);\n}\n\n/**\n * asynchronous copy generated files (_config_yml.public_dir) to deploy dir (run after generated)\n * @returns\n */\nexport function asyncCopyGen() {\n  return new Bluebird(function (resolve) {\n    copyGen().once('end', function () {\n      resolve(null);\n    });\n  });\n}\n\n// copy public to .deploy_git\ngulp.task('deploy:copy', copyGen);\n\n/**\n * git pull on deploy dir\n * @param done\n */\nasync function pull(done: TaskFunctionCallback) {\n  const config = getConfig();\n  const cwd = config.deploy.deployDir;\n  const gh = config.deploy.github;\n  const doPull = async (cwd: string) => {\n    try {\n      await spawnAsync('git', ['config', 'pull.rebase', 'false'], {\n        cwd\n      });\n    } catch (e) {\n      // Logger.log(e.message, sub.root);\n    }\n\n    try {\n      Logger.log('pulling', cwd);\n      await spawnAsync('git', ['pull', '-X', 'theirs'], {\n        cwd,\n        stdio: 'pipe'\n      });\n    } catch (e) {\n      Logger.log('cannot pull', cwd);\n    }\n  };\n\n  const clone = async () => {\n    if (!existsSync(cwd)) {\n      await spawnAsync('git', [...'clone -b master --single-branch'.split(' '), config.deploy.repo, '.deploy_git'], {\n        cwd: __dirname\n      });\n    }\n  };\n\n  await clone();\n  doPull(cwd);\n  if (gh) {\n    const submodules = gh.submodule.get();\n    for (let i = 0; i < submodules.length; i++) {\n      const sub = submodules[i];\n\n      doPull(sub.root);\n    }\n  }\n  done();\n}\n\nfunction status(done?: gulp.TaskFunctionCallback) {\n  const { github } = deployConfig();\n  if (!github) return;\n  github.status().then((statuses) => {\n    statuses.map((item) => {\n      let str = '';\n\n      switch (item.changes) {\n        case 'deleted':\n          str += ansiColors.red(item.changes);\n          break;\n        case 'added':\n          str += ansiColors.green(item.changes);\n          break;\n        case 'modified':\n          str += ansiColors.yellow(item.changes);\n          break;\n        case 'untracked':\n          str += ansiColors.grey(item.changes);\n          break;\n        default:\n          str += item.changes;\n          break;\n      }\n\n      str += ' ';\n      str += item.path;\n      Logger.log(str);\n    });\n\n    if (typeof done === 'function') done();\n  });\n}\n\nfunction commit() {\n  const { github } = deployConfig();\n  if (!github) return Promise.resolve(null);\n  const now = moment().tz(getConfig().timezone).format('LLL');\n  const commitRoot = function () {\n    return new Promise((resolve) => {\n      github.status().then((changes) => {\n        Logger.log('changes', changes.length, toUnix(github.cwd).replace(toUnix(process.cwd()), ''));\n        if (changes.length > 0) {\n          github.add('-A').then(() => {\n            github.commit('update site ' + now).then(() => {\n              resolve(null);\n            });\n          });\n        } else {\n          resolve(null);\n        }\n      });\n    });\n  };\n  const commitSubmodule = function () {\n    return new Promise((resolve) => {\n      if (github.submodule.hasSubmodule()) {\n        const info = github.submodule.get();\n        const commitSubmoduleChild = async (sub: (typeof info)[number]) => {\n          const submodule = new gitHelper(sub.root);\n          const items = await submodule.status();\n          if (items.length > 0) {\n            await submodule.add('-A');\n            await submodule.commit(`update ${sub.path} ${now}`, 'am');\n          }\n        };\n        const iterate = function () {\n          return new Promise((resolveIt) => {\n            // resolve directly when submodule items no made changes\n            if (info.length === 0) return resolveIt(null);\n            commitSubmoduleChild(info[0])\n              .catch(noop)\n              .finally(() => {\n                info.shift();\n                // re-iterate when submodule items not committed\n                if (info.length > 0) return iterate();\n                // resolves all\n                resolveIt(null);\n              });\n          });\n        };\n        iterate().then(() => {\n          resolve(null);\n        });\n      }\n    });\n  };\n\n  return new Promise((resolve) => {\n    commitSubmodule()\n      .then(commitRoot)\n      .then(() => resolve(null));\n  });\n}\n\nfunction noop() {\n  //\n}\n\nfunction push() {\n  const { github } = deployConfig();\n  if (!github) {\n    return;\n  }\n  const submodules = github.submodule.hasSubmodule() ? github.submodule.get() : [];\n  const pushSubmodule = function (submodule: (typeof submodules)[number]) {\n    const { url, branch, root } = submodule;\n    if (!submodule.github) {\n      submodule.github = new gitHelper(root);\n    }\n    const { github } = submodule;\n    return new Promise((resolvePush) => {\n      const setR = () => github.setremote(url);\n      const setB = () => github.setbranch(branch);\n      Promise.all([setR(), setB()]).then(() => {\n        github.canPush().then((allowed) => {\n          Logger.log(workspace(root), 'can push', allowed);\n          if (allowed) {\n            // push then resolve\n            github.push(false, { stdio: 'pipe' }).then(resolvePush);\n          } else {\n            github.status().then((changes) => {\n              if (changes.length > 0) {\n                Logger.log('submodule', workspace(root), 'changes not staged');\n                // resolve changes not staged\n                resolvePush(null);\n              } else {\n                github.isUpToDate().then((updated) => {\n                  Logger.log('submodule', workspace(root), 'updated', updated);\n                  // resolve is up to date\n                  resolvePush(null);\n                });\n              }\n            });\n          }\n        });\n      });\n    });\n  };\n  const iterateSubmodule = function () {\n    return new Promise((resolve) => {\n      if (submodules.length === 0) {\n        resolve(null);\n      } else {\n        const submodule = submodules.shift();\n        if (submodule) {\n          pushSubmodule(submodule).then(() => {\n            if (submodules.length > 0) {\n              iterateSubmodule().then(resolve);\n            } else {\n              resolve(null);\n            }\n          });\n        } else {\n          resolve(null);\n        }\n      }\n    });\n  };\n  return new Promise((resolve) => {\n    iterateSubmodule()\n      .then(function () {\n        return new Promise((resolvePush) => {\n          github.canPush().then((allowed) => {\n            Logger.log(workspace(github.cwd), 'can push', allowed);\n            if (allowed) {\n              github.push().then(resolvePush);\n            }\n          });\n        });\n      })\n      .then(resolve);\n    //pushSubmodule(submodules[1]).then(resolve);\n  });\n}\n\ngulp.task('deploy:push', push);\ngulp.task('deploy:status', status);\ngulp.task('deploy:commit', commit);\ngulp.task('deploy:pull', pull);\n\n/**\n * get relative path from workspace\n * @param str\n * @returns\n */\nfunction workspace(str: string) {\n  return toUnix(str).replace(toUnix(process.cwd()), '');\n}\n\n// deploy\ngulp.task('deploy', gulp.series('deploy:pull', 'deploy:copy', 'safelink', 'deploy:commit', 'deploy:push'));\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/90/gulpdeploy_90b84dd58a01145dad19e958e2ead383.map","wrapperLength":82},"result":{"scriptId":"14625","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.deploy.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":39615,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":39612,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":6},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":4}],"isBlockCoverage":true},{"functionName":"copyGen","ranges":[{"startOffset":4398,"endOffset":4808,"count":0}],"isBlockCoverage":false},{"functionName":"asyncCopyGen","ranges":[{"startOffset":4954,"endOffset":5127,"count":0}],"isBlockCoverage":false},{"functionName":"pull","ranges":[{"startOffset":5289,"endOffset":9078,"count":0}],"isBlockCoverage":false},{"functionName":"status","ranges":[{"startOffset":9079,"endOffset":10135,"count":0}],"isBlockCoverage":false},{"functionName":"commit","ranges":[{"startOffset":10136,"endOffset":13560,"count":0}],"isBlockCoverage":false},{"functionName":"noop","ranges":[{"startOffset":13561,"endOffset":13587,"count":0}],"isBlockCoverage":false},{"functionName":"push","ranges":[{"startOffset":13588,"endOffset":16844,"count":0}],"isBlockCoverage":false},{"functionName":"workspace","ranges":[{"startOffset":17091,"endOffset":17203,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSafelink = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar path_1 = __importDefault(require(\"path\"));\nvar safelinkify_1 = __importDefault(require(\"safelinkify\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nfunction taskSafelink(_done, cwd) {\n    var _this = this;\n    var _a, _b, _c;\n    var config = (0, _config_1.getConfig)();\n    var workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n    var logname = ansi_colors_1.default.greenBright('safelink');\n    // skip process safelink\n    var hasError = false;\n    if (!config.external_link.safelink) {\n        hasError = true;\n        logger_1.default.log(logname, 'config safelink', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.redirect) {\n        hasError = true;\n        logger_1.default.log(logname, 'safelink redirector', ansi_colors_1.default.red('not configured'));\n    }\n    if (!config.external_link.safelink.enable) {\n        hasError = true;\n        logger_1.default.log(logname, ansi_colors_1.default.red('disabled'));\n    }\n    if ((0, fs_1.existsSync)(workingDir) && !hasError) {\n        var defaultConfigSafelink = {\n            enable: false,\n            exclude: [],\n            redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n            password: 'root',\n            type: 'base64'\n        };\n        var configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n        var baseURL = '';\n        try {\n            baseURL = new URL(config.url).host;\n        }\n        catch (_d) {\n            //\n        }\n        var opt = {\n            // exclude patterns (dont anonymize these patterns)\n            exclude: __spreadArray(__spreadArray(__spreadArray([], __read((((_a = config.external_link) === null || _a === void 0 ? void 0 : _a.exclude) || [])), false), [\n                /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n                /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n                baseURL,\n                'www.webmanajemen.com',\n                'https://github.com/dimaslanjaka',\n                'https://facebook.com/dimaslanjaka1',\n                'dimaslanjaka.github.io'\n            ], false), __read(configSafelink.exclude), false).filter(function (x, i, a) {\n                // remove duplicate and empties\n                return a.indexOf(x) === i && x.toString().trim().length !== 0;\n            }),\n            redirect: [],\n            //redirect: [, configSafelink.redirect],\n            password: configSafelink.password || config.external_link.safelink.password,\n            type: configSafelink.type || config.external_link.safelink.type\n        };\n        if (configSafelink.redirect) {\n            opt.redirect = configSafelink.redirect;\n        }\n        var safelink_1 = new safelinkify_1.default.safelink(opt);\n        var gulpopt = {\n            cwd: workingDir,\n            ignore: []\n        };\n        if (Array.isArray(config.external_link.exclude)) {\n            (_b = gulpopt.ignore) === null || _b === void 0 ? void 0 : _b.concat.apply(_b, __spreadArray([], __read(config.external_link.exclude), false));\n        }\n        if (Array.isArray(configSafelink.exclude)) {\n            var ignore = configSafelink.exclude.filter(function (str) {\n                if (typeof str === 'string') {\n                    return !/^(https?:\\/|www.)/.test(str);\n                }\n                return false;\n            });\n            (_c = gulpopt.ignore) === null || _c === void 0 ? void 0 : _c.concat.apply(_c, __spreadArray([], __read(ignore), false));\n        }\n        return gulp_1.default\n            .src(['**/*.{html,htm}'], gulpopt)\n            .pipe((0, gulp_cache_1.default)({ name: 'safelink' }))\n            .pipe(through2_1.default.obj(function (file, _enc, next) { return __awaiter(_this, void 0, void 0, function () {\n            var content, parsed;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        // drops\n                        if (file.isNull() || file.isDirectory() || !file || file.isStream())\n                            return [2 /*return*/, next()];\n                        if (!(file.isBuffer() && Buffer.isBuffer(file.contents))) return [3 /*break*/, 2];\n                        content = file.contents.toString('utf-8');\n                        return [4 /*yield*/, safelink_1.parse(content)];\n                    case 1:\n                        parsed = _a.sent();\n                        if (typeof parsed === 'string') {\n                            // Logger.log(parsed);\n                            file.contents = Buffer.from(parsed);\n                            return [2 /*return*/, next(null, file)];\n                        }\n                        _a.label = 2;\n                    case 2:\n                        logger_1.default.log('cannot parse', file.path);\n                        // drop fails\n                        next();\n                        return [2 /*return*/];\n                }\n            });\n        }); }))\n            .pipe(gulp_1.default.dest(workingDir));\n    }\n    else {\n        var wstream = (0, fm_1.createWriteStream)(path_1.default.join(config.cwd, 'tmp/errors/safelink.log'));\n        return wstream;\n    }\n}\nexports.taskSafelink = taskSafelink;\n// safelinkify the deploy folder\ngulp_1.default.task('safelink', taskSafelink);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2FmZWxpbmsudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFxQztBQUNyQyx5QkFBZ0M7QUFDaEMsOENBQXdCO0FBQ3hCLDhDQUF3QjtBQUN4Qiw0REFBa0Q7QUFDbEQsc0RBQWdDO0FBRWhDLHVFQUFpRDtBQUNqRCxpQ0FBK0M7QUFDL0MsMERBQW9DO0FBQ3BDLHFDQUFzQztBQUV0Qzs7Ozs7R0FLRztBQUNILFNBQWdCLFlBQVksQ0FBQyxLQUFvRCxFQUFFLEdBQStCO0lBQWxILGlCQThHQzs7SUE3R0MsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxHQUFFLENBQUM7SUFDM0IsSUFBTSxVQUFVLEdBQUcsT0FBTyxHQUFHLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO0lBQzNFLElBQU0sT0FBTyxHQUFHLHFCQUFVLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBRW5ELHdCQUF3QjtJQUN4QixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFO1FBQ2xDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLHFCQUFVLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztLQUMxRTtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDM0MsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUscUJB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LElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzt3QkFDdEMsYUFBYTt3QkFDYixJQUFJLEVBQUUsQ0FBQzs7OzthQUNSLENBQUMsQ0FDSDthQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7S0FDaEM7U0FBTTtRQUNMLElBQU0sT0FBTyxHQUFHLElBQUEsc0JBQWlCLEVBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLHlCQUF5QixDQUFDLENBQUMsQ0FBQztRQUNwRixPQUFPLE9BQU8sQ0FBQztLQUNoQjtBQUNILENBQUM7QUE5R0Qsb0NBOEdDO0FBRUQsZ0NBQWdDO0FBQ2hDLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxSZXBvc2l0b3JpZXNcXHN0YXRpYy1ibG9nLWdlbmVyYXRvclxcc3JjXFxndWxwLnNhZmVsaW5rLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNmLCB7IFNhZmVsaW5rT3B0aW9ucyB9IGZyb20gJ3NhZmVsaW5raWZ5JztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBTcmNPcHRpb25zIH0gZnJvbSAndmlueWwtZnMnO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IHsgY3JlYXRlV3JpdGVTdHJlYW0gfSBmcm9tICcuL3V0aWxzL2ZtJztcbmltcG9ydCBMb2dnZXIgZnJvbSAnLi91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBQcm9jZXNzIFNhZmVsaW5rIG9uIERlcGxveSBEaXJcbiAqIEBwYXJhbSBfZG9uZSBjYWxsYmFjayBmdW5jdGlvblxuICogQHBhcmFtIGN3ZCB3b3JraW5nIGRpcmVjdG9yeSB0byBzY2FuIGh0bWwnc1xuICogQHJldHVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTYWZlbGluayhfZG9uZT86IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q/OiB1bmRlZmluZWQgfCBudWxsIHwgc3RyaW5nKSB7XG4gIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpO1xuICBjb25zdCB3b3JraW5nRGlyID0gdHlwZW9mIGN3ZCA9PT0gJ3N0cmluZycgPyBjd2QgOiBjb25maWcuZGVwbG95LmRlcGxveURpcjtcbiAgY29uc3QgbG9nbmFtZSA9IGFuc2lDb2xvcnMuZ3JlZW5CcmlnaHQoJ3NhZmVsaW5rJyk7XG5cbiAgLy8gc2tpcCBwcm9jZXNzIHNhZmVsaW5rXG4gIGxldCBoYXNFcnJvciA9IGZhbHNlO1xuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rKSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ2NvbmZpZyBzYWZlbGluaycsIGFuc2lDb2xvcnMucmVkKCdub3QgY29uZmlndXJlZCcpKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnJlZGlyZWN0KSB7XG4gICAgaGFzRXJyb3IgPSB0cnVlO1xuICAgIExvZ2dlci5sb2cobG9nbmFtZSwgJ3NhZmVsaW5rIHJlZGlyZWN0b3InLCBhbnNpQ29sb3JzLnJlZCgnbm90IGNvbmZpZ3VyZWQnKSk7XG4gIH1cbiAgaWYgKCFjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay5lbmFibGUpIHtcbiAgICBoYXNFcnJvciA9IHRydWU7XG4gICAgTG9nZ2VyLmxvZyhsb2duYW1lLCBhbnNpQ29sb3JzLnJlZCgnZGlzYWJsZWQnKSk7XG4gIH1cblxuICBpZiAoZXhpc3RzU3luYyh3b3JraW5nRGlyKSAmJiAhaGFzRXJyb3IpIHtcbiAgICBjb25zdCBkZWZhdWx0Q29uZmlnU2FmZWxpbms6IFNhZmVsaW5rT3B0aW9ucyAmIFJlY29yZDxzdHJpbmcsIGFueT4gPSB7XG4gICAgICBlbmFibGU6IGZhbHNlLFxuICAgICAgZXhjbHVkZTogW10gYXMgc3RyaW5nW10sXG4gICAgICByZWRpcmVjdDogJ2h0dHBzOi8vd3d3LndlYm1hbmFqZW1lbi5jb20vcGFnZS9zYWZlbGluay5odG1sP3VybD0nLFxuICAgICAgcGFzc3dvcmQ6ICdyb290JyxcbiAgICAgIHR5cGU6ICdiYXNlNjQnXG4gICAgfTtcbiAgICBjb25zdCBjb25maWdTYWZlbGluayA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdENvbmZpZ1NhZmVsaW5rLCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluayB8fCB7fSk7XG4gICAgbGV0IGJhc2VVUkwgPSAnJztcbiAgICB0cnkge1xuICAgICAgYmFzZVVSTCA9IG5ldyBVUkwoY29uZmlnLnVybCkuaG9zdDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vXG4gICAgfVxuXG4gICAgY29uc3Qgb3B0OiBQYXJ0aWFsPFNhZmVsaW5rT3B0aW9ucz4gPSB7XG4gICAgICAvLyBleGNsdWRlIHBhdHRlcm5zIChkb250IGFub255bWl6ZSB0aGVzZSBwYXR0ZXJucylcbiAgICAgIGV4Y2x1ZGU6IFtcbiAgICAgICAgLi4uKGNvbmZpZy5leHRlcm5hbF9saW5rPy5leGNsdWRlIHx8IFtdKSxcbiAgICAgICAgL2h0dHBzPzpcXC9cXC8/KD86KFteKl0rKVxcLik/d2VibWFuYWplbWVuXFwuY29tLyxcbiAgICAgICAgLyhbYS16MC05XSg/OlthLXowLTktXXsxLDYxfVthLXowLTldKT9bLl0pKndlYm1hbmFqZW1lblxcLmNvbS8sXG4gICAgICAgIGJhc2VVUkwsXG4gICAgICAgICd3d3cud2VibWFuYWplbWVuLmNvbScsXG4gICAgICAgICdodHRwczovL2dpdGh1Yi5jb20vZGltYXNsYW5qYWthJyxcbiAgICAgICAgJ2h0dHBzOi8vZmFjZWJvb2suY29tL2RpbWFzbGFuamFrYTEnLFxuICAgICAgICAnZGltYXNsYW5qYWthLmdpdGh1Yi5pbycsXG4gICAgICAgIC4uLmNvbmZpZ1NhZmVsaW5rLmV4Y2x1ZGVcbiAgICAgIF0uZmlsdGVyKGZ1bmN0aW9uICh4LCBpLCBhKSB7XG4gICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGUgYW5kIGVtcHRpZXNcbiAgICAgICAgcmV0dXJuIGEuaW5kZXhPZih4KSA9PT0gaSAmJiB4LnRvU3RyaW5nKCkudHJpbSgpLmxlbmd0aCAhPT0gMDtcbiAgICAgIH0pLFxuICAgICAgcmVkaXJlY3Q6IFtdLFxuICAgICAgLy9yZWRpcmVjdDogWywgY29uZmlnU2FmZWxpbmsucmVkaXJlY3RdLFxuICAgICAgcGFzc3dvcmQ6IGNvbmZpZ1NhZmVsaW5rLnBhc3N3b3JkIHx8IGNvbmZpZy5leHRlcm5hbF9saW5rLnNhZmVsaW5rLnBhc3N3b3JkLFxuICAgICAgdHlwZTogY29uZmlnU2FmZWxpbmsudHlwZSB8fCBjb25maWcuZXh0ZXJuYWxfbGluay5zYWZlbGluay50eXBlXG4gICAgfTtcblxuICAgIGlmIChjb25maWdTYWZlbGluay5yZWRpcmVjdCkge1xuICAgICAgb3B0LnJlZGlyZWN0ID0gY29uZmlnU2FmZWxpbmsucmVkaXJlY3Q7XG4gICAgfVxuXG4gICAgY29uc3Qgc2FmZWxpbmsgPSBuZXcgc2Yuc2FmZWxpbmsob3B0KTtcblxuICAgIGNvbnN0IGd1bHBvcHQ6IFNyY09wdGlvbnMgPSB7XG4gICAgICBjd2Q6IHdvcmtpbmdEaXIsXG4gICAgICBpZ25vcmU6IFtdXG4gICAgfTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpKSB7XG4gICAgICBndWxwb3B0Lmlnbm9yZT8uY29uY2F0KC4uLmNvbmZpZy5leHRlcm5hbF9saW5rLmV4Y2x1ZGUpO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWdTYWZlbGluay5leGNsdWRlKSkge1xuICAgICAgY29uc3QgaWdub3JlID0gY29uZmlnU2FmZWxpbmsuZXhjbHVkZS5maWx0ZXIoKHN0cikgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHN0ciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gIS9eKGh0dHBzPzpcXC98d3d3LikvLnRlc3Qoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KSBhcyBzdHJpbmdbXTtcbiAgICAgIGd1bHBvcHQuaWdub3JlPy5jb25jYXQoLi4uaWdub3JlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3VscFxuICAgICAgLnNyYyhbJyoqLyoue2h0bWwsaHRtfSddLCBndWxwb3B0KVxuICAgICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzYWZlbGluaycgfSkpXG4gICAgICAucGlwZShcbiAgICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIChmaWxlLCBfZW5jLCBuZXh0KSA9PiB7XG4gICAgICAgICAgLy8gZHJvcHNcbiAgICAgICAgICBpZiAoZmlsZS5pc051bGwoKSB8fCBmaWxlLmlzRGlyZWN0b3J5KCkgfHwgIWZpbGUgfHwgZmlsZS5pc1N0cmVhbSgpKSByZXR1cm4gbmV4dCgpO1xuICAgICAgICAgIC8vIHByb2Nlc3NcbiAgICAgICAgICBpZiAoZmlsZS5pc0J1ZmZlcigpICYmIEJ1ZmZlci5pc0J1ZmZlcihmaWxlLmNvbnRlbnRzKSkge1xuICAgICAgICAgICAgLy8gZG8gc2FmZWxpbmtpZnlcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCd1dGYtOCcpO1xuICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gYXdhaXQgc2FmZWxpbmsucGFyc2UoY29udGVudCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcnNlZCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgLy8gTG9nZ2VyLmxvZyhwYXJzZWQpO1xuICAgICAgICAgICAgICBmaWxlLmNvbnRlbnRzID0gQnVmZmVyLmZyb20ocGFyc2VkKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5leHQobnVsbCwgZmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIExvZ2dlci5sb2coJ2Nhbm5vdCBwYXJzZScsIGZpbGUucGF0aCk7XG4gICAgICAgICAgLy8gZHJvcCBmYWlsc1xuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICAgIC5waXBlKGd1bHAuZGVzdCh3b3JraW5nRGlyKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgd3N0cmVhbSA9IGNyZWF0ZVdyaXRlU3RyZWFtKHBhdGguam9pbihjb25maWcuY3dkLCAndG1wL2Vycm9ycy9zYWZlbGluay5sb2cnKSk7XG4gICAgcmV0dXJuIHdzdHJlYW07XG4gIH1cbn1cblxuLy8gc2FmZWxpbmtpZnkgdGhlIGRlcGxveSBmb2xkZXJcbmd1bHAudGFzaygnc2FmZWxpbmsnLCB0YXNrU2FmZWxpbmspO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import ansiColors from 'ansi-colors';\nimport { existsSync } from 'fs';\nimport gulp from 'gulp';\nimport path from 'path';\nimport sf, { SafelinkOptions } from 'safelinkify';\nimport through2 from 'through2';\nimport { SrcOptions } from 'vinyl-fs';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport { createWriteStream } from './utils/fm';\nimport Logger from './utils/logger';\nimport { getConfig } from './_config';\n\n/**\n * Process Safelink on Deploy Dir\n * @param _done callback function\n * @param cwd working directory to scan html's\n * @returns\n */\nexport function taskSafelink(_done?: gulp.TaskFunctionCallback | null | undefined, cwd?: undefined | null | string) {\n  const config = getConfig();\n  const workingDir = typeof cwd === 'string' ? cwd : config.deploy.deployDir;\n  const logname = ansiColors.greenBright('safelink');\n\n  // skip process safelink\n  let hasError = false;\n  if (!config.external_link.safelink) {\n    hasError = true;\n    Logger.log(logname, 'config safelink', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.redirect) {\n    hasError = true;\n    Logger.log(logname, 'safelink redirector', ansiColors.red('not configured'));\n  }\n  if (!config.external_link.safelink.enable) {\n    hasError = true;\n    Logger.log(logname, ansiColors.red('disabled'));\n  }\n\n  if (existsSync(workingDir) && !hasError) {\n    const defaultConfigSafelink: SafelinkOptions & Record<string, any> = {\n      enable: false,\n      exclude: [] as string[],\n      redirect: 'https://www.webmanajemen.com/page/safelink.html?url=',\n      password: 'root',\n      type: 'base64'\n    };\n    const configSafelink = Object.assign(defaultConfigSafelink, config.external_link.safelink || {});\n    let baseURL = '';\n    try {\n      baseURL = new URL(config.url).host;\n    } catch {\n      //\n    }\n\n    const opt: Partial<SafelinkOptions> = {\n      // exclude patterns (dont anonymize these patterns)\n      exclude: [\n        ...(config.external_link?.exclude || []),\n        /https?:\\/\\/?(?:([^*]+)\\.)?webmanajemen\\.com/,\n        /([a-z0-9](?:[a-z0-9-]{1,61}[a-z0-9])?[.])*webmanajemen\\.com/,\n        baseURL,\n        'www.webmanajemen.com',\n        'https://github.com/dimaslanjaka',\n        'https://facebook.com/dimaslanjaka1',\n        'dimaslanjaka.github.io',\n        ...configSafelink.exclude\n      ].filter(function (x, i, a) {\n        // remove duplicate and empties\n        return a.indexOf(x) === i && x.toString().trim().length !== 0;\n      }),\n      redirect: [],\n      //redirect: [, configSafelink.redirect],\n      password: configSafelink.password || config.external_link.safelink.password,\n      type: configSafelink.type || config.external_link.safelink.type\n    };\n\n    if (configSafelink.redirect) {\n      opt.redirect = configSafelink.redirect;\n    }\n\n    const safelink = new sf.safelink(opt);\n\n    const gulpopt: SrcOptions = {\n      cwd: workingDir,\n      ignore: []\n    };\n\n    if (Array.isArray(config.external_link.exclude)) {\n      gulpopt.ignore?.concat(...config.external_link.exclude);\n    }\n    if (Array.isArray(configSafelink.exclude)) {\n      const ignore = configSafelink.exclude.filter((str) => {\n        if (typeof str === 'string') {\n          return !/^(https?:\\/|www.)/.test(str);\n        }\n        return false;\n      }) as string[];\n      gulpopt.ignore?.concat(...ignore);\n    }\n\n    return gulp\n      .src(['**/*.{html,htm}'], gulpopt)\n      .pipe(gulpCached({ name: 'safelink' }))\n      .pipe(\n        through2.obj(async (file, _enc, next) => {\n          // drops\n          if (file.isNull() || file.isDirectory() || !file || file.isStream()) return next();\n          // process\n          if (file.isBuffer() && Buffer.isBuffer(file.contents)) {\n            // do safelinkify\n            const content = file.contents.toString('utf-8');\n            const parsed = await safelink.parse(content);\n            if (typeof parsed === 'string') {\n              // Logger.log(parsed);\n              file.contents = Buffer.from(parsed);\n              return next(null, file);\n            }\n          }\n          Logger.log('cannot parse', file.path);\n          // drop fails\n          next();\n        })\n      )\n      .pipe(gulp.dest(workingDir));\n  } else {\n    const wstream = createWriteStream(path.join(config.cwd, 'tmp/errors/safelink.log'));\n    return wstream;\n  }\n}\n\n// safelinkify the deploy folder\ngulp.task('safelink', taskSafelink);\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/16/gulpsafelink_164c92c7edb79d3cef122f73272620d8.map","wrapperLength":82},"result":{"scriptId":"14626","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.safelink.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":21119,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":21116,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":7},{"startOffset":3579,"endOffset":3584,"count":2},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"taskSafelink","ranges":[{"startOffset":4339,"endOffset":9448,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.taskSeo = void 0;\nvar ansi_colors_1 = __importDefault(require(\"ansi-colors\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar gulp_cache_1 = __importDefault(require(\"./gulp-utils/gulp.cache\"));\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar _config_1 = require(\"./_config\");\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nfunction taskSeo(_done, cwd) {\n    var config = (0, _config_1.getConfig)();\n    var ignore = Array.isArray(config.exclude) ? config.exclude : [];\n    ignore.push.apply(ignore, __spreadArray([], __read(_config_1.commonIgnore), false));\n    return gulp_1.default\n        .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd: cwd, ignore: ignore })\n        .pipe((0, gulp_cache_1.default)({ name: 'seo' }))\n        .pipe((0, gulp_dom_1.default)(function (path) {\n        var _this = this;\n        // fix alt images\n        var images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach(function (el) {\n            var alt = el.getAttribute('alt');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n                el.setAttribute('alt', title);\n            }\n        });\n        // fix title iframe\n        var iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach(function (el) {\n            var alt = el.getAttribute('title');\n            if (!alt || alt.length === 0) {\n                var title = _this.title + ' - ' + el.getAttribute('src') || 'No Title';\n                el.setAttribute('title', title);\n            }\n        });\n        // WARNING MAKER\n        // count H1\n        var h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n            logger_1.default.log(ansi_colors_1.default.yellowBright('[WARN]'), \"H1 (\".concat(h1.length, \") \").concat(path));\n        }\n    }))\n        .pipe(gulp_1.default.dest(cwd));\n}\nexports.taskSeo = taskSeo;\ngulp_1.default.task('seo', function () {\n    var deployDir = (0, _config_1.deployConfig)().deployDir;\n    return taskSeo(null, deployDir);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw0REFBcUM7QUFDckMsOENBQXdCO0FBQ3hCLHNEQUErQjtBQUMvQix1RUFBaUQ7QUFDakQsMERBQW9DO0FBQ3BDLHFDQUFrRTtBQUVsRTs7O0dBR0c7QUFDSCxTQUFnQixPQUFPLENBQUMsS0FBbUQsRUFBRSxHQUFXO0lBQ3RGLElBQU0sTUFBTSxHQUFHLElBQUEsbUJBQVMsR0FBRSxDQUFDO0lBQzNCLElBQU0sTUFBTSxHQUFhLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0UsTUFBTSxDQUFDLElBQUksT0FBWCxNQUFNLDJCQUFTLHNCQUFZLFdBQUU7SUFDN0IsT0FBTyxjQUFJO1NBQ1IsR0FBRyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsY0FBYyxDQUFDLEVBQUUsRUFBRSxHQUFHLEtBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDO1NBQ3pELElBQUksQ0FBQyxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNqQyxJQUFJLENBQ0gsSUFBQSxrQkFBTyxFQUFDLFVBQVUsSUFBSTtRQUFkLGlCQTJCUDtRQTFCQyxpQkFBaUI7UUFDakIsSUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM3RCxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQUMsRUFBRTtZQUNoQixJQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQU0sS0FBSyxHQUFHLEtBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDO2dCQUN0RSxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQzthQUMvQjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsbUJBQW1CO1FBQ25CLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDakUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLEVBQUU7WUFDakIsSUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUM1QixJQUFNLEtBQUssR0FBRyxLQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLFVBQVUsQ0FBQztnQkFDeEUsRUFBRSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7YUFDakM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILGdCQUFnQjtRQUNoQixXQUFXO1FBQ1gsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakIsZ0JBQU0sQ0FBQyxHQUFHLENBQUMscUJBQVUsQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEVBQUUsY0FBTyxFQUFFLENBQUMsTUFBTSxlQUFLLElBQUksQ0FBRSxDQUFDLENBQUM7U0FDNUU7SUFDSCxDQUFDLENBQUMsQ0FDSDtTQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQXRDRCwwQkFzQ0M7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtJQUNQLElBQUEsU0FBUyxHQUFLLElBQUEsc0JBQVksR0FBRSxVQUFuQixDQUFvQjtJQUNyQyxPQUFPLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2VvLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhbnNpQ29sb3JzIGZyb20gJ2Fuc2ktY29sb3JzJztcbmltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IGd1bHBEb20gZnJvbSAnZ3VscC1kb20nO1xuaW1wb3J0IGd1bHBDYWNoZWQgZnJvbSAnLi9ndWxwLXV0aWxzL2d1bHAuY2FjaGUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBjb21tb25JZ25vcmUsIGRlcGxveUNvbmZpZywgZ2V0Q29uZmlnIH0gZnJvbSAnLi9fY29uZmlnJztcblxuLyoqXG4gKiBBdXRvIHNlbyBydW5uZXJcbiAqIEBwYXJhbSBjd2Qgd29ya2luZyBkaXJlY3RvcnkgdG8gc2NhbiBodG1sJ3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRhc2tTZW8oX2RvbmU6IGd1bHAuVGFza0Z1bmN0aW9uQ2FsbGJhY2sgfCBudWxsIHwgdW5kZWZpbmVkLCBjd2Q6IHN0cmluZykge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaWdub3JlOiBzdHJpbmdbXSA9IEFycmF5LmlzQXJyYXkoY29uZmlnLmV4Y2x1ZGUpID8gY29uZmlnLmV4Y2x1ZGUgOiBbXTtcbiAgaWdub3JlLnB1c2goLi4uY29tbW9uSWdub3JlKTtcbiAgcmV0dXJuIGd1bHBcbiAgICAuc3JjKFsnKiovKi57aHRtLGh0bWx9JywgJyoue2h0bWwsaHRtfSddLCB7IGN3ZCwgaWdub3JlIH0pXG4gICAgLnBpcGUoZ3VscENhY2hlZCh7IG5hbWU6ICdzZW8nIH0pKVxuICAgIC5waXBlKFxuICAgICAgZ3VscERvbShmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAvLyBmaXggYWx0IGltYWdlc1xuICAgICAgICBjb25zdCBpbWFnZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaW1nW3NyY10nKSk7XG4gICAgICAgIGltYWdlcy5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGFsdCA9IGVsLmdldEF0dHJpYnV0ZSgnYWx0Jyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBBbHQnO1xuICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdhbHQnLCB0aXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBmaXggdGl0bGUgaWZyYW1lXG4gICAgICAgIGNvbnN0IGlmcmFtZXMgPSBBcnJheS5mcm9tKHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaWZyYW1lW3NyY10nKSk7XG4gICAgICAgIGlmcmFtZXMuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgICAgICBjb25zdCBhbHQgPSBlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyk7XG4gICAgICAgICAgaWYgKCFhbHQgfHwgYWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSB0aGlzLnRpdGxlICsgJyAtICcgKyBlbC5nZXRBdHRyaWJ1dGUoJ3NyYycpIHx8ICdObyBUaXRsZSc7XG4gICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgdGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV0FSTklORyBNQUtFUlxuICAgICAgICAvLyBjb3VudCBIMVxuICAgICAgICBjb25zdCBoMSA9IHRoaXMucXVlcnlTZWxlY3RvckFsbCgnaDEnKTtcbiAgICAgICAgaWYgKGgxLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBMb2dnZXIubG9nKGFuc2lDb2xvcnMueWVsbG93QnJpZ2h0KCdbV0FSTl0nKSwgYEgxICgke2gxLmxlbmd0aH0pICR7cGF0aH1gKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApXG4gICAgLnBpcGUoZ3VscC5kZXN0KGN3ZCkpO1xufVxuXG5ndWxwLnRhc2soJ3NlbycsIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgeyBkZXBsb3lEaXIgfSA9IGRlcGxveUNvbmZpZygpO1xuICByZXR1cm4gdGFza1NlbyhudWxsLCBkZXBsb3lEaXIpO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import ansiColors from 'ansi-colors';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport gulpCached from './gulp-utils/gulp.cache';\nimport Logger from './utils/logger';\nimport { commonIgnore, deployConfig, getConfig } from './_config';\n\n/**\n * Auto seo runner\n * @param cwd working directory to scan html's\n */\nexport function taskSeo(_done: gulp.TaskFunctionCallback | null | undefined, cwd: string) {\n  const config = getConfig();\n  const ignore: string[] = Array.isArray(config.exclude) ? config.exclude : [];\n  ignore.push(...commonIgnore);\n  return gulp\n    .src(['**/*.{htm,html}', '*.{html,htm}'], { cwd, ignore })\n    .pipe(gulpCached({ name: 'seo' }))\n    .pipe(\n      gulpDom(function (path) {\n        // fix alt images\n        const images = Array.from(this.querySelectorAll('img[src]'));\n        images.forEach((el) => {\n          const alt = el.getAttribute('alt');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Alt';\n            el.setAttribute('alt', title);\n          }\n        });\n\n        // fix title iframe\n        const iframes = Array.from(this.querySelectorAll('iframe[src]'));\n        iframes.forEach((el) => {\n          const alt = el.getAttribute('title');\n          if (!alt || alt.length === 0) {\n            const title = this.title + ' - ' + el.getAttribute('src') || 'No Title';\n            el.setAttribute('title', title);\n          }\n        });\n\n        // WARNING MAKER\n        // count H1\n        const h1 = this.querySelectorAll('h1');\n        if (h1.length > 1) {\n          Logger.log(ansiColors.yellowBright('[WARN]'), `H1 (${h1.length}) ${path}`);\n        }\n      })\n    )\n    .pipe(gulp.dest(cwd));\n}\n\ngulp.task('seo', function () {\n  const { deployDir } = deployConfig();\n  return taskSeo(null, deployDir);\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/ee/gulpseo_ee59cff135689a98b46d52951c185d0d.map","wrapperLength":82},"result":{"scriptId":"14675","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.seo.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8740,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8737,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":134,"endOffset":584,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":638,"endOffset":965,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":1023,"endOffset":1104,"count":5},{"startOffset":1075,"endOffset":1080,"count":3},{"startOffset":1081,"endOffset":1101,"count":2}],"isBlockCoverage":true},{"functionName":"taskSeo","ranges":[{"startOffset":1601,"endOffset":3164,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":3219,"endOffset":3332,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cross_spawn_1 = __importDefault(require(\"cross-spawn\"));\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar through2_1 = __importDefault(require(\"through2\"));\nvar upath_1 = require(\"upath\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar string_1 = require(\"./utils/string\");\nvar _config_1 = require(\"./_config\");\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n    logger_1.default.log('[standalone] Running scripts...\\n');\n    return gulp_1.default\n        .src((0, upath_1.join)((0, _config_1.getConfig)().cwd, '**/_*.standalone.js'), { cwd: (0, _config_1.getConfig)().cwd, ignore: ['**/tmp/**'] })\n        .pipe(through2_1.default.obj(function (file, _enc, next) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, _b, _c, child;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        logger_1.default.log('='.repeat(10) + ' input ' + '='.repeat(10));\n                        _b = (_a = logger_1.default).log;\n                        _c = \"node \".concat;\n                        return [4 /*yield*/, (0, string_1.replacePath)(file.path, (0, _config_1.getConfig)().cwd, '')];\n                    case 1:\n                        _b.apply(_a, [_c.apply(\"node \", [_d.sent()])]);\n                        logger_1.default.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n                        child = (0, cross_spawn_1.default)('node', [file.path], { stdio: 'inherit' });\n                        child.on('close', function () {\n                            // drop file\n                            next();\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }))\n        .pipe(gulp_1.default.dest((0, upath_1.join)((0, _config_1.getConfig)().cwd, 'tmp/standalone')))\n        .once('end', function () {\n        logger_1.default.log('\\n[standalone] stopped');\n    });\n}\ngulp_1.default.task('post:standalone', standaloneRunner);\nexports.default = standaloneRunner;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc3RhbmRhbG9uZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUFnQztBQUNoQyw4Q0FBd0I7QUFDeEIsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QiwwREFBb0M7QUFDcEMseUNBQTZDO0FBQzdDLHFDQUFzQztBQUV0Qzs7O0dBR0c7QUFDSCxTQUFTLGdCQUFnQjtJQUN2QixnQkFBTSxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ2hELE9BQU8sY0FBSTtTQUNSLEdBQUcsQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUscUJBQXFCLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztTQUNsRyxJQUFJLENBQ0gsa0JBQVEsQ0FBQyxHQUFHLENBQUMsVUFBZ0IsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJOzs7Ozs7d0JBQzNDLGdCQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzt3QkFDeEQsS0FBQSxDQUFBLEtBQUEsZ0JBQU0sQ0FBQSxDQUFDLEdBQUcsQ0FBQTs7d0JBQVMscUJBQU0sSUFBQSxvQkFBVyxFQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBQSxtQkFBUyxHQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFBOzt3QkFBcEUsY0FBVyxtQkFBUSxTQUFpRCxFQUFFLEVBQUMsQ0FBQzt3QkFDeEUsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNsRCxLQUFLLEdBQUcsSUFBQSxxQkFBSyxFQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO3dCQUMvRCxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRTs0QkFDaEIsWUFBWTs0QkFDWixJQUFJLEVBQUUsQ0FBQzt3QkFDVCxDQUFDLENBQUMsQ0FBQzs7Ozs7S0FDSixDQUFDLENBQ0g7U0FDQSxJQUFJLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1NBQ3hELElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDWCxnQkFBTSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELGNBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUUvQyxrQkFBZSxnQkFBZ0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJEOlxcUmVwb3NpdG9yaWVzXFxzdGF0aWMtYmxvZy1nZW5lcmF0b3JcXHNyY1xcZ3VscC5zdGFuZGFsb25lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzcGF3biBmcm9tICdjcm9zcy1zcGF3bic7XG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJztcbmltcG9ydCB0aHJvdWdoMiBmcm9tICd0aHJvdWdoMic7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAndXBhdGgnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyByZXBsYWNlUGF0aCB9IGZyb20gJy4vdXRpbHMvc3RyaW5nJztcbmltcG9ydCB7IGdldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qKlxuICogcnVuIGFsbCBfKi5zdGFuZGFsb25lLmpzIGluc2lkZSBzcmMtcG9zdHMgKF9jb25maWdfeW1sLnBvc3RfZGlyKVxuICogQHJldHVybnNcbiAqL1xuZnVuY3Rpb24gc3RhbmRhbG9uZVJ1bm5lcigpIHtcbiAgTG9nZ2VyLmxvZygnW3N0YW5kYWxvbmVdIFJ1bm5pbmcgc2NyaXB0cy4uLlxcbicpO1xuICByZXR1cm4gZ3VscFxuICAgIC5zcmMoam9pbihnZXRDb25maWcoKS5jd2QsICcqKi9fKi5zdGFuZGFsb25lLmpzJyksIHsgY3dkOiBnZXRDb25maWcoKS5jd2QsIGlnbm9yZTogWycqKi90bXAvKionXSB9KVxuICAgIC5waXBlKFxuICAgICAgdGhyb3VnaDIub2JqKGFzeW5jIGZ1bmN0aW9uIChmaWxlLCBfZW5jLCBuZXh0KSB7XG4gICAgICAgIExvZ2dlci5sb2coJz0nLnJlcGVhdCgxMCkgKyAnIGlucHV0ICcgKyAnPScucmVwZWF0KDEwKSk7XG4gICAgICAgIExvZ2dlci5sb2coYG5vZGUgJHthd2FpdCByZXBsYWNlUGF0aChmaWxlLnBhdGgsIGdldENvbmZpZygpLmN3ZCwgJycpfWApO1xuICAgICAgICBMb2dnZXIubG9nKCc9Jy5yZXBlYXQoMTApICsgJyBvdXB1dCAnICsgJz0nLnJlcGVhdCgxMCkpO1xuICAgICAgICBjb25zdCBjaGlsZCA9IHNwYXduKCdub2RlJywgW2ZpbGUucGF0aF0sIHsgc3RkaW86ICdpbmhlcml0JyB9KTtcbiAgICAgICAgY2hpbGQub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICAgIC8vIGRyb3AgZmlsZVxuICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgIClcbiAgICAucGlwZShndWxwLmRlc3Qoam9pbihnZXRDb25maWcoKS5jd2QsICd0bXAvc3RhbmRhbG9uZScpKSlcbiAgICAub25jZSgnZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgTG9nZ2VyLmxvZygnXFxuW3N0YW5kYWxvbmVdIHN0b3BwZWQnKTtcbiAgICB9KTtcbn1cblxuZ3VscC50YXNrKCdwb3N0OnN0YW5kYWxvbmUnLCBzdGFuZGFsb25lUnVubmVyKTtcblxuZXhwb3J0IGRlZmF1bHQgc3RhbmRhbG9uZVJ1bm5lcjtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import spawn from 'cross-spawn';\nimport gulp from 'gulp';\nimport through2 from 'through2';\nimport { join } from 'upath';\nimport Logger from './utils/logger';\nimport { replacePath } from './utils/string';\nimport { getConfig } from './_config';\n\n/**\n * run all _*.standalone.js inside src-posts (_config_yml.post_dir)\n * @returns\n */\nfunction standaloneRunner() {\n  Logger.log('[standalone] Running scripts...\\n');\n  return gulp\n    .src(join(getConfig().cwd, '**/_*.standalone.js'), { cwd: getConfig().cwd, ignore: ['**/tmp/**'] })\n    .pipe(\n      through2.obj(async function (file, _enc, next) {\n        Logger.log('='.repeat(10) + ' input ' + '='.repeat(10));\n        Logger.log(`node ${await replacePath(file.path, getConfig().cwd, '')}`);\n        Logger.log('='.repeat(10) + ' ouput ' + '='.repeat(10));\n        const child = spawn('node', [file.path], { stdio: 'inherit' });\n        child.on('close', () => {\n          // drop file\n          next();\n        });\n      })\n    )\n    .pipe(gulp.dest(join(getConfig().cwd, 'tmp/standalone')))\n    .once('end', function () {\n      Logger.log('\\n[standalone] stopped');\n    });\n}\n\ngulp.task('post:standalone', standaloneRunner);\n\nexport default standaloneRunner;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/70/gulpstandalone_70a88f15ac851281d69271b2b48c84eb.map","wrapperLength":82},"result":{"scriptId":"14681","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.standalone.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":8780,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":8777,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":2656,"endOffset":2737,"count":4},{"startOffset":2708,"endOffset":2713,"count":1},{"startOffset":2714,"endOffset":2734,"count":3}],"isBlockCoverage":true},{"functionName":"standaloneRunner","ranges":[{"startOffset":3224,"endOffset":4848,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.hexoGenerateSitemap = exports.generateSitemap = void 0;\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar fs_extra_1 = require(\"fs-extra\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar micromatch_1 = __importDefault(require(\"micromatch\"));\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar os_1 = require(\"os\");\nvar sitemap_crawler_1 = require(\"sitemap-crawler\");\nvar upath_1 = require(\"upath\");\nvar sitemap_1 = require(\"./sitemap\");\nvar array_1 = require(\"./utils/array\");\nvar fm_1 = require(\"./utils/fm\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\nvar noop_1 = __importDefault(require(\"./utils/noop\"));\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nvar sitemaps = [];\nvar crawled = new Set();\nvar env = (0, nunjucks_env_1.default)();\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nfunction generateSitemap(url, deep) {\n    var _this = this;\n    if (deep === void 0) { deep = 0; }\n    return new bluebird_1.default(function (resolve) {\n        var promises = [];\n        if (typeof url === 'string') {\n            crawled.add(url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)(url, {\n                deep: deep\n            }));\n        }\n        else {\n            crawled.add((0, _config_1.getConfig)().url);\n            promises.push((0, sitemap_crawler_1.sitemapCrawlerAsync)((0, _config_1.getConfig)().url, {\n                deep: deep\n            }));\n        }\n        bluebird_1.default.all(promises)\n            .then(function (results) {\n            var mapped = {};\n            results.forEach(function (sitemap) {\n                for (var key in sitemap) {\n                    var values = sitemap[key];\n                    if (key in mapped === false) {\n                        mapped[key] = values;\n                    }\n                    else {\n                        mapped[key] = (0, array_1.array_unique)(values.concat(mapped[key]));\n                    }\n                }\n            });\n            // dump\n            var saveto = (0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n            (0, fm_1.writefile)(saveto, JSON.stringify(mapped, null, 2));\n            // return\n            return mapped;\n        })\n            .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n            var i, ii, url_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sitemaps = (0, array_1.array_unique)((0, array_1.array_remove_empty)(Object.values(results).flat(1).concat(sitemaps))).sort(function (a, b) {\n                            return a === b ? 0 : a < b ? -1 : 1;\n                        });\n                        i = 0;\n                        _a.label = 1;\n                    case 1:\n                        if (!(i < deep)) return [3 /*break*/, 6];\n                        ii = 0;\n                        _a.label = 2;\n                    case 2:\n                        if (!(ii < sitemaps.length)) return [3 /*break*/, 5];\n                        url_1 = sitemaps[ii];\n                        if (crawled.has(url_1) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url_1))\n                            return [3 /*break*/, 4];\n                        crawled.add(url_1);\n                        logger_1.default.log('[depth]', ii, url_1);\n                        return [4 /*yield*/, generateSitemap(url_1, deep).then(function () { return writeSitemap(); })];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        ii++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        i++;\n                        return [3 /*break*/, 1];\n                    case 6:\n                        writeSitemap(resolve);\n                        return [2 /*return*/];\n                }\n            });\n        }); });\n    });\n}\nexports.generateSitemap = generateSitemap;\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback) {\n    var cb = noop_1.default;\n    if (callback)\n        cb = function () { return callback(sitemaps); };\n    var sitemapTXT = (0, upath_1.join)((0, _config_1.getConfig)().cwd, (0, _config_1.getConfig)().public_dir || 'public', 'sitemap.txt');\n    (0, fm_1.writefile)(sitemapTXT, (0, array_1.array_remove_empty)(sitemaps).join(os_1.EOL));\n    cb.apply(this);\n}\nfunction hexoGenerateSitemap() {\n    return new bluebird_1.default(function (resolve) {\n        var instance = new hexo_1.default((0, _config_1.getConfig)().cwd);\n        instance.init().then(function () {\n            instance.load().then(function () {\n                env.addFilter('formatUrl', function (str) {\n                    return hexo_util_1.full_url_for.call(instance, str);\n                });\n                var config = (0, _config_1.setConfig)(instance.config);\n                // assign default config\n                var sitemap = Object.assign({ rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] }, config.sitemap);\n                // Build Yoast SEO sitemap\n                // when config.yoast defined\n                if (sitemap.yoast) {\n                    return (0, sitemap_1.yoastSeo)(instance);\n                }\n                if (!config.sitemap)\n                    return logger_1.default.log('[sitemap] config.sitemap not configured in _config.yml');\n                var locals = instance.locals;\n                var skip_render = config.skip_render;\n                if (!sitemap.tags || !sitemap.categories) {\n                    return logger_1.default.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n                }\n                var skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n                if (Array.isArray(skip_render)) {\n                    skipRenderList.push.apply(skipRenderList, __spreadArray([], __read(skip_render), false));\n                }\n                else if (typeof skip_render === 'string') {\n                    if (skip_render.length > 0) {\n                        skipRenderList.push(skip_render);\n                    }\n                }\n                var posts = __spreadArray(__spreadArray([], __read(locals.get('pages').toArray()), false), __read(locals.get('posts').toArray()), false).filter(function (post) {\n                    return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n                })\n                    .sort(function (a, b) {\n                    if (b.updated && a.updated)\n                        return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n                    return 0;\n                });\n                if (posts.length <= 0) {\n                    return resolve();\n                }\n                var tmplSrc = (0, upath_1.join)(__dirname, '_config_template_sitemap.xml');\n                var template = nunjucks_1.default.compile((0, fs_extra_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var tagsCfg = sitemap.tags, catsCfg = sitemap.categories, relCfg = sitemap.rel;\n                var data = template.render({\n                    config: config,\n                    posts: posts,\n                    sNow: new Date(),\n                    tags: tagsCfg ? locals.get('tags').toArray() : [],\n                    categories: catsCfg ? locals.get('categories').toArray() : []\n                });\n                // remove blank newlines\n                data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n                //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n                // dump\n                (0, fm_1.writefile)((0, upath_1.join)(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n                // write\n                var sitemapXml = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir, 'sitemap.xml');\n                (0, fm_1.writefile)(sitemapXml, data);\n                instance.log.info('sitemap written', sitemapXml);\n                if (!relCfg)\n                    return resolve();\n                var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n                var publicDir = (0, upath_1.join)((0, _config_1.getConfig)().cwd, config.public_dir);\n                gulp_1.default\n                    .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                    .pipe((0, gulp_dom_1.default)(function () {\n                    // auto discovery sitemap\n                    if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"sitemap.xml\\\"]\")).length === 0 &&\n                        this.querySelectorAll(\"link[href=\\\"/sitemap.xml\\\"]\").length === 0) {\n                        this.head.innerHTML += \"<link id=\\\"sitemap-site-url\\\" type=\\\"application/text+xml\\\" rel=\\\"sitemap\\\" href=\\\"\".concat(baseURL, \"sitemap.xml\\\" />\");\n                    }\n                    //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n                }))\n                    .pipe(gulp_1.default.dest(publicDir))\n                    .once('end', function () { return resolve(); });\n            });\n        });\n    });\n}\nexports.hexoGenerateSitemap = hexoGenerateSitemap;\nfunction isMatch(path, patterns) {\n    return micromatch_1.default.isMatch(path, patterns);\n}\ngulp_1.default.task('sitemap', function () {\n    return new bluebird_1.default(function (resolve) {\n        hexoGenerateSitemap().then(function () {\n            resolve();\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQWdDO0FBQ2hDLHFDQUF3QztBQUN4Qyw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF1QztBQUN2Qyx1Q0FBeUM7QUFDekMsMERBQW9DO0FBQ3BDLHNEQUFnQztBQUNoQyx5QkFBeUI7QUFDekIsbURBQXNEO0FBQ3RELCtCQUE2QjtBQUM3QixxQ0FBcUM7QUFDckMsdUNBQWlFO0FBQ2pFLGlDQUF1QztBQUN2QywwREFBb0M7QUFDcEMsc0RBQWdDO0FBQ2hDLHNFQUErQztBQUMvQyxxQ0FBK0Q7QUFFL0Q7Ozs7RUFJRTtBQUNGLElBQUksUUFBUSxHQUFHLEVBQWMsQ0FBQztBQUM5QixJQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO0FBQ2xDLElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCOzs7OztHQUtHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLEdBQStCLEVBQUUsSUFBUTtJQUF6RSxpQkE2REM7SUE3RGdFLHFCQUFBLEVBQUEsUUFBUTtJQUN2RSxPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQW9DO1FBQ3ZELElBQU0sUUFBUSxHQUF5QyxFQUFFLENBQUM7UUFDMUQsSUFBSSxPQUFPLEdBQUcsS0FBSyxRQUFRLEVBQUU7WUFDM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixRQUFRLENBQUMsSUFBSSxDQUNYLElBQUEscUNBQW1CLEVBQUMsR0FBRyxFQUFFO2dCQUN2QixJQUFJLE1BQUE7YUFDTCxDQUFDLENBQ0gsQ0FBQztTQUNIO2FBQU07WUFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdCLFFBQVEsQ0FBQyxJQUFJLENBQ1gsSUFBQSxxQ0FBbUIsRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ25DLElBQUksTUFBQTthQUNMLENBQUMsQ0FDSCxDQUFDO1NBQ0g7UUFDRCxrQkFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUM7YUFDbkIsSUFBSSxDQUFDLFVBQUMsT0FBTztZQUNaLElBQU0sTUFBTSxHQUFHLEVBQTRDLENBQUM7WUFDNUQsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFDLE9BQU87Z0JBQ3RCLEtBQUssSUFBTSxHQUFHLElBQUksT0FBTyxFQUFFO29CQUN6QixJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzVCLElBQUksR0FBRyxJQUFJLE1BQU0sS0FBSyxLQUFLLEVBQUU7d0JBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUM7cUJBQ3RCO3lCQUFNO3dCQUNMLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFBLG9CQUFZLEVBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUN4RDtpQkFDRjtZQUNILENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTztZQUNQLElBQU0sTUFBTSxHQUFHLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSwrQkFBK0IsQ0FBQyxDQUFDO1lBQ3BFLElBQUEsY0FBUyxFQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVuRCxTQUFTO1lBQ1QsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLFVBQU8sT0FBTzs7Ozs7d0JBQ2xCLFFBQVEsR0FBRyxJQUFBLG9CQUFZLEVBQUMsSUFBQSwwQkFBa0IsRUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUNoRyxDQUFDLEVBQ0QsQ0FBQzs0QkFFRCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDdEMsQ0FBQyxDQUFDLENBQUM7d0JBRU0sQ0FBQyxHQUFHLENBQUM7Ozs2QkFBRSxDQUFBLENBQUMsR0FBRyxJQUFJLENBQUE7d0JBQ2IsRUFBRSxHQUFHLENBQUM7Ozs2QkFBRSxDQUFBLEVBQUUsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFBO3dCQUM3QixRQUFNLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQzt3QkFDekIsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUcsQ0FBQyxJQUFJLGlEQUFpRCxDQUFDLElBQUksQ0FBQyxLQUFHLENBQUM7NEJBQUUsd0JBQVM7d0JBRTlGLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBRyxDQUFDLENBQUM7d0JBQ2pCLGdCQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxFQUFFLEVBQUUsS0FBRyxDQUFDLENBQUM7d0JBQy9CLHFCQUFNLGVBQWUsQ0FBQyxLQUFHLEVBQUUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQU0sT0FBQSxZQUFZLEVBQUUsRUFBZCxDQUFjLENBQUMsRUFBQTs7d0JBQTNELFNBQTJELENBQUM7Ozt3QkFOdkIsRUFBRSxFQUFFLENBQUE7Ozt3QkFEbkIsQ0FBQyxFQUFFLENBQUE7Ozt3QkFXN0IsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDOzs7O2FBQ3ZCLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQTdERCwwQ0E2REM7QUFFRDs7O0dBR0c7QUFDSCxTQUFTLFlBQVksQ0FBQyxRQUFrQztJQUN0RCxJQUFJLEVBQUUsR0FBRyxjQUFJLENBQUM7SUFDZCxJQUFJLFFBQVE7UUFBRSxFQUFFLEdBQUcsY0FBTSxPQUFBLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBbEIsQ0FBa0IsQ0FBQztJQUM1QyxJQUFNLFVBQVUsR0FBRyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBQSxtQkFBUyxHQUFFLENBQUMsVUFBVSxJQUFJLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQztJQUM1RixJQUFBLGNBQVMsRUFBQyxVQUFVLEVBQUUsSUFBQSwwQkFBa0IsRUFBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBRyxDQUFDLENBQUMsQ0FBQztJQUM5RCxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2pCLENBQUM7QUFVRCxTQUFnQixtQkFBbUI7SUFDakMsT0FBTyxJQUFJLGtCQUFRLENBQUMsVUFBQyxPQUFPO1FBQzFCLElBQU0sUUFBUSxHQUFHLElBQUksY0FBSSxDQUFDLElBQUEsbUJBQVMsR0FBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDbkIsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQztnQkFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUFHO29CQUM3QixPQUFPLHdCQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDMUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ0gsSUFBTSxNQUFNLEdBQUcsSUFBQSxtQkFBUyxFQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDMUMsd0JBQXdCO2dCQUN4QixJQUFNLE9BQU8sR0FBbUIsTUFBTSxDQUFDLE1BQU0sQ0FDM0MsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDLEVBQUUsRUFDcEYsTUFBTSxDQUFDLE9BQU8sQ0FDZixDQUFDO2dCQUVGLDBCQUEwQjtnQkFDMUIsNEJBQTRCO2dCQUM1QixJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7b0JBQ2pCLE9BQU8sSUFBQSxrQkFBUSxFQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUMzQjtnQkFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87b0JBQUUsT0FBTyxnQkFBTSxDQUFDLEdBQUcsQ0FBQyx3REFBd0QsQ0FBQyxDQUFDO2dCQUNqRyxJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO2dCQUN2QixJQUFBLFdBQVcsR0FBSyxNQUFNLFlBQVgsQ0FBWTtnQkFFL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFO29CQUN4QyxPQUFPLGdCQUFNLENBQUMsR0FBRyxDQUFDLDBGQUEwRixDQUFDLENBQUM7aUJBQy9HO2dCQUNELElBQU0sY0FBYyxHQUFHLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFFM0QsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFO29CQUM5QixjQUFjLENBQUMsSUFBSSxPQUFuQixjQUFjLDJCQUFTLFdBQVcsV0FBRTtpQkFDckM7cUJBQU0sSUFBSSxPQUFPLFdBQVcsS0FBSyxRQUFRLEVBQUU7b0JBQzFDLElBQUksV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7d0JBQzFCLGNBQWMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7cUJBQ2xDO2lCQUNGO2dCQUVELElBQU0sS0FBSyxHQUFHLHVDQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLGtCQUFLLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLFVBQzlFLE1BQU0sQ0FBQyxVQUFDLElBQUk7b0JBQ1gsT0FBTyxJQUFJLENBQUMsT0FBTyxLQUFLLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO2dCQUN6RSxDQUFDLENBQUM7cUJBQ0QsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQ1QsSUFBSSxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxPQUFPO3dCQUFFLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDO29CQUMvRixPQUFPLENBQUMsQ0FBQztnQkFDWCxDQUFDLENBQUMsQ0FBQztnQkFFTCxJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO29CQUNyQixPQUFPLE9BQU8sRUFBRSxDQUFDO2lCQUNsQjtnQkFFRCxJQUFNLE9BQU8sR0FBRyxJQUFBLFlBQUksRUFBQyxTQUFTLEVBQUUsOEJBQThCLENBQUMsQ0FBQztnQkFDaEUsSUFBTSxRQUFRLEdBQUcsa0JBQVEsQ0FBQyxPQUFPLENBQUMsSUFBQSx1QkFBWSxFQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDL0QsSUFBTSxPQUFPLEdBQXVDLE9BQU8sS0FBOUMsRUFBYyxPQUFPLEdBQWtCLE9BQU8sV0FBekIsRUFBTyxNQUFNLEdBQUssT0FBTyxJQUFaLENBQWE7Z0JBQ3BFLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7b0JBQ3pCLE1BQU0sUUFBQTtvQkFDTixLQUFLLE9BQUE7b0JBQ0wsSUFBSSxFQUFFLElBQUksSUFBSSxFQUFFO29CQUNoQixJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFO29CQUNqRCxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFO2lCQUM5RCxDQUFDLENBQUM7Z0JBRUgsd0JBQXdCO2dCQUN4QixJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBRTFDLHlGQUF5RjtnQkFFekYsT0FBTztnQkFDUCxJQUFBLGNBQVMsRUFBQyxJQUFBLFlBQUksRUFBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsOEJBQThCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFFckUsUUFBUTtnQkFDUixJQUFNLFVBQVUsR0FBRyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsQ0FBQztnQkFDM0UsSUFBQSxjQUFTLEVBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUM1QixRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFFakQsSUFBSSxDQUFDLE1BQU07b0JBQUUsT0FBTyxPQUFPLEVBQUUsQ0FBQztnQkFDOUIsSUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO2dCQUN6RSxJQUFNLFNBQVMsR0FBRyxJQUFBLFlBQUksRUFBQyxJQUFBLG1CQUFTLEdBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUMzRCxjQUFJO3FCQUNELEdBQUcsQ0FBQyxXQUFXLEVBQUUsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxzQkFBWSxFQUFFLENBQUM7cUJBQzFELElBQUksQ0FDSCxJQUFBLGtCQUFPLEVBQUM7b0JBQ04seUJBQXlCO29CQUN6QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLG1CQUFlLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQzt3QkFDeEUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDZCQUEyQixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDL0Q7d0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNkZBQStFLE9BQU8scUJBQWlCLENBQUM7cUJBQ2hJO29CQUNELHVFQUF1RTtnQkFDekUsQ0FBQyxDQUFDLENBQ0g7cUJBQ0EsSUFBSSxDQUFDLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7cUJBQzFCLElBQUksQ0FBQyxLQUFLLEVBQUUsY0FBTSxPQUFBLE9BQU8sRUFBRSxFQUFULENBQVMsQ0FBQyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFqR0Qsa0RBaUdDO0FBRUQsU0FBUyxPQUFPLENBQUMsSUFBWSxFQUFFLFFBQW9DO0lBQ2pFLE9BQU8sb0JBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtJQUNuQixPQUFPLElBQUksa0JBQVEsQ0FBQyxVQUFDLE9BQU87UUFDMUIsbUJBQW1CLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDekIsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuc2l0ZW1hcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgcmVhZEZpbGVTeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgeyBkZWZhdWx0IGFzIGhleG8gfSBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciB9IGZyb20gJ2hleG8tdXRpbCc7XG5pbXBvcnQgbWljcm9tYXRjaCBmcm9tICdtaWNyb21hdGNoJztcbmltcG9ydCBudW5qdWNrcyBmcm9tICdudW5qdWNrcyc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgeyBzaXRlbWFwQ3Jhd2xlckFzeW5jIH0gZnJvbSAnc2l0ZW1hcC1jcmF3bGVyJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgeyB5b2FzdFNlbyB9IGZyb20gJy4vc2l0ZW1hcCc7XG5pbXBvcnQgeyBhcnJheV9yZW1vdmVfZW1wdHksIGFycmF5X3VuaXF1ZSB9IGZyb20gJy4vdXRpbHMvYXJyYXknO1xuaW1wb3J0IHsgd3JpdGVmaWxlIH0gZnJvbSAnLi91dGlscy9mbSc7XG5pbXBvcnQgTG9nZ2VyIGZyb20gJy4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCBub29wIGZyb20gJy4vdXRpbHMvbm9vcCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcsIHNldENvbmZpZyB9IGZyb20gJy4vX2NvbmZpZyc7XG5cbi8qXG4vLyByZWFkIGV4aXN0aW5nIHNpdGVtYXAudHh0XG5jb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xubGV0IHNpdGVtYXBzID0gZXhpc3RzU3luYyhzaXRlbWFwVFhUKSA/IGFycmF5X3JlbW92ZV9lbXB0eShyZWFkRmlsZVN5bmMoc2l0ZW1hcFRYVCwgJ3V0Zi04Jykuc3BsaXQoL1xccj9cXG4vZ20pKSA6IFtdO1xuKi9cbmxldCBzaXRlbWFwcyA9IFtdIGFzIHN0cmluZ1tdO1xuY29uc3QgY3Jhd2xlZCA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuY29uc3QgZW52ID0gZW52TnVuanVja3MoKTtcblxuLyoqXG4gKiBTaXRlbWFwIEdlbmVyYXRvclxuICogQHBhcmFtIHVybCB1cmwgdG8gY3Jhd2xcbiAqIEBwYXJhbSBkZWVwIGNyYXdsIGRlZXBlciBuIHRpbWVzXG4gKiBAcmV0dXJuc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTaXRlbWFwKHVybD86IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsIGRlZXAgPSAwKSB7XG4gIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmU6IChzaXRlbWFwczogc3RyaW5nW10pID0+IGFueSkgPT4ge1xuICAgIGNvbnN0IHByb21pc2VzOiBCbHVlYmlyZDxSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4+W10gPSBbXTtcbiAgICBpZiAodHlwZW9mIHVybCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKHVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNyYXdsZWQuYWRkKGdldENvbmZpZygpLnVybCk7XG4gICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICBzaXRlbWFwQ3Jhd2xlckFzeW5jKGdldENvbmZpZygpLnVybCwge1xuICAgICAgICAgIGRlZXBcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIEJsdWViaXJkLmFsbChwcm9taXNlcylcbiAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hcHBlZCA9IHt9IGFzIFJldHVyblR5cGU8dHlwZW9mIHNpdGVtYXBDcmF3bGVyQXN5bmM+O1xuICAgICAgICByZXN1bHRzLmZvckVhY2goKHNpdGVtYXApID0+IHtcbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBzaXRlbWFwKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBzaXRlbWFwW2tleV07XG4gICAgICAgICAgICBpZiAoa2V5IGluIG1hcHBlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbWFwcGVkW2tleV0gPSB2YWx1ZXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBtYXBwZWRba2V5XSA9IGFycmF5X3VuaXF1ZSh2YWx1ZXMuY29uY2F0KG1hcHBlZFtrZXldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIGNvbnN0IHNhdmV0byA9IGpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcC9kdW1wL3NpdGVtYXAvc2l0ZW1hcC5qc29uJyk7XG4gICAgICAgIHdyaXRlZmlsZShzYXZldG8sIEpTT04uc3RyaW5naWZ5KG1hcHBlZCwgbnVsbCwgMikpO1xuXG4gICAgICAgIC8vIHJldHVyblxuICAgICAgICByZXR1cm4gbWFwcGVkO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGFzeW5jIChyZXN1bHRzKSA9PiB7XG4gICAgICAgIHNpdGVtYXBzID0gYXJyYXlfdW5pcXVlKGFycmF5X3JlbW92ZV9lbXB0eShPYmplY3QudmFsdWVzKHJlc3VsdHMpLmZsYXQoMSkuY29uY2F0KHNpdGVtYXBzKSkpLnNvcnQoZnVuY3Rpb24gKFxuICAgICAgICAgIGEsXG4gICAgICAgICAgYlxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gYSA9PT0gYiA/IDAgOiBhIDwgYiA/IC0xIDogMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkZWVwOyBpKyspIHtcbiAgICAgICAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgc2l0ZW1hcHMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBzaXRlbWFwc1tpaV07XG4gICAgICAgICAgICBpZiAoY3Jhd2xlZC5oYXModXJsKSB8fCAvLihqc3x0c3xjc3N8c2Nzc3x0eHR8cGRmfHBuZ3xqcGU/Z3xnaWZ8d2VicCkkL2dpLnRlc3QodXJsKSkgY29udGludWU7XG5cbiAgICAgICAgICAgIGNyYXdsZWQuYWRkKHVybCk7XG4gICAgICAgICAgICBMb2dnZXIubG9nKCdbZGVwdGhdJywgaWksIHVybCk7XG4gICAgICAgICAgICBhd2FpdCBnZW5lcmF0ZVNpdGVtYXAodXJsLCBkZWVwKS50aGVuKCgpID0+IHdyaXRlU2l0ZW1hcCgpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB3cml0ZVNpdGVtYXAocmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8qKlxuICogd3JpdGUgdGhlIHNpdGVtYXBcbiAqIEBwYXJhbSBjYWxsYmFja1xuICovXG5mdW5jdGlvbiB3cml0ZVNpdGVtYXAoY2FsbGJhY2s/OiAoLi4uYXJnczogYW55W10pID0+IGFueSkge1xuICBsZXQgY2IgPSBub29wO1xuICBpZiAoY2FsbGJhY2spIGNiID0gKCkgPT4gY2FsbGJhY2soc2l0ZW1hcHMpO1xuICBjb25zdCBzaXRlbWFwVFhUID0gam9pbihnZXRDb25maWcoKS5jd2QsIGdldENvbmZpZygpLnB1YmxpY19kaXIgfHwgJ3B1YmxpYycsICdzaXRlbWFwLnR4dCcpO1xuICB3cml0ZWZpbGUoc2l0ZW1hcFRYVCwgYXJyYXlfcmVtb3ZlX2VtcHR5KHNpdGVtYXBzKS5qb2luKEVPTCkpO1xuICBjYi5hcHBseSh0aGlzKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTaXRlbWFwT3B0aW9ucyB7XG4gIHBhdGg6IHN0cmluZ1tdO1xuICB0YWdzOiBib29sZWFuO1xuICBjYXRlZ29yaWVzOiBib29sZWFuO1xuICByZWw6IGJvb2xlYW47XG4gIHlvYXN0OiBib29sZWFuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4b0dlbmVyYXRlU2l0ZW1hcCgpIHtcbiAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IGluc3RhbmNlID0gbmV3IGhleG8oZ2V0Q29uZmlnKCkuY3dkKTtcbiAgICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICBpbnN0YW5jZS5sb2FkKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGVudi5hZGRGaWx0ZXIoJ2Zvcm1hdFVybCcsIChzdHIpID0+IHtcbiAgICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBjb25maWcgPSBzZXRDb25maWcoaW5zdGFuY2UuY29uZmlnKTtcbiAgICAgICAgLy8gYXNzaWduIGRlZmF1bHQgY29uZmlnXG4gICAgICAgIGNvbnN0IHNpdGVtYXA6IFNpdGVtYXBPcHRpb25zID0gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICB7IHJlbDogZmFsc2UsIHRhZ3M6IGZhbHNlLCBjYXRlZ29yaWVzOiBmYWxzZSwgcGF0aDogWydzaXRlbWFwLnR4dCcsICdzaXRlbWFwLnhtbCddIH0sXG4gICAgICAgICAgY29uZmlnLnNpdGVtYXBcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBCdWlsZCBZb2FzdCBTRU8gc2l0ZW1hcFxuICAgICAgICAvLyB3aGVuIGNvbmZpZy55b2FzdCBkZWZpbmVkXG4gICAgICAgIGlmIChzaXRlbWFwLnlvYXN0KSB7XG4gICAgICAgICAgcmV0dXJuIHlvYXN0U2VvKGluc3RhbmNlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY29uZmlnLnNpdGVtYXApIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAgbm90IGNvbmZpZ3VyZWQgaW4gX2NvbmZpZy55bWwnKTtcbiAgICAgICAgY29uc3QgbG9jYWxzID0gaW5zdGFuY2UubG9jYWxzO1xuICAgICAgICBjb25zdCB7IHNraXBfcmVuZGVyIH0gPSBjb25maWc7XG5cbiAgICAgICAgaWYgKCFzaXRlbWFwLnRhZ3MgfHwgIXNpdGVtYXAuY2F0ZWdvcmllcykge1xuICAgICAgICAgIHJldHVybiBMb2dnZXIubG9nKCdbc2l0ZW1hcF0gY29uZmlnLnNpdGVtYXAudGFncyBvciBjb25maWcuc2l0ZW1hcC5jYXRlZ29yaWVzIG5vdCBjb25maWd1cmVkIGluIF9jb25maWcueW1sJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2tpcFJlbmRlckxpc3QgPSBbJyoqLyouanMnLCAnKiovKi5jc3MnLCAnKiovLmdpdConXTtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShza2lwX3JlbmRlcikpIHtcbiAgICAgICAgICBza2lwUmVuZGVyTGlzdC5wdXNoKC4uLnNraXBfcmVuZGVyKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygc2tpcF9yZW5kZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgaWYgKHNraXBfcmVuZGVyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNraXBSZW5kZXJMaXN0LnB1c2goc2tpcF9yZW5kZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvc3RzID0gWy4uLmxvY2Fscy5nZXQoJ3BhZ2VzJykudG9BcnJheSgpLCAuLi5sb2NhbHMuZ2V0KCdwb3N0cycpLnRvQXJyYXkoKV1cbiAgICAgICAgICAuZmlsdGVyKChwb3N0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcG9zdC5zaXRlbWFwICE9PSBmYWxzZSAmJiAhaXNNYXRjaChwb3N0LnNvdXJjZSwgc2tpcFJlbmRlckxpc3QpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChiLnVwZGF0ZWQgJiYgYS51cGRhdGVkKSByZXR1cm4gYi51cGRhdGVkLnRvRGF0ZSgpLmdldFRpbWUoKSAtIGEudXBkYXRlZC50b0RhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAocG9zdHMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdG1wbFNyYyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9zaXRlbWFwLnhtbCcpO1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IG51bmp1Y2tzLmNvbXBpbGUocmVhZEZpbGVTeW5jKHRtcGxTcmMsICd1dGYtOCcpLCBlbnYpO1xuICAgICAgICBjb25zdCB7IHRhZ3M6IHRhZ3NDZmcsIGNhdGVnb3JpZXM6IGNhdHNDZmcsIHJlbDogcmVsQ2ZnIH0gPSBzaXRlbWFwO1xuICAgICAgICBsZXQgZGF0YSA9IHRlbXBsYXRlLnJlbmRlcih7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIHBvc3RzLFxuICAgICAgICAgIHNOb3c6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdGFnczogdGFnc0NmZyA/IGxvY2Fscy5nZXQoJ3RhZ3MnKS50b0FycmF5KCkgOiBbXSxcbiAgICAgICAgICBjYXRlZ29yaWVzOiBjYXRzQ2ZnID8gbG9jYWxzLmdldCgnY2F0ZWdvcmllcycpLnRvQXJyYXkoKSA6IFtdXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlbW92ZSBibGFuayBuZXdsaW5lc1xuICAgICAgICBkYXRhID0gZGF0YS5yZXBsYWNlKC9eXFxzKltcXHJcXG5dL2dtLCAnXFxuJyk7XG5cbiAgICAgICAgLy9kYXRhID0gcHJldHRpZXIuZm9ybWF0KGRhdGEsIHsgcGFyc2VyOiAneG1sJywgcGx1Z2luczogW3htbHBsdWdpbl0sIGVuZE9mTGluZTogJ2xmJyB9KTtcblxuICAgICAgICAvLyBkdW1wXG4gICAgICAgIHdyaXRlZmlsZShqb2luKHByb2Nlc3MuY3dkKCksICd0bXAvZHVtcC9zaXRlbWFwL3NpdGVtYXAueG1sJyksIGRhdGEpO1xuXG4gICAgICAgIC8vIHdyaXRlXG4gICAgICAgIGNvbnN0IHNpdGVtYXBYbWwgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdzaXRlbWFwLnhtbCcpO1xuICAgICAgICB3cml0ZWZpbGUoc2l0ZW1hcFhtbCwgZGF0YSk7XG4gICAgICAgIGluc3RhbmNlLmxvZy5pbmZvKCdzaXRlbWFwIHdyaXR0ZW4nLCBzaXRlbWFwWG1sKTtcblxuICAgICAgICBpZiAoIXJlbENmZykgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgY29uc3QgYmFzZVVSTCA9IGNvbmZpZy51cmwuZW5kc1dpdGgoJy8nKSA/IGNvbmZpZy51cmwgOiBjb25maWcudXJsICsgJy8nO1xuICAgICAgICBjb25zdCBwdWJsaWNEaXIgPSBqb2luKGdldENvbmZpZygpLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIpO1xuICAgICAgICBndWxwXG4gICAgICAgICAgLnNyYygnKiovKi5odG1sJywgeyBjd2Q6IHB1YmxpY0RpciwgaWdub3JlOiBjb21tb25JZ25vcmUgfSlcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBzaXRlbWFwXG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpbmtbaHJlZj1cIiR7YmFzZVVSTH1zaXRlbWFwLnhtbFwiXWApLmxlbmd0aCA9PT0gMCAmJlxuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL3NpdGVtYXAueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwic2l0ZW1hcC1zaXRlLXVybFwiIHR5cGU9XCJhcHBsaWNhdGlvbi90ZXh0K3htbFwiIHJlbD1cInNpdGVtYXBcIiBocmVmPVwiJHtiYXNlVVJMfXNpdGVtYXAueG1sXCIgLz5gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgICAub25jZSgnZW5kJywgKCkgPT4gcmVzb2x2ZSgpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaXNNYXRjaChwYXRoOiBzdHJpbmcsIHBhdHRlcm5zOiBzdHJpbmcgfCByZWFkb25seSBzdHJpbmdbXSkge1xuICByZXR1cm4gbWljcm9tYXRjaC5pc01hdGNoKHBhdGgsIHBhdHRlcm5zKTtcbn1cblxuZ3VscC50YXNrKCdzaXRlbWFwJywgKCkgPT4ge1xuICByZXR1cm4gbmV3IEJsdWViaXJkKChyZXNvbHZlKSA9PiB7XG4gICAgaGV4b0dlbmVyYXRlU2l0ZW1hcCgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9","originalCode":"import Bluebird from 'bluebird';\nimport { readFileSync } from 'fs-extra';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport { default as hexo } from 'hexo';\nimport { full_url_for } from 'hexo-util';\nimport micromatch from 'micromatch';\nimport nunjucks from 'nunjucks';\nimport { EOL } from 'os';\nimport { sitemapCrawlerAsync } from 'sitemap-crawler';\nimport { join } from 'upath';\nimport { yoastSeo } from './sitemap';\nimport { array_remove_empty, array_unique } from './utils/array';\nimport { writefile } from './utils/fm';\nimport Logger from './utils/logger';\nimport noop from './utils/noop';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig, setConfig } from './_config';\n\n/*\n// read existing sitemap.txt\nconst sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\nlet sitemaps = existsSync(sitemapTXT) ? array_remove_empty(readFileSync(sitemapTXT, 'utf-8').split(/\\r?\\n/gm)) : [];\n*/\nlet sitemaps = [] as string[];\nconst crawled = new Set<string>();\nconst env = envNunjucks();\n\n/**\n * Sitemap Generator\n * @param url url to crawl\n * @param deep crawl deeper n times\n * @returns\n */\nexport function generateSitemap(url?: string | null | undefined, deep = 0) {\n  return new Bluebird((resolve: (sitemaps: string[]) => any) => {\n    const promises: Bluebird<Record<string, string[]>>[] = [];\n    if (typeof url === 'string') {\n      crawled.add(url);\n      promises.push(\n        sitemapCrawlerAsync(url, {\n          deep\n        })\n      );\n    } else {\n      crawled.add(getConfig().url);\n      promises.push(\n        sitemapCrawlerAsync(getConfig().url, {\n          deep\n        })\n      );\n    }\n    Bluebird.all(promises)\n      .then((results) => {\n        const mapped = {} as ReturnType<typeof sitemapCrawlerAsync>;\n        results.forEach((sitemap) => {\n          for (const key in sitemap) {\n            const values = sitemap[key];\n            if (key in mapped === false) {\n              mapped[key] = values;\n            } else {\n              mapped[key] = array_unique(values.concat(mapped[key]));\n            }\n          }\n        });\n\n        // dump\n        const saveto = join(process.cwd(), 'tmp/dump/sitemap/sitemap.json');\n        writefile(saveto, JSON.stringify(mapped, null, 2));\n\n        // return\n        return mapped;\n      })\n      .then(async (results) => {\n        sitemaps = array_unique(array_remove_empty(Object.values(results).flat(1).concat(sitemaps))).sort(function (\n          a,\n          b\n        ) {\n          return a === b ? 0 : a < b ? -1 : 1;\n        });\n\n        for (let i = 0; i < deep; i++) {\n          for (let ii = 0; ii < sitemaps.length; ii++) {\n            const url = sitemaps[ii];\n            if (crawled.has(url) || /.(js|ts|css|scss|txt|pdf|png|jpe?g|gif|webp)$/gi.test(url)) continue;\n\n            crawled.add(url);\n            Logger.log('[depth]', ii, url);\n            await generateSitemap(url, deep).then(() => writeSitemap());\n          }\n        }\n\n        writeSitemap(resolve);\n      });\n  });\n}\n\n/**\n * write the sitemap\n * @param callback\n */\nfunction writeSitemap(callback?: (...args: any[]) => any) {\n  let cb = noop;\n  if (callback) cb = () => callback(sitemaps);\n  const sitemapTXT = join(getConfig().cwd, getConfig().public_dir || 'public', 'sitemap.txt');\n  writefile(sitemapTXT, array_remove_empty(sitemaps).join(EOL));\n  cb.apply(this);\n}\n\nexport interface SitemapOptions {\n  path: string[];\n  tags: boolean;\n  categories: boolean;\n  rel: boolean;\n  yoast: boolean;\n}\n\nexport function hexoGenerateSitemap() {\n  return new Bluebird((resolve) => {\n    const instance = new hexo(getConfig().cwd);\n    instance.init().then(() => {\n      instance.load().then(function () {\n        env.addFilter('formatUrl', (str) => {\n          return full_url_for.call(instance, str);\n        });\n        const config = setConfig(instance.config);\n        // assign default config\n        const sitemap: SitemapOptions = Object.assign(\n          { rel: false, tags: false, categories: false, path: ['sitemap.txt', 'sitemap.xml'] },\n          config.sitemap\n        );\n\n        // Build Yoast SEO sitemap\n        // when config.yoast defined\n        if (sitemap.yoast) {\n          return yoastSeo(instance);\n        }\n\n        if (!config.sitemap) return Logger.log('[sitemap] config.sitemap not configured in _config.yml');\n        const locals = instance.locals;\n        const { skip_render } = config;\n\n        if (!sitemap.tags || !sitemap.categories) {\n          return Logger.log('[sitemap] config.sitemap.tags or config.sitemap.categories not configured in _config.yml');\n        }\n        const skipRenderList = ['**/*.js', '**/*.css', '**/.git*'];\n\n        if (Array.isArray(skip_render)) {\n          skipRenderList.push(...skip_render);\n        } else if (typeof skip_render === 'string') {\n          if (skip_render.length > 0) {\n            skipRenderList.push(skip_render);\n          }\n        }\n\n        const posts = [...locals.get('pages').toArray(), ...locals.get('posts').toArray()]\n          .filter((post) => {\n            return post.sitemap !== false && !isMatch(post.source, skipRenderList);\n          })\n          .sort((a, b) => {\n            if (b.updated && a.updated) return b.updated.toDate().getTime() - a.updated.toDate().getTime();\n            return 0;\n          });\n\n        if (posts.length <= 0) {\n          return resolve();\n        }\n\n        const tmplSrc = join(__dirname, '_config_template_sitemap.xml');\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n        const { tags: tagsCfg, categories: catsCfg, rel: relCfg } = sitemap;\n        let data = template.render({\n          config,\n          posts,\n          sNow: new Date(),\n          tags: tagsCfg ? locals.get('tags').toArray() : [],\n          categories: catsCfg ? locals.get('categories').toArray() : []\n        });\n\n        // remove blank newlines\n        data = data.replace(/^\\s*[\\r\\n]/gm, '\\n');\n\n        //data = prettier.format(data, { parser: 'xml', plugins: [xmlplugin], endOfLine: 'lf' });\n\n        // dump\n        writefile(join(process.cwd(), 'tmp/dump/sitemap/sitemap.xml'), data);\n\n        // write\n        const sitemapXml = join(getConfig().cwd, config.public_dir, 'sitemap.xml');\n        writefile(sitemapXml, data);\n        instance.log.info('sitemap written', sitemapXml);\n\n        if (!relCfg) return resolve();\n        const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n        const publicDir = join(getConfig().cwd, config.public_dir);\n        gulp\n          .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n          .pipe(\n            gulpDom(function () {\n              // auto discovery sitemap\n              if (\n                this.querySelectorAll(`link[href=\"${baseURL}sitemap.xml\"]`).length === 0 &&\n                this.querySelectorAll(`link[href=\"/sitemap.xml\"]`).length === 0\n              ) {\n                this.head.innerHTML += `<link id=\"sitemap-site-url\" type=\"application/text+xml\" rel=\"sitemap\" href=\"${baseURL}sitemap.xml\" />`;\n              }\n              //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            })\n          )\n          .pipe(gulp.dest(publicDir))\n          .once('end', () => resolve());\n      });\n    });\n  });\n}\n\nfunction isMatch(path: string, patterns: string | readonly string[]) {\n  return micromatch.isMatch(path, patterns);\n}\n\ngulp.task('sitemap', () => {\n  return new Bluebird((resolve) => {\n    hexoGenerateSitemap().then(function () {\n      resolve();\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/e1/gulpsitemap_e101e74aed6d774c00756f77ebed36bd.map","wrapperLength":82},"result":{"scriptId":"14685","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.sitemap.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":33900,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":33897,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__generator","ranges":[{"startOffset":825,"endOffset":2598,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__read","ranges":[{"startOffset":2638,"endOffset":3088,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__spreadArray","ranges":[{"startOffset":3142,"endOffset":3469,"count":0}],"isBlockCoverage":false},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":3527,"endOffset":3608,"count":9},{"startOffset":3579,"endOffset":3584,"count":4},{"startOffset":3585,"endOffset":3605,"count":5}],"isBlockCoverage":true},{"functionName":"generateSitemap","ranges":[{"startOffset":5012,"endOffset":8188,"count":0}],"isBlockCoverage":false},{"functionName":"writeSitemap","ranges":[{"startOffset":8280,"endOffset":8672,"count":0}],"isBlockCoverage":false},{"functionName":"hexoGenerateSitemap","ranges":[{"startOffset":8673,"endOffset":13477,"count":0}],"isBlockCoverage":false},{"functionName":"isMatch","ranges":[{"startOffset":13529,"endOffset":13622,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":13654,"endOffset":13816,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.commitProject = void 0;\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar upath_1 = require(\"upath\");\nrequire(\"./gulp.clean\");\nrequire(\"./gulp.deploy\");\nrequire(\"./gulp.feed\");\nrequire(\"./gulp.safelink\");\nrequire(\"./gulp.seo\");\nrequire(\"./post/copy\");\nrequire(\"./gulp.standalone\");\nvar logger_1 = __importDefault(require(\"./utils/logger\"));\n// commit current project\nfunction commitProject(finish) {\n    var gitDirs = [(0, upath_1.join)(process.cwd(), 'src-posts'), (0, upath_1.join)(process.cwd(), 'source'), process.cwd()];\n    var commit = function () {\n        if (!gitDirs.length)\n            return finish();\n        var gitDir = gitDirs[0];\n        var opt = {\n            cwd: gitDir,\n            stdio: 'inherit'\n        };\n        return (0, hexo_util_1.spawn)('git', ['add', '-A'], opt)\n            .then(function () { return (0, hexo_util_1.spawn)('git', ['commit', '-m', 'update ' + new Date()], opt); })\n            .catch(function (e) {\n            if (e instanceof Error)\n                logger_1.default.log(e.message, gitDir);\n        })\n            .finally(function () {\n            gitDirs.shift();\n            commit();\n        });\n    };\n    return commit();\n}\nexports.commitProject = commitProject;\ngulp_1.default.task('project-commit', commitProject);\nexports.default = gulp_1.default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDhDQUF3QjtBQUN4Qix1Q0FBa0M7QUFDbEMsK0JBQTZCO0FBQzdCLHdCQUFzQjtBQUN0Qix5QkFBdUI7QUFDdkIsdUJBQXFCO0FBQ3JCLDJCQUF5QjtBQUN6QixzQkFBb0I7QUFDcEIsdUJBQXFCO0FBQ3JCLDZCQUEyQjtBQUMzQiwwREFBb0M7QUFFcEMseUJBQXlCO0FBQ3pCLFNBQWdCLGFBQWEsQ0FBQyxNQUFpQztJQUM3RCxJQUFNLE9BQU8sR0FBRyxDQUFDLElBQUEsWUFBSSxFQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxXQUFXLENBQUMsRUFBRSxJQUFBLFlBQUksRUFBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDakcsSUFBTSxNQUFNLEdBQUc7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU07WUFBRSxPQUFPLE1BQU0sRUFBRSxDQUFDO1FBQ3JDLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFNLEdBQUcsR0FBRztZQUNWLEdBQUcsRUFBRSxNQUFNO1lBQ1gsS0FBSyxFQUFFLFNBQVM7U0FDakIsQ0FBQztRQUNGLE9BQU8sSUFBQSxpQkFBSyxFQUFDLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBTyxHQUFHLENBQUM7YUFDekMsSUFBSSxDQUFDLGNBQU0sT0FBQSxJQUFBLGlCQUFLLEVBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxFQUFPLEdBQUcsQ0FBQyxFQUFoRSxDQUFnRSxDQUFDO2FBQzVFLEtBQUssQ0FBQyxVQUFDLENBQUM7WUFDUCxJQUFJLENBQUMsWUFBWSxLQUFLO2dCQUFFLGdCQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDO2FBQ0QsT0FBTyxDQUFDO1lBQ1AsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2hCLE1BQU0sRUFBRSxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUM7SUFDRixPQUFPLE1BQU0sRUFBRSxDQUFDO0FBQ2xCLENBQUM7QUFwQkQsc0NBb0JDO0FBRUQsY0FBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUUzQyxrQkFBZSxjQUFJLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHBmaWxlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBndWxwIGZyb20gJ2d1bHAnO1xuaW1wb3J0IHsgc3Bhd24gfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3VwYXRoJztcbmltcG9ydCAnLi9ndWxwLmNsZWFuJztcbmltcG9ydCAnLi9ndWxwLmRlcGxveSc7XG5pbXBvcnQgJy4vZ3VscC5mZWVkJztcbmltcG9ydCAnLi9ndWxwLnNhZmVsaW5rJztcbmltcG9ydCAnLi9ndWxwLnNlbyc7XG5pbXBvcnQgJy4vcG9zdC9jb3B5JztcbmltcG9ydCAnLi9ndWxwLnN0YW5kYWxvbmUnO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuL3V0aWxzL2xvZ2dlcic7XG5cbi8vIGNvbW1pdCBjdXJyZW50IHByb2plY3RcbmV4cG9ydCBmdW5jdGlvbiBjb21taXRQcm9qZWN0KGZpbmlzaDogZ3VscC5UYXNrRnVuY3Rpb25DYWxsYmFjaykge1xuICBjb25zdCBnaXREaXJzID0gW2pvaW4ocHJvY2Vzcy5jd2QoKSwgJ3NyYy1wb3N0cycpLCBqb2luKHByb2Nlc3MuY3dkKCksICdzb3VyY2UnKSwgcHJvY2Vzcy5jd2QoKV07XG4gIGNvbnN0IGNvbW1pdCA9ICgpID0+IHtcbiAgICBpZiAoIWdpdERpcnMubGVuZ3RoKSByZXR1cm4gZmluaXNoKCk7XG4gICAgY29uc3QgZ2l0RGlyID0gZ2l0RGlyc1swXTtcbiAgICBjb25zdCBvcHQgPSB7XG4gICAgICBjd2Q6IGdpdERpcixcbiAgICAgIHN0ZGlvOiAnaW5oZXJpdCdcbiAgICB9O1xuICAgIHJldHVybiBzcGF3bignZ2l0JywgWydhZGQnLCAnLUEnXSwgPGFueT5vcHQpXG4gICAgICAudGhlbigoKSA9PiBzcGF3bignZ2l0JywgWydjb21taXQnLCAnLW0nLCAndXBkYXRlICcgKyBuZXcgRGF0ZSgpXSwgPGFueT5vcHQpKVxuICAgICAgLmNhdGNoKChlKSA9PiB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRXJyb3IpIExvZ2dlci5sb2coZS5tZXNzYWdlLCBnaXREaXIpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgZ2l0RGlycy5zaGlmdCgpO1xuICAgICAgICBjb21taXQoKTtcbiAgICAgIH0pO1xuICB9O1xuICByZXR1cm4gY29tbWl0KCk7XG59XG5cbmd1bHAudGFzaygncHJvamVjdC1jb21taXQnLCBjb21taXRQcm9qZWN0KTtcblxuZXhwb3J0IGRlZmF1bHQgZ3VscDtcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import gulp from 'gulp';\nimport { spawn } from 'hexo-util';\nimport { join } from 'upath';\nimport './gulp.clean';\nimport './gulp.deploy';\nimport './gulp.feed';\nimport './gulp.safelink';\nimport './gulp.seo';\nimport './post/copy';\nimport './gulp.standalone';\nimport Logger from './utils/logger';\n\n// commit current project\nexport function commitProject(finish: gulp.TaskFunctionCallback) {\n  const gitDirs = [join(process.cwd(), 'src-posts'), join(process.cwd(), 'source'), process.cwd()];\n  const commit = () => {\n    if (!gitDirs.length) return finish();\n    const gitDir = gitDirs[0];\n    const opt = {\n      cwd: gitDir,\n      stdio: 'inherit'\n    };\n    return spawn('git', ['add', '-A'], <any>opt)\n      .then(() => spawn('git', ['commit', '-m', 'update ' + new Date()], <any>opt))\n      .catch((e) => {\n        if (e instanceof Error) Logger.log(e.message, gitDir);\n      })\n      .finally(() => {\n        gitDirs.shift();\n        commit();\n      });\n  };\n  return commit();\n}\n\ngulp.task('project-commit', commitProject);\n\nexport default gulp;\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/c0/gulpfile_c0c9f96e795586c702c83946161b1950.map","wrapperLength":82},"result":{"scriptId":"15034","url":"D:\\Repositories\\static-blog-generator\\src\\gulpfile.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4931,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4928,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":1}],"isBlockCoverage":true},{"functionName":"commitProject","ranges":[{"startOffset":714,"endOffset":1530,"count":0}],"isBlockCoverage":false}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar fs_1 = require(\"fs\");\nvar gulp_1 = __importDefault(require(\"gulp\"));\nvar gulp_dom_1 = __importDefault(require(\"gulp-dom\"));\nvar hexo_1 = __importDefault(require(\"hexo\"));\nvar hexo_util_1 = require(\"hexo-util\");\nvar nunjucks_1 = __importDefault(require(\"nunjucks\"));\nvar upath_1 = require(\"upath\");\nvar nunjucks_env_1 = __importDefault(require(\"./utils/nunjucks-env\"));\nvar _config_1 = require(\"./_config\");\nvar env = (0, nunjucks_env_1.default)();\ngulp_1.default.task('feed', function (done) {\n    var config = (0, _config_1.getConfig)();\n    var instance = new hexo_1.default(config.cwd);\n    instance.init().then(function () {\n        instance.load().then(function () {\n            env.addFilter('formatUrl', function (str) {\n                return hexo_util_1.full_url_for.call(instance, str);\n            });\n            function build(tmplSrc, dest) {\n                var template = nunjucks_1.default.compile((0, fs_1.readFileSync)(tmplSrc, 'utf-8'), env);\n                var posts = instance.locals.get('posts');\n                posts = posts.sort('-date');\n                posts = posts.filter(function (post) {\n                    return post.draft !== true;\n                });\n                var email = config.email, feed = config.feed, urlCfg = config.url;\n                var iconCfg = feed.icon;\n                var url = urlCfg;\n                if (url[url.length - 1] !== '/')\n                    url += '/';\n                // remove broken hexo lang shortcode\n                if (url.includes(':lang/'))\n                    url = url.replace('/:lang/', '/');\n                var icon = '';\n                if (iconCfg)\n                    icon = hexo_util_1.full_url_for.call(instance, iconCfg);\n                else if (email)\n                    icon = (0, hexo_util_1.gravatar)(email, {});\n                var feed_url = hexo_util_1.full_url_for.call(instance, 'rss.xml');\n                var data = template.render({\n                    config: config,\n                    url: url,\n                    icon: icon,\n                    posts: posts,\n                    feed_url: feed_url\n                });\n                (0, fs_1.writeFileSync)(dest, data);\n            }\n            var templateRSS = (0, upath_1.join)(__dirname, '_config_template_rss.xml');\n            var destRSS = (0, upath_1.join)(config.cwd, config.public_dir, 'rss.xml');\n            build(templateRSS, destRSS);\n            var templateATOM = (0, upath_1.join)(__dirname, '_config_template_atom.xml');\n            var destATOM = (0, upath_1.join)(config.cwd, config.public_dir, 'atom.xml');\n            build(templateATOM, destATOM);\n            var baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n            var publicDir = (0, upath_1.join)(config.cwd, config.public_dir);\n            gulp_1.default\n                .src('**/*.html', { cwd: publicDir, ignore: _config_1.commonIgnore })\n                .pipe((0, gulp_dom_1.default)(function () {\n                // auto discovery rss\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"rss.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/rss.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"rss-site-url\\\" type=\\\"application/rss+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"rss.xml\\\" />\");\n                }\n                // auto discovery atom\n                if (this.querySelectorAll(\"link[href=\\\"\".concat(baseURL, \"atom.xml\\\"]\")).length === 0 &&\n                    this.querySelectorAll(\"link[href=\\\"/atom.xml\\\"]\").length === 0) {\n                    this.head.innerHTML += \"<link id=\\\"atom-site-url\\\" type=\\\"application/atom+xml\\\" rel=\\\"alternate\\\" href=\\\"\".concat(baseURL, \"atom.xml\\\" />\");\n                }\n                //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n            }))\n                .pipe(gulp_1.default.dest(publicDir))\n                .once('end', function () { return done(); });\n        });\n    });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLHlCQUF1RTtBQUN2RSw4Q0FBd0I7QUFDeEIsc0RBQStCO0FBQy9CLDhDQUF3QjtBQUN4Qix1Q0FBbUQ7QUFDbkQsc0RBQWdDO0FBQ2hDLCtCQUE2QjtBQUM3QixzRUFBK0M7QUFDL0MscUNBQW9EO0FBRXBELElBQU0sR0FBRyxHQUFHLElBQUEsc0JBQVcsR0FBRSxDQUFDO0FBRTFCLGNBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsSUFBSTtJQUM5QixJQUFNLE1BQU0sR0FBRyxJQUFBLG1CQUFTLEdBQUUsQ0FBQztJQUMzQixJQUFNLFFBQVEsR0FBRyxJQUFJLGNBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQztRQUNuQixRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLFVBQUMsR0FBRztnQkFDN0IsT0FBTyx3QkFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUM7WUFFSCxTQUFTLEtBQUssQ0FBQyxPQUE2QixFQUFFLElBQTBCO2dCQUN0RSxJQUFNLFFBQVEsR0FBRyxrQkFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFZLEVBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUV2RSxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDekMsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzVCLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsSUFB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QTRFLE9BQU8saUJBQWEsQ0FBQztpQkFDekg7Z0JBQ0Qsc0JBQXNCO2dCQUN0QixJQUNFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBYyxPQUFPLGdCQUFZLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQztvQkFDckUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDBCQUF3QixDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsRUFDNUQ7b0JBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksNEZBQThFLE9BQU8sa0JBQWMsQ0FBQztpQkFDNUg7Z0JBQ0QsdUVBQXVFO1lBQ3pFLENBQUMsQ0FBQyxDQUNIO2lCQUNBLElBQUksQ0FBQyxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2lCQUMxQixJQUFJLENBQUMsS0FBSyxFQUFFLGNBQU0sT0FBQSxJQUFJLEVBQUUsRUFBTixDQUFNLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRDpcXFJlcG9zaXRvcmllc1xcc3RhdGljLWJsb2ctZ2VuZXJhdG9yXFxzcmNcXGd1bHAuZmVlZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXRoT3JGaWxlRGVzY3JpcHRvciwgcmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCc7XG5pbXBvcnQgZ3VscERvbSBmcm9tICdndWxwLWRvbSc7XG5pbXBvcnQgaGV4byBmcm9tICdoZXhvJztcbmltcG9ydCB7IGZ1bGxfdXJsX2ZvciwgZ3JhdmF0YXIgfSBmcm9tICdoZXhvLXV0aWwnO1xuaW1wb3J0IG51bmp1Y2tzIGZyb20gJ251bmp1Y2tzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICd1cGF0aCc7XG5pbXBvcnQgZW52TnVuanVja3MgZnJvbSAnLi91dGlscy9udW5qdWNrcy1lbnYnO1xuaW1wb3J0IHsgY29tbW9uSWdub3JlLCBnZXRDb25maWcgfSBmcm9tICcuL19jb25maWcnO1xuXG5jb25zdCBlbnYgPSBlbnZOdW5qdWNrcygpO1xuXG5ndWxwLnRhc2soJ2ZlZWQnLCBmdW5jdGlvbiAoZG9uZSkge1xuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgY29uc3QgaW5zdGFuY2UgPSBuZXcgaGV4byhjb25maWcuY3dkKTtcblxuICBpbnN0YW5jZS5pbml0KCkudGhlbigoKSA9PiB7XG4gICAgaW5zdGFuY2UubG9hZCgpLnRoZW4oKCkgPT4ge1xuICAgICAgZW52LmFkZEZpbHRlcignZm9ybWF0VXJsJywgKHN0cikgPT4ge1xuICAgICAgICByZXR1cm4gZnVsbF91cmxfZm9yLmNhbGwoaW5zdGFuY2UsIHN0cik7XG4gICAgICB9KTtcblxuICAgICAgZnVuY3Rpb24gYnVpbGQodG1wbFNyYzogUGF0aE9yRmlsZURlc2NyaXB0b3IsIGRlc3Q6IFBhdGhPckZpbGVEZXNjcmlwdG9yKSB7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gbnVuanVja3MuY29tcGlsZShyZWFkRmlsZVN5bmModG1wbFNyYywgJ3V0Zi04JyksIGVudik7XG5cbiAgICAgICAgbGV0IHBvc3RzID0gaW5zdGFuY2UubG9jYWxzLmdldCgncG9zdHMnKTtcbiAgICAgICAgcG9zdHMgPSBwb3N0cy5zb3J0KCctZGF0ZScpO1xuICAgICAgICBwb3N0cyA9IHBvc3RzLmZpbHRlcigocG9zdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBwb3N0LmRyYWZ0ICE9PSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB7IGVtYWlsLCBmZWVkLCB1cmw6IHVybENmZyB9ID0gY29uZmlnO1xuICAgICAgICBjb25zdCB7IGljb246IGljb25DZmcgfSA9IGZlZWQ7XG5cbiAgICAgICAgbGV0IHVybCA9IHVybENmZztcbiAgICAgICAgaWYgKHVybFt1cmwubGVuZ3RoIC0gMV0gIT09ICcvJykgdXJsICs9ICcvJztcbiAgICAgICAgLy8gcmVtb3ZlIGJyb2tlbiBoZXhvIGxhbmcgc2hvcnRjb2RlXG4gICAgICAgIGlmICh1cmwuaW5jbHVkZXMoJzpsYW5nLycpKSB1cmwgPSB1cmwucmVwbGFjZSgnLzpsYW5nLycsICcvJyk7XG5cbiAgICAgICAgbGV0IGljb24gPSAnJztcbiAgICAgICAgaWYgKGljb25DZmcpIGljb24gPSBmdWxsX3VybF9mb3IuY2FsbChpbnN0YW5jZSwgaWNvbkNmZyk7XG4gICAgICAgIGVsc2UgaWYgKGVtYWlsKSBpY29uID0gZ3JhdmF0YXIoZW1haWwsIHt9KTtcblxuICAgICAgICBjb25zdCBmZWVkX3VybCA9IGZ1bGxfdXJsX2Zvci5jYWxsKGluc3RhbmNlLCAncnNzLnhtbCcpO1xuXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0ZW1wbGF0ZS5yZW5kZXIoe1xuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB1cmwsXG4gICAgICAgICAgaWNvbixcbiAgICAgICAgICBwb3N0cyxcbiAgICAgICAgICBmZWVkX3VybFxuICAgICAgICB9KTtcblxuICAgICAgICB3cml0ZUZpbGVTeW5jKGRlc3QsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0ZW1wbGF0ZVJTUyA9IGpvaW4oX19kaXJuYW1lLCAnX2NvbmZpZ190ZW1wbGF0ZV9yc3MueG1sJyk7XG4gICAgICBjb25zdCBkZXN0UlNTID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2RpciwgJ3Jzcy54bWwnKTtcbiAgICAgIGJ1aWxkKHRlbXBsYXRlUlNTLCBkZXN0UlNTKTtcblxuICAgICAgY29uc3QgdGVtcGxhdGVBVE9NID0gam9pbihfX2Rpcm5hbWUsICdfY29uZmlnX3RlbXBsYXRlX2F0b20ueG1sJyk7XG4gICAgICBjb25zdCBkZXN0QVRPTSA9IGpvaW4oY29uZmlnLmN3ZCwgY29uZmlnLnB1YmxpY19kaXIsICdhdG9tLnhtbCcpO1xuICAgICAgYnVpbGQodGVtcGxhdGVBVE9NLCBkZXN0QVRPTSk7XG5cbiAgICAgIGNvbnN0IGJhc2VVUkwgPSBjb25maWcudXJsLmVuZHNXaXRoKCcvJykgPyBjb25maWcudXJsIDogY29uZmlnLnVybCArICcvJztcblxuICAgICAgY29uc3QgcHVibGljRGlyID0gam9pbihjb25maWcuY3dkLCBjb25maWcucHVibGljX2Rpcik7XG4gICAgICBndWxwXG4gICAgICAgIC5zcmMoJyoqLyouaHRtbCcsIHsgY3dkOiBwdWJsaWNEaXIsIGlnbm9yZTogY29tbW9uSWdub3JlIH0pXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIGd1bHBEb20oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gYXV0byBkaXNjb3ZlcnkgcnNzXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIl1gKS5sZW5ndGggPT09IDAgJiZcbiAgICAgICAgICAgICAgdGhpcy5xdWVyeVNlbGVjdG9yQWxsKGBsaW5rW2hyZWY9XCIvcnNzLnhtbFwiXWApLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHRoaXMuaGVhZC5pbm5lckhUTUwgKz0gYDxsaW5rIGlkPVwicnNzLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL3Jzcyt4bWxcIiByZWw9XCJhbHRlcm5hdGVcIiBocmVmPVwiJHtiYXNlVVJMfXJzcy54bWxcIiAvPmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBhdXRvIGRpc2NvdmVyeSBhdG9tXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiJHtiYXNlVVJMfWF0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgIHRoaXMucXVlcnlTZWxlY3RvckFsbChgbGlua1tocmVmPVwiL2F0b20ueG1sXCJdYCkubGVuZ3RoID09PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5oZWFkLmlubmVySFRNTCArPSBgPGxpbmsgaWQ9XCJhdG9tLXNpdGUtdXJsXCIgdHlwZT1cImFwcGxpY2F0aW9uL2F0b20reG1sXCIgcmVsPVwiYWx0ZXJuYXRlXCIgaHJlZj1cIiR7YmFzZVVSTH1hdG9tLnhtbFwiIC8+YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vdGhpcy5xdWVyeVNlbGVjdG9yQWxsKCdib2R5JylbMF0uc2V0QXR0cmlidXRlKCdkYXRhLXZlcnNpb24nLCAnMS4wJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAucGlwZShndWxwLmRlc3QocHVibGljRGlyKSlcbiAgICAgICAgLm9uY2UoJ2VuZCcsICgpID0+IGRvbmUoKSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { PathOrFileDescriptor, readFileSync, writeFileSync } from 'fs';\nimport gulp from 'gulp';\nimport gulpDom from 'gulp-dom';\nimport hexo from 'hexo';\nimport { full_url_for, gravatar } from 'hexo-util';\nimport nunjucks from 'nunjucks';\nimport { join } from 'upath';\nimport envNunjucks from './utils/nunjucks-env';\nimport { commonIgnore, getConfig } from './_config';\n\nconst env = envNunjucks();\n\ngulp.task('feed', function (done) {\n  const config = getConfig();\n  const instance = new hexo(config.cwd);\n\n  instance.init().then(() => {\n    instance.load().then(() => {\n      env.addFilter('formatUrl', (str) => {\n        return full_url_for.call(instance, str);\n      });\n\n      function build(tmplSrc: PathOrFileDescriptor, dest: PathOrFileDescriptor) {\n        const template = nunjucks.compile(readFileSync(tmplSrc, 'utf-8'), env);\n\n        let posts = instance.locals.get('posts');\n        posts = posts.sort('-date');\n        posts = posts.filter((post) => {\n          return post.draft !== true;\n        });\n\n        const { email, feed, url: urlCfg } = config;\n        const { icon: iconCfg } = feed;\n\n        let url = urlCfg;\n        if (url[url.length - 1] !== '/') url += '/';\n        // remove broken hexo lang shortcode\n        if (url.includes(':lang/')) url = url.replace('/:lang/', '/');\n\n        let icon = '';\n        if (iconCfg) icon = full_url_for.call(instance, iconCfg);\n        else if (email) icon = gravatar(email, {});\n\n        const feed_url = full_url_for.call(instance, 'rss.xml');\n\n        const data = template.render({\n          config,\n          url,\n          icon,\n          posts,\n          feed_url\n        });\n\n        writeFileSync(dest, data);\n      }\n\n      const templateRSS = join(__dirname, '_config_template_rss.xml');\n      const destRSS = join(config.cwd, config.public_dir, 'rss.xml');\n      build(templateRSS, destRSS);\n\n      const templateATOM = join(__dirname, '_config_template_atom.xml');\n      const destATOM = join(config.cwd, config.public_dir, 'atom.xml');\n      build(templateATOM, destATOM);\n\n      const baseURL = config.url.endsWith('/') ? config.url : config.url + '/';\n\n      const publicDir = join(config.cwd, config.public_dir);\n      gulp\n        .src('**/*.html', { cwd: publicDir, ignore: commonIgnore })\n        .pipe(\n          gulpDom(function () {\n            // auto discovery rss\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}rss.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/rss.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"rss-site-url\" type=\"application/rss+xml\" rel=\"alternate\" href=\"${baseURL}rss.xml\" />`;\n            }\n            // auto discovery atom\n            if (\n              this.querySelectorAll(`link[href=\"${baseURL}atom.xml\"]`).length === 0 &&\n              this.querySelectorAll(`link[href=\"/atom.xml\"]`).length === 0\n            ) {\n              this.head.innerHTML += `<link id=\"atom-site-url\" type=\"application/atom+xml\" rel=\"alternate\" href=\"${baseURL}atom.xml\" />`;\n            }\n            //this.querySelectorAll('body')[0].setAttribute('data-version', '1.0');\n          })\n        )\n        .pipe(gulp.dest(publicDir))\n        .once('end', () => done());\n    });\n  });\n});\n","sourceMapPath":"D:/Repositories/static-blog-generator/tmp/jest/jest-transform-cache-f9ecad479997addbdc747e754606e3b7-57ee97693e12897f2e1746fb4faeafbf/21/gulpfeed_218d054d70d3561ba89867e4695c6976.map","wrapperLength":82},"result":{"scriptId":"15035","url":"D:\\Repositories\\static-blog-generator\\src\\gulp.feed.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":13306,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":13303,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":5},{"startOffset":204,"endOffset":209,"count":2},{"startOffset":210,"endOffset":230,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":778,"endOffset":4330,"count":0}],"isBlockCoverage":false}]}}]}],"wasInterrupted":false,"config":{"bail":0,"changedFilesWithAncestor":false,"ci":false,"collectCoverage":true,"collectCoverageFrom":["src/*.{js,ts}","!**/node_modules/**","!**/vendor/**","!**/test/**","!**/*.test.{js,ts}"],"coverageDirectory":"D:\\Repositories\\static-blog-generator\\coverage","coverageProvider":"v8","coverageReporters":["json","text","lcov","clover"],"detectLeaks":false,"detectOpenHandles":true,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":false,"json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":1,"noStackTrace":false,"nonFlagArgs":[],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["D:\\Repositories\\static-blog-generator\\node_modules\\jest-html-reporters\\index.js",{"publicPath":"./coverage/html-report","filename":"report.html","openReport":false}]],"rootDir":"D:\\Repositories\\static-blog-generator","runTestsByPath":false,"seed":143967257,"skipFilter":false,"snapshotFormat":{"escapeString":false,"printBasicPrototype":false},"testFailureExitCode":1,"testPathPattern":"","testSequencer":"D:\\Repositories\\static-blog-generator\\node_modules\\@jest\\test-sequencer\\build\\index.js","updateSnapshot":"new","useStderr":false,"verbose":false,"watch":false,"watchAll":false,"watchman":true,"coverageLinkPath":"..\\lcov-report\\index.html"},"endTime":1673237886009,"_reporterOptions":{"publicPath":"./coverage/html-report","filename":"report.html","expand":false,"pageTitle":"","hideIcon":false,"testCommand":"npx jest","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false,"urlForTestFiles":""},"attachInfos":{}})